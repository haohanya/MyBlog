<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8" />
<title>Spring-Security - 浩瀚</title>
<meta name="description" content="浩瀚-每天向往着外面的世界">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

<link type='text/css' rel='stylesheet' href='https://haohanya.github.io/styles/main.css' media='screen' />
<link type="text/css" rel="stylesheet" href="https://cdn.bootcss.com/KaTeX/0.11.1/katex.min.css">
<link type="text/css" rel="stylesheet" href="https://cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css">

<script type="text/javascript" src='https://haohanya.github.io/media/scripts/jquery.js'></script>
<script type="text/javascript" src="https://cdn.bootcss.com/highlight.js/9.15.10/highlight.min.js"></script>

<script>
    hljs.initHighlightingOnLoad();
</script>
</head>

<body>
  <div class="layout theme-dark">
    <div class="layout-header">

	<div class="layout-header-main">
		<div class="container">
			<div class="row justify-content-lg-center">
				<div class="col-12 col-lg-9">

					<div class="navbar">

						<div class="logo">
							<a href="https://haohanya.github.io">
								<img class="logo"
									src="https://haohanya.github.io/media/images/site_avatar.png?v=1593173921588"
									alt="">
							</a>
						</div>

						<div class="menu d-md-inline-block d-none">
							<ul class="layout-navigation-list">
								
								<li class="layout-navigation-item"><a title="首页"
										href="/">首页</a>
								</li>
								
								<li class="layout-navigation-item"><a title="归档"
										href="/archives">归档</a>
								</li>
								
								<li class="layout-navigation-item"><a title="标签"
										href="/tags">标签</a>
								</li>
								
								<li class="layout-navigation-item"><a title="关于"
										href="/post/about">关于</a>
								</li>
								
							</ul>
						</div>

						<div class="item d-md-inline-block d-none">
							<div class="search-icon">
								<i class="fa fa-search" aria-hidden="true"></i>
							</div>
						</div>



						<div class="d-md-inline-block d-none">
							<div class="search-lightbox">
								<div class="search-body">

									<form id="gridea-search-form" data-update="1593173921588" action="/search/" class="search-form">
										<input type="text" name="q" id="s" value="" class="search-field" placeholder="请输入搜索关键词" aria-label="请输入搜索关键词" required="">
										<button type="submit" class="submit" aria-label="Submit">
											<i class="fa fa-search" aria-hidden="true"></i>
										</button>
									</form>

								</div>
							</div>
						</div>

						<div class="nav d-md-none d-inline-block">
							<div class="trigger">
								<i class="fa fa-bars layout-btn-toggle" aria-hidden="true"></i>
							</div>
						</div>

					</div>

				</div>
			</div>




		</div>
	</div>

</div>
    <div class="layout-collapse d-md-none">
	<div class="layout-collapse-main">
		<ul class="layout-collapse-list">
			
			<li class="layout-collapse-item"><a title="首页" href="/">首页</a></li>
			
			<li class="layout-collapse-item"><a title="归档" href="/archives">归档</a></li>
			
			<li class="layout-collapse-item"><a title="标签" href="/tags">标签</a></li>
			
			<li class="layout-collapse-item"><a title="关于" href="/post/about">关于</a></li>
			

		</ul>
	</div>
</div>

    <div class="layout-content">
      <div class="layout-content-main">
        <div class="container">
          <div class="row justify-content-lg-center">
            <div class="col-12 col-lg-9">
              <div class="layout-post">
                <div class="layout-post-body">
                  <div class="row">

                    <div class="col-12 col-lg-10">
                      <div class="layout-post-main m-right m-md-right">
                        <div class="layout-post-header">
                          <h1 class="layout-post-title">Spring-Security</h1>
                          <div class="layout-post-meta">
                            <div class="item">
                               <a href="https://haohanya.github.io/tag/YYffL2EXa/" class="post--keyword"
                                data-title="spring-security" data-type="post_tag" data-term-id="39">spring-security</a>
                               <a href="https://haohanya.github.io/tag/POgCfBu13Z/" class="post--keyword"
                                data-title="spring" data-type="post_tag" data-term-id="39">spring</a>
                              
                            </div>
                            <div class="item">
                              <span>2020-05-04</span>
                            </div>
                          </div>
                        </div>
                        <div class="layout-post-content">
                          <div class="layout-post-item">
                            
                            <h2 id="spring-security简介">Spring Security简介</h2>
<blockquote>
<p>Spring Security是一个能够为基于Spring的企业应用系统提供声明式的安全访问控制解决方案的安全框架。它提供了一组可以在Spring应用上下文中配置的Bean，充分利用了Spring IoC，DI（控制反转Inversion of Control ,DI:Dependency Injection 依赖注入）和AOP（面向切面编程）功能，为应用系统提供声明式的安全访问控制功能，减少了为企业系统安全控制编写大量重复代码的工作。</p>
</blockquote>
<h2 id="单机版">单机版</h2>
<p>1.引入依赖</p>
<pre><code class="language-xml"> &lt;!-- 身份验证 --&gt;
&lt;dependency&gt;
    &lt;groupId&gt;org.springframework.security&lt;/groupId&gt;
    &lt;artifactId&gt;spring-security-web&lt;/artifactId&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
    &lt;groupId&gt;org.springframework.security&lt;/groupId&gt;
    &lt;artifactId&gt;spring-security-config&lt;/artifactId&gt;
&lt;/dependency&gt;
</code></pre>
<!-- more -->
<p>2.配置核心配置文件</p>
<pre><code class="language-xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;beans:beans xmlns=&quot;http://www.springframework.org/schema/security&quot;
             xmlns:beans=&quot;http://www.springframework.org/schema/beans&quot;
             xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
             xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
						http://www.springframework.org/schema/security http://www.springframework.org/schema/security/spring-security.xsd&quot;&gt;
    &lt;!-- 以下页面不被拦截 --&gt;
    &lt;http pattern=&quot;/login.html&quot; security=&quot;none&quot;/&gt;
    &lt;http pattern=&quot;/css/**&quot; security=&quot;none&quot;/&gt;
    &lt;http pattern=&quot;/img/**&quot; security=&quot;none&quot;/&gt;
    &lt;http pattern=&quot;/js/**&quot; security=&quot;none&quot;/&gt;
    &lt;http pattern=&quot;/plugins/**&quot; security=&quot;none&quot;/&gt;

    &lt;!--
            页面拦截规则
                use-expressions:是否启用spel表达式, 如果为true那么access=&quot;hasRole('ROLE_USER')&quot;
        --&gt;
    &lt;!-- 页面拦截规则 --&gt;
    &lt;http use-expressions=&quot;false&quot;&gt;
        &lt;!--
            pattern : 拦截的url
            access : 拥有如下权限允许访问
        --&gt;
        &lt;intercept-url pattern=&quot;/**&quot; access=&quot;ROLE_ADMIN&quot; /&gt;
        &lt;!--
            login-page : 自定义登陆页面
            default-target-url : 登陆成功后跳转的页面,不设定默认跳转上一次访问的页面
            authentication-failure-url : 登陆失败时跳转的url
            always-use-default-target : 登陆成功后 总是跳转到 default-target-url 设定的url
        --&gt;
        &lt;form-login login-page=&quot;/login.html&quot;  default-target-url=&quot;/admin/index.html&quot; authentication-failure-url=&quot;/login.html&quot; always-use-default-target=&quot;true&quot;/&gt;
        &lt;csrf disabled=&quot;true&quot;/&gt;

        &lt;!--
            logout-url : 退出的地址
            logout-success-url : 退出后跳转的地址
        --&gt;
        &lt;logout logout-url=&quot;/logout&quot; logout-success-url=&quot;/login.html&quot;/&gt;
        &lt;!--
            如果使用了iframe,需要指定框架页的策略为 SAMEORIGIN
        --&gt;
        &lt;headers&gt;
            &lt;frame-options policy=&quot;SAMEORIGIN&quot;/&gt;  &lt;!--允许使用frameset --&gt;
        &lt;/headers&gt;
    &lt;/http&gt;

    &lt;!--认证管理器--&gt;
    &lt;authentication-manager&gt;
        &lt;authentication-provider&gt;
            &lt;user-service&gt;
                &lt;!--用户名和密码,权限--&gt;
                &lt;user name=&quot;root&quot; password=&quot;root&quot; authorities=&quot;ROLE_ADMIN&quot;/&gt;
            &lt;/user-service&gt;
        &lt;/authentication-provider&gt;
    &lt;/authentication-manager&gt;

&lt;/beans:beans&gt;

</code></pre>
<p>3.配置web.xml</p>
<pre><code class="language-xml">&lt;context-param&gt;
    &lt;param-name&gt;contextConfigLocation&lt;/param-name&gt;
    &lt;param-value&gt;classpath:spring/spring-security.xml&lt;/param-value&gt;
&lt;/context-param&gt;
&lt;listener&gt;
    &lt;listener-class&gt;
        org.springframework.web.context.ContextLoaderListener
    &lt;/listener-class&gt;
&lt;/listener&gt;
&lt;filter&gt;
    &lt;filter-name&gt;springSecurityFilterChain&lt;/filter-name&gt;
    &lt;filter-class&gt;org.springframework.web.filter.DelegatingFilterProxy&lt;/filter-class&gt;
&lt;/filter&gt;
&lt;filter-mapping&gt;
    &lt;filter-name&gt;springSecurityFilterChain&lt;/filter-name&gt;
    &lt;url-pattern&gt;/*&lt;/url-pattern&gt;
&lt;/filter-mapping&gt;
</code></pre>
<h2 id="连接数据库">连接数据库</h2>
<p>1.引入依赖</p>
<p>2.实现UserDetailsService接口</p>
<pre><code class="language-java">package com.jd.shop.service.impl;

import com.jd.pojo.TbSeller;
import com.jd.sellergoods.service.TbSellerService;
import org.springframework.security.core.GrantedAuthority;
import org.springframework.security.core.authority.SimpleGrantedAuthority;
import org.springframework.security.core.userdetails.User;
import org.springframework.security.core.userdetails.UserDetails;
import org.springframework.security.core.userdetails.UserDetailsService;
import org.springframework.security.core.userdetails.UsernameNotFoundException;

import java.util.ArrayList;
import java.util.List;

/**
 * 认证类
 * @program: jd
 * @author: 潘
 * @create: 2020-04-29 22:43
 **/
public class UserDetailsServiceImpl implements UserDetailsService{

    private TbSellerService tbSellerService;

    public void setTbSellerService(TbSellerService tbSellerService) {
        this.tbSellerService = tbSellerService;
    }

    @Override
    public UserDetails loadUserByUsername(String username) throws UsernameNotFoundException {

        if(username == null){
            return null;
        }

        TbSeller byId = tbSellerService.findById(username);

        if(byId == null){
            return null;
        }

        //构建角色列表
        List&lt;GrantedAuthority&gt; list = new ArrayList&lt;&gt;();

        //用户的权限集合
        list.add(new SimpleGrantedAuthority(&quot;ROLE_USER&quot;));

        return new User(username,byId.getPassword(),list);
    }
}

</code></pre>
<p>3.配置核心配置文件</p>
<pre><code class="language-xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;beans:beans xmlns=&quot;http://www.springframework.org/schema/security&quot;
             xmlns:beans=&quot;http://www.springframework.org/schema/beans&quot;
             xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
             xmlns:dubbo=&quot;http://code.alibabatech.com/schema/dubbo&quot;
             xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
						http://www.springframework.org/schema/security http://www.springframework.org/schema/security/spring-security.xsd http://code.alibabatech.com/schema/dubbo http://code.alibabatech.com/schema/dubbo/dubbo.xsd&quot;&gt;
    &lt;!-- 以下页面不被拦截 --&gt;
    &lt;http pattern=&quot;/login.html&quot; security=&quot;none&quot;/&gt;
    &lt;http pattern=&quot;/css/**&quot; security=&quot;none&quot;/&gt;
    &lt;http pattern=&quot;/img/**&quot; security=&quot;none&quot;/&gt;
    &lt;http pattern=&quot;/js/**&quot; security=&quot;none&quot;/&gt;
    &lt;http pattern=&quot;/plugins/**&quot; security=&quot;none&quot;/&gt;
    &lt;http pattern=&quot;/*.html&quot; security=&quot;none&quot;/&gt;
&lt;!--    &lt;http pattern=&quot;/login&quot; security=&quot;none&quot;/&gt;--&gt;

    &lt;!--
            页面拦截规则
                use-expressions:是否启用spel表达式, 如果为true那么access=&quot;hasRole('ROLE_USER')&quot;
        --&gt;
    &lt;!-- 页面拦截规则 --&gt;
    &lt;http use-expressions=&quot;false&quot;&gt;
        &lt;!--
            pattern : 拦截的url
            access : 拥有如下权限允许访问
        --&gt;
        &lt;intercept-url pattern=&quot;/**&quot; access=&quot;ROLE_USER&quot; /&gt;
        &lt;!--
            login-page : 自定义登陆页面
            default-target-url : 登陆成功后跳转的页面,不设定默认跳转上一次访问的页面
            authentication-failure-url : 登陆失败时跳转的url
            always-use-default-target : 登陆成功后 总是跳转到 default-target-url 设定的url
        --&gt;
        &lt;form-login login-processing-url=&quot;/login&quot; login-page=&quot;/shoplogin.html&quot;  default-target-url=&quot;/admin/index.html&quot; authentication-failure-url=&quot;/shoplogin.html&quot; always-use-default-target=&quot;true&quot;/&gt;
        &lt;csrf disabled=&quot;true&quot;/&gt;

        &lt;!--
            logout-url : 退出的地址
            logout-success-url : 退出后跳转的地址
        --&gt;
        &lt;logout logout-url=&quot;/logout&quot; logout-success-url=&quot;/shoplogin.html&quot;/&gt;
        &lt;!--
            如果使用了iframe,需要指定框架页的策略为 SAMEORIGIN
        --&gt;
        &lt;headers&gt;
            &lt;frame-options policy=&quot;SAMEORIGIN&quot;/&gt;  &lt;!--允许使用frameset --&gt;
        &lt;/headers&gt;
    &lt;/http&gt;

    &lt;!--认证管理器--&gt;
    &lt;authentication-manager&gt;
        &lt;authentication-provider user-service-ref=&quot;userDetailsServiceImpl&quot;/&gt;
    &lt;/authentication-manager&gt;

    &lt;!-- 引用dubbo 服务 --&gt;
    &lt;dubbo:application name=&quot;jd-shop-web&quot; /&gt;
    &lt;dubbo:registry address=&quot;zookeeper://47.98.157.69:2181&quot; timeout=&quot;30000&quot;/&gt;
    &lt;dubbo:annotation package=&quot;com.jd.shop.controller&quot; /&gt;
    
    &lt;dubbo:reference interface=&quot;com.jd.sellergoods.service.TbSellerService&quot; id=&quot;tbSellerService&quot;/&gt;

    &lt;beans:bean id=&quot;userDetailsServiceImpl&quot; class=&quot;com.jd.shop.service.impl.UserDetailsServiceImpl&quot;&gt;
        &lt;beans:property name=&quot;tbSellerService&quot; ref=&quot;tbSellerService&quot;/&gt;
    &lt;/beans:bean&gt;

&lt;/beans:beans&gt;

</code></pre>
<p>4.配置web.xml文件</p>
<h2 id="brcy加密">Brcy加密</h2>
<p>1.编写java</p>
<pre><code class="language-java">BCryptPasswordEncoder passwordEncoder = new BCryptPasswordEncoder();
String encode = passwordEncoder.encode(tbSeller.getPassword());
</code></pre>
<p>2.编写配置文件</p>
<pre><code class="language-xml">&lt;!--认证管理器--&gt;
&lt;authentication-manager&gt;
    &lt;authentication-provider user-service-ref=&quot;userDetailsServiceImpl&quot;&gt;
        &lt;!-- 这句话表示在登陆时使用bcry加密验证 --&gt;
        &lt;password-encoder ref=&quot;bCryptPasswordEncoder&quot;/&gt;
    &lt;/authentication-provider&gt;
&lt;/authentication-manager&gt;
&lt;!--配置加密,在认证管理器中引用--&gt;
&lt;beans:bean id=&quot;bCryptPasswordEncoder&quot; class=&quot;org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder&quot;/&gt;
</code></pre>
<h2 id="记住我">记住我</h2>
<pre><code class="language-html">&lt;input value=&quot;1&quot; name=&quot;remember-me&quot;/&gt;

</code></pre>

                          </div>
                        </div>
                        <div class="layout-post-social">
                          <div class="item reader">
                            <div id="/post/spring-security/" class="leancloud-visitors view"
                              data-flag-title="Spring-Security">
                              <span class="post-meta-item-text">阅读 </span>
                              <span class="leancloud-visitors-count"></span>
                            </div>
                          </div>
                        </div>

                        <div class="layout-post-navigation">
                          <div class="navigation-list">
                            
                            <div class="post-card row">
                              
                              <div class="card-content col-12">
                                <div class="card-body">
                                  <div class="header">
                                    <a href="https://haohanya.github.io/post/solr-an-zhuang-shi-yong/" class="title">
                                      <h4>solr安装使用</h4>
                                    </a>
                                  </div>
                                  <div class="inner">
                                    <div class="abstract">
                                      
                                    </div>
                                  </div>
                                </div>
                                <div class="card-footer">
                                  <div class="item"><span>上一篇</span></div>
                                  <div class="item">2020-05-12</div>
                                </div>
                              </div>
                              
                            </div>

                            <div class="post-card row">
                              
                              <div class="card-content col-12">
                                <div class="card-body">
                                  <div class="header">
                                    <a href="https://haohanya.github.io/post/mybatis/" class="title">
                                      <h4>MyBatis</h4>
                                    </a>
                                  </div>
                                  <div class="inner">
                                    <div class="abstract">
                                      
                                    </div>
                                  </div>
                                </div>
                                <div class="card-footer">
                                  <div class="item"><span>下一篇</span></div>
                                  <div class="item">2020-05-04</div>
                                </div>
                              </div>
                              
                            </div>

                            
                          </div>
                        </div>

                        <div class="layout-comments"></div>
                        
                      </div>
                    </div>

                    <div class="col-12 col-lg-2 d-none d-lg-block">
                      <div class="layout-post-sidebar">
                        <div class="layout-sidebar-item">
                          <ul class="markdownIt-TOC">
<li>
<ul>
<li><a href="#spring-security%E7%AE%80%E4%BB%8B">Spring Security简介</a></li>
<li><a href="#%E5%8D%95%E6%9C%BA%E7%89%88">单机版</a></li>
<li><a href="#%E8%BF%9E%E6%8E%A5%E6%95%B0%E6%8D%AE%E5%BA%93">连接数据库</a></li>
<li><a href="#brcy%E5%8A%A0%E5%AF%86">Brcy加密</a></li>
<li><a href="#%E8%AE%B0%E4%BD%8F%E6%88%91">记住我</a></li>
</ul>
</li>
</ul>

                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="layout-totop d-none"><i class="fa fa-angle-up" aria-hidden="true"></i></div>

    	<div class="layout-footer">

		<div class="container">
			<div class="row justify-content-lg-center">
				<div class="col-12 col-lg-9">
					<div class="footer">
						<div class="row">
							<div class="col-12 col-md-9">
								<div class="footer-copy">
									
									Powered by <a href="https://github.com/getgridea/gridea" target="_blank">Gridea</a>
									<div class="footer-icp d-none d-sm-inline-block">
										<span class="px-2">⋅</span>
										
									</div>
								</div>
							</div>
							<div class="col-sm-3 d-none d-md-block">
								<div class="footer-links">
									
									
									
									
									
									
									
									
									
									
									
									
									
									
									
									
									
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>

	</div>

	<script type="text/javascript" src='https://haohanya.github.io/media/scripts/main.js'></script>
	

  </div>
</body>

</html>