<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8" />
<title>solr安装使用 - 浩瀚</title>
<meta name="description" content="浩瀚-每天向往着外面的世界">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

<link type='text/css' rel='stylesheet' href='https://haohanya.github.io/styles/main.css' media='screen' />
<link type="text/css" rel="stylesheet" href="https://cdn.bootcss.com/KaTeX/0.11.1/katex.min.css">
<link type="text/css" rel="stylesheet" href="https://cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css">

<script type="text/javascript" src='https://haohanya.github.io/media/scripts/jquery.js'></script>
<script type="text/javascript" src="https://cdn.bootcss.com/highlight.js/9.15.10/highlight.min.js"></script>

<script>
    hljs.initHighlightingOnLoad();
</script>
</head>

<body>
  <div class="layout theme-dark">
    <div class="layout-header">

	<div class="layout-header-main">
		<div class="container">
			<div class="row justify-content-lg-center">
				<div class="col-12 col-lg-9">

					<div class="navbar">

						<div class="logo">
							<a href="https://haohanya.github.io">
								<img class="logo"
									src="https://haohanya.github.io/media/images/site_avatar.png?v=1593174218272"
									alt="">
							</a>
						</div>

						<div class="menu d-md-inline-block d-none">
							<ul class="layout-navigation-list">
								
								<li class="layout-navigation-item"><a title="首页"
										href="/">首页</a>
								</li>
								
								<li class="layout-navigation-item"><a title="归档"
										href="/archives">归档</a>
								</li>
								
								<li class="layout-navigation-item"><a title="标签"
										href="/tags">标签</a>
								</li>
								
								<li class="layout-navigation-item"><a title="关于"
										href="/post/about">关于</a>
								</li>
								
								<li class="layout-navigation-item"><a title="友情链接"
										href="https://ucuser.cn/links/">友情链接</a>
								</li>
								
							</ul>
						</div>

						<div class="item d-md-inline-block d-none">
							<div class="search-icon">
								<i class="fa fa-search" aria-hidden="true"></i>
							</div>
						</div>



						<div class="d-md-inline-block d-none">
							<div class="search-lightbox">
								<div class="search-body">

									<form id="gridea-search-form" data-update="1593174218272" action="/search/" class="search-form">
										<input type="text" name="q" id="s" value="" class="search-field" placeholder="请输入搜索关键词" aria-label="请输入搜索关键词" required="">
										<button type="submit" class="submit" aria-label="Submit">
											<i class="fa fa-search" aria-hidden="true"></i>
										</button>
									</form>

								</div>
							</div>
						</div>

						<div class="nav d-md-none d-inline-block">
							<div class="trigger">
								<i class="fa fa-bars layout-btn-toggle" aria-hidden="true"></i>
							</div>
						</div>

					</div>

				</div>
			</div>




		</div>
	</div>

</div>
    <div class="layout-collapse d-md-none">
	<div class="layout-collapse-main">
		<ul class="layout-collapse-list">
			
			<li class="layout-collapse-item"><a title="首页" href="/">首页</a></li>
			
			<li class="layout-collapse-item"><a title="归档" href="/archives">归档</a></li>
			
			<li class="layout-collapse-item"><a title="标签" href="/tags">标签</a></li>
			
			<li class="layout-collapse-item"><a title="关于" href="/post/about">关于</a></li>
			
			<li class="layout-collapse-item"><a title="友情链接" href="https://ucuser.cn/links/">友情链接</a></li>
			

		</ul>
	</div>
</div>

    <div class="layout-content">
      <div class="layout-content-main">
        <div class="container">
          <div class="row justify-content-lg-center">
            <div class="col-12 col-lg-9">
              <div class="layout-post">
                <div class="layout-post-body">
                  <div class="row">

                    <div class="col-12 col-lg-10">
                      <div class="layout-post-main m-right m-md-right">
                        <div class="layout-post-header">
                          <h1 class="layout-post-title">solr安装使用</h1>
                          <div class="layout-post-meta">
                            <div class="item">
                               <a href="https://haohanya.github.io/tag/D-nvo_2ol/" class="post--keyword"
                                data-title="solr" data-type="post_tag" data-term-id="39">solr</a>
                              
                            </div>
                            <div class="item">
                              <span>2020-05-12</span>
                            </div>
                          </div>
                        </div>
                        <div class="layout-post-content">
                          <div class="layout-post-item">
                            
                            <h2 id="什么是solr">什么是Solr</h2>
<blockquote>
<p>大多数搜索引擎应用都必须具有某种搜索功能，问题是搜索功能往往是巨大的资源消耗并且它们由于沉重的数据库加载而拖垮你的应用的性能。</p>
<p>这就是为什么转移负载到一个外部的搜索服务器是一个不错的主意，Apache Solr是一个流行的开源搜索服务器，它通过使用类似REST的HTTP API，这就确保你能从几乎任何编程语言来使用solr。</p>
<p>Solr是一个开源搜索平台，用于构建搜索应用程序。 它建立在Lucene(全文搜索引擎)之上。 Solr是企业级的，快速的和高度可扩展的。 使用Solr构建的应用程序非常复杂，可提供高性能。</p>
<p>为了在CNET网络的公司网站上添加搜索功能，Yonik Seely于2004年创建了Solr。并在2006年1月，它成为Apache软件基金会下的一个开源项目。并于2016年发布最新版本Solr 6.0，支持并行SQL查询的执行。</p>
<p>Solr可以和Hadoop一起使用。由于Hadoop处理大量数据，Solr帮助我们从这么大的源中找到所需的信息。不仅限于搜索，Solr也可以用于存储目的。像其他NoSQL数据库一样，它是一种非关系数据存储和处理技术。</p>
<p>总之，Solr是一个可扩展的，可部署，搜索/存储引擎，优化搜索大量以文本为中心的数据。</p>
</blockquote>
<h2 id="solr安装">solr安装</h2>
<h3 id="1-上传文件">1 上传文件</h3>
<p>apache-tomcat-7.0.82.tar.gz</p>
<p>solr-4.10.3.tgz.tgz</p>
<p>IK Analyzer 2012FF_hf1</p>
<h3 id="2-创建目录">2 创建目录</h3>
<p>mkdir /usr/soft/solr</p>
<h3 id="3-解压tomcat并移动到solr目录">3 解压tomcat并移动到solr目录</h3>
<p>tar -zxvf apache-tomcat-7.0.82.tar.gz</p>
<p>mv apache-tomcat-7.0.82 /usr/soft/solr/tomcat7</p>
<p>tar -zxvf solr-4.10.3.tgz.tgz</p>
<p>在solr-4.10.3/dist目录下有一个war包 需要把war包移动到tomcat里运行</p>
<p>cp ~/solr-4.10.3/dist/solr-4.10.3.war /usr/soft/solr/tomcat7/webapps/solr.war</p>
<h3 id="4-启动tomcat">4 启动tomcat</h3>
<p>cd /usr/soft/solr/tomcat7</p>
<p>./bin/startup.sh</p>
<p>查看tomcat日志(可选)</p>
<p>tail -f logs/catalina.out</p>
<h3 id="5-引入依赖jar包">5 引入依赖jar包</h3>
<p>cd ~/solr-4.10.3/example/lib/ext</p>
<p>cp * /usr/soft/solr/tomcat7/webapps/solr/WEB-INF/lib</p>
<h3 id="6-复制配置文件">6 复制配置文件</h3>
<p>cd ~/solr-4.10.3/example</p>
<p>cp -r solr /usr/soft/solr/solrhome</p>
<h3 id="7-solr和solrhome建立联系">7 solr和solrhome建立联系</h3>
<p>cd /usr/soft/solr/tomcat7/webapps/solr/WEB-INF</p>
<p>vi web.xml</p>
<p>/usr/soft/solr/solrhome</p>
<pre><code class="language-xml">&lt;env-entry&gt;
	&lt;env-entry-name&gt;solr/home&lt;/env-entry-name&gt;
    &lt;!-- 这里设置为自己的solrhome路径 --&gt;
    &lt;env-entry-value&gt;/usr/soft/solr/solrhome&lt;/env-entry-value&gt;
    &lt;env-entry-type&gt;java.lang.String&lt;/env-entry-type&gt;
&lt;/env-entry&gt;
</code></pre>
<p>:wq</p>
<h3 id="8-重启-tomcat">8 重启 tomcat</h3>
<p>cd /usr/soft/solr/tomcat7/bin</p>
<p>./shutdown.sh</p>
<p>./startup.sh</p>
<h3 id="9-访问solr">9 访问solr</h3>
<p>http://192.168.25.132:8080/solr/</p>
<h2 id="配置ik分词器">配置IK分词器</h2>
<h3 id="ik-analyzer简介">IK Analyzer简介</h3>
<blockquote>
<p>IK Analyzer 是一个开源的，基亍 java 语言开发的轻量级的中文分词工具包。从 2006年 12 月推出 1.0 版开始， IKAnalyzer 已经推出了 4 个大版本。最初，它是以开源项目Luence 为应用主体的，结合词典分词和文法分析算法的中文分词组件。从 3.0 版本开始，IK 发展为面向 Java 的公用分词组件，独立亍 Lucene 项目，同时提供了对 Lucene 的默认优化实现。在 2012 版本中，IK 实现了简单的分词歧义排除算法，标志着 IK 分词器从单纯的词典分词向模拟语义分词衍化。</p>
</blockquote>
<h3 id="1-将ik分词器jar包移动到solr中">1 将ik分词器jar包移动到solr中</h3>
<p>cp ~/IK\ Analyzer\ 2012FF_hf1/IKAnalyzer2012FF_u1.jar /usr/soft/solr/tomcat7/webapps/solr/WEB-INF/lib</p>
<h3 id="2-在solr项目的web-inf-目录创建一个classes目录">2 在solr项目的WEB-INF 目录创建一个classes目录</h3>
<p>mkdir /usr/soft/solr/tomcat7/webapps/solr/WEB-INF/classes</p>
<h3 id="3-移动配置文件到classes目录">3 移动配置文件到classes目录</h3>
<p>cp IKAnalyzer.cfg.xml ext_stopword.dic mydict.dic /usr/soft/solr/tomcat7/webapps/solr/WEB-INF/classes</p>
<h3 id="4-启用-编辑配置文件">4 启用---编辑配置文件</h3>
<p>使用npp编辑服务器上的文件</p>
<p>1 安装npp (略)</p>
<p>2  安装NppFTP(略)</p>
<p>3 连接服务器 (虐)</p>
<p>4 编辑xml文件 : /usr/soft/solr/solrhome/collection1/conf/schema.xml</p>
<pre><code class="language-xml">&lt;!-- 配置IK分词器 --&gt;
&lt;fieldType name=&quot;text_ik&quot; class=&quot;solr.TextField&quot;&gt;
    &lt;analyzer class=&quot;org.wltea.analyzer.lucene.IKAnalyzer&quot;&gt;&lt;/analyzer&gt;
&lt;/fieldType&gt;
</code></pre>
<p>5 重启tomcat</p>
<p>cd /usr/soft/solr/tomcat7/bin</p>
<p>./shutdown.sh</p>
<p>./startup.sh</p>
<p>6 访问url</p>
<p>http://192.168.25.132:8080/solr/</p>
<h2 id="域">域</h2>
<p>域 : 相当于数据库表的字段</p>
<pre><code class="language-xml">&lt;!--
	name : 指定域的名称
	type : 指定域的类型
	indexed : 是否索引
	stored : 是否存储
	required : 是否必须
	multiValued : 是否多值
--&gt;
&lt;field name=&quot;id&quot; type=&quot;string&quot; indexed=&quot;true&quot; stored=&quot;true&quot; required=&quot;true&quot; multiValued=&quot;false&quot; /&gt; 
</code></pre>
<h2 id="spring-data-solr-demo">Spring Data Solr Demo</h2>
<p>1、引入依赖</p>
<pre><code class="language-xml">&lt;dependency&gt;
    &lt;groupId&gt;org.springframework.data&lt;/groupId&gt;
    &lt;artifactId&gt;spring-data-solr&lt;/artifactId&gt;
    &lt;version&gt;1.5.5.RELEASE&lt;/version&gt;
&lt;/dependency&gt; 
</code></pre>
<p>2、applicationContext-solr.xml</p>
<pre><code class="language-xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;
	xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xmlns:p=&quot;http://www.springframework.org/schema/p&quot;
	xmlns:context=&quot;http://www.springframework.org/schema/context&quot;
	xmlns:solr=&quot;http://www.springframework.org/schema/data/solr&quot;
	xsi:schemaLocation=&quot;http://www.springframework.org/schema/data/solr 
  		http://www.springframework.org/schema/data/solr/spring-solr-1.0.xsd
		http://www.springframework.org/schema/beans 
		http://www.springframework.org/schema/beans/spring-beans.xsd
		http://www.springframework.org/schema/context 
		http://www.springframework.org/schema/context/spring-context.xsd&quot;&gt;
	&lt;!-- solr服务器地址 --&gt;
	&lt;solr:solr-server id=&quot;solrServer&quot; url=&quot;http://127.0.0.1:8080/solr&quot; /&gt;
	&lt;!-- solr模板，使用solr模板可对索引库进行CRUD的操作 --&gt;
	&lt;bean id=&quot;solrTemplate&quot; class=&quot;org.springframework.data.solr.core.SolrTemplate&quot;&gt;
		&lt;constructor-arg ref=&quot;solrServer&quot; /&gt;
	&lt;/bean&gt;
&lt;/beans&gt;
</code></pre>
<p>3、@Field 注解</p>
<p>作用：如果在pojo上添加了这个注解，那么这个属性会被引用到solr，value为指定solr中field定义的name，如果一样可以省略</p>
<p>@Dynamic注解，在属性上定义就表示是一个动态域</p>
<p>4、添加</p>
<pre><code class="language-java">@Autowired
private SolrTemplate solrTemplate;

solrTemplate.saveBean(item);
//添加多条数据可以使用saveBeans
solrTemplate.commit();//提交事务
</code></pre>
<p>5、按主键查询</p>
<pre><code class="language-java">//参数1 ：要查询的主键ID
//参数2 ：返回的数据类型
solrTemplate.getById(1,TbItem.class)
</code></pre>
<p>6、按主键删除</p>
<pre><code class="language-java">solrTemplate.deleteById(&quot;1&quot;);
</code></pre>
<p>7、分页查询</p>
<pre><code class="language-java">//条件
Query query = newSimpleQuery(&quot;*:*&quot;);
//查询条件
Criteria criteria = new Criteria();
//and ：查询的域
//contains ：查询的关键字
criteria.and(&quot;item_title&quot;).contains(&quot;手机&quot;);
//将查询条件添加到queyr中
query.addCriteria(criteria);
query.setOffset(0);//开始索引，默认为0，翻页规则 (pageNow - 1) * pageSize
query.setRows(20);//每页记录条数
//ScoredPage ：solr的分页查询
//参数1：查询条件
//参数2：返回类型
ScoredPage&lt;TbItem&gt; page = solrTemplate.queryForPage(query,TbItem.class)
System.out.pringln(&quot;总记录数:&quot;+page.getTotalElements());
List&lt;TbItem&gt; list = page.getContent();
</code></pre>
<p>8、高亮查询</p>
<pre><code class="language-java">@Resource
private SolrTemplate solrTemplate;

@Override
public Map&lt;String, Object&gt; search(Map&lt;String, Object&gt; searchMap) {

    Map&lt;String,Object&gt; map = new HashMap&lt;String, Object&gt;();

    //设置搜索高亮
    HighlightQuery query = new SimpleHighlightQuery();

    //设置高亮的域
    HighlightOptions highlightOptions = new HighlightOptions().addField(&quot;item_title&quot;);

    //设置高亮前缀
    highlightOptions.setSimplePrefix(&quot;&lt;em style='color:red'&gt;&quot;);
    //设置高亮后缀
    highlightOptions.setSimplePostfix(&quot;&lt;/em&gt;&quot;);

    //设置高亮选项
    query.setHighlightOptions(highlightOptions);

    //按照关键字查询
    Criteria criteria = new Criteria(&quot;item_keywords&quot;).is(searchMap.get(&quot;keywords&quot;));

    //添加条件
    query.addCriteria(criteria);

    //到solr中查询
    HighlightPage&lt;TbItem&gt; page = solrTemplate.queryForHighlightPage(query,TbItem.class);

    //循环高亮入口集合
    for (HighlightEntry&lt;TbItem&gt; entry : page.getHighlighted()) {
        //获取原实体类
        TbItem tbItem = entry.getEntity();

        //判断是否有高亮内容
        if(entry.getHighlights().size() &gt; 0 &amp;&amp; entry.getHighlights().get(0).getSnipplets().size() &gt; 0 ){
            //设置高亮的结果
            tbItem.setTitle(entry.getHighlights().get(0).getSnipplets().get(0));
        }
    }
    map.put(&quot;rows&quot;,page.getContent());

    return map;
}
</code></pre>

                          </div>
                        </div>
                        <div class="layout-post-social">
                          <div class="item reader">
                            <div id="/post/solr-an-zhuang-shi-yong/" class="leancloud-visitors view"
                              data-flag-title="solr安装使用">
                              <span class="post-meta-item-text">阅读 </span>
                              <span class="leancloud-visitors-count"></span>
                            </div>
                          </div>
                        </div>

                        <div class="layout-post-navigation">
                          <div class="navigation-list">
                            
                            <div class="post-card row">
                              
                              <div class="card-content col-12">
                                <div class="card-body">
                                  <div class="header">
                                    <a href="https://haohanya.github.io/post/activemq/" class="title">
                                      <h4>ActiveMQ</h4>
                                    </a>
                                  </div>
                                  <div class="inner">
                                    <div class="abstract">
                                      
                                    </div>
                                  </div>
                                </div>
                                <div class="card-footer">
                                  <div class="item"><span>上一篇</span></div>
                                  <div class="item">2020-05-17</div>
                                </div>
                              </div>
                              
                            </div>

                            <div class="post-card row">
                              
                              <div class="card-content col-12">
                                <div class="card-body">
                                  <div class="header">
                                    <a href="https://haohanya.github.io/post/spring-security/" class="title">
                                      <h4>Spring-Security</h4>
                                    </a>
                                  </div>
                                  <div class="inner">
                                    <div class="abstract">
                                      <h2 id="spring-security简介">Spring Security简介</h2>
<blockquote>
<p>Spring Security是一个能够为基于Spring的企业应用系统提供声明式的安全访问控制解决方案的安全框架。它提供了一组可以在Spring应用上下文中配置的Bean，充分利用了Spring IoC，DI（控制反转Inversion of Control ,DI:Dependency Injection 依赖注入）和AOP（面向切面编程）功能，为应用系统提供声明式的安全访问控制功能，减少了为企业系统安全控制编写大量重复代码的工作。</p>
</blockquote>
<h2 id="单机版">单机版</h2>
<p>1.引入依赖</p>
<pre><code class="language-xml"> &lt;!-- 身份验证 --&gt;
&lt;dependency&gt;
    &lt;groupId&gt;org.springframework.security&lt;/groupId&gt;
    &lt;artifactId&gt;spring-security-web&lt;/artifactId&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
    &lt;groupId&gt;org.springframework.security&lt;/groupId&gt;
    &lt;artifactId&gt;spring-security-config&lt;/artifactId&gt;
&lt;/dependency&gt;
</code></pre>

                                    </div>
                                  </div>
                                </div>
                                <div class="card-footer">
                                  <div class="item"><span>下一篇</span></div>
                                  <div class="item">2020-05-04</div>
                                </div>
                              </div>
                              
                            </div>

                            
                          </div>
                        </div>

                        <div class="layout-comments"></div>
                        
                      </div>
                    </div>

                    <div class="col-12 col-lg-2 d-none d-lg-block">
                      <div class="layout-post-sidebar">
                        <div class="layout-sidebar-item">
                          <ul class="markdownIt-TOC">
<li>
<ul>
<li><a href="#%E4%BB%80%E4%B9%88%E6%98%AFsolr">什么是Solr</a></li>
<li><a href="#solr%E5%AE%89%E8%A3%85">solr安装</a>
<ul>
<li><a href="#1-%E4%B8%8A%E4%BC%A0%E6%96%87%E4%BB%B6">1 上传文件</a></li>
<li><a href="#2-%E5%88%9B%E5%BB%BA%E7%9B%AE%E5%BD%95">2 创建目录</a></li>
<li><a href="#3-%E8%A7%A3%E5%8E%8Btomcat%E5%B9%B6%E7%A7%BB%E5%8A%A8%E5%88%B0solr%E7%9B%AE%E5%BD%95">3 解压tomcat并移动到solr目录</a></li>
<li><a href="#4-%E5%90%AF%E5%8A%A8tomcat">4 启动tomcat</a></li>
<li><a href="#5-%E5%BC%95%E5%85%A5%E4%BE%9D%E8%B5%96jar%E5%8C%85">5 引入依赖jar包</a></li>
<li><a href="#6-%E5%A4%8D%E5%88%B6%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6">6 复制配置文件</a></li>
<li><a href="#7-solr%E5%92%8Csolrhome%E5%BB%BA%E7%AB%8B%E8%81%94%E7%B3%BB">7 solr和solrhome建立联系</a></li>
<li><a href="#8-%E9%87%8D%E5%90%AF-tomcat">8 重启 tomcat</a></li>
<li><a href="#9-%E8%AE%BF%E9%97%AEsolr">9 访问solr</a></li>
</ul>
</li>
<li><a href="#%E9%85%8D%E7%BD%AEik%E5%88%86%E8%AF%8D%E5%99%A8">配置IK分词器</a>
<ul>
<li><a href="#ik-analyzer%E7%AE%80%E4%BB%8B">IK Analyzer简介</a></li>
<li><a href="#1-%E5%B0%86ik%E5%88%86%E8%AF%8D%E5%99%A8jar%E5%8C%85%E7%A7%BB%E5%8A%A8%E5%88%B0solr%E4%B8%AD">1 将ik分词器jar包移动到solr中</a></li>
<li><a href="#2-%E5%9C%A8solr%E9%A1%B9%E7%9B%AE%E7%9A%84web-inf-%E7%9B%AE%E5%BD%95%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AAclasses%E7%9B%AE%E5%BD%95">2 在solr项目的WEB-INF 目录创建一个classes目录</a></li>
<li><a href="#3-%E7%A7%BB%E5%8A%A8%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E5%88%B0classes%E7%9B%AE%E5%BD%95">3 移动配置文件到classes目录</a></li>
<li><a href="#4-%E5%90%AF%E7%94%A8-%E7%BC%96%E8%BE%91%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6">4 启用---编辑配置文件</a></li>
</ul>
</li>
<li><a href="#%E5%9F%9F">域</a></li>
<li><a href="#spring-data-solr-demo">Spring Data Solr Demo</a></li>
</ul>
</li>
</ul>

                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="layout-totop d-none"><i class="fa fa-angle-up" aria-hidden="true"></i></div>

    	<div class="layout-footer">

		<div class="container">
			<div class="row justify-content-lg-center">
				<div class="col-12 col-lg-9">
					<div class="footer">
						<div class="row">
							<div class="col-12 col-md-9">
								<div class="footer-copy">
									
									Powered by <a href="https://github.com/getgridea/gridea" target="_blank">Gridea</a>
									<div class="footer-icp d-none d-sm-inline-block">
										<span class="px-2">⋅</span>
										
									</div>
								</div>
							</div>
							<div class="col-sm-3 d-none d-md-block">
								<div class="footer-links">
									
									
									
									
									
									
									
									
									
									
									
									
									
									
									
									
									
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>

	</div>

	<script type="text/javascript" src='https://haohanya.github.io/media/scripts/main.js'></script>
	

  </div>
</body>

</html>