{"posts":[{"title":"ElasticSearchï¼ˆäºŒï¼‰","content":"ElasticSearchç¼–ç¨‹æ“ä½œåˆ›å»ºå·¥ç¨‹ï¼Œå¯¼å…¥åæ ‡&lt;dependency&gt;&lt;groupId&gt;org.elasticsearch&lt;/groupId&gt;&lt;artifactId&gt;elasticsearch&lt;/artifactId&gt;&lt;version&gt;5.6.8&lt;/version&gt;&lt;/dependency&gt;&lt;dependency&gt;&lt;groupId&gt;org.elasticsearch.client&lt;/groupId&gt;&lt;artifactId&gt;transport&lt;/artifactId&gt;&lt;version&gt;5.6.8&lt;/version&gt;&lt;/dependency&gt;&lt;dependency&gt;&lt;groupId&gt;org.apache.logging.log4j&lt;/groupId&gt;&lt;artifactId&gt;log4j-to-slf4j&lt;/artifactId&gt;&lt;version&gt;2.9.1&lt;/version&gt;&lt;/dependency&gt;&lt;dependency&gt;&lt;groupId&gt;org.slf4j&lt;/groupId&gt;&lt;artifactId&gt;slf4j-api&lt;/artifactId&gt;&lt;version&gt;1.7.24&lt;/version&gt;&lt;/dependency&gt;&lt;dependency&gt;&lt;groupId&gt;org.slf4j&lt;/groupId&gt;&lt;artifactId&gt;slf4j-simple&lt;/artifactId&gt;&lt;version&gt;1.7.21&lt;/version&gt;&lt;/dependency&gt;&lt;dependency&gt;&lt;groupId&gt;log4j&lt;/groupId&gt;&lt;artifactId&gt;log4j&lt;/artifactId&gt;&lt;version&gt;1.2.12&lt;/version&gt;&lt;/dependency&gt;&lt;dependency&gt;&lt;groupId&gt;junit&lt;/groupId&gt;&lt;artifactId&gt;junit&lt;/artifactId&gt;&lt;version&gt;4.12&lt;/version&gt;&lt;/dependency&gt;åˆ›å»ºç´¢å¼•index/***åˆ›å»ºç´¢å¼•*@throwsException*/@TestpublicvoidtestCreateIndex()throwsException{//åˆ›å»ºClientè¿æ¥å¯¹è±¡Settingssettings=Settings.builder().put(&quot;cluster.name&quot;,&quot;elasticsearch&quot;).build();TransportClientclient=newPreBuiltTransportClient(settings).addTransportAddress(newInetSocketTransportAddress(InetAddress.getByName(&quot;127.0.0.1&quot;),9300));//åˆ›å»ºåç§°ä¸ºblog2çš„ç´¢å¼•client.admin().indices().prepareCreate(&quot;blog2&quot;).get();//é‡Šæ”¾èµ„æºclient.close();}åˆ›å»ºæ˜ å°„mapping/***åˆ›å»ºæ˜ å°„Mappings*@throwsException*/@TestpublicvoidtestCreateMappings()throwsException{//åˆ›å»ºClientè¿æ¥å¯¹è±¡Settingssettings=Settings.builder().put(&quot;cluster.name&quot;,&quot;elasticsearch&quot;).build();TransportClientclient=newPreBuiltTransportClient(settings).addTransportAddress(newInetSocketTransportAddress(InetAddress.getByName(&quot;127.0.0.1&quot;),9300));//æ·»åŠ æ˜ å°„/***æ ¼å¼ï¼š*&quot;mappings&quot;:{&quot;article&quot;:{&quot;dynamic&quot;:&quot;false&quot;,&quot;properties&quot;:{&quot;id&quot;:{&quot;type&quot;:&quot;string&quot;},&quot;content&quot;:{&quot;type&quot;:&quot;string&quot;},&quot;author&quot;:{&quot;type&quot;:&quot;string&quot;}}}}*//*XContentBuilderbuilder=XContentFactory.jsonBuilder();builder.startObject().startObject(&quot;article&quot;).startObject(&quot;properties&quot;).startObject(&quot;id&quot;).field(&quot;type&quot;,&quot;integer&quot;).field(&quot;store&quot;,&quot;yes&quot;).endObject().startObject(&quot;title&quot;).field(&quot;type&quot;,&quot;string&quot;).field(&quot;store&quot;,&quot;yes&quot;).field(&quot;analyzer&quot;,&quot;ik_smart&quot;).endObject().startObject(&quot;content&quot;).field(&quot;type&quot;,&quot;string&quot;).field(&quot;store&quot;,&quot;yes&quot;).field(&quot;analyzer&quot;,&quot;ik_smart&quot;).endObject().endObject().endObject().endObject();*/Map&lt;String,String&gt;fieldType=newHashMap&lt;&gt;();fieldType.put(&quot;type&quot;,&quot;integer&quot;);fieldType.put(&quot;store&quot;,&quot;yes&quot;);Map&lt;String,String&gt;field2Type=newHashMap&lt;&gt;();field2Type.put(&quot;type&quot;,&quot;string&quot;);field2Type.put(&quot;store&quot;,&quot;yes&quot;);field2Type.put(&quot;analyzer&quot;,&quot;ik_smart&quot;);Map&lt;String,Object&gt;fields=newHashMap&lt;&gt;();fields.put(&quot;id&quot;,fieldType);fields.put(&quot;title&quot;,field2Type);fields.put(&quot;content&quot;,field2Type);Map&lt;String,Object&gt;properties=newHashMap&lt;&gt;();properties.put(&quot;properties&quot;,fields);Map&lt;String,Object&gt;builder=newHashMap&lt;&gt;();builder.put(&quot;article&quot;,properties);//åˆ›å»ºæ˜ å°„PutMappingRequestmappingRequest=Requests.putMappingRequest(&quot;blog2&quot;).type(&quot;article&quot;).source(builder);client.admin().indices().putMapping(mappingRequest).get();//é‡Šæ”¾èµ„æºclient.close();}å»ºç«‹æ–‡æ¡£documentå»ºç«‹æ–‡æ¡£ï¼ˆé€šè¿‡XContentBuilderï¼‰/***åˆ›å»ºæ–‡æ¡£é€šè¿‡XContentBuilder*/@TestpublicvoidtestCreateDocument()throwsException{//åˆ›å»ºClientè¿æ¥å¯¹è±¡Settingssettings=Settings.builder().put(&quot;cluster.name&quot;,&quot;elasticsearch&quot;).build();TransportClientclient=newPreBuiltTransportClient(settings);client.addTransportAddress(newInetSocketTransportAddress(InetAddress.getByName(&quot;127.0.0.1&quot;),9300));//åˆ›å»ºæ–‡æ¡£ä¿¡æ¯XContentBuilderbuilder=XContentFactory.jsonBuilder().startObject().field(&quot;id&quot;,1).field(&quot;title&quot;,&quot;ElasticSearchæ˜¯ä¸€ä¸ªåŸºäºLuceneçš„æœç´¢æœåŠ¡å™¨&quot;).field(&quot;content&quot;,&quot;å®ƒæä¾›äº†ä¸€ä¸ªåˆ†å¸ƒå¼å¤šç”¨æˆ·èƒ½åŠ›çš„å…¨æ–‡æœç´¢å¼•æ“ï¼ŒåŸºäºRESTfulwebæ¥å£ã€‚Elasticsearchæ˜¯ç”¨Javaå¼€å‘çš„ï¼Œå¹¶ä½œä¸ºApacheè®¸å¯æ¡æ¬¾ä¸‹çš„å¼€æ”¾æºç å‘å¸ƒï¼Œæ˜¯å½“å‰æµè¡Œçš„ä¼ä¸šçº§æœç´¢å¼•æ“ã€‚è®¾è®¡ç”¨äºäº‘è®¡ç®—ä¸­ï¼Œèƒ½å¤Ÿè¾¾åˆ°å®æ—¶æœç´¢ï¼Œç¨³å®šï¼Œå¯é ï¼Œå¿«é€Ÿï¼Œå®‰è£…ä½¿ç”¨æ–¹ä¾¿ã€‚&quot;).endObject();//å»ºç«‹æ–‡æ¡£å¯¹è±¡/***å‚æ•°1ï¼šç´¢å¼•å¯¹è±¡*å‚æ•°2ï¼šç±»å‹*å‚æ•°3ï¼šå»ºç«‹id*/client.prepareIndex(&quot;blog2&quot;,&quot;article&quot;,&quot;1&quot;).setSource(builder);//é‡Šæ”¾èµ„æºclient.close();}å»ºç«‹æ–‡æ¡£ï¼ˆé€šè¿‡å®ä½“ç±»è½¬jsonï¼‰/***åˆ›å»ºæ–‡æ¡£é€šè¿‡*@throwsException*/@TestpublicvoidtestCreateDocumentByEntity()throwsException{//åˆ›å»ºClientè¿æ¥å¯¹è±¡Settingssettings=Settings.builder().put(&quot;cluster.name&quot;,&quot;elasticsearch&quot;).build();TransportClientclient=newPreBuiltTransportClient(settings);client.addTransportAddress(newInetSocketTransportAddress(InetAddress.getByName(&quot;127.0.0.1&quot;),9300));//æè¿°jsonæ•°æ®Articlearticle=newArticle();article.setId(2);article.setTitle(&quot;2æœç´¢å·¥ä½œå…¶å®å¾ˆå¿«ä¹&quot;);article.setContent(&quot;2æˆ‘ä»¬å¸Œæœ›æˆ‘ä»¬çš„æœç´¢è§£å†³æ–¹æ¡ˆè¦å¿«ï¼Œæˆ‘ä»¬å¸Œæœ›æœ‰ä¸€ä¸ªé›¶é…ç½®å’Œä¸€ä¸ªå®Œå…¨å…è´¹çš„æœç´¢æ¨¡å¼ï¼Œæˆ‘ä»¬å¸Œæœ›èƒ½å¤Ÿç®€å•åœ°ä½¿ç”¨JSONé€šè¿‡HTTPçš„ç´¢å¼•æ•°æ®ï¼Œæˆ‘ä»¬å¸Œæœ›æˆ‘ä»¬çš„æœç´¢æœåŠ¡å™¨å§‹ç»ˆå¯ç”¨ï¼Œæˆ‘ä»¬å¸Œæœ›èƒ½å¤Ÿä¸€å°å¼€å§‹å¹¶æ‰©å±•åˆ°æ•°ç™¾ï¼Œæˆ‘ä»¬è¦å®æ—¶æœç´¢ï¼Œæˆ‘ä»¬è¦ç®€å•çš„å¤šç§Ÿæˆ·ï¼Œæˆ‘ä»¬å¸Œæœ›å»ºç«‹ä¸€ä¸ªäº‘çš„è§£å†³æ–¹æ¡ˆã€‚Elasticsearchæ—¨åœ¨è§£å†³æ‰€æœ‰è¿™äº›é—®é¢˜å’Œæ›´å¤šçš„é—®é¢˜ã€‚&quot;);//å»ºç«‹æ–‡æ¡£//jackson//ObjectMapperobjectMapper=newObjectMapper();//client.prepareIndex(&quot;blog2&quot;,&quot;article&quot;,article.getId().toString())//.setSource(objectMapper.writeValueAsString(article).getBytes(),XContentType.JSON).get();//fastjsonclient.prepareIndex(&quot;blog2&quot;,&quot;article&quot;,article.getId().toString()).setSource(JSON.toJSONBytes(article),XContentType.JSON).get();//é‡Šæ”¾èµ„æºclient.close();}æŸ¥è¯¢æ–‡æ¡£æ“ä½œå…³é”®è¯æŸ¥è¯¢/***å…³é”®è¯æŸ¥è¯¢*@throwsException*/@TestpublicvoidtestTermQuery()throwsException{//1ã€åˆ›å»ºClientè¿æ¥å¯¹è±¡Settingssettings=Settings.builder().put(&quot;cluster.name&quot;,&quot;elasticsearch&quot;).build();TransportClientclient=newPreBuiltTransportClient(settings);client.addTransportAddress(newInetSocketTransportAddress(InetAddress.getByName(&quot;127.0.0.1&quot;),9300));//2ã€è®¾ç½®æœç´¢æ¡ä»¶SearchResponsesearchResponse=client.prepareSearch(&quot;blog2&quot;).setTypes(&quot;article&quot;).setQuery(QueryBuilders.termQuery(&quot;content&quot;,&quot;æœç´¢&quot;)).get();//3ã€éå†æœç´¢ç»“æœæ•°æ®SearchHitshits=searchResponse.getHits();//è·å–å‘½ä¸­æ¬¡æ•°ï¼ŒæŸ¥è¯¢ç»“æœæœ‰å¤šå°‘å¯¹è±¡System.out.println(&quot;æŸ¥è¯¢ç»“æœæœ‰ï¼š&quot;+hits.getTotalHits()+&quot;æ¡&quot;);Iterator&lt;SearchHit&gt;iterator=hits.iterator();while(iterator.hasNext()){SearchHitsearchHit=iterator.next();//æ¯ä¸ªæŸ¥è¯¢å¯¹è±¡System.out.println(searchHit.getSourceAsString());//è·å–å­—ç¬¦ä¸²æ ¼å¼æ‰“å°System.out.println(&quot;title:&quot;+searchHit.getSource().get(&quot;title&quot;));}//4ã€é‡Šæ”¾èµ„æºclient.close();}å­—ç¬¦ä¸²æŸ¥è¯¢/***å­—ç¬¦ä¸²æŸ¥è¯¢*@throwsException*/@TestpublicvoidtestStringQuery()throwsException{//1ã€åˆ›å»ºClientè¿æ¥å¯¹è±¡Settingssettings=Settings.builder().put(&quot;cluster.name&quot;,&quot;elasticsearch&quot;).build();TransportClientclient=newPreBuiltTransportClient(settings);client.addTransportAddress(newInetSocketTransportAddress(InetAddress.getByName(&quot;127.0.0.1&quot;),9300));//2ã€è®¾ç½®æœç´¢æ¡ä»¶SearchResponsesearchResponse=client.prepareSearch(&quot;blog2&quot;).setTypes(&quot;article&quot;).setQuery(QueryBuilders.queryStringQuery(&quot;æœç´¢&quot;)).get();//3ã€éå†æœç´¢ç»“æœæ•°æ®SearchHitshits=searchResponse.getHits();//è·å–å‘½ä¸­æ¬¡æ•°ï¼ŒæŸ¥è¯¢ç»“æœæœ‰å¤šå°‘å¯¹è±¡System.out.println(&quot;æŸ¥è¯¢ç»“æœæœ‰ï¼š&quot;+hits.getTotalHits()+&quot;æ¡&quot;);Iterator&lt;SearchHit&gt;iterator=hits.iterator();while(iterator.hasNext()){SearchHitsearchHit=iterator.next();//æ¯ä¸ªæŸ¥è¯¢å¯¹è±¡System.out.println(searchHit.getSourceAsString());//è·å–å­—ç¬¦ä¸²æ ¼å¼æ‰“å°System.out.println(&quot;title:&quot;+searchHit.getSource().get(&quot;title&quot;));}//4ã€é‡Šæ”¾èµ„æºclient.close();}ä½¿ç”¨æ–‡æ¡£IDæŸ¥è¯¢æ–‡æ¡£/***ä½¿ç”¨æ–‡æ¡£IDæŸ¥è¯¢æ–‡æ¡£*@throwsException*/@TestpublicvoidtestIdQuery()throwsException{//1ã€åˆ›å»ºClientè¿æ¥å¯¹è±¡Settingssettings=Settings.builder().put(&quot;cluster.name&quot;,&quot;elasticsearch&quot;).build();TransportClientclient=newPreBuiltTransportClient(settings);client.addTransportAddress(newInetSocketTransportAddress(InetAddress.getByName(&quot;127.0.0.1&quot;),9300));//clientå¯¹è±¡ä¸ºTransportClientå¯¹è±¡SearchResponseresponse=client.prepareSearch(&quot;blog2&quot;).setTypes(&quot;article&quot;)//è®¾ç½®è¦æŸ¥è¯¢çš„id.setQuery(QueryBuilders.idsQuery().addIds(&quot;1&quot;,&quot;2&quot;))//æ‰§è¡ŒæŸ¥è¯¢.get();//å–æŸ¥è¯¢ç»“æœSearchHitssearchHits=response.getHits();//å–æŸ¥è¯¢ç»“æœæ€»è®°å½•æ•°System.out.println(searchHits.getTotalHits());Iterator&lt;SearchHit&gt;hitIterator=searchHits.iterator();while(hitIterator.hasNext()){SearchHitsearchHit=hitIterator.next();//æ‰“å°æ•´è¡Œæ•°æ®System.out.println(searchHit.getSourceAsString());}}æŸ¥è¯¢æ–‡æ¡£åˆ†é¡µæ“ä½œæ‰¹é‡æ’å…¥æ•°æ®/***æ‰¹é‡æ’å…¥100æ¡æ•°æ®*@throwsException*/@TestpublicvoidtestCreateDocument100()throwsException{//1ã€åˆ›å»ºClientè¿æ¥å¯¹è±¡Settingssettings=Settings.builder().put(&quot;cluster.name&quot;,&quot;elasticsearch&quot;).build();TransportClientclient=newPreBuiltTransportClient(settings);client.addTransportAddress(newInetSocketTransportAddress(InetAddress.getByName(&quot;127.0.0.1&quot;),9300));for(inti=1;i&lt;=100;i++){//æè¿°jsonæ•°æ®Articlearticle=newArticle();article.setId(i);article.setTitle(i+&quot;æœç´¢å·¥ä½œå…¶å®å¾ˆå¿«ä¹&quot;);article.setContent(i+&quot;æˆ‘ä»¬å¸Œæœ›æˆ‘ä»¬çš„æœç´¢è§£å†³æ–¹æ¡ˆè¦å¿«ï¼Œæˆ‘ä»¬å¸Œæœ›æœ‰ä¸€ä¸ªé›¶é…ç½®å’Œä¸€ä¸ªå®Œå…¨å…è´¹çš„æœç´¢æ¨¡å¼ï¼Œæˆ‘ä»¬å¸Œæœ›èƒ½å¤Ÿç®€å•åœ°ä½¿ç”¨JSONé€šè¿‡HTTPçš„ç´¢å¼•æ•°æ®ï¼Œæˆ‘ä»¬å¸Œæœ›æˆ‘ä»¬çš„æœç´¢æœåŠ¡å™¨å§‹ç»ˆå¯ç”¨ï¼Œæˆ‘ä»¬å¸Œæœ›èƒ½å¤Ÿä¸€å°å¼€å§‹å¹¶æ‰©å±•åˆ°æ•°ç™¾ï¼Œæˆ‘ä»¬è¦å®æ—¶æœç´¢ï¼Œæˆ‘ä»¬è¦ç®€å•çš„å¤šç§Ÿæˆ·ï¼Œæˆ‘ä»¬å¸Œæœ›å»ºç«‹ä¸€ä¸ªäº‘çš„è§£å†³æ–¹æ¡ˆã€‚Elasticsearchæ—¨åœ¨è§£å†³æ‰€æœ‰è¿™äº›é—®é¢˜å’Œæ›´å¤šçš„é—®é¢˜ã€‚&quot;);//å»ºç«‹æ–‡æ¡£client.prepareIndex(&quot;blog2&quot;,&quot;article&quot;,article.getId().toString()).setSource(JSON.toJSONBytes(article),XContentType.JSON).get();}//é‡Šæ”¾èµ„æºclient.close();}åˆ†é¡µæŸ¥è¯¢/***åˆ†é¡µæŸ¥è¯¢*@throwsException*/@Testpublicvoidtest10()throwsException{//1ã€åˆ›å»ºClientè¿æ¥å¯¹è±¡Settingssettings=Settings.builder().put(&quot;cluster.name&quot;,&quot;elasticsearch&quot;).build();TransportClientclient=newPreBuiltTransportClient(settings);client.addTransportAddress(newInetSocketTransportAddress(InetAddress.getByName(&quot;127.0.0.1&quot;),9300));//æœç´¢æ•°æ®SearchRequestBuildersearchRequestBuilder=client.prepareSearch(&quot;blog2&quot;).setTypes(&quot;article&quot;).setQuery(QueryBuilders.matchAllQuery());//é»˜è®¤æ¯é¡µ10æ¡è®°å½•//æŸ¥è¯¢ç¬¬1é¡µæ•°æ®ï¼Œæ¯é¡µ5æ¡//setFrom()ï¼šä»ç¬¬å‡ æ¡å¼€å§‹æ£€ç´¢ï¼Œé»˜è®¤æ˜¯0ã€‚//setSize():æ¯é¡µæœ€å¤šæ˜¾ç¤ºçš„è®°å½•æ•°ã€‚searchRequestBuilder.setFrom(0).setSize(5);SearchResponsesearchResponse=searchRequestBuilder.get();SearchHitshits=searchResponse.getHits();//è·å–å‘½ä¸­æ¬¡æ•°ï¼ŒæŸ¥è¯¢ç»“æœæœ‰å¤šå°‘å¯¹è±¡System.out.println(&quot;æŸ¥è¯¢ç»“æœæœ‰ï¼š&quot;+hits.getTotalHits()+&quot;æ¡&quot;);Iterator&lt;SearchHit&gt;iterator=hits.iterator();while(iterator.hasNext()){SearchHitsearchHit=iterator.next();//æ¯ä¸ªæŸ¥è¯¢å¯¹è±¡System.out.println(searchHit.getSourceAsString());//è·å–å­—ç¬¦ä¸²æ ¼å¼æ‰“å°System.out.println(&quot;id:&quot;+searchHit.getSource().get(&quot;id&quot;));System.out.println(&quot;title:&quot;+searchHit.getSource().get(&quot;title&quot;));System.out.println(&quot;content:&quot;+searchHit.getSource().get(&quot;content&quot;));System.out.println(&quot;-----------------------------------------&quot;);}//é‡Šæ”¾èµ„æºclient.close();}æŸ¥è¯¢ç»“æœé«˜äº®æ“ä½œ/***æœç´¢é«˜äº®*@throwsException*/@Testpublicvoidtest11()throwsException{//1ã€åˆ›å»ºClientè¿æ¥å¯¹è±¡Settingssettings=Settings.builder().put(&quot;cluster.name&quot;,&quot;elasticsearch&quot;).build();TransportClientclient=newPreBuiltTransportClient(settings);client.addTransportAddress(newInetSocketTransportAddress(InetAddress.getByName(&quot;127.0.0.1&quot;),9300));//æœç´¢æ•°æ®SearchRequestBuildersearchRequestBuilder=client.prepareSearch(&quot;blog2&quot;).setTypes(&quot;article&quot;).setQuery(QueryBuilders.termQuery(&quot;title&quot;,&quot;æœç´¢&quot;));//è®¾ç½®é«˜äº®æ•°æ®HighlightBuilderhiBuilder=newHighlightBuilder();hiBuilder.preTags(&quot;&lt;fontstyle='color:red'&gt;&quot;);hiBuilder.postTags(&quot;&lt;/font&gt;&quot;);hiBuilder.field(&quot;title&quot;);searchRequestBuilder.highlighter(hiBuilder);//è·å¾—æŸ¥è¯¢ç»“æœæ•°æ®SearchResponsesearchResponse=searchRequestBuilder.get();//è·å–æŸ¥è¯¢ç»“æœé›†SearchHitssearchHits=searchResponse.getHits();System.out.println(&quot;å…±æœåˆ°:&quot;+searchHits.getTotalHits()+&quot;æ¡ç»“æœ!&quot;);//éå†ç»“æœfor(SearchHithit:searchHits){System.out.println(&quot;Stringæ–¹å¼æ‰“å°æ–‡æ¡£æœç´¢å†…å®¹:&quot;);System.out.println(hit.getSourceAsString());System.out.println(&quot;Mapæ–¹å¼æ‰“å°é«˜äº®å†…å®¹&quot;);System.out.println(hit.getHighlightFields());System.out.println(&quot;éå†é«˜äº®é›†åˆï¼Œæ‰“å°é«˜äº®ç‰‡æ®µ:&quot;);Text[]text=hit.getHighlightFields().get(&quot;title&quot;).getFragments();for(Textstr:text){System.out.println(str);}}//é‡Šæ”¾èµ„æºclient.close();}SpringDataElasticSearchä½¿ç”¨SpringDataElasticSearchç®€ä»‹ä»€ä¹ˆæ˜¯SpringDataSpringDataæ˜¯ä¸€ä¸ªç”¨äºç®€åŒ–æ•°æ®åº“è®¿é—®ï¼Œå¹¶æ”¯æŒäº‘æœåŠ¡çš„å¼€æºæ¡†æ¶ã€‚å…¶ä¸»è¦ç›®æ ‡æ˜¯ä½¿å¾—å¯¹æ•°æ®çš„è®¿é—®å˜å¾—æ–¹ä¾¿å¿«æ·ï¼Œå¹¶æ”¯æŒmap-reduceæ¡†æ¶å’Œäº‘è®¡ç®—æ•°æ®æœåŠ¡ã€‚SpringDataå¯ä»¥æå¤§çš„ç®€åŒ–JPAçš„å†™æ³•ï¼Œå¯ä»¥åœ¨å‡ ä¹ä¸ç”¨å†™å®ç°çš„æƒ…å†µä¸‹ï¼Œå®ç°å¯¹æ•°æ®çš„è®¿é—®å’Œæ“ä½œã€‚é™¤äº†CRUDå¤–ï¼Œè¿˜åŒ…æ‹¬å¦‚åˆ†é¡µã€æ’åºç­‰ä¸€äº›å¸¸ç”¨çš„åŠŸèƒ½ã€‚SpringDataçš„å®˜ç½‘ï¼šhttp://projects.spring.io/spring-data/ä»€ä¹ˆæ˜¯SpringDataElasticSearchSpringDataElasticSearchåŸºäºspringdataAPIç®€åŒ–elasticSearchæ“ä½œï¼Œå°†åŸå§‹æ“ä½œelasticSearchçš„å®¢æˆ·ç«¯APIè¿›è¡Œå°è£…ã€‚SpringDataä¸ºElasticsearché¡¹ç›®æä¾›é›†æˆæœç´¢å¼•æ“ã€‚SpringDataElasticsearchPOJOçš„å…³é”®åŠŸèƒ½åŒºåŸŸä¸ºä¸­å¿ƒçš„æ¨¡å‹ä¸Elastichsearchäº¤äº’æ–‡æ¡£å’Œè½»æ¾åœ°ç¼–å†™ä¸€ä¸ªå­˜å‚¨åº“æ•°æ®è®¿é—®å±‚ã€‚å®˜æ–¹ç½‘ç«™ï¼šhttp://projects.spring.io/spring-data-elasticsearch/SpringDataElasticSearchå…¥é—¨1ã€å¯¼å…¥ä¾èµ–&lt;dependency&gt;&lt;groupId&gt;org.elasticsearch&lt;/groupId&gt;&lt;artifactId&gt;elasticsearch&lt;/artifactId&gt;&lt;version&gt;5.6.8&lt;/version&gt;&lt;/dependency&gt;&lt;dependency&gt;&lt;groupId&gt;org.elasticsearch.client&lt;/groupId&gt;&lt;artifactId&gt;transport&lt;/artifactId&gt;&lt;version&gt;5.6.8&lt;/version&gt;&lt;/dependency&gt;&lt;dependency&gt;&lt;groupId&gt;org.apache.logging.log4j&lt;/groupId&gt;&lt;artifactId&gt;log4j-to-slf4j&lt;/artifactId&gt;&lt;version&gt;2.9.1&lt;/version&gt;&lt;/dependency&gt;&lt;dependency&gt;&lt;groupId&gt;org.slf4j&lt;/groupId&gt;&lt;artifactId&gt;slf4j-api&lt;/artifactId&gt;&lt;version&gt;1.7.24&lt;/version&gt;&lt;/dependency&gt;&lt;dependency&gt;&lt;groupId&gt;org.slf4j&lt;/groupId&gt;&lt;artifactId&gt;slf4j-simple&lt;/artifactId&gt;&lt;version&gt;1.7.21&lt;/version&gt;&lt;/dependency&gt;&lt;dependency&gt;&lt;groupId&gt;log4j&lt;/groupId&gt;&lt;artifactId&gt;log4j&lt;/artifactId&gt;&lt;version&gt;1.2.12&lt;/version&gt;&lt;/dependency&gt;&lt;dependency&gt;&lt;groupId&gt;junit&lt;/groupId&gt;&lt;artifactId&gt;junit&lt;/artifactId&gt;&lt;version&gt;4.12&lt;/version&gt;&lt;/dependency&gt;&lt;dependency&gt;&lt;groupId&gt;com.fasterxml.jackson.core&lt;/groupId&gt;&lt;artifactId&gt;jackson-core&lt;/artifactId&gt;&lt;version&gt;2.8.1&lt;/version&gt;&lt;/dependency&gt;&lt;dependency&gt;&lt;groupId&gt;com.fasterxml.jackson.core&lt;/groupId&gt;&lt;artifactId&gt;jackson-databind&lt;/artifactId&gt;&lt;version&gt;2.8.1&lt;/version&gt;&lt;/dependency&gt;&lt;dependency&gt;&lt;groupId&gt;com.fasterxml.jackson.core&lt;/groupId&gt;&lt;artifactId&gt;jackson-annotations&lt;/artifactId&gt;&lt;version&gt;2.8.1&lt;/version&gt;&lt;/dependency&gt;&lt;dependency&gt;&lt;groupId&gt;org.springframework.data&lt;/groupId&gt;&lt;artifactId&gt;spring-data-elasticsearch&lt;/artifactId&gt;&lt;version&gt;3.0.5.RELEASE&lt;/version&gt;&lt;exclusions&gt;&lt;exclusion&gt;&lt;groupId&gt;org.elasticsearch.plugin&lt;/groupId&gt;&lt;artifactId&gt;transport-netty4-client&lt;/artifactId&gt;&lt;/exclusion&gt;&lt;/exclusions&gt;&lt;/dependency&gt;&lt;dependency&gt;&lt;groupId&gt;org.springframework&lt;/groupId&gt;&lt;artifactId&gt;spring-test&lt;/artifactId&gt;&lt;version&gt;5.0.4.RELEASE&lt;/version&gt;&lt;/dependency&gt;&lt;dependency&gt;&lt;groupId&gt;org.projectlombok&lt;/groupId&gt;&lt;artifactId&gt;lombok&lt;/artifactId&gt;&lt;version&gt;1.18.12&lt;/version&gt;&lt;scope&gt;provided&lt;/scope&gt;&lt;/dependency&gt;&lt;dependency&gt;&lt;groupId&gt;com.alibaba&lt;/groupId&gt;&lt;artifactId&gt;fastjson&lt;/artifactId&gt;&lt;version&gt;1.2.72&lt;/version&gt;&lt;/dependency&gt;2ã€å†™å®ä½“Article@lombok.DatapublicclassArticle{privateIntegerid;privateStringtitle;privateStringcontent;}3ã€Daoimportcom.cn.entity.Article;importorg.springframework.data.elasticsearch.repository.ElasticsearchRepository;importorg.springframework.stereotype.Repository;@RepositorypublicinterfaceArticleRepositoryextendsElasticsearchRepository&lt;Article,Integer&gt;{}4ã€Serviceimportcom.cn.entity.Article;publicinterfaceArticleService{voidsave(Articlearticle);}importcom.cn.dao.ArticleRepository;importcom.cn.entity.Article;importcom.cn.service.ArticleService;importorg.springframework.stereotype.Service;importjavax.annotation.Resource;@ServicepublicclassArticleServiceImplimplementsArticleService{@ResourceprivateArticleRepositoryarticleRepository;@Overridepublicvoidsave(Articlearticle){articleRepository.save(article);}}5ã€é…ç½®applicationContext.xml&lt;?xmlversion=&quot;1.0&quot;encoding=&quot;UTF-8&quot;?&gt;&lt;beansxmlns=&quot;http://www.springframework.org/schema/beans&quot;xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;xmlns:context=&quot;http://www.springframework.org/schema/context&quot;xmlns:elasticsearch=&quot;http://www.springframework.org/schema/data/elasticsearch&quot;xsi:schemaLocation=&quot;http://www.springframework.org/schema/beanshttp://www.springframework.org/schema/beans/spring-beans.xsdhttp://www.springframework.org/schema/contexthttp://www.springframework.org/schema/context/spring-context.xsdhttp://www.springframework.org/schema/data/elasticsearchhttp://www.springframework.org/schema/data/elasticsearch/spring-elasticsearch-1.0.xsd&quot;&gt;&lt;!--æ‰«æDaoåŒ…ï¼Œè‡ªåŠ¨åˆ›å»ºå®ä¾‹--&gt;&lt;elasticsearch:repositoriesbase-package=&quot;com.cn.dao&quot;/&gt;&lt;!--æ‰«æServiceåŒ…ï¼Œåˆ›å»ºServiceçš„å®ä½“--&gt;&lt;context:component-scanbase-package=&quot;com.cn.service&quot;/&gt;&lt;!--é…ç½®elasticSearchçš„è¿æ¥--&gt;&lt;!--é…ç½®elasticSearchçš„è¿æ¥--&gt;&lt;elasticsearch:transport-clientid=&quot;client&quot;cluster-nodes=&quot;localhost:9300&quot;cluster-name=&quot;elasticsearch&quot;/&gt;&lt;!--ElasticSearchæ¨¡ç‰ˆå¯¹è±¡--&gt;&lt;beanid=&quot;elasticsearchTemplate&quot;class=&quot;org.springframework.data.elasticsearch.core.ElasticsearchTemplate&quot;&gt;&lt;constructor-argname=&quot;client&quot;ref=&quot;client&quot;/&gt;&lt;/bean&gt;&lt;/beans&gt;6ã€é…ç½®å®ä½“åŸºäºspringdataelasticsearchæ³¨è§£é…ç½®ç´¢å¼•ã€æ˜ å°„å’Œå®ä½“çš„å…³ç³»importorg.springframework.data.annotation.Id;importorg.springframework.data.elasticsearch.annotations.Document;importorg.springframework.data.elasticsearch.annotations.Field;importorg.springframework.data.elasticsearch.annotations.FieldType;@lombok.Data//@Documentæ–‡æ¡£å¯¹è±¡ï¼ˆç´¢å¼•ä¿¡æ¯ã€æ–‡æ¡£ç±»å‹ï¼‰@Document(indexName=&quot;blog3&quot;,type=&quot;article&quot;)publicclassArticle{//@Idæ–‡æ¡£ä¸»é”®å”¯ä¸€æ ‡è¯†@Id//@Fieldæ¯ä¸ªæ–‡æ¡£çš„å­—æ®µé…ç½®ï¼ˆç±»å‹ã€æ˜¯å¦åˆ†è¯ã€æ˜¯å¦å­˜å‚¨ã€åˆ†è¯å™¨ï¼‰@Field(store=true,index=false,type=FieldType.Integer)privateIntegerid;@Field(index=true,analyzer=&quot;ik_smart&quot;,store=true,searchAnalyzer=&quot;ik_smart&quot;,type=FieldType.text)privateStringtitle;@Field(index=true,analyzer=&quot;ik_smart&quot;,store=true,searchAnalyzer=&quot;ik_smart&quot;,type=FieldType.text)privateStringcontent;}å…¶ä¸­ï¼Œæ³¨è§£è§£é‡Šå¦‚ä¸‹ï¼š@Document(indexName=&quot;blob3&quot;,type=&quot;article&quot;)ï¼šindexNameï¼šç´¢å¼•çš„åç§°ï¼ˆå¿…å¡«é¡¹ï¼‰typeï¼šç´¢å¼•çš„ç±»å‹@Idï¼šä¸»é”®çš„å”¯ä¸€æ ‡è¯†@Field(index=true,analyzer=&quot;ik_smart&quot;,store=true,searchAnalyzer=&quot;ik_smart&quot;,type=FieldType.text)indexï¼šæ˜¯å¦è®¾ç½®åˆ†è¯analyzerï¼šå­˜å‚¨æ—¶ä½¿ç”¨çš„åˆ†è¯å™¨searchAnalyzeï¼šæœç´¢æ—¶ä½¿ç”¨çš„åˆ†è¯å™¨storeï¼šæ˜¯å¦å­˜å‚¨type:æ•°æ®ç±»å‹7ã€åˆ›å»ºæµ‹è¯•ç±»SpringDataESTestpackagecom.cn.test;importcom.cn.entity.Article;importcom.cn.service.ArticleService;importorg.elasticsearch.client.transport.TransportClient;importorg.junit.Test;importorg.junit.runner.RunWith;importorg.springframework.data.elasticsearch.core.ElasticsearchTemplate;importorg.springframework.test.context.ContextConfiguration;importorg.springframework.test.context.junit4.SpringJUnit4ClassRunner;importjavax.annotation.Resource;@RunWith(SpringJUnit4ClassRunner.class)@ContextConfiguration(locations=&quot;classpath:applicationContext.xml&quot;)publicclassSpringDataESTest{@ResourceprivateArticleServicearticleService;@ResourceprivateTransportClientclient;@ResourceprivateElasticsearchTemplateelasticsearchTemplate;/**åˆ›å»ºç´¢å¼•å’Œæ˜ å°„*/@TestpublicvoidcreateIndex(){elasticsearchTemplate.createIndex(Article.class);elasticsearchTemplate.putMapping(Article.class);}/**æµ‹è¯•ä¿å­˜æ–‡æ¡£*/@TestpublicvoidsaveArticle(){Articlearticle=newArticle();article.setId(100);article.setTitle(&quot;æµ‹è¯•SpringDataElasticSearch&quot;);article.setContent(&quot;SpringDataElasticSearchåŸºäºspringdataAPIç®€åŒ–elasticSearchæ“ä½œï¼Œå°†åŸå§‹æ“ä½œelasticSearchçš„å®¢æˆ·ç«¯APIè¿›è¡Œå°è£…\\n&quot;+&quot;SpringDataä¸ºElasticsearchElasticsearché¡¹ç›®æä¾›é›†æˆæœç´¢å¼•æ“&quot;);articleService.save(article);}}SpringDataElasticSearchçš„å¸¸ç”¨æ“ä½œå¢åˆ æ”¹æŸ¥æ–¹æ³•æµ‹è¯•packagecom.cn.test;importcom.cn.entity.Article;importcom.cn.service.ArticleService;importorg.elasticsearch.client.transport.TransportClient;importorg.junit.Test;importorg.junit.runner.RunWith;importorg.springframework.data.domain.Page;importorg.springframework.data.domain.PageRequest;importorg.springframework.data.domain.Pageable;importorg.springframework.data.elasticsearch.core.ElasticsearchTemplate;importorg.springframework.test.context.ContextConfiguration;importorg.springframework.test.context.junit4.SpringJUnit4ClassRunner;importjavax.annotation.Resource;@RunWith(SpringJUnit4ClassRunner.class)@ContextConfiguration(locations=&quot;classpath:applicationContext.xml&quot;)publicclassSpringDataESTest{@ResourceprivateArticleServicearticleService;@ResourceprivateTransportClientclient;@ResourceprivateElasticsearchTemplateelasticsearchTemplate;/**åˆ›å»ºç´¢å¼•å’Œæ˜ å°„*/@TestpublicvoidcreateIndex(){elasticsearchTemplate.createIndex(Article.class);elasticsearchTemplate.putMapping(Article.class);}/**æµ‹è¯•ä¿å­˜æ–‡æ¡£*/@TestpublicvoidsaveArticle(){Articlearticle=newArticle();article.setId(100);article.setTitle(&quot;æµ‹è¯•SpringDataElasticSearch&quot;);article.setContent(&quot;SpringDataElasticSearchåŸºäºspringdataAPIç®€åŒ–elasticSearchæ“ä½œï¼Œå°†åŸå§‹æ“ä½œelasticSearchçš„å®¢æˆ·ç«¯APIè¿›è¡Œå°è£…\\n&quot;+&quot;SpringDataä¸ºElasticsearchElasticsearché¡¹ç›®æä¾›é›†æˆæœç´¢å¼•æ“&quot;);articleService.save(article);}/***æµ‹è¯•æ›´æ–°*/@Testpublicvoidupdate(){Articlearticle=newArticle();article.setId(1001);article.setTitle(&quot;elasticSearch3.0ç‰ˆæœ¬å‘å¸ƒ...æ›´æ–°&quot;);article.setContent(&quot;ElasticSearchæ˜¯ä¸€ä¸ªåŸºäºLuceneçš„æœç´¢æœåŠ¡å™¨ã€‚å®ƒæä¾›äº†ä¸€ä¸ªåˆ†å¸ƒå¼å¤šç”¨æˆ·èƒ½åŠ›çš„å…¨æ–‡æœç´¢å¼•æ“ï¼ŒåŸºäºRESTfulwebæ¥å£&quot;);articleService.save(article);}/***æµ‹è¯•åˆ é™¤*/@Testpublicvoiddelete(){Articlearticle=newArticle();article.setId(1001);articleService.delete(article);}/***æ‰¹é‡æ’å…¥*/@Testpublicvoidsave100(){for(inti=1;i&lt;=100;i++){Articlearticle=newArticle();article.setId(i);article.setTitle(i+&quot;elasticSearch3.0ç‰ˆæœ¬å‘å¸ƒ..ï¼Œæ›´æ–°&quot;);article.setContent(i+&quot;ElasticSearchæ˜¯ä¸€ä¸ªåŸºäºLuceneçš„æœç´¢æœåŠ¡å™¨ã€‚å®ƒæä¾›äº†ä¸€ä¸ªåˆ†å¸ƒå¼å¤šç”¨æˆ·èƒ½åŠ›çš„å…¨æ–‡æœç´¢å¼•æ“ï¼ŒåŸºäºRESTfulwebæ¥å£&quot;);articleService.save(article);}}/***åˆ†é¡µæŸ¥è¯¢*/@TestpublicvoidfindAllPage(){Pageablepageable=PageRequest.of(1,10);Page&lt;Article&gt;page=articleService.findAll(pageable);for(Articlearticle:page.getContent()){System.out.println(article);}}}å¸¸ç”¨æŸ¥è¯¢å‘½åè§„åˆ™å…³é”®å­—å‘½åè§„åˆ™è§£é‡Šç¤ºä¾‹andfindByField1AndField2æ ¹æ®Field1å’ŒField2è·å¾—æ•°æ®findByTitleAndContentorfindByField1OrField2æ ¹æ®Field1æˆ–Field2è·å¾—æ•°æ®findByTitleOrContentisfindByFieldæ ¹æ®Fieldè·å¾—æ•°æ®findByTitlenotfindByFieldNotæ ¹æ®Fieldè·å¾—è¡¥é›†æ•°æ®findByTitleNotbetweenfindByFieldBetweenè·å¾—æŒ‡å®šèŒƒå›´çš„æ•°æ®findByPriceBetweenlessThanEqualfindByFieldLessThanè·å¾—å°äºç­‰äºæŒ‡å®šå€¼çš„æ•°æ®findByPriceLessThanä½¿ç”¨Elasticsearchçš„åŸç”ŸæŸ¥è¯¢å¯¹è±¡è¿›è¡ŒæŸ¥è¯¢ã€‚@TestpublicvoidfindByNativeQuery(){//åˆ›å»ºä¸€ä¸ªSearchQueryå¯¹è±¡SearchQuerysearchQuery=newNativeSearchQueryBuilder()//è®¾ç½®æŸ¥è¯¢æ¡ä»¶ï¼Œæ­¤å¤„å¯ä»¥ä½¿ç”¨QueryBuildersåˆ›å»ºå¤šç§æŸ¥è¯¢.withQuery(QueryBuilders.queryStringQuery(&quot;å¤‡ä»½èŠ‚ç‚¹ä¸Šæ²¡æœ‰æ•°æ®&quot;).defaultField(&quot;title&quot;))//è¿˜å¯ä»¥è®¾ç½®åˆ†é¡µä¿¡æ¯.withPageable(PageRequest.of(1,5))//åˆ›å»ºSearchQueryå¯¹è±¡.build();//ä½¿ç”¨æ¨¡æ¿å¯¹è±¡æ‰§è¡ŒæŸ¥è¯¢elasticsearchTemplate.queryForList(searchQuery,Article.class).forEach(a-&gt;System.out.println(a));}","link":"https://haohanya.github.io/post/elasticsearch/"},{"title":" ElasticSearchï¼ˆä¸€ï¼‰","content":"ElasticSearchç®€ä»‹ä»€ä¹ˆæ˜¯ElasticSearchElaticsearchï¼Œç®€ç§°ä¸ºesï¼Œesæ˜¯ä¸€ä¸ªå¼€æºçš„é«˜æ‰©å±•çš„åˆ†å¸ƒå¼å…¨æ–‡æ£€ç´¢å¼•æ“ï¼Œå®ƒå¯ä»¥è¿‘ä¹å®æ—¶çš„å­˜å‚¨ã€æ£€ç´¢æ•°æ®ï¼›æœ¬èº«æ‰©å±•æ€§å¾ˆå¥½ï¼Œå¯ä»¥æ‰©å±•åˆ°ä¸Šç™¾å°æœåŠ¡å™¨ï¼Œå¤„ç†PBçº§åˆ«çš„æ•°æ®ã€‚esä¹Ÿä½¿ç”¨Javaå¼€å‘å¹¶ä½¿ç”¨Luceneä½œä¸ºå…¶æ ¸å¿ƒæ¥å®ç°æ‰€æœ‰ç´¢å¼•å’Œæœç´¢çš„åŠŸèƒ½ï¼Œä½†æ˜¯å®ƒçš„ç›®çš„æ˜¯é€šè¿‡ç®€å•çš„RESTfulAPIæ¥éšè—Luceneçš„å¤æ‚æ€§ï¼Œä»è€Œè®©å…¨æ–‡æœç´¢å˜å¾—ç®€å•ã€‚ElasticSearchçš„ä½¿ç”¨æ¡ˆä¾‹2013å¹´åˆï¼ŒGitHubæŠ›å¼ƒäº†Solrï¼Œé‡‡å–ElasticSearchæ¥åšPBçº§çš„æœç´¢ã€‚â€œGitHubä½¿ç”¨ElasticSearchæœç´¢20TBçš„æ•°æ®ï¼ŒåŒ…æ‹¬13äº¿æ–‡ä»¶å’Œ1300äº¿è¡Œä»£ç â€ç»´åŸºç™¾ç§‘ï¼šå¯åŠ¨ä»¥elasticsearchä¸ºåŸºç¡€çš„æ ¸å¿ƒæœç´¢æ¶æ„SoundCloudï¼šâ€œSoundCloudä½¿ç”¨ElasticSearchä¸º1.8äº¿ç”¨æˆ·æä¾›å³æ—¶è€Œç²¾å‡†çš„éŸ³ä¹æœç´¢æœåŠ¡â€ç™¾åº¦ï¼šç™¾åº¦ç›®å‰å¹¿æ³›ä½¿ç”¨ElasticSearchä½œä¸ºæ–‡æœ¬æ•°æ®åˆ†æï¼Œé‡‡é›†ç™¾åº¦æ‰€æœ‰æœåŠ¡å™¨ä¸Šçš„å„ç±»æŒ‡æ ‡æ•°æ®åŠç”¨æˆ·è‡ªå®šä¹‰æ•°æ®ï¼Œé€šè¿‡å¯¹å„ç§æ•°æ®è¿›è¡Œå¤šç»´åˆ†æå±•ç¤ºï¼Œè¾…åŠ©å®šä½åˆ†æå®ä¾‹å¼‚å¸¸æˆ–ä¸šåŠ¡å±‚é¢å¼‚å¸¸ã€‚ç›®å‰è¦†ç›–ç™¾åº¦å†…éƒ¨20å¤šä¸ªä¸šåŠ¡çº¿ï¼ˆåŒ…æ‹¬casioã€äº‘åˆ†æã€ç½‘ç›Ÿã€é¢„æµ‹ã€æ–‡åº“ã€ç›´è¾¾å·ã€é’±åŒ…ã€é£æ§ç­‰ï¼‰ï¼Œå•é›†ç¾¤æœ€å¤§100å°æœºå™¨ï¼Œ200ä¸ªESèŠ‚ç‚¹ï¼Œæ¯å¤©å¯¼å…¥30TB+æ•°æ®æ–°æµªä½¿ç”¨ESåˆ†æå¤„ç†32äº¿æ¡å®æ—¶æ—¥å¿—é˜¿é‡Œä½¿ç”¨ESæ„å»ºæŒ–è´¢è‡ªå·±çš„æ—¥å¿—é‡‡é›†å’Œåˆ†æä½“ç³»ElasticSearchå¯¹æ¯”SolrSolråˆ©ç”¨Zookeeperè¿›è¡Œåˆ†å¸ƒå¼ç®¡ç†ï¼Œè€ŒElasticsearchè‡ªèº«å¸¦æœ‰åˆ†å¸ƒå¼åè°ƒç®¡ç†åŠŸèƒ½;Solræ”¯æŒæ›´å¤šæ ¼å¼çš„æ•°æ®ï¼Œè€ŒElasticsearchä»…æ”¯æŒjsonæ–‡ä»¶æ ¼å¼ï¼›Solrå®˜æ–¹æä¾›çš„åŠŸèƒ½æ›´å¤šï¼Œè€ŒElasticsearchæœ¬èº«æ›´æ³¨é‡äºæ ¸å¿ƒåŠŸèƒ½ï¼Œé«˜çº§åŠŸèƒ½å¤šæœ‰ç¬¬ä¸‰æ–¹æ’ä»¶æä¾›ï¼›Solråœ¨ä¼ ç»Ÿçš„æœç´¢åº”ç”¨ä¸­è¡¨ç°å¥½äºElasticsearchï¼Œä½†åœ¨å¤„ç†å®æ—¶æœç´¢åº”ç”¨æ—¶æ•ˆç‡æ˜æ˜¾ä½äºElasticsearchElasticSearchå®‰è£…ä¸å¯åŠ¨ä¸‹è½½ESå‹ç¼©åŒ…ElasticSearchåˆ†ä¸ºLinuxå’ŒWindowç‰ˆæœ¬ï¼ŒåŸºäºæˆ‘ä»¬ä¸»è¦å­¦ä¹ çš„æ˜¯ElasticSearchçš„Javaå®¢æˆ·ç«¯çš„ä½¿ç”¨ï¼Œæ‰€ä»¥æˆ‘ä»¬è¯¾ç¨‹ä¸­ä½¿ç”¨çš„æ˜¯å®‰è£…è¾ƒä¸ºç®€ä¾¿çš„Windowç‰ˆæœ¬ï¼Œé¡¹ç›®ä¸Šçº¿åï¼Œå…¬å¸çš„è¿ç»´äººå‘˜ä¼šå®‰è£…Linuxç‰ˆçš„ESä¾›æˆ‘ä»¬è¿æ¥ä½¿ç”¨ã€‚ElasticSearchçš„å®˜æ–¹åœ°å€ï¼šhttps://www.elastic.co/products/elasticsearchå®‰è£…ESæœåŠ¡Windowç‰ˆçš„ElasticSearchçš„å®‰è£…å¾ˆç®€å•ï¼Œç±»ä¼¼Windowç‰ˆçš„Tomcatï¼Œè§£å‹å¼€å³å®‰è£…å®Œæ¯•ï¼Œè§£å‹åçš„ElasticSearchçš„ç›®å½•ç»“æ„å¦‚ä¸‹ï¼šä¿®æ”¹elasticsearché…ç½®æ–‡ä»¶ï¼šconfig/elasticsearch.ymlï¼Œå¢åŠ ä»¥ä¸‹ä¸¤å¥å‘½ä»¤ï¼šhttp.cors.enabled:truehttp.cors.allowâ€origin:&quot;*&quot;æ­¤æ­¥ä¸ºå…è®¸elasticsearchè·¨è¶Šè®¿é—®ï¼Œå¦‚æœä¸å®‰è£…åé¢çš„elasticsearch-headæ˜¯å¯ä»¥ä¸ä¿®æ”¹ï¼Œç›´æ¥å¯åŠ¨ã€‚å¯åŠ¨ESæœåŠ¡ç‚¹å‡»ElasticSearchä¸‹çš„binç›®å½•ä¸‹çš„elasticsearch.batå¯åŠ¨æ³¨æ„ï¼š9300æ˜¯tcpé€šè®¯ç«¯å£ï¼Œé›†ç¾¤é—´å’ŒTCPClientéƒ½æ‰§è¡Œè¯¥ç«¯å£ï¼Œ9200æ˜¯httpåè®®çš„RESTfulæ¥å£ã€‚é€šè¿‡æµè§ˆå™¨è®¿é—®ElasticSearchæœåŠ¡å™¨ï¼Œçœ‹åˆ°å¦‚ä¸‹è¿”å›çš„jsonä¿¡æ¯ï¼Œä»£è¡¨æœåŠ¡å¯åŠ¨æˆåŠŸï¼šæ³¨æ„ï¼šElasticSearchæ˜¯ä½¿ç”¨javaå¼€å‘çš„ï¼Œä¸”æœ¬ç‰ˆæœ¬çš„eséœ€è¦çš„jdkç‰ˆæœ¬è¦æ˜¯1.8ä»¥ä¸Šï¼Œæ‰€ä»¥å®‰è£…ElasticSearchä¹‹å‰ä¿è¯JDK1.8+å®‰è£…å®Œæ¯•ï¼Œå¹¶æ­£ç¡®çš„é…ç½®å¥½JDKç¯å¢ƒå˜é‡ï¼Œå¦åˆ™å¯åŠ¨ElasticSearchå¤±è´¥ã€‚å®‰è£…ESçš„å›¾å½¢åŒ–ç•Œé¢æ’ä»¶ElasticSearchä¸åŒäºSolrè‡ªå¸¦å›¾å½¢åŒ–ç•Œé¢ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å®‰è£…ElasticSearchçš„headæ’ä»¶ï¼Œå®Œæˆå›¾å½¢åŒ–ç•Œé¢çš„æ•ˆæœï¼Œå®Œæˆç´¢å¼•æ•°æ®çš„æŸ¥çœ‹ã€‚å®‰è£…æ’ä»¶çš„æ–¹å¼æœ‰ä¸¤ç§ï¼Œåœ¨çº¿å®‰è£…å’Œæœ¬åœ°å®‰è£…ã€‚æœ¬æ–‡æ¡£é‡‡ç”¨æœ¬åœ°å®‰è£…æ–¹å¼è¿›è¡Œheadæ’ä»¶çš„å®‰è£…ã€‚elasticsearch-5-*ä»¥ä¸Šç‰ˆæœ¬å®‰è£…headéœ€è¦å®‰è£…nodeå’Œgruntä¸‹è½½headæ’ä»¶ï¼šhttps://github.com/mobz/elasticsearch-headå°†elasticsearch-head-masterå‹ç¼©åŒ…è§£å‹åˆ°ä»»æ„ç›®å½•ï¼Œä½†æ˜¯è¦å’Œelasticsearchçš„å®‰è£…ç›®å½•åŒºåˆ«å¼€ä¸‹è½½nodejsï¼šhttps://nodejs.org/en/download/å°†gruntå®‰è£…ä¸ºå…¨å±€å‘½ä»¤ï¼ŒGruntæ˜¯åŸºäºNode.jsçš„é¡¹ç›®æ„å»ºå·¥å…·npminstallâ€ggruntâ€cliè¿›å…¥elasticsearch-head-masterç›®å½•å¯åŠ¨headï¼Œåœ¨å‘½ä»¤æç¤ºç¬¦ä¸‹è¾“å…¥å‘½ä»¤npminstallgruntserveræ‰“å¼€æµè§ˆå™¨ï¼Œè¾“å…¥http://localhost:9100ï¼Œçœ‹åˆ°å¦‚ä¸‹é¡µé¢ElasticSearchç›¸å…³æ¦‚å¿µ(æœ¯è¯­)æ¦‚è¿°Elasticsearchæ˜¯é¢å‘æ–‡æ¡£(documentoriented)çš„ï¼Œè¿™æ„å‘³ç€å®ƒå¯ä»¥å­˜å‚¨æ•´ä¸ªå¯¹è±¡æˆ–æ–‡æ¡£(document)ã€‚ç„¶è€Œå®ƒä¸ä»…ä»…æ˜¯å­˜å‚¨ï¼Œè¿˜ä¼šç´¢å¼•(index)æ¯ä¸ªæ–‡æ¡£çš„å†…å®¹ä½¿ä¹‹å¯ä»¥è¢«æœç´¢ã€‚åœ¨Elasticsearchä¸­ï¼Œä½ å¯ä»¥å¯¹æ–‡æ¡£ï¼ˆè€Œéæˆè¡Œæˆåˆ—çš„æ•°æ®ï¼‰è¿›è¡Œç´¢å¼•ã€æœç´¢ã€æ’åºã€è¿‡æ»¤ã€‚Elasticsearchæ¯”ä¼ ç»Ÿå…³ç³»å‹æ•°æ®åº“å¦‚ä¸‹ï¼šRelationalDBâ€&gt;Databasesâ€&gt;Tablesâ€&gt;Rowsâ€&gt;ColumnsElasticsearchâ€&gt;Indicesâ€&gt;Typesâ€&gt;Documentsâ€&gt;FieldsElasticsearchæ ¸å¿ƒæ¦‚å¿µç´¢å¼•indexä¸€ä¸ªç´¢å¼•å°±æ˜¯ä¸€ä¸ªæ‹¥æœ‰å‡ åˆ†ç›¸ä¼¼ç‰¹å¾çš„æ–‡æ¡£çš„é›†åˆã€‚æ¯”å¦‚è¯´ï¼Œä½ å¯ä»¥æœ‰ä¸€ä¸ªå®¢æˆ·æ•°æ®çš„ç´¢å¼•ï¼Œå¦ä¸€ä¸ªäº§å“ç›®å½•çš„ç´¢å¼•ï¼Œè¿˜æœ‰ä¸€ä¸ªè®¢å•æ•°æ®çš„ç´¢å¼•ã€‚ä¸€ä¸ªç´¢å¼•ç”±ä¸€ä¸ªåå­—æ¥æ ‡è¯†ï¼ˆå¿…é¡»å…¨éƒ¨æ˜¯å°å†™å­—æ¯çš„ï¼‰ï¼Œå¹¶ä¸”å½“æˆ‘ä»¬è¦å¯¹å¯¹åº”äºè¿™ä¸ªç´¢å¼•ä¸­çš„æ–‡æ¡£è¿›è¡Œç´¢å¼•ã€æœç´¢ã€æ›´æ–°å’Œåˆ é™¤çš„æ—¶å€™ï¼Œéƒ½è¦ä½¿ç”¨åˆ°è¿™ä¸ªåå­—ã€‚åœ¨ä¸€ä¸ªé›†ç¾¤ä¸­ï¼Œå¯ä»¥å®šä¹‰ä»»æ„å¤šçš„ç´¢å¼•ç±»å‹typeåœ¨ä¸€ä¸ªç´¢å¼•ä¸­ï¼Œä½ å¯ä»¥å®šä¹‰ä¸€ç§æˆ–å¤šç§ç±»å‹ã€‚ä¸€ä¸ªç±»å‹æ˜¯ä½ çš„ç´¢å¼•çš„ä¸€ä¸ªé€»è¾‘ä¸Šçš„åˆ†ç±»/åˆ†åŒºï¼Œå…¶è¯­ä¹‰å®Œå…¨ç”±ä½ æ¥å®šã€‚é€šå¸¸ï¼Œä¼šä¸ºå…·æœ‰ä¸€ç»„å…±åŒå­—æ®µçš„æ–‡æ¡£å®šä¹‰ä¸€ä¸ªç±»å‹ã€‚æ¯”å¦‚è¯´ï¼Œæˆ‘ä»¬å‡è®¾ä½ è¿è¥ä¸€ä¸ªåšå®¢å¹³å°å¹¶ä¸”å°†ä½ æ‰€æœ‰çš„æ•°æ®å­˜å‚¨åˆ°ä¸€ä¸ªç´¢å¼•ä¸­ã€‚åœ¨è¿™ä¸ªç´¢å¼•ä¸­ï¼Œä½ å¯ä»¥ä¸ºç”¨æˆ·æ•°æ®å®šä¹‰ä¸€ä¸ªç±»å‹ï¼Œä¸ºåšå®¢æ•°æ®å®šä¹‰å¦ä¸€ä¸ªç±»å‹ï¼Œå½“ç„¶ï¼Œä¹Ÿå¯ä»¥ä¸ºè¯„è®ºæ•°æ®å®šä¹‰å¦ä¸€ä¸ªç±»å‹ã€‚å­—æ®µFieldç›¸å½“äºæ˜¯æ•°æ®è¡¨çš„å­—æ®µï¼Œå¯¹æ–‡æ¡£æ•°æ®æ ¹æ®ä¸åŒå±æ€§è¿›è¡Œçš„åˆ†ç±»æ ‡è¯†æ˜ å°„mappingmappingæ˜¯å¤„ç†æ•°æ®çš„æ–¹å¼å’Œè§„åˆ™æ–¹é¢åšä¸€äº›é™åˆ¶ï¼Œå¦‚æŸä¸ªå­—æ®µçš„æ•°æ®ç±»å‹ã€é»˜è®¤å€¼ã€åˆ†æå™¨ã€æ˜¯å¦è¢«ç´¢å¼•ç­‰ç­‰ï¼Œè¿™äº›éƒ½æ˜¯æ˜ å°„é‡Œé¢å¯ä»¥è®¾ç½®çš„ï¼Œå…¶å®ƒå°±æ˜¯å¤„ç†esé‡Œé¢æ•°æ®çš„ä¸€äº›ä½¿ç”¨è§„åˆ™è®¾ç½®ä¹Ÿå«åšæ˜ å°„ï¼ŒæŒ‰ç€æœ€ä¼˜è§„åˆ™å¤„ç†æ•°æ®å¯¹æ€§èƒ½æé«˜å¾ˆå¤§ï¼Œå› æ­¤æ‰éœ€è¦å»ºç«‹æ˜ å°„ï¼Œå¹¶ä¸”éœ€è¦æ€è€ƒå¦‚ä½•å»ºç«‹æ˜ å°„æ‰èƒ½å¯¹æ€§èƒ½æ›´å¥½æ–‡æ¡£documentä¸€ä¸ªæ–‡æ¡£æ˜¯ä¸€ä¸ªå¯è¢«ç´¢å¼•çš„åŸºç¡€ä¿¡æ¯å•å…ƒã€‚æ¯”å¦‚ï¼Œä½ å¯ä»¥æ‹¥æœ‰æŸä¸€ä¸ªå®¢æˆ·çš„æ–‡æ¡£ï¼ŒæŸä¸€ä¸ªäº§å“çš„ä¸€ä¸ªæ–‡æ¡£ï¼Œå½“ç„¶ï¼Œä¹Ÿå¯ä»¥æ‹¥æœ‰æŸä¸ªè®¢å•çš„ä¸€ä¸ªæ–‡æ¡£ã€‚æ–‡æ¡£ä»¥JSONï¼ˆJavascriptObjectNotationï¼‰æ ¼å¼æ¥è¡¨ç¤ºï¼Œè€ŒJSONæ˜¯ä¸€ä¸ªåˆ°å¤„å­˜åœ¨çš„äº’è”ç½‘æ•°æ®äº¤äº’æ ¼å¼ã€‚åœ¨ä¸€ä¸ªindex/typeé‡Œé¢ï¼Œä½ å¯ä»¥å­˜å‚¨ä»»æ„å¤šçš„æ–‡æ¡£ã€‚æ³¨æ„ï¼Œå°½ç®¡ä¸€ä¸ªæ–‡æ¡£ï¼Œç‰©ç†ä¸Šå­˜åœ¨äºä¸€ä¸ªç´¢å¼•ä¹‹ä¸­ï¼Œæ–‡æ¡£å¿…é¡»è¢«ç´¢å¼•/èµ‹äºˆä¸€ä¸ªç´¢å¼•çš„typeã€‚æ¥è¿‘å®æ—¶NRTElasticsearchæ˜¯ä¸€ä¸ªæ¥è¿‘å®æ—¶çš„æœç´¢å¹³å°ã€‚è¿™æ„å‘³ç€ï¼Œä»ç´¢å¼•ä¸€ä¸ªæ–‡æ¡£ç›´åˆ°è¿™ä¸ªæ–‡æ¡£èƒ½å¤Ÿè¢«æœç´¢åˆ°æœ‰ä¸€ä¸ªè½»å¾®çš„å»¶è¿Ÿï¼ˆé€šå¸¸æ˜¯1ç§’ä»¥å†…ï¼‰é›†ç¾¤clusterä¸€ä¸ªé›†ç¾¤å°±æ˜¯ç”±ä¸€ä¸ªæˆ–å¤šä¸ªèŠ‚ç‚¹ç»„ç»‡åœ¨ä¸€èµ·ï¼Œå®ƒä»¬å…±åŒæŒæœ‰æ•´ä¸ªçš„æ•°æ®ï¼Œå¹¶ä¸€èµ·æä¾›ç´¢å¼•å’Œæœç´¢åŠŸèƒ½ã€‚ä¸€ä¸ªé›†ç¾¤ç”±ä¸€ä¸ªå”¯ä¸€çš„åå­—æ ‡è¯†ï¼Œè¿™ä¸ªåå­—é»˜è®¤å°±æ˜¯â€œelasticsearchâ€ã€‚è¿™ä¸ªåå­—æ˜¯é‡è¦çš„ï¼Œå› ä¸ºä¸€ä¸ªèŠ‚ç‚¹åªèƒ½é€šè¿‡æŒ‡å®šæŸä¸ªé›†ç¾¤çš„åå­—ï¼Œæ¥åŠ å…¥è¿™ä¸ªé›†ç¾¤èŠ‚ç‚¹nodeä¸€ä¸ªèŠ‚ç‚¹æ˜¯é›†ç¾¤ä¸­çš„ä¸€ä¸ªæœåŠ¡å™¨ï¼Œä½œä¸ºé›†ç¾¤çš„ä¸€éƒ¨åˆ†ï¼Œå®ƒå­˜å‚¨æ•°æ®ï¼Œå‚ä¸é›†ç¾¤çš„ç´¢å¼•å’Œæœç´¢åŠŸèƒ½ã€‚å’Œé›†ç¾¤ç±»ä¼¼ï¼Œä¸€ä¸ªèŠ‚ç‚¹ä¹Ÿæ˜¯ç”±ä¸€ä¸ªåå­—æ¥æ ‡è¯†çš„ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œè¿™ä¸ªåå­—æ˜¯ä¸€ä¸ªéšæœºçš„æ¼«å¨æ¼«ç”»è§’è‰²çš„åå­—ï¼Œè¿™ä¸ªåå­—ä¼šåœ¨å¯åŠ¨çš„æ—¶å€™èµ‹äºˆèŠ‚ç‚¹ã€‚è¿™ä¸ªåå­—å¯¹äºç®¡ç†å·¥ä½œæ¥è¯´æŒºé‡è¦çš„ï¼Œå› ä¸ºåœ¨è¿™ä¸ªç®¡ç†è¿‡ç¨‹ä¸­ï¼Œä½ ä¼šå»ç¡®å®šç½‘ç»œä¸­çš„å“ªäº›æœåŠ¡å™¨å¯¹åº”äºElasticsearché›†ç¾¤ä¸­çš„å“ªäº›èŠ‚ç‚¹ã€‚ä¸€ä¸ªèŠ‚ç‚¹å¯ä»¥é€šè¿‡é…ç½®é›†ç¾¤åç§°çš„æ–¹å¼æ¥åŠ å…¥ä¸€ä¸ªæŒ‡å®šçš„é›†ç¾¤ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½ä¼šè¢«å®‰æ’åŠ å…¥åˆ°ä¸€ä¸ªå«åšâ€œelasticsearchâ€çš„é›†ç¾¤ä¸­ï¼Œè¿™æ„å‘³ç€ï¼Œå¦‚æœä½ åœ¨ä½ çš„ç½‘ç»œä¸­å¯åŠ¨äº†è‹¥å¹²ä¸ªèŠ‚ç‚¹ï¼Œå¹¶å‡å®šå®ƒä»¬èƒ½å¤Ÿç›¸äº’å‘ç°å½¼æ­¤ï¼Œå®ƒä»¬å°†ä¼šè‡ªåŠ¨åœ°å½¢æˆå¹¶åŠ å…¥åˆ°ä¸€ä¸ªå«åšâ€œelasticsearchâ€çš„é›†ç¾¤ä¸­ã€‚åœ¨ä¸€ä¸ªé›†ç¾¤é‡Œï¼Œåªè¦ä½ æƒ³ï¼Œå¯ä»¥æ‹¥æœ‰ä»»æ„å¤šä¸ªèŠ‚ç‚¹ã€‚è€Œä¸”ï¼Œå¦‚æœå½“å‰ä½ çš„ç½‘ç»œä¸­æ²¡æœ‰è¿è¡Œä»»ä½•ElasticsearchèŠ‚ç‚¹ï¼Œè¿™æ—¶å¯åŠ¨ä¸€ä¸ªèŠ‚ç‚¹ï¼Œä¼šé»˜è®¤åˆ›å»ºå¹¶åŠ å…¥ä¸€ä¸ªå«åšâ€œelasticsearchâ€çš„é›†ç¾¤åˆ†ç‰‡å’Œå¤åˆ¶shards&amp;replicasä¸€ä¸ªç´¢å¼•å¯ä»¥å­˜å‚¨è¶…å‡ºå•ä¸ªç»“ç‚¹ç¡¬ä»¶é™åˆ¶çš„å¤§é‡æ•°æ®ã€‚æ¯”å¦‚ï¼Œä¸€ä¸ªå…·æœ‰10äº¿æ–‡æ¡£çš„ç´¢å¼•å æ®1TBçš„ç£ç›˜ç©ºé—´ï¼Œè€Œä»»ä¸€èŠ‚ç‚¹éƒ½æ²¡æœ‰è¿™æ ·å¤§çš„ç£ç›˜ç©ºé—´ï¼›æˆ–è€…å•ä¸ªèŠ‚ç‚¹å¤„ç†æœç´¢è¯·æ±‚ï¼Œå“åº”å¤ªæ…¢ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒElasticsearchæä¾›äº†å°†ç´¢å¼•åˆ’åˆ†æˆå¤šä»½çš„èƒ½åŠ›ï¼Œè¿™äº›ä»½å°±å«åšåˆ†ç‰‡ã€‚å½“ä½ åˆ›å»ºä¸€ä¸ªç´¢å¼•çš„æ—¶å€™ï¼Œä½ å¯ä»¥æŒ‡å®šä½ æƒ³è¦çš„åˆ†ç‰‡çš„æ•°é‡ã€‚æ¯ä¸ªåˆ†ç‰‡æœ¬èº«ä¹Ÿæ˜¯ä¸€ä¸ªåŠŸèƒ½å®Œå–„å¹¶ä¸”ç‹¬ç«‹çš„â€œç´¢å¼•â€ï¼Œè¿™ä¸ªâ€œç´¢å¼•â€å¯ä»¥è¢«æ”¾ç½®åˆ°é›†ç¾¤ä¸­çš„ä»»ä½•èŠ‚ç‚¹ä¸Šã€‚åˆ†ç‰‡å¾ˆé‡è¦ï¼Œä¸»è¦æœ‰ä¸¤æ–¹é¢çš„åŸå› ï¼šâ€‹1ï¼‰å…è®¸ä½ æ°´å¹³åˆ†å‰²/æ‰©å±•ä½ çš„å†…å®¹å®¹é‡ã€‚â€‹2ï¼‰å…è®¸ä½ åœ¨åˆ†ç‰‡ï¼ˆæ½œåœ¨åœ°ï¼Œä½äºå¤šä¸ªèŠ‚ç‚¹ä¸Šï¼‰ä¹‹ä¸Šè¿›è¡Œåˆ†å¸ƒå¼çš„ã€å¹¶è¡Œçš„æ“ä½œï¼Œè¿›è€Œæé«˜æ€§èƒ½/ååé‡ã€‚è‡³äºä¸€ä¸ªåˆ†ç‰‡æ€æ ·åˆ†å¸ƒï¼Œå®ƒçš„æ–‡æ¡£æ€æ ·èšåˆå›æœç´¢è¯·æ±‚ï¼Œæ˜¯å®Œå…¨ç”±Elasticsearchç®¡ç†çš„ï¼Œå¯¹äºä½œä¸ºç”¨æˆ·çš„ä½ æ¥è¯´ï¼Œè¿™äº›éƒ½æ˜¯é€æ˜çš„ã€‚åœ¨ä¸€ä¸ªç½‘ç»œ/äº‘çš„ç¯å¢ƒé‡Œï¼Œå¤±è´¥éšæ—¶éƒ½å¯èƒ½å‘ç”Ÿï¼Œåœ¨æŸä¸ªåˆ†ç‰‡/èŠ‚ç‚¹ä¸çŸ¥æ€ä¹ˆçš„å°±å¤„äºç¦»çº¿çŠ¶æ€ï¼Œæˆ–è€…ç”±äºä»»ä½•åŸå› æ¶ˆå¤±äº†ï¼Œè¿™ç§æƒ…å†µä¸‹ï¼Œæœ‰ä¸€ä¸ªæ•…éšœè½¬ç§»æœºåˆ¶æ˜¯éå¸¸æœ‰ç”¨å¹¶ä¸”æ˜¯å¼ºçƒˆæ¨èçš„ã€‚ä¸ºæ­¤ç›®çš„ï¼ŒElasticsearchå…è®¸ä½ åˆ›å»ºåˆ†ç‰‡çš„ä¸€ä»½æˆ–å¤šä»½æ‹·è´ï¼Œè¿™äº›æ‹·è´å«åšå¤åˆ¶åˆ†ç‰‡ï¼Œæˆ–è€…ç›´æ¥å«å¤åˆ¶ã€‚å¤åˆ¶ä¹‹æ‰€ä»¥é‡è¦ï¼Œæœ‰ä¸¤ä¸ªä¸»è¦åŸå› ï¼šåœ¨åˆ†ç‰‡/èŠ‚ç‚¹å¤±è´¥çš„æƒ…å†µä¸‹ï¼Œæä¾›äº†é«˜å¯ç”¨æ€§ã€‚å› ä¸ºè¿™ä¸ªåŸå› ï¼Œæ³¨æ„åˆ°å¤åˆ¶åˆ†ç‰‡ä»ä¸ä¸åŸ/ä¸»è¦ï¼ˆoriginal/primaryï¼‰åˆ†ç‰‡ç½®äºåŒä¸€èŠ‚ç‚¹ä¸Šæ˜¯éå¸¸é‡è¦çš„ã€‚æ‰©å±•ä½ çš„æœç´¢é‡/ååé‡ï¼Œå› ä¸ºæœç´¢å¯ä»¥åœ¨æ‰€æœ‰çš„å¤åˆ¶ä¸Šå¹¶è¡Œè¿è¡Œã€‚æ€»ä¹‹ï¼Œæ¯ä¸ªç´¢å¼•å¯ä»¥è¢«åˆ†æˆå¤šä¸ªåˆ†ç‰‡ã€‚ä¸€ä¸ªç´¢å¼•ä¹Ÿå¯ä»¥è¢«å¤åˆ¶0æ¬¡ï¼ˆæ„æ€æ˜¯æ²¡æœ‰å¤åˆ¶ï¼‰æˆ–å¤šæ¬¡ã€‚ä¸€æ—¦å¤åˆ¶äº†ï¼Œæ¯ä¸ªç´¢å¼•å°±æœ‰äº†ä¸»åˆ†ç‰‡ï¼ˆä½œä¸ºå¤åˆ¶æºçš„åŸæ¥çš„åˆ†ç‰‡ï¼‰å’Œå¤åˆ¶åˆ†ç‰‡ï¼ˆä¸»åˆ†ç‰‡çš„æ‹·è´ï¼‰ä¹‹åˆ«ã€‚åˆ†ç‰‡å’Œå¤åˆ¶çš„æ•°é‡å¯ä»¥åœ¨ç´¢å¼•åˆ›å»ºçš„æ—¶å€™æŒ‡å®šã€‚åœ¨ç´¢å¼•åˆ›å»ºä¹‹åï¼Œä½ å¯ä»¥åœ¨ä»»ä½•æ—¶å€™åŠ¨æ€åœ°æ”¹å˜å¤åˆ¶çš„æ•°é‡ï¼Œä½†æ˜¯ä½ äº‹åä¸èƒ½æ”¹å˜åˆ†ç‰‡çš„æ•°é‡ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒElasticsearchä¸­çš„æ¯ä¸ªç´¢å¼•è¢«åˆ†ç‰‡5ä¸ªä¸»åˆ†ç‰‡å’Œ1ä¸ªå¤åˆ¶ï¼Œè¿™æ„å‘³ç€ï¼Œå¦‚æœä½ çš„é›†ç¾¤ä¸­è‡³å°‘æœ‰ä¸¤ä¸ªèŠ‚ç‚¹ï¼Œä½ çš„ç´¢å¼•å°†ä¼šæœ‰5ä¸ªä¸»åˆ†ç‰‡å’Œå¦å¤–5ä¸ªå¤åˆ¶åˆ†ç‰‡ï¼ˆ1ä¸ªå®Œå…¨æ‹·è´ï¼‰ï¼Œè¿™æ ·çš„è¯æ¯ä¸ªç´¢å¼•æ€»å…±å°±æœ‰10ä¸ªåˆ†ç‰‡ã€‚ElasticSearchçš„å®¢æˆ·ç«¯æ“ä½œä¸‹è½½PostManPostmanå®˜ç½‘ï¼šhttps://www.getpostman.comä½¿ç”¨Postmanå·¥å…·è¿›è¡ŒRestfulæ¥å£è®¿é—®ElasticSearchçš„æ¥å£è¯­æ³•curlâ€X'ğŸ˜•/:/?&lt;QUERY_STRING&gt;'â€d''å‚æ•°è§£é‡ŠVERBé€‚å½“çš„HTTPæ–¹æ³•æˆ–è°“è¯:GETã€POSTã€PUTã€HEADæˆ–è€…DELETEPROTOCOLhttpæˆ–è€…httpsï¼ˆå¦‚æœä½ åœ¨Elasticsearchå‰é¢æœ‰ä¸€ä¸ªhttpsä»£ç†ï¼‰HOSTElasticsearché›†ç¾¤ä¸­ä»»æ„èŠ‚ç‚¹çš„ä¸»æœºåï¼Œæˆ–è€…ç”¨localhostä»£è¡¨æœ¬åœ°æœºå™¨ä¸Šçš„èŠ‚ç‚¹PORTè¿è¡ŒElasticsearchHTTPæœåŠ¡çš„ç«¯å£å·ï¼Œé»˜è®¤æ˜¯9200PATHAPIçš„ç»ˆç«¯è·¯å¾„ï¼ˆä¾‹å¦‚_countå°†è¿”å›é›†ç¾¤ä¸­æ–‡æ¡£æ•°é‡ï¼‰ã€‚Pathå¯èƒ½åŒ…å«å¤šä¸ªç»„ä»¶ï¼Œä¾‹å¦‚ï¼š_cluster/statså’Œ_nodes/stats/jvmQUERY_STRINGä»»æ„å¯é€‰çš„æŸ¥è¯¢å­—ç¬¦ä¸²å‚æ•°(ä¾‹å¦‚?prettyå°†æ ¼å¼åŒ–åœ°è¾“å‡ºJSONè¿”å›å€¼ï¼Œä½¿å…¶æ›´å®¹æ˜“é˜…è¯»)BODYä¸€ä¸ªJSONæ ¼å¼çš„è¯·æ±‚ä½“(å¦‚æœè¯·æ±‚éœ€è¦çš„è¯)åˆ›å»ºç´¢å¼•indexå’Œæ˜ å°„mappingcurlPUThttp://127.0.0.1:9200/blog1body{&quot;mappings&quot;:{&quot;article&quot;:{&quot;properties&quot;:{&quot;id&quot;:{&quot;type&quot;:&quot;long&quot;,&quot;store&quot;:true,&quot;index&quot;:&quot;not_analyzed&quot;},&quot;title&quot;:{&quot;type&quot;:&quot;text&quot;,&quot;store&quot;:true,&quot;index&quot;:&quot;analyzed&quot;,&quot;analyzer&quot;:&quot;standard&quot;},&quot;content&quot;:{&quot;type&quot;:&quot;text&quot;,&quot;store&quot;:true,&quot;index&quot;:&quot;analyzed&quot;,&quot;analyzer&quot;:&quot;standard&quot;}}}}}response{&quot;acknowledged&quot;:true,&quot;shards_acknowledged&quot;:true,&quot;index&quot;:&quot;blog1&quot;}åˆ›å»ºç´¢å¼•åè®¾ç½®Mappingå¯ä»¥åœ¨åˆ›å»ºç´¢å¼•æ—¶è®¾ç½®mappingä¿¡æ¯ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥å…ˆåˆ›å»ºç´¢å¼•ç„¶åå†è®¾ç½®mappingã€‚åœ¨ä¸Šä¸€ä¸ªæ­¥éª¤ä¸­ä¸è®¾ç½®mapingä¿¡æ¯ï¼Œç›´æ¥ä½¿ç”¨putæ–¹æ³•åˆ›å»ºä¸€ä¸ªç´¢å¼•ï¼Œç„¶åè®¾ç½®mappingä¿¡æ¯ã€‚curlposthttp://127.0.0.1:9200/blog2/hello/_mappingbody{&quot;hello&quot;:{&quot;properties&quot;:{&quot;id&quot;:{&quot;type&quot;:&quot;long&quot;,&quot;store&quot;:true},&quot;title&quot;:{&quot;type&quot;:&quot;text&quot;,&quot;store&quot;:true,&quot;index&quot;:true,&quot;analyzer&quot;:&quot;standard&quot;},&quot;content&quot;:{&quot;type&quot;:&quot;text&quot;,&quot;store&quot;:true,&quot;index&quot;:true,&quot;analyzer&quot;:&quot;standard&quot;}}}}response{&quot;acknowledged&quot;:true}åˆ é™¤ç´¢å¼•indexcurldeletehttp://127.0.0.1:9200/blog1response{&quot;acknowledged&quot;:true}åˆ›å»ºæ–‡æ¡£documentcurlposthttp://127.0.0.1:9200/blog1/article/1body{&quot;id&quot;:1,&quot;title&quot;:&quot;ElasticSearchæ˜¯ä¸€ä¸ªåŸºäºLuceneçš„æœç´¢æœåŠ¡å™¨&quot;,&quot;content&quot;:&quot;å®ƒæä¾›äº†ä¸€ä¸ªåˆ†å¸ƒå¼å¤šç”¨æˆ·èƒ½åŠ›çš„å…¨æ–‡æœç´¢å¼•æ“ï¼ŒåŸºäºRESTfulwebæ¥å£ã€‚Elasticsearchæ˜¯ç”¨Javaå¼€å‘çš„ï¼Œå¹¶ä½œä¸ºApacheè®¸å¯æ¡æ¬¾ä¸‹çš„å¼€æ”¾æºç å‘å¸ƒï¼Œæ˜¯å½“å‰æµè¡Œçš„ä¼ä¸šçº§æœç´¢å¼•æ“ã€‚è®¾è®¡ç”¨äºäº‘è®¡ç®—ä¸­ï¼Œèƒ½å¤Ÿè¾¾åˆ°å®æ—¶æœç´¢ï¼Œç¨³å®šï¼Œå¯é ï¼Œå¿«é€Ÿï¼Œå®‰è£…ä½¿ç”¨æ–¹ä¾¿ã€‚&quot;}response{&quot;_index&quot;:&quot;blog1&quot;,&quot;_type&quot;:&quot;article&quot;,&quot;_id&quot;:&quot;1&quot;,&quot;_version&quot;:1,&quot;result&quot;:&quot;created&quot;,&quot;_shards&quot;:{&quot;total&quot;:2,&quot;successful&quot;:1,&quot;failed&quot;:0},&quot;created&quot;:true}ä¿®æ”¹æ–‡æ¡£documentcurlposthttp://127.0.0.1:9200/blog1/article/1body{&quot;id&quot;:1,&quot;title&quot;:&quot;[ä¿®æ”¹]ElasticSearchæ˜¯ä¸€ä¸ªåŸºäºLuceneçš„æœç´¢æœåŠ¡å™¨&quot;,&quot;content&quot;:&quot;[ä¿®æ”¹]å®ƒæä¾›äº†ä¸€ä¸ªåˆ†å¸ƒå¼å¤šç”¨æˆ·èƒ½åŠ›çš„å…¨æ–‡æœç´¢å¼•æ“ï¼ŒåŸºäºRESTfulwebæ¥å£ã€‚Elasticsearchæ˜¯ç”¨Javaå¼€å‘çš„ï¼Œå¹¶ä½œä¸ºApacheè®¸å¯æ¡æ¬¾ä¸‹çš„å¼€æ”¾æºç å‘å¸ƒï¼Œæ˜¯å½“å‰æµè¡Œçš„ä¼ä¸šçº§æœç´¢å¼•æ“ã€‚è®¾è®¡ç”¨äºäº‘è®¡ç®—ä¸­ï¼Œèƒ½å¤Ÿè¾¾åˆ°å®æ—¶æœç´¢ï¼Œç¨³å®šï¼Œå¯é ï¼Œå¿«é€Ÿï¼Œå®‰è£…ä½¿ç”¨æ–¹ä¾¿ã€‚&quot;}response{&quot;_index&quot;:&quot;blog1&quot;,&quot;_type&quot;:&quot;article&quot;,&quot;_id&quot;:&quot;1&quot;,&quot;_version&quot;:2,&quot;result&quot;:&quot;updated&quot;,&quot;_shards&quot;:{&quot;total&quot;:2,&quot;successful&quot;:1,&quot;failed&quot;:0},&quot;created&quot;:false}åˆ é™¤æ–‡æ¡£documentcurldeletehttp://127.0.0.1:9200/blog1/article/1response{&quot;found&quot;:true,&quot;_index&quot;:&quot;blog1&quot;,&quot;_type&quot;:&quot;article&quot;,&quot;_id&quot;:&quot;1&quot;,&quot;_version&quot;:3,&quot;result&quot;:&quot;deleted&quot;,&quot;_shards&quot;:{&quot;total&quot;:2,&quot;successful&quot;:1,&quot;failed&quot;:0}}æŸ¥è¯¢æ–‡æ¡£-æ ¹æ®idæŸ¥è¯¢curlgethttp://127.0.0.1:9200/blog1/article/1response{&quot;_index&quot;:&quot;blog1&quot;,&quot;_type&quot;:&quot;article&quot;,&quot;_id&quot;:&quot;1&quot;,&quot;_version&quot;:1,&quot;found&quot;:true,&quot;_source&quot;:{&quot;id&quot;:1,&quot;title&quot;:&quot;[ä¿®æ”¹]ElasticSearchæ˜¯ä¸€ä¸ªåŸºäºLuceneçš„æœç´¢æœåŠ¡å™¨&quot;,&quot;content&quot;:&quot;[ä¿®æ”¹]å®ƒæä¾›äº†ä¸€ä¸ªåˆ†å¸ƒå¼å¤šç”¨æˆ·èƒ½åŠ›çš„å…¨æ–‡æœç´¢å¼•æ“ï¼ŒåŸºäºRESTfulwebæ¥å£ã€‚Elasticsearchæ˜¯ç”¨Javaå¼€å‘çš„ï¼Œå¹¶ä½œä¸ºApacheè®¸å¯æ¡æ¬¾ä¸‹çš„å¼€æ”¾æºç å‘å¸ƒï¼Œæ˜¯å½“å‰æµè¡Œçš„ä¼ä¸šçº§æœç´¢å¼•æ“ã€‚è®¾è®¡ç”¨äºäº‘è®¡ç®—ä¸­ï¼Œèƒ½å¤Ÿè¾¾åˆ°å®æ—¶æœç´¢ï¼Œç¨³å®šï¼Œå¯é ï¼Œå¿«é€Ÿï¼Œå®‰è£…ä½¿ç”¨æ–¹ä¾¿ã€‚&quot;}}æŸ¥è¯¢æ–‡æ¡£-querystringæŸ¥è¯¢curlposthttp://127.0.0.1:9200/blog1/article/_searchbody{&quot;query&quot;:{&quot;query_string&quot;:{&quot;default_field&quot;:&quot;title&quot;,&quot;query&quot;:&quot;æœç´¢æœåŠ¡å™¨&quot;}}}response{&quot;took&quot;:24,&quot;timed_out&quot;:false,&quot;_shards&quot;:{&quot;total&quot;:5,&quot;successful&quot;:5,&quot;skipped&quot;:0,&quot;failed&quot;:0},&quot;hits&quot;:{&quot;total&quot;:1,&quot;max_score&quot;:1.4002227,&quot;hits&quot;:[{&quot;_index&quot;:&quot;blog1&quot;,&quot;_type&quot;:&quot;article&quot;,&quot;_id&quot;:&quot;1&quot;,&quot;_score&quot;:1.4002227,&quot;_source&quot;:{&quot;id&quot;:1,&quot;title&quot;:&quot;[ä¿®æ”¹]ElasticSearchæ˜¯ä¸€ä¸ªåŸºäºLuceneçš„æœç´¢æœåŠ¡å™¨&quot;,&quot;content&quot;:&quot;[ä¿®æ”¹]å®ƒæä¾›äº†ä¸€ä¸ªåˆ†å¸ƒå¼å¤šç”¨æˆ·èƒ½åŠ›çš„å…¨æ–‡æœç´¢å¼•æ“ï¼ŒåŸºäºRESTfulwebæ¥å£ã€‚Elasticsearchæ˜¯ç”¨Javaå¼€å‘çš„ï¼Œå¹¶ä½œä¸ºApacheè®¸å¯æ¡æ¬¾ä¸‹çš„å¼€æ”¾æºç å‘å¸ƒï¼Œæ˜¯å½“å‰æµè¡Œçš„ä¼ä¸šçº§æœç´¢å¼•æ“ã€‚è®¾è®¡ç”¨äºäº‘è®¡ç®—ä¸­ï¼Œèƒ½å¤Ÿè¾¾åˆ°å®æ—¶æœç´¢ï¼Œç¨³å®šï¼Œå¯é ï¼Œå¿«é€Ÿï¼Œå®‰è£…ä½¿ç”¨æ–¹ä¾¿ã€‚&quot;}}]}}æ³¨æ„ï¼šå°†æœç´¢å†…å®¹&quot;æœç´¢æœåŠ¡å™¨&quot;ä¿®æ”¹ä¸º&quot;é’¢ç´¢&quot;ï¼ŒåŒæ ·ä¹Ÿèƒ½æœç´¢åˆ°æ–‡æ¡£ï¼Œè¿™æ˜¯å› ä¸ºESæ˜¯æ­ªæœä»å¼€å‘çš„äº§å“ï¼Œæ‰€ä»¥å¯¹ä¸­æ–‡åˆ†è¯ä¸å‹å¥½ï¼Œéœ€è¦ä½¿ç”¨åˆ†è¯æ’ä»¶ï¼ˆIKåˆ†è¯å™¨ï¼‰æ¥è§£å†³ä¸­æ–‡åˆ†è¯é—®é¢˜æŸ¥è¯¢æ–‡æ¡£-termæŸ¥è¯¢curlposthttp://127.0.0.1:9200/blog1/article/_searchbody{&quot;query&quot;:{&quot;term&quot;:{&quot;title&quot;:&quot;æœç´¢&quot;}}}response{&quot;took&quot;:1,&quot;timed_out&quot;:false,&quot;_shards&quot;:{&quot;total&quot;:5,&quot;successful&quot;:5,&quot;skipped&quot;:0,&quot;failed&quot;:0},&quot;hits&quot;:{&quot;total&quot;:0,&quot;max_score&quot;:null,&quot;hits&quot;:[]}}ElasticSearché›†æˆIKåˆ†è¯å™¨ä¸Šè¿°æŸ¥è¯¢å­˜åœ¨é—®é¢˜åˆ†æåœ¨è¿›è¡Œå­—ç¬¦ä¸²æŸ¥è¯¢æ—¶ï¼Œæˆ‘ä»¬å‘ç°å»æœç´¢&quot;æœç´¢æœåŠ¡å™¨&quot;å’Œ&quot;é’¢ç´¢&quot;éƒ½å¯ä»¥æœç´¢åˆ°æ•°æ®ï¼›è€Œåœ¨è¿›è¡Œè¯æ¡æŸ¥è¯¢æ—¶ï¼Œæˆ‘ä»¬æœç´¢&quot;æœç´¢&quot;å´æ²¡æœ‰æœç´¢åˆ°æ•°æ®ï¼›ç©¶å…¶åŸå› æ˜¯ElasticSearchçš„æ ‡å‡†åˆ†è¯å™¨å¯¼è‡´çš„ï¼Œå½“æˆ‘ä»¬åˆ›å»ºç´¢å¼•æ—¶ï¼Œå­—æ®µä½¿ç”¨çš„æ˜¯æ ‡å‡†åˆ†è¯å™¨ï¼š&quot;analyzer&quot;:&quot;standard&quot;//æ ‡å‡†åˆ†è¯å™¨ä¾‹å¦‚å¯¹&quot;æˆ‘æ˜¯ç¨‹åºå‘˜&quot;è¿›è¡Œåˆ†è¯æ ‡å‡†åˆ†è¯å™¨åˆ†è¯æ•ˆæœæµ‹è¯•ï¼šcurlgethttp://127.0.0.1:9200/_analyze?analyzer=standard&amp;pretty=true&amp;text=æˆ‘æ˜¯ç¨‹åºå‘˜åˆ†è¯ç»“æœ{&quot;tokens&quot;:[{&quot;token&quot;:&quot;æˆ‘&quot;,&quot;start_offset&quot;:0,&quot;end_offset&quot;:1,&quot;type&quot;:&quot;&lt;IDEOGRAPHIC&gt;&quot;,&quot;position&quot;:0},{&quot;token&quot;:&quot;æ˜¯&quot;,&quot;start_offset&quot;:1,&quot;end_offset&quot;:2,&quot;type&quot;:&quot;&lt;IDEOGRAPHIC&gt;&quot;,&quot;position&quot;:1},{&quot;token&quot;:&quot;ç¨‹&quot;,&quot;start_offset&quot;:2,&quot;end_offset&quot;:3,&quot;type&quot;:&quot;&lt;IDEOGRAPHIC&gt;&quot;,&quot;position&quot;:2},{&quot;token&quot;:&quot;åº&quot;,&quot;start_offset&quot;:3,&quot;end_offset&quot;:4,&quot;type&quot;:&quot;&lt;IDEOGRAPHIC&gt;&quot;,&quot;position&quot;:3},{&quot;token&quot;:&quot;å‘˜&quot;,&quot;start_offset&quot;:4,&quot;end_offset&quot;:5,&quot;type&quot;:&quot;&lt;IDEOGRAPHIC&gt;&quot;,&quot;position&quot;:4}]}è€Œæˆ‘ä»¬éœ€è¦çš„åˆ†è¯æ•ˆæœæ˜¯ï¼šæˆ‘ã€æ˜¯ã€ç¨‹åºã€ç¨‹åºå‘˜è¿™æ ·çš„è¯å°±éœ€è¦å¯¹ä¸­æ–‡æ”¯æŒè‰¯å¥½çš„åˆ†æå™¨çš„æ”¯æŒï¼Œæ”¯æŒä¸­æ–‡åˆ†è¯çš„åˆ†è¯å™¨æœ‰å¾ˆå¤šï¼Œwordåˆ†è¯å™¨ã€åº–ä¸è§£ç‰›ã€ç›˜å¤åˆ†è¯ã€Ansjåˆ†è¯ç­‰ï¼Œä½†æˆ‘ä»¬å¸¸ç”¨çš„è¿˜æ˜¯ä¸‹é¢è¦ä»‹ç»çš„IKåˆ†è¯å™¨ã€‚IKåˆ†è¯å™¨ç®€ä»‹IKAnalyzeræ˜¯ä¸€ä¸ªå¼€æºçš„ï¼ŒåŸºäºjavaè¯­è¨€å¼€å‘çš„è½»é‡çº§çš„ä¸­æ–‡åˆ†è¯å·¥å…·åŒ…ã€‚ä»2006å¹´12æœˆæ¨å‡º1.0ç‰ˆå¼€å§‹ï¼ŒIKAnalyzerå·²ç»æ¨å‡ºäº†3ä¸ªå¤§ç‰ˆæœ¬ã€‚æœ€åˆï¼Œå®ƒæ˜¯ä»¥å¼€æºé¡¹ç›®Luceneä¸ºåº”ç”¨ä¸»ä½“çš„ï¼Œç»“åˆè¯å…¸åˆ†è¯å’Œæ–‡æ³•åˆ†æç®—æ³•çš„ä¸­æ–‡åˆ†è¯ç»„ä»¶ã€‚æ–°ç‰ˆæœ¬çš„IKAnalyzer3.0åˆ™å‘å±•ä¸ºé¢å‘Javaçš„å…¬ç”¨åˆ†è¯ç»„ä»¶ï¼Œç‹¬ç«‹äºLuceneé¡¹ç›®ï¼ŒåŒæ—¶æä¾›äº†å¯¹Luceneçš„é»˜è®¤ä¼˜åŒ–å®ç°ã€‚IKåˆ†è¯å™¨3.0çš„ç‰¹æ€§å¦‚ä¸‹ï¼šé‡‡ç”¨äº†ç‰¹æœ‰çš„â€œæ­£å‘è¿­ä»£æœ€ç»†ç²’åº¦åˆ‡åˆ†ç®—æ³•â€œï¼Œå…·æœ‰60ä¸‡å­—/ç§’çš„é«˜é€Ÿå¤„ç†èƒ½åŠ›ã€‚é‡‡ç”¨äº†å¤šå­å¤„ç†å™¨åˆ†ææ¨¡å¼ï¼Œæ”¯æŒï¼šè‹±æ–‡å­—æ¯ï¼ˆIPåœ°å€ã€Emailã€URLï¼‰ã€æ•°å­—ï¼ˆæ—¥æœŸï¼Œå¸¸ç”¨ä¸­æ–‡æ•°é‡è¯ï¼Œç½—é©¬æ•°å­—ï¼Œç§‘å­¦è®¡æ•°æ³•ï¼‰ï¼Œä¸­æ–‡è¯æ±‡ï¼ˆå§“åã€åœ°åå¤„ç†ï¼‰ç­‰åˆ†è¯å¤„ç†ã€‚å¯¹ä¸­è‹±è”åˆæ”¯æŒä¸æ˜¯å¾ˆå¥½,åœ¨è¿™æ–¹é¢çš„å¤„ç†æ¯”è¾ƒéº»çƒ¦.éœ€å†åšä¸€æ¬¡æŸ¥è¯¢,åŒæ—¶æ˜¯æ”¯æŒä¸ªäººè¯æ¡çš„ä¼˜åŒ–çš„è¯å…¸å­˜å‚¨ï¼Œæ›´å°çš„å†…å­˜å ç”¨ã€‚æ”¯æŒç”¨æˆ·è¯å…¸æ‰©å±•å®šä¹‰ã€‚é’ˆå¯¹Luceneå…¨æ–‡æ£€ç´¢ä¼˜åŒ–çš„æŸ¥è¯¢åˆ†æå™¨IKQueryParserï¼›é‡‡ç”¨æ­§ä¹‰åˆ†æç®—æ³•ä¼˜åŒ–æŸ¥è¯¢å…³é”®å­—çš„æœç´¢æ’åˆ—ç»„åˆï¼Œèƒ½æå¤§çš„æé«˜Luceneæ£€ç´¢çš„å‘½ä¸­ç‡ã€‚ElasticSearché›†æˆIKåˆ†è¯å™¨IKåˆ†è¯å™¨çš„å®‰è£…1ã€ä¸‹è½½åœ°å€ï¼šhttps://github.com/medcl/elasticsearch-analysis-ik/releases2ã€è§£å‹ï¼Œå°†è§£å‹åçš„elasticsearchæ–‡ä»¶å¤¹æ‹·è´åˆ°elasticsearch-5.6.8\\pluginsä¸‹ï¼Œå¹¶é‡å‘½åæ–‡ä»¶å¤¹ä¸ºanalysis-ik3ã€é‡æ–°å¯åŠ¨ElasticSearchï¼Œå³å¯åŠ è½½IKåˆ†è¯å™¨IKåˆ†è¯å™¨æµ‹è¯•IKæä¾›äº†ä¸¤ä¸ªåˆ†è¯ç®—æ³•ik_smartå’Œik_max_wordå…¶ä¸­ik_smartä¸ºæœ€å°‘åˆ‡åˆ†ï¼Œik_max_wordä¸ºæœ€ç»†ç²’åº¦åˆ’åˆ†1ã€æœ€å°åˆ‡åˆ†curlgethttp://127.0.0.1:9200/_analyze?analyzer=ik_smart&amp;pretty=true&amp;text=æˆ‘æ˜¯ç¨‹åºå‘˜response{&quot;tokens&quot;:[{&quot;token&quot;:&quot;æˆ‘&quot;,&quot;start_offset&quot;:0,&quot;end_offset&quot;:1,&quot;type&quot;:&quot;CN_CHAR&quot;,&quot;position&quot;:0},{&quot;token&quot;:&quot;æ˜¯&quot;,&quot;start_offset&quot;:1,&quot;end_offset&quot;:2,&quot;type&quot;:&quot;CN_CHAR&quot;,&quot;position&quot;:1},{&quot;token&quot;:&quot;ç¨‹åºå‘˜&quot;,&quot;start_offset&quot;:2,&quot;end_offset&quot;:5,&quot;type&quot;:&quot;CN_WORD&quot;,&quot;position&quot;:2}]}2ã€æœ€ç»†åˆ‡åˆ†curlgethttp://127.0.0.1:9200/_analyze?analyzer=ik_max_word&amp;pretty=true&amp;text=æˆ‘æ˜¯ç¨‹åºå‘˜response{&quot;tokens&quot;:[{&quot;token&quot;:&quot;æˆ‘&quot;,&quot;start_offset&quot;:0,&quot;end_offset&quot;:1,&quot;type&quot;:&quot;CN_CHAR&quot;,&quot;position&quot;:0},{&quot;token&quot;:&quot;æ˜¯&quot;,&quot;start_offset&quot;:1,&quot;end_offset&quot;:2,&quot;type&quot;:&quot;CN_CHAR&quot;,&quot;position&quot;:1},{&quot;token&quot;:&quot;ç¨‹åºå‘˜&quot;,&quot;start_offset&quot;:2,&quot;end_offset&quot;:5,&quot;type&quot;:&quot;CN_WORD&quot;,&quot;position&quot;:2},{&quot;token&quot;:&quot;ç¨‹åº&quot;,&quot;start_offset&quot;:2,&quot;end_offset&quot;:4,&quot;type&quot;:&quot;CN_WORD&quot;,&quot;position&quot;:3},{&quot;token&quot;:&quot;å‘˜&quot;,&quot;start_offset&quot;:4,&quot;end_offset&quot;:5,&quot;type&quot;:&quot;CN_CHAR&quot;,&quot;position&quot;:4}]}ä¿®æ”¹ç´¢å¼•æ˜ å°„mappingé‡å»ºç´¢å¼•åˆ é™¤åŸæœ‰blog1ç´¢å¼•curldeletehttp://127.0.0.1:9200/blog1åˆ›å»ºblog1ç´¢å¼•ï¼Œæ­¤æ—¶åˆ†è¯å™¨ä½¿ç”¨ik_max_wordcurlputhttp://127.0.0.1:9200/blog1body{&quot;mappings&quot;:{&quot;article&quot;:{&quot;properties&quot;:{&quot;id&quot;:{&quot;type&quot;:&quot;long&quot;,&quot;store&quot;:true,&quot;index&quot;:&quot;not_analyzed&quot;},&quot;title&quot;:{&quot;type&quot;:&quot;text&quot;,&quot;store&quot;:true,&quot;index&quot;:&quot;analyzed&quot;,&quot;analyzer&quot;:&quot;ik_max_word&quot;},&quot;content&quot;:{&quot;type&quot;:&quot;text&quot;,&quot;store&quot;:true,&quot;index&quot;:&quot;analyzed&quot;,&quot;analyzer&quot;:&quot;ik_max_word&quot;}}}}}åˆ›å»ºæ–‡æ¡£curlposthttp://127.0.0.1:9200/blog1/article/1body{&quot;id&quot;:1,&quot;title&quot;:&quot;ElasticSearchæ˜¯ä¸€ä¸ªåŸºäºLuceneçš„æœç´¢æœåŠ¡å™¨&quot;,&quot;content&quot;:&quot;å®ƒæä¾›äº†ä¸€ä¸ªåˆ†å¸ƒå¼å¤šç”¨æˆ·èƒ½åŠ›çš„å…¨æ–‡æœç´¢å¼•æ“ï¼ŒåŸºäºRESTfulwebæ¥å£ã€‚Elasticsearchæ˜¯ç”¨Javaå¼€å‘çš„ï¼Œå¹¶ä½œä¸ºApacheè®¸å¯æ¡æ¬¾ä¸‹çš„å¼€æ”¾æºç å‘å¸ƒï¼Œæ˜¯å½“å‰æµè¡Œçš„ä¼ä¸šçº§æœç´¢å¼•æ“ã€‚è®¾è®¡ç”¨äºäº‘è®¡ç®—ä¸­ï¼Œèƒ½å¤Ÿè¾¾åˆ°å®æ—¶æœç´¢ï¼Œç¨³å®šï¼Œå¯é ï¼Œå¿«é€Ÿï¼Œå®‰è£…ä½¿ç”¨æ–¹ä¾¿ã€‚&quot;}æµ‹è¯•queryStringæŸ¥è¯¢curlposthttp://127.0.0.1:9200/blog1/article/_searchresponse{&quot;took&quot;:101,&quot;timed_out&quot;:false,&quot;_shards&quot;:{&quot;total&quot;:5,&quot;successful&quot;:5,&quot;skipped&quot;:0,&quot;failed&quot;:0},&quot;hits&quot;:{&quot;total&quot;:1,&quot;max_score&quot;:1.012641,&quot;hits&quot;:[{&quot;_index&quot;:&quot;blog1&quot;,&quot;_type&quot;:&quot;article&quot;,&quot;_id&quot;:&quot;1&quot;,&quot;_score&quot;:1.012641,&quot;_source&quot;:{&quot;id&quot;:1,&quot;title&quot;:&quot;ElasticSearchæ˜¯ä¸€ä¸ªåŸºäºLuceneçš„æœç´¢æœåŠ¡å™¨&quot;,&quot;content&quot;:&quot;å®ƒæä¾›äº†ä¸€ä¸ªåˆ†å¸ƒå¼å¤šç”¨æˆ·èƒ½åŠ›çš„å…¨æ–‡æœç´¢å¼•æ“ï¼ŒåŸºäºRESTfulwebæ¥å£ã€‚Elasticsearchæ˜¯ç”¨Javaå¼€å‘çš„ï¼Œå¹¶ä½œä¸ºApacheè®¸å¯æ¡æ¬¾ä¸‹çš„å¼€æ”¾æºç å‘å¸ƒï¼Œæ˜¯å½“å‰æµè¡Œçš„ä¼ä¸šçº§æœç´¢å¼•æ“ã€‚è®¾è®¡ç”¨äºäº‘è®¡ç®—ä¸­ï¼Œèƒ½å¤Ÿè¾¾åˆ°å®æ—¶æœç´¢ï¼Œç¨³å®šï¼Œå¯é ï¼Œå¿«é€Ÿï¼Œå®‰è£…ä½¿ç”¨æ–¹ä¾¿ã€‚&quot;}}]}}è¿™æ¬¡å†æ¬¡æµ‹è¯•é’¢ç´¢åˆ™æ— æ³•æœç´¢åˆ°å†…å®¹termæµ‹è¯•curlposthttp://127.0.0.1:9200/blog1/article/_searchbody{&quot;query&quot;:{&quot;term&quot;:{&quot;title&quot;:&quot;æœç´¢&quot;}}}response{&quot;took&quot;:5,&quot;timed_out&quot;:false,&quot;_shards&quot;:{&quot;total&quot;:5,&quot;successful&quot;:5,&quot;skipped&quot;:0,&quot;failed&quot;:0},&quot;hits&quot;:{&quot;total&quot;:1,&quot;max_score&quot;:0.25316024,&quot;hits&quot;:[{&quot;_index&quot;:&quot;blog1&quot;,&quot;_type&quot;:&quot;article&quot;,&quot;_id&quot;:&quot;1&quot;,&quot;_score&quot;:0.25316024,&quot;_source&quot;:{&quot;id&quot;:1,&quot;title&quot;:&quot;ElasticSearchæ˜¯ä¸€ä¸ªåŸºäºLuceneçš„æœç´¢æœåŠ¡å™¨&quot;,&quot;content&quot;:&quot;å®ƒæä¾›äº†ä¸€ä¸ªåˆ†å¸ƒå¼å¤šç”¨æˆ·èƒ½åŠ›çš„å…¨æ–‡æœç´¢å¼•æ“ï¼ŒåŸºäºRESTfulwebæ¥å£ã€‚Elasticsearchæ˜¯ç”¨Javaå¼€å‘çš„ï¼Œå¹¶ä½œä¸ºApacheè®¸å¯æ¡æ¬¾ä¸‹çš„å¼€æ”¾æºç å‘å¸ƒï¼Œæ˜¯å½“å‰æµè¡Œçš„ä¼ä¸šçº§æœç´¢å¼•æ“ã€‚è®¾è®¡ç”¨äºäº‘è®¡ç®—ä¸­ï¼Œèƒ½å¤Ÿè¾¾åˆ°å®æ—¶æœç´¢ï¼Œç¨³å®šï¼Œå¯é ï¼Œå¿«é€Ÿï¼Œå®‰è£…ä½¿ç”¨æ–¹ä¾¿ã€‚&quot;}}]}}ElasticSearché›†ç¾¤ESé›†ç¾¤æ˜¯ä¸€ä¸ªP2Pç±»å‹(ä½¿ç”¨gossipåè®®)çš„åˆ†å¸ƒå¼ç³»ç»Ÿï¼Œé™¤äº†é›†ç¾¤çŠ¶æ€ç®¡ç†ä»¥å¤–ï¼Œå…¶ä»–æ‰€æœ‰çš„è¯·æ±‚éƒ½å¯ä»¥å‘é€åˆ°é›†ç¾¤å†…ä»»æ„ä¸€å°èŠ‚ç‚¹ä¸Šï¼Œè¿™ä¸ªèŠ‚ç‚¹å¯ä»¥è‡ªå·±æ‰¾åˆ°éœ€è¦è½¬å‘ç»™å“ªäº›èŠ‚ç‚¹ï¼Œå¹¶ä¸”ç›´æ¥è·Ÿè¿™äº›èŠ‚ç‚¹é€šä¿¡ã€‚æ‰€ä»¥ï¼Œä»ç½‘ç»œæ¶æ„åŠæœåŠ¡é…ç½®ä¸Šæ¥è¯´ï¼Œæ„å»ºé›†ç¾¤æ‰€éœ€è¦çš„é…ç½®æå…¶ç®€å•ã€‚åœ¨Elasticsearch2.0ä¹‹å‰ï¼Œæ— é˜»ç¢çš„ç½‘ç»œä¸‹ï¼Œæ‰€æœ‰é…ç½®äº†ç›¸åŒcluster.nameçš„èŠ‚ç‚¹éƒ½è‡ªåŠ¨å½’å±åˆ°ä¸€ä¸ªé›†ç¾¤ä¸­ã€‚2.0ç‰ˆæœ¬ä¹‹åï¼ŒåŸºäºå®‰å…¨çš„è€ƒè™‘é¿å…å¼€å‘ç¯å¢ƒè¿‡äºéšä¾¿é€ æˆçš„éº»çƒ¦ï¼Œä»2.0ç‰ˆæœ¬å¼€å§‹ï¼Œé»˜è®¤çš„è‡ªåŠ¨å‘ç°æ–¹å¼æ”¹ä¸ºäº†å•æ’­(unicast)æ–¹å¼ã€‚é…ç½®é‡Œæä¾›å‡ å°èŠ‚ç‚¹çš„åœ°å€ï¼ŒESå°†å…¶è§†ä½œgossiprouterè§’è‰²ï¼Œå€Ÿä»¥å®Œæˆé›†ç¾¤çš„å‘ç°ã€‚ç”±äºè¿™åªæ˜¯ESå†…ä¸€ä¸ªå¾ˆå°çš„åŠŸèƒ½ï¼Œæ‰€ä»¥gossiprouterè§’è‰²å¹¶ä¸éœ€è¦å•ç‹¬é…ç½®ï¼Œæ¯ä¸ªESèŠ‚ç‚¹éƒ½å¯ä»¥æ‹…ä»»ã€‚æ‰€ä»¥ï¼Œé‡‡ç”¨å•æ’­æ–¹å¼çš„é›†ç¾¤ï¼Œå„èŠ‚ç‚¹éƒ½é…ç½®ç›¸åŒçš„å‡ ä¸ªèŠ‚ç‚¹åˆ—è¡¨ä½œä¸ºrouterå³å¯ã€‚é›†ç¾¤ä¸­èŠ‚ç‚¹æ•°é‡æ²¡æœ‰é™åˆ¶ï¼Œä¸€èˆ¬å¤§äºç­‰äº2ä¸ªèŠ‚ç‚¹å°±å¯ä»¥çœ‹åšæ˜¯é›†ç¾¤äº†ã€‚ä¸€èˆ¬å¤„äºé«˜æ€§èƒ½åŠé«˜å¯ç”¨æ–¹é¢æ¥è€ƒè™‘ä¸€èˆ¬é›†ç¾¤ä¸­çš„èŠ‚ç‚¹æ•°é‡éƒ½æ˜¯3ä¸ªåŠ3ä¸ªä»¥ä¸Šã€‚é›†ç¾¤çš„ç›¸å…³æ¦‚å¿µé›†ç¾¤clusterä¸€ä¸ªé›†ç¾¤å°±æ˜¯ç”±ä¸€ä¸ªæˆ–å¤šä¸ªèŠ‚ç‚¹ç»„ç»‡åœ¨ä¸€èµ·ï¼Œå®ƒä»¬å…±åŒæŒæœ‰æ•´ä¸ªçš„æ•°æ®ï¼Œå¹¶ä¸€èµ·æä¾›ç´¢å¼•å’Œæœç´¢åŠŸèƒ½ã€‚ä¸€ä¸ªé›†ç¾¤ç”±ä¸€ä¸ªå”¯ä¸€çš„åå­—æ ‡è¯†ï¼Œè¿™ä¸ªåå­—é»˜è®¤å°±æ˜¯â€œelasticsearchâ€ã€‚è¿™ä¸ªåå­—æ˜¯é‡è¦çš„ï¼Œå› ä¸ºä¸€ä¸ªèŠ‚ç‚¹åªèƒ½é€šè¿‡æŒ‡å®šæŸä¸ªé›†ç¾¤çš„åå­—ï¼Œæ¥åŠ å…¥è¿™ä¸ªé›†ç¾¤èŠ‚ç‚¹nodeä¸€ä¸ªèŠ‚ç‚¹æ˜¯é›†ç¾¤ä¸­çš„ä¸€ä¸ªæœåŠ¡å™¨ï¼Œä½œä¸ºé›†ç¾¤çš„ä¸€éƒ¨åˆ†ï¼Œå®ƒå­˜å‚¨æ•°æ®ï¼Œå‚ä¸é›†ç¾¤çš„ç´¢å¼•å’Œæœç´¢åŠŸèƒ½ã€‚å’Œé›†ç¾¤ç±»ä¼¼ï¼Œä¸€ä¸ªèŠ‚ç‚¹ä¹Ÿæ˜¯ç”±ä¸€ä¸ªåå­—æ¥æ ‡è¯†çš„ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œè¿™ä¸ªåå­—æ˜¯ä¸€ä¸ªéšæœºçš„æ¼«å¨æ¼«ç”»è§’è‰²çš„åå­—ï¼Œè¿™ä¸ªåå­—ä¼šåœ¨å¯åŠ¨çš„æ—¶å€™èµ‹äºˆèŠ‚ç‚¹ã€‚è¿™ä¸ªåå­—å¯¹äºç®¡ç†å·¥ä½œæ¥è¯´æŒºé‡è¦çš„ï¼Œå› ä¸ºåœ¨è¿™ä¸ªç®¡ç†è¿‡ç¨‹ä¸­ï¼Œä½ ä¼šå»ç¡®å®šç½‘ç»œä¸­çš„å“ªäº›æœåŠ¡å™¨å¯¹åº”äºElasticsearché›†ç¾¤ä¸­çš„å“ªäº›èŠ‚ç‚¹ã€‚ä¸€ä¸ªèŠ‚ç‚¹å¯ä»¥é€šè¿‡é…ç½®é›†ç¾¤åç§°çš„æ–¹å¼æ¥åŠ å…¥ä¸€ä¸ªæŒ‡å®šçš„é›†ç¾¤ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½ä¼šè¢«å®‰æ’åŠ å…¥åˆ°ä¸€ä¸ªå«åšâ€œelasticsearchâ€çš„é›†ç¾¤ä¸­ï¼Œè¿™æ„å‘³ç€ï¼Œå¦‚æœä½ åœ¨ä½ çš„ç½‘ç»œä¸­å¯åŠ¨äº†è‹¥å¹²ä¸ªèŠ‚ç‚¹ï¼Œå¹¶å‡å®šå®ƒä»¬èƒ½å¤Ÿç›¸äº’å‘ç°å½¼æ­¤ï¼Œå®ƒä»¬å°†ä¼šè‡ªåŠ¨åœ°å½¢æˆå¹¶åŠ å…¥åˆ°ä¸€ä¸ªå«åšâ€œelasticsearchâ€çš„é›†ç¾¤ä¸­ã€‚åœ¨ä¸€ä¸ªé›†ç¾¤é‡Œï¼Œåªè¦ä½ æƒ³ï¼Œå¯ä»¥æ‹¥æœ‰ä»»æ„å¤šä¸ªèŠ‚ç‚¹ã€‚è€Œä¸”ï¼Œå¦‚æœå½“å‰ä½ çš„ç½‘ç»œä¸­æ²¡æœ‰è¿è¡Œä»»ä½•ElasticsearchèŠ‚ç‚¹ï¼Œè¿™æ—¶å¯åŠ¨ä¸€ä¸ªèŠ‚ç‚¹ï¼Œä¼šé»˜è®¤åˆ›å»ºå¹¶åŠ å…¥ä¸€ä¸ªå«åšâ€œelasticsearchâ€çš„é›†ç¾¤ã€‚åˆ†ç‰‡å’Œå¤åˆ¶shards&amp;replicasä¸€ä¸ªç´¢å¼•å¯ä»¥å­˜å‚¨è¶…å‡ºå•ä¸ªç»“ç‚¹ç¡¬ä»¶é™åˆ¶çš„å¤§é‡æ•°æ®ã€‚æ¯”å¦‚ï¼Œä¸€ä¸ªå…·æœ‰10äº¿æ–‡æ¡£çš„ç´¢å¼•å æ®1TBçš„ç£ç›˜ç©ºé—´ï¼Œè€Œä»»ä¸€èŠ‚ç‚¹éƒ½æ²¡æœ‰è¿™æ ·å¤§çš„ç£ç›˜ç©ºé—´ï¼›æˆ–è€…å•ä¸ªèŠ‚ç‚¹å¤„ç†æœç´¢è¯·æ±‚ï¼Œå“åº”å¤ªæ…¢ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒElasticsearchæä¾›äº†å°†ç´¢å¼•åˆ’åˆ†æˆå¤šä»½çš„èƒ½åŠ›ï¼Œè¿™äº›ä»½å°±å«åšåˆ†ç‰‡ã€‚å½“ä½ åˆ›å»ºä¸€ä¸ªç´¢å¼•çš„æ—¶å€™ï¼Œä½ å¯ä»¥æŒ‡å®šä½ æƒ³è¦çš„åˆ†ç‰‡çš„æ•°é‡ã€‚æ¯ä¸ªåˆ†ç‰‡æœ¬èº«ä¹Ÿæ˜¯ä¸€ä¸ªåŠŸèƒ½å®Œå–„å¹¶ä¸”ç‹¬ç«‹çš„â€œç´¢å¼•â€ï¼Œè¿™ä¸ªâ€œç´¢å¼•â€å¯ä»¥è¢«æ”¾ç½®åˆ°é›†ç¾¤ä¸­çš„ä»»ä½•èŠ‚ç‚¹ä¸Šã€‚åˆ†ç‰‡å¾ˆé‡è¦ï¼Œä¸»è¦æœ‰ä¸¤æ–¹é¢çš„åŸå› ï¼š1ï¼‰å…è®¸ä½ æ°´å¹³åˆ†å‰²/æ‰©å±•ä½ çš„å†…å®¹å®¹é‡ã€‚2ï¼‰å…è®¸ä½ åœ¨åˆ†ç‰‡ï¼ˆæ½œåœ¨åœ°ï¼Œä½äºå¤šä¸ªèŠ‚ç‚¹ä¸Šï¼‰ä¹‹ä¸Šè¿›è¡Œåˆ†å¸ƒå¼çš„ã€å¹¶è¡Œçš„æ“ä½œï¼Œè¿›è€Œæé«˜æ€§èƒ½/ååé‡ã€‚è‡³äºä¸€ä¸ªåˆ†ç‰‡æ€æ ·åˆ†å¸ƒï¼Œå®ƒçš„æ–‡æ¡£æ€æ ·èšåˆå›æœç´¢è¯·æ±‚ï¼Œæ˜¯å®Œå…¨ç”±Elasticsearchç®¡ç†çš„ï¼Œå¯¹äºä½œä¸ºç”¨æˆ·çš„ä½ æ¥è¯´ï¼Œè¿™äº›éƒ½æ˜¯é€æ˜çš„ã€‚åœ¨ä¸€ä¸ªç½‘ç»œ/äº‘çš„ç¯å¢ƒé‡Œï¼Œå¤±è´¥éšæ—¶éƒ½å¯èƒ½å‘ç”Ÿï¼Œåœ¨æŸä¸ªåˆ†ç‰‡/èŠ‚ç‚¹ä¸çŸ¥æ€ä¹ˆçš„å°±å¤„äºç¦»çº¿çŠ¶æ€ï¼Œæˆ–è€…ç”±äºä»»ä½•åŸå› æ¶ˆå¤±äº†ï¼Œè¿™ç§æƒ…å†µä¸‹ï¼Œæœ‰ä¸€ä¸ªæ•…éšœè½¬ç§»æœºåˆ¶æ˜¯éå¸¸æœ‰ç”¨å¹¶ä¸”æ˜¯å¼ºçƒˆæ¨èçš„ã€‚ä¸ºæ­¤ç›®çš„ï¼ŒElasticsearchå…è®¸ä½ åˆ›å»ºåˆ†ç‰‡çš„ä¸€ä»½æˆ–å¤šä»½æ‹·è´ï¼Œè¿™äº›æ‹·è´å«åšå¤åˆ¶åˆ†ç‰‡ï¼Œæˆ–è€…ç›´æ¥å«å¤åˆ¶ã€‚å¤åˆ¶ä¹‹æ‰€ä»¥é‡è¦ï¼Œæœ‰ä¸¤ä¸ªä¸»è¦åŸå› ï¼šåœ¨åˆ†ç‰‡/èŠ‚ç‚¹å¤±è´¥çš„æƒ…å†µä¸‹ï¼Œæä¾›äº†é«˜å¯ç”¨æ€§ã€‚å› ä¸ºè¿™ä¸ªåŸå› ï¼Œæ³¨æ„åˆ°å¤åˆ¶åˆ†ç‰‡ä»ä¸ä¸åŸ/ä¸»è¦ï¼ˆoriginal/primaryï¼‰åˆ†ç‰‡ç½®äºåŒä¸€èŠ‚ç‚¹ä¸Šæ˜¯éå¸¸é‡è¦çš„ã€‚æ‰©å±•ä½ çš„æœç´¢é‡/ååé‡ï¼Œå› ä¸ºæœç´¢å¯ä»¥åœ¨æ‰€æœ‰çš„å¤åˆ¶ä¸Šå¹¶è¡Œè¿è¡Œã€‚æ€»ä¹‹ï¼Œæ¯ä¸ªç´¢å¼•å¯ä»¥è¢«åˆ†æˆå¤šä¸ªåˆ†ç‰‡ã€‚ä¸€ä¸ªç´¢å¼•ä¹Ÿå¯ä»¥è¢«å¤åˆ¶0æ¬¡ï¼ˆæ„æ€æ˜¯æ²¡æœ‰å¤åˆ¶ï¼‰æˆ–å¤šæ¬¡ã€‚ä¸€æ—¦å¤åˆ¶äº†ï¼Œæ¯ä¸ªç´¢å¼•å°±æœ‰äº†ä¸»åˆ†ç‰‡ï¼ˆä½œä¸ºå¤åˆ¶æºçš„åŸæ¥çš„åˆ†ç‰‡ï¼‰å’Œå¤åˆ¶åˆ†ç‰‡ï¼ˆä¸»åˆ†ç‰‡çš„æ‹·è´ï¼‰ä¹‹åˆ«ã€‚åˆ†ç‰‡å’Œå¤åˆ¶çš„æ•°é‡å¯ä»¥åœ¨ç´¢å¼•åˆ›å»ºçš„æ—¶å€™æŒ‡å®šã€‚åœ¨ç´¢å¼•åˆ›å»ºä¹‹åï¼Œä½ å¯ä»¥åœ¨ä»»ä½•æ—¶å€™åŠ¨æ€åœ°æ”¹å˜å¤åˆ¶çš„æ•°é‡ï¼Œä½†æ˜¯ä½ äº‹åä¸èƒ½æ”¹å˜åˆ†ç‰‡çš„æ•°é‡ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒElasticsearchä¸­çš„æ¯ä¸ªç´¢å¼•è¢«åˆ†ç‰‡5ä¸ªä¸»åˆ†ç‰‡å’Œ1ä¸ªå¤åˆ¶ï¼Œè¿™æ„å‘³ç€ï¼Œå¦‚æœä½ çš„é›†ç¾¤ä¸­è‡³å°‘æœ‰ä¸¤ä¸ªèŠ‚ç‚¹ï¼Œä½ çš„ç´¢å¼•å°†ä¼šæœ‰5ä¸ªä¸»åˆ†ç‰‡å’Œå¦å¤–5ä¸ªå¤åˆ¶åˆ†ç‰‡ï¼ˆ1ä¸ªå®Œå…¨æ‹·è´ï¼‰ï¼Œè¿™æ ·çš„è¯æ¯ä¸ªç´¢å¼•æ€»å…±å°±æœ‰10ä¸ªåˆ†ç‰‡ã€‚é›†ç¾¤çš„æ­å»ºå‡†å¤‡ä¸‰å°elasticsearchæœåŠ¡å™¨åˆ›å»ºelasticsearch-clusteræ–‡ä»¶å¤¹ï¼Œåœ¨å†…éƒ¨å¤åˆ¶ä¸‰ä¸ªelasticsearchæœåŠ¡ä¿®æ”¹æ¯å°æœåŠ¡å™¨é…ç½®ä¿®æ”¹elasticsearch-cluster\\node*\\config\\elasticsearch.ymlé…ç½®æ–‡ä»¶node1èŠ‚ç‚¹ï¼š#èŠ‚ç‚¹3çš„é…ç½®ä¿¡æ¯ï¼š#é›†ç¾¤åç§°ï¼Œä¿è¯å”¯ä¸€cluster.name:my-elasticsearch#èŠ‚ç‚¹åç§°ï¼Œå¿…é¡»ä¸ä¸€æ ·node.name:node-1#å¿…é¡»ä¸ºæœ¬æœºçš„ipåœ°å€network.host:127.0.0.1#æœåŠ¡ç«¯å£å·ï¼Œåœ¨åŒä¸€æœºå™¨ä¸‹å¿…é¡»ä¸ä¸€æ ·http.port:9200#é›†ç¾¤é—´é€šä¿¡ç«¯å£å·ï¼Œåœ¨åŒä¸€æœºå™¨ä¸‹å¿…é¡»ä¸ä¸€æ ·transport.tcp.port:9300#è®¾ç½®é›†ç¾¤è‡ªåŠ¨å‘ç°æœºå™¨ipé›†åˆdiscovery.zen.ping.unicast.hosts:[&quot;127.0.0.1:9300&quot;,&quot;127.0.0.1:9301&quot;,&quot;127.0.0.1:9302&quot;]node2èŠ‚ç‚¹ï¼š#èŠ‚ç‚¹3çš„é…ç½®ä¿¡æ¯ï¼š#é›†ç¾¤åç§°ï¼Œä¿è¯å”¯ä¸€cluster.name:my-elasticsearch#èŠ‚ç‚¹åç§°ï¼Œå¿…é¡»ä¸ä¸€æ ·node.name:node-2#å¿…é¡»ä¸ºæœ¬æœºçš„ipåœ°å€network.host:127.0.0.1#æœåŠ¡ç«¯å£å·ï¼Œåœ¨åŒä¸€æœºå™¨ä¸‹å¿…é¡»ä¸ä¸€æ ·http.port:9201#é›†ç¾¤é—´é€šä¿¡ç«¯å£å·ï¼Œåœ¨åŒä¸€æœºå™¨ä¸‹å¿…é¡»ä¸ä¸€æ ·transport.tcp.port:9301#è®¾ç½®é›†ç¾¤è‡ªåŠ¨å‘ç°æœºå™¨ipé›†åˆdiscovery.zen.ping.unicast.hosts:[&quot;127.0.0.1:9300&quot;,&quot;127.0.0.1:9301&quot;,&quot;127.0.0.1:9302&quot;]node3èŠ‚ç‚¹ï¼š#èŠ‚ç‚¹3çš„é…ç½®ä¿¡æ¯ï¼š#é›†ç¾¤åç§°ï¼Œä¿è¯å”¯ä¸€cluster.name:my-elasticsearch#èŠ‚ç‚¹åç§°ï¼Œå¿…é¡»ä¸ä¸€æ ·node.name:node-3#å¿…é¡»ä¸ºæœ¬æœºçš„ipåœ°å€network.host:127.0.0.1#æœåŠ¡ç«¯å£å·ï¼Œåœ¨åŒä¸€æœºå™¨ä¸‹å¿…é¡»ä¸ä¸€æ ·http.port:9202#é›†ç¾¤é—´é€šä¿¡ç«¯å£å·ï¼Œåœ¨åŒä¸€æœºå™¨ä¸‹å¿…é¡»ä¸ä¸€æ ·transport.tcp.port:9302#è®¾ç½®é›†ç¾¤è‡ªåŠ¨å‘ç°æœºå™¨ipé›†åˆdiscovery.zen.ping.unicast.hosts:[&quot;127.0.0.1:9300&quot;,&quot;127.0.0.1:9301&quot;,&quot;127.0.0.1:9302&quot;]å¯åŠ¨å„ä¸ªèŠ‚ç‚¹æœåŠ¡å™¨åŒå‡»elasticsearch-cluster\\node*\\bin\\elasticsearch.baté›†ç¾¤æµ‹è¯•æ·»åŠ ç´¢å¼•å’Œæ˜ å°„curlputhttp://127.0.0.1:9200/blog1body{&quot;mappings&quot;:{&quot;article&quot;:{&quot;properties&quot;:{&quot;id&quot;:{&quot;type&quot;:&quot;long&quot;,&quot;store&quot;:true,&quot;index&quot;:&quot;not_analyzed&quot;},&quot;title&quot;:{&quot;type&quot;:&quot;text&quot;,&quot;store&quot;:true,&quot;index&quot;:&quot;analyzed&quot;,&quot;analyzer&quot;:&quot;ik_max_word&quot;},&quot;content&quot;:{&quot;type&quot;:&quot;text&quot;,&quot;store&quot;:true,&quot;index&quot;:&quot;analyzed&quot;,&quot;analyzer&quot;:&quot;ik_max_word&quot;}}}}}æ·»åŠ æ–‡æ¡£curlposthttp://127.0.0.1:9200/blog1/article/1body{&quot;id&quot;:1,&quot;title&quot;:&quot;ElasticSearchæ˜¯ä¸€ä¸ªåŸºäºLuceneçš„æœç´¢æœåŠ¡å™¨&quot;,&quot;content&quot;:&quot;å®ƒæä¾›äº†ä¸€ä¸ªåˆ†å¸ƒå¼å¤šç”¨æˆ·èƒ½åŠ›çš„å…¨æ–‡æœç´¢å¼•æ“ï¼ŒåŸºäºRESTfulwebæ¥å£ã€‚Elasticsearchæ˜¯ç”¨Javaå¼€å‘çš„ï¼Œå¹¶ä½œä¸ºApacheè®¸å¯æ¡æ¬¾ä¸‹çš„å¼€æ”¾æºç å‘å¸ƒï¼Œæ˜¯å½“å‰æµè¡Œçš„ä¼ä¸šçº§æœç´¢å¼•æ“ã€‚è®¾è®¡ç”¨äºäº‘è®¡ç®—ä¸­ï¼Œèƒ½å¤Ÿè¾¾åˆ°å®æ—¶æœç´¢ï¼Œç¨³å®šï¼Œå¯é ï¼Œå¿«é€Ÿï¼Œå®‰è£…ä½¿ç”¨æ–¹ä¾¿ã€‚&quot;}response{&quot;_index&quot;:&quot;blog1&quot;,&quot;_type&quot;:&quot;article&quot;,&quot;_id&quot;:&quot;1&quot;,&quot;_version&quot;:1,&quot;result&quot;:&quot;created&quot;,&quot;_shards&quot;:{&quot;total&quot;:2,&quot;successful&quot;:1,&quot;failed&quot;:0},&quot;created&quot;:true}ä½¿ç”¨elasticsearch-headeræŸ¥çœ‹é›†ç¾¤æƒ…å†µå¦‚æœåˆ†ç‰‡å‰¯æœ¬å‡ºç°UNASSIGNEDå¯èƒ½åŸå› æ˜¯é…ç½®å‡ºé”™æˆ–è€…æ˜¯ç¡¬ç›˜ä½¿ç”¨ç‡å¤§äº80%ï¼Œå¯ä»¥è°ƒæ•´ä½¿ç”¨ç‡æ¥è§£å†³curlputhttp://127.0.0.1:9200/_cluster/settingsbody{&quot;transient&quot;:{&quot;cluster.routing.allocation.disk.watermark.low&quot;:&quot;95%&quot;}}","link":"https://haohanya.github.io/post/elasticsearch1/"},{"title":"RabbitMQï¼ˆäºŒï¼‰","content":"RabbitMQé«˜çº§ç‰¹æ€§æ¶ˆæ¯å¯é æ€§æŠ•é€’ConsumerACKæ¶ˆè´¹æ®µé™æµTTLæ­»ä¿¡é˜Ÿåˆ—å»¶è¿Ÿé˜Ÿåˆ—æ—¥å¿—ä¸ç›‘æ§æ¶ˆæ¯å¯é æ€§åˆ†æä¸è¿½è¸ªç®¡ç†RabbitMQå®é™…åº”ç”¨é—®é¢˜æ¶ˆæ¯å¯é æ€§æ¶ˆæ¯å¹‚ç­‰æ€§RabbitMQé«˜çº§ç‰¹æ€§æ¶ˆæ¯å¯é æ€§æŠ•é€’ç®€ä»‹åœ¨ä½¿ç”¨RabbitMQçš„æ—¶å€™ï¼Œä½œä¸ºæ¶ˆæ¯çš„å‘é€æ–¹å¸Œæœ›æœç»ä»»ä½•æ¶ˆæ¯çš„ä¸¢å¤±æˆ–è€…æ˜¯æ¶ˆæ¯çš„æŠ•é€’å¤±è´¥åœºæ™¯ã€‚RabbitMQä¸ºæˆ‘ä»¬æä¾›äº†ä¸¤ç§æ–¹å¼å¼€æ§åˆ¶æ¶ˆæ¯çš„å¯é æ€§æŠ•é€’æ¨¡å¼confrimç¡®è®¤æ¨¡å¼returné€€å›æ¨¡å¼RabbitMQçœŸå®æ¶ˆæ¯æŠ•é€’çš„è·¯å¾„producer--&gt;borker(RabbitMQserver)--&gt;exchange--&gt;queue--&gt;consumeræ¶ˆæ¯é‡produceråˆ°exchangeåˆ™ä¼šè¿”å›ä¸€ä¸ªconfirmCallbackï¼ˆconfrimç¡®è®¤æ¨¡å¼ï¼‰æ¶ˆæ¯ä»exchangeåˆ°queueæŠ•é€’å¤±è´¥åˆ™ä¼šè¿”å›ä¸€ä¸ªreturnCallbackï¼ˆreturné€€å›æ¨¡å¼ï¼‰æˆ‘ä»¬å°†åˆ©ç”¨è¿™ä¸¤ä¸ªcallbackæ§åˆ¶æ¶ˆæ¯çš„å¯é æ€§æŠ•é€’å®æˆ˜æ¡ˆä¾‹åˆ›å»ºproducerï¼ˆç”Ÿäº§è€…ï¼‰æ·»åŠ ä¾èµ–&lt;dependencies&gt;&lt;dependency&gt;&lt;groupId&gt;org.springframework&lt;/groupId&gt;&lt;artifactId&gt;spring-context&lt;/artifactId&gt;&lt;version&gt;5.1.7.RELEASE&lt;/version&gt;&lt;/dependency&gt;&lt;!--æ·»åŠ rabbitmqå’Œspringæ•´åˆ--&gt;&lt;dependency&gt;&lt;groupId&gt;org.springframework.amqp&lt;/groupId&gt;&lt;artifactId&gt;spring-rabbit&lt;/artifactId&gt;&lt;version&gt;2.1.8.RELEASE&lt;/version&gt;&lt;/dependency&gt;&lt;dependency&gt;&lt;groupId&gt;junit&lt;/groupId&gt;&lt;artifactId&gt;junit&lt;/artifactId&gt;&lt;version&gt;4.12&lt;/version&gt;&lt;scope&gt;test&lt;/scope&gt;&lt;/dependency&gt;&lt;dependency&gt;&lt;groupId&gt;org.springframework&lt;/groupId&gt;&lt;artifactId&gt;spring-test&lt;/artifactId&gt;&lt;version&gt;5.1.7.RELEASE&lt;/version&gt;&lt;/dependency&gt;&lt;/dependencies&gt;æ·»åŠ é…ç½®æ–‡ä»¶rabbitmq.propertiesrabbitmq.host=192.168.25.134rabbitmq.port=5672rabbitmq.username=guestrabbitmq.password=guestrabbitmq.virtual-host=/spring-rabbitmq-producer.xml&lt;?xmlversion=&quot;1.0&quot;encoding=&quot;UTF-8&quot;?&gt;&lt;beansxmlns=&quot;http://www.springframework.org/schema/beans&quot;xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;xmlns:context=&quot;http://www.springframework.org/schema/context&quot;xmlns:rabbit=&quot;http://www.springframework.org/schema/rabbit&quot;xsi:schemaLocation=&quot;http://www.springframework.org/schema/beanshttp://www.springframework.org/schema/beans/spring-beans.xsdhttp://www.springframework.org/schema/contexthttps://www.springframework.org/schema/context/spring-context.xsdhttp://www.springframework.org/schema/rabbithttp://www.springframework.org/schema/rabbit/spring-rabbit.xsd&quot;&gt;&lt;!--åŠ è½½é…ç½®æ–‡ä»¶--&gt;&lt;context:property-placeholderlocation=&quot;classpath:rabbitmq.properties&quot;/&gt;&lt;!--å®šä¹‰rabbitmqconnectionFactroy--&gt;&lt;rabbit:connection-factoryid=&quot;connectionFactory&quot;host=&quot;${rabbitmq.host}&quot;port=&quot;${rabbitmq.port}&quot;username=&quot;${rabbitmq.username}&quot;password=&quot;${rabbitmq.username}&quot;virtual-host=&quot;${rabbitmq.virtual-host}&quot;publisher-confirms=&quot;true&quot;publisher-returns=&quot;true&quot;/&gt;&lt;!--å®šä¹‰ç®¡ç†äº¤æ¢æœºã€é˜Ÿåˆ—--&gt;&lt;rabbit:adminconnection-factory=&quot;connectionFactory&quot;/&gt;&lt;!--å®šä¹‰rabbitTemplateå¯¹è±¡æ“ä½œæ¶ˆæ¯--&gt;&lt;rabbit:templateid=&quot;rabbitTemplate&quot;connection-factory=&quot;connectionFactory&quot;/&gt;&lt;!--æ¶ˆæ¯å¯é æ€§æŠ•é€’--&gt;&lt;rabbit:queueid=&quot;test_queue_confirm&quot;name=&quot;test_queue_confirm&quot;/&gt;&lt;!--åˆ›å»ºäº¤æ¢å™¨ï¼Œå¹¶ä¸”ç»‘å®šqueue--&gt;&lt;rabbit:direct-exchangename=&quot;test_exchange_confirm&quot;&gt;&lt;rabbit:bindings&gt;&lt;rabbit:bindingqueue=&quot;test_queue_confirm&quot;key=&quot;confirm&quot;/&gt;&lt;/rabbit:bindings&gt;&lt;/rabbit:direct-exchange&gt;&lt;/beans&gt;æµ‹è¯•ç¡®è®¤æ¨¡å¼packagecom.cn.test;importorg.junit.Test;importorg.junit.runner.RunWith;importorg.springframework.amqp.rabbit.connection.CorrelationData;importorg.springframework.amqp.rabbit.core.RabbitTemplate;importorg.springframework.test.context.ContextConfiguration;importorg.springframework.test.context.junit4.SpringJUnit4ClassRunner;importjavax.annotation.Resource;@RunWith(SpringJUnit4ClassRunner.class)@ContextConfiguration(locations=&quot;classpath:spring-rabbitmq-producer.xml&quot;)publicclassProducerTest{@ResourceprivateRabbitTemplaterabbitTemplate;/***æµ‹è¯•ç¡®è®¤æ¨¡å¼*æ€è·¯ï¼š*1ã€å¼€å¯ç¡®è®¤æ¨¡å¼*2ã€å®šä¹‰confirmCallbackå›è°ƒå‡½æ•°**/@TestpublicvoidtestConfirm(){//1ã€å¼€å¯ç¡®è®¤æ¨¡å¼rabbitTemplate.setMandatory(true);//2ã€å®šä¹‰å›è°ƒå‡½æ•°(confirmCallbackï¼šæ¶ˆæ¯ä»produceråˆ°exchangeçš„å¯é æ€§)rabbitTemplate.setConfirmCallback(newRabbitTemplate.ConfirmCallback(){/****@paramcorrelationDataç›¸å…³é…ç½®ä¿¡æ¯*@parambexchangeäº¤æ¢æœºæ˜¯å¦æˆåŠŸæ”¶åˆ°æ¶ˆæ¯ï¼Œå¦‚æœä¸ºtrueåˆ™æˆåŠŸï¼Œfalseå¤±è´¥*@paramsè¡¨ç¤ºå¤±è´¥çš„åŸå› */@Overridepublicvoidconfirm(CorrelationDatacorrelationData,booleanb,Strings){System.out.println(&quot;confirmæ–¹æ³•è¢«æ‰§è¡Œäº†...&quot;);if(b){//æ¶ˆæ¯æˆåŠŸæ¥æ”¶System.out.println(&quot;æ¶ˆæ¯å‘é€æˆåŠŸï¼š&quot;+s);}else{//æ¶ˆæ¯æ¥æ”¶å¤±è´¥System.out.println(&quot;æ¶ˆæ¯å‘é€å¤±è´¥:&quot;+s);//åšä¸€äº›ä¸šåŠ¡å¤„ç†ï¼Œå¦‚:è®©æ¶ˆæ¯å†æ¬¡å‘é€ï¼Œåœ¨å®é™…å¼€å‘ä¸­æ¶ˆæ¯å‘é€å¤±è´¥åéœ€è¦å†æ¬¡å‘é€}}});//å‘é€æ¶ˆæ¯rabbitTemplate.convertAndSend(&quot;test_exchange_confirm&quot;,&quot;confirm&quot;,&quot;messageconfirm....&quot;);}}æµ‹è¯•ç»“æœå¦‚æœæ˜¯æ­£ç¡®çš„ï¼Œé‚£ä¹ˆä¼šèµ°æ¶ˆæ¯å‘é€æˆåŠŸçš„é€»è¾‘ï¼Œå¦‚æœå¤±è´¥äº†ï¼Œä¼šæ‰§è¡Œæ¶ˆæ¯å‘é€å¤±è´¥çš„é€»è¾‘æµ‹è¯•å›é€€æ¨¡å¼/***æµ‹è¯•å›é€€æ¨¡å¼ï¼šæµ‹è¯•ä»exchangeåˆ°queueçš„æ¶ˆæ¯å¯é æ€§*ä¼šé€€æ¨¡å¼:å½“æ¶ˆæ¯å™¶ç»™exchangeä¹‹åï¼Œexchangeè·¯ç”±åˆ°queueæœ‰å¯èƒ½ä¼šå¤±è´¥çš„ï¼Œå¦‚æœå¤±è´¥ä¼šæ‰§è¡ŒreturnCallback*æ­¥éª¤ï¼š*1ã€å¼€å¯å›é€€æ¨¡å¼*2ã€è®¾ç½®returnCallBack*3ã€è®¾ç½®exchangeæ¶ˆæ¯å¤„ç†æ¨¡å¼*/@TestpublicvoidtestReturn(){//1ã€å¼€å¯å›é€€æ¨¡å¼rabbitTemplate.setMandatory(true);//2ã€è®¾ç½®ReturnCallBackrabbitTemplate.setReturnCallback(newRabbitTemplate.ReturnCallback(){/****@parammessageæ¶ˆæ¯å¯¹è±¡*@paramié”™è¯¯ä»£ç *@paramsé”™è¯¯ä¿¡æ¯*@params1äº¤æ¢å™¨*@params2è·¯ç”±é”®*/@OverridepublicvoidreturnedMessage(Messagemessage,inti,Strings,Strings1,Strings2){System.out.println(&quot;returnè¢«æ‰§è¡Œäº†&quot;);System.out.println(&quot;æ¶ˆæ¯å¯¹è±¡ï¼š&quot;+message);System.out.println(&quot;é”™è¯¯ä»£ç ï¼š&quot;+i);System.out.println(&quot;é”™è¯¯ä¿¡æ¯ï¼š&quot;+s);System.out.println(&quot;å‡ºé”™çš„äº¤æ¢å™¨ï¼š&quot;+s1);System.out.println(&quot;å‡ºé”™çš„è·¯ç”±é”®ï¼š&quot;+s2);}});//3ã€å‘é€æ¶ˆæ¯rabbitTemplate.convertAndSend(&quot;test_exchange_confirm&quot;,&quot;confirm111&quot;,&quot;messageconfirm....&quot;);}æ­£å¸¸æƒ…å†µä¸‹æ˜¯ä¸ä¼šæ‰§è¡ŒreturnCallBackæ–¹æ³•çš„ï¼Œåªæœ‰åœ¨å‡ºé”™çš„æƒ…å†µä¸‹æ‰ä¼šæ‰§è¡Œï¼Œæµ‹è¯•æ—¶å¯ä»¥æ‰‹åŠ¨å°†è·¯ç”±é”®ç»™ä¿®æ”¹ä¸ºé”™è¯¯çš„å†æµ‹è¯•å°ç»“è®¾ç½®ConnectionFactroyçš„publisher-confrim=&quot;true&quot;å¼€å¯ç¡®è®¤æ¨¡å¼ä½¿ç”¨rabbitTemplate.setConfirmCallbackè®¾ç½®å›è°ƒå‡½æ•°ï¼Œå½“æ¶ˆæ¯å‘é€åˆ°exchangeä¹‹åå›è°ƒconfirmæ–¹æ³•ã€‚åœ¨æ–¹æ³•ä¸­å»åˆ¤æ–­ackï¼Œå¦‚æœæœªtrueåˆ™è¡¨ç¤ºå‘é€æˆåŠŸï¼Œå¦‚æœæœªfalseï¼Œè¡¨ç¤ºå‘é€å¤±è´¥éœ€è¦å»å¤„ç†è®¾ç½®ConnectionFatroyçš„publisher-returns=&quot;true&quot;å¼€å¯å›é€€æ¨¡å¼ä½¿ç”¨rabbitTemplate.setReturnCallbackè®¾ç½®é€€å›å‡½æ•°ï¼Œå½“æ¶ˆæ¯ä»exchangeè·¯ç”±åˆ°queueå¤±è´¥åï¼Œå¦‚æœè®¾ç½®äº†rabbitTemplate.setMandatory(true)å‚æ•°ï¼Œåˆ™ä¼šå°†æ¶ˆæ¯å›é€€ç»™producerï¼Œå¹¶ä¸”æ‰§è¡ŒreturnedMessageæ–¹æ³•åœ¨RabbitMQä¸­æä¾›äº†äº‹åŠ¡çš„æœºåˆ¶æ¥è§£å†³æ¶ˆæ¯æŠ•é€’å¯é æ€§çš„é—®é¢˜ï¼Œä½†æ˜¯æ€§èƒ½è¾ƒå·®ï¼Œå®é™…å¼€å‘ä¸­å¹¶ä¸é€‚ç”¨ConsumerACKä»‹ç»ackï¼šacknowledgeç¡®è®¤è¡¨ç¤ºæ¶ˆè´¹æ®µæ”¶åˆ°æ¶ˆæ¯åçš„ç¡®è®¤æ–¹å¼ç¡®è®¤æ–¹å¼ä¸€å…±æœ‰ä¸‰ç§acknowledge=&quot;none&quot;è‡ªåŠ¨acknowledge=&quot;manual&quot;æ‰‹åŠ¨ç¡®è®¤acknowledge=&quot;auto&quot;æ ¹æ®å¼‚å¸¸æƒ…å†µç¡®è®¤ï¼ˆè¿™ç§æ–¹å¼ä½¿ç”¨èµ·æ¥å¾ˆéº»çƒ¦ï¼Œå¼€å‘ä¸­åŸºæœ¬ä¸ç”¨ï¼‰å…¶ä¸­è‡ªåŠ¨ç¡®è®¤æ˜¯æŒ‡ï¼šå½“æ¶ˆæ¯ä¸€æ—¦è¢«Consumeræ¥æ”¶åˆ°ï¼Œåˆ™è‡ªåŠ¨ç¡®è®¤æ‰‹åŠ¨ï¼Œå¹¶ä¸”å°†messageä»RabbitMQçš„æ¶ˆæ¯ç¼“å­˜ä¸­ç§»é™¤ï¼Œä½†æ˜¯å®é™…ä¸šåŠ¡å¤„ç†ä¸­ï¼Œå¾ˆå¯èƒ½æ¶ˆæ¯æ¥æ”¶åˆ°äº†ï¼Œä½†æ˜¯ä¸šåŠ¡å¤„ç†å‡ºç°äº†å¼‚å¸¸ï¼Œé‚£ä¹ˆè¯¥æ¶ˆæ¯å°±ä¸¢å¤±äº†ã€‚å¦‚æœè®¾ç½®äº†æ‰‹åŠ¨ç¡®è®¤æ–¹å¼ï¼Œåˆ™éœ€è¦åœ¨ä¸šåŠ¡å¤„ç†æˆåŠŸåè°ƒç”¨channel.basicAck()æ‰‹åŠ¨ç­¾æ”¶ï¼Œå¦‚æœå‡ºç°å¼‚å¸¸ï¼Œåˆ™è°ƒç”¨channel.basicNack()æ–¹æ³•ï¼Œè®©å…¶è‡ªåŠ¨é‡æ–°å‘é€æ¶ˆæ¯åˆ›å»ºconsumerå·¥ç¨‹æ·»åŠ ä¾èµ–&lt;dependencies&gt;&lt;dependency&gt;&lt;groupId&gt;org.springframework&lt;/groupId&gt;&lt;artifactId&gt;spring-context&lt;/artifactId&gt;&lt;version&gt;5.1.7.RELEASE&lt;/version&gt;&lt;/dependency&gt;&lt;dependency&gt;&lt;groupId&gt;org.springframework.amqp&lt;/groupId&gt;&lt;artifactId&gt;spring-rabbit&lt;/artifactId&gt;&lt;version&gt;2.1.8.RELEASE&lt;/version&gt;&lt;/dependency&gt;&lt;dependency&gt;&lt;groupId&gt;junit&lt;/groupId&gt;&lt;artifactId&gt;junit&lt;/artifactId&gt;&lt;version&gt;4.12&lt;/version&gt;&lt;scope&gt;test&lt;/scope&gt;&lt;/dependency&gt;&lt;dependency&gt;&lt;groupId&gt;org.springframework&lt;/groupId&gt;&lt;artifactId&gt;spring-test&lt;/artifactId&gt;&lt;version&gt;5.1.7.RELEASE&lt;/version&gt;&lt;/dependency&gt;&lt;/dependencies&gt;ç¼–å†™é…ç½®æ–‡ä»¶spring-rabbitmq-consumer.xml&lt;?xmlversion=&quot;1.0&quot;encoding=&quot;UTF-8&quot;?&gt;&lt;beansxmlns=&quot;http://www.springframework.org/schema/beans&quot;xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;xmlns:context=&quot;http://www.springframework.org/schema/context&quot;xmlns:rabbit=&quot;http://www.springframework.org/schema/rabbit&quot;xsi:schemaLocation=&quot;http://www.springframework.org/schema/beanshttp://www.springframework.org/schema/beans/spring-beans.xsdhttp://www.springframework.org/schema/contexthttps://www.springframework.org/schema/context/spring-context.xsdhttp://www.springframework.org/schema/rabbithttp://www.springframework.org/schema/rabbit/spring-rabbit.xsd&quot;&gt;&lt;!--åŠ è½½é…ç½®æ–‡ä»¶--&gt;&lt;context:property-placeholderlocation=&quot;classpath:rabbitmq.properties&quot;&gt;&lt;/context:property-placeholder&gt;&lt;!--å®šä¹‰rabbitmqconnectionFactroy--&gt;&lt;rabbit:connection-factoryid=&quot;connectionFactory&quot;host=&quot;${rabbitmq.host}&quot;port=&quot;${rabbitmq.port}&quot;username=&quot;${rabbitmq.username}&quot;password=&quot;${rabbitmq.username}&quot;virtual-host=&quot;${rabbitmq.virtual-host}&quot;publisher-confirms=&quot;true&quot;publisher-returns=&quot;true&quot;&gt;&lt;/rabbit:connection-factory&gt;&lt;!--æ·»åŠ åŒ…æ‰«æï¼Œæ–¹ä¾¿åæœŸç›‘å¬å™¨äº¤ç»™spirngç®¡ç†--&gt;&lt;context:component-scanbase-package=&quot;com.cn.listener&quot;&gt;&lt;/context:component-scan&gt;&lt;!--å®šä¹‰ç›‘å¬å™¨å®¹å™¨--&gt;&lt;rabbit:listener-containerconnection-factory=&quot;connectionFactory&quot;&gt;&lt;rabbit:listenerref=&quot;ackListener&quot;queue-names=&quot;test_queue_confirm&quot;&gt;&lt;/rabbit:listener&gt;&lt;/rabbit:listener-container&gt;&lt;/beans&gt;rabbitmq.propertiesrabbitmq.host=192.168.25.134rabbitmq.port=5672rabbitmq.username=guestrabbitmq.password=guestrabbitmq.virtual-host=/ç¼–å†™ç›‘å¬ç±»packagecom.cn.listener;importorg.springframework.amqp.core.AcknowledgeMode;importorg.springframework.amqp.core.Message;importorg.springframework.amqp.core.MessageListener;importorg.springframework.stereotype.Component;@ComponentpublicclassAckListenerimplementsMessageListener{publicvoidonMessage(Messagemessage){System.out.println(message.getBody());}publicvoidcontainerAckMode(AcknowledgeModemode){}}ç¼–å†™æµ‹è¯•ç±»importorg.junit.Test;importorg.junit.runner.RunWith;importorg.springframework.test.context.ContextConfiguration;importorg.springframework.test.context.junit4.SpringJUnit4ClassRunner;@RunWith(SpringJUnit4ClassRunner.class)@ContextConfiguration(locations=&quot;classpath:spring-rabbitmq-consumer.xml&quot;)publicclassConsumerTest{//ä¸ºäº†å®ç°ç›‘å¬çš„æ•ˆæœï¼Œå†™ä¸ªæ­»å¾ªç¯ï¼Œä¸€ç›´è¯»å–é…ç½®æ–‡ä»¶@Testpublicvoidtest(){while(true){}}}ä»æ¶ˆæ¯ç”Ÿäº§è€…å·¥ç¨‹ä¸­å‘é€ä¸€ä¸ªæ¶ˆæ¯ï¼Œç„¶ååœ¨æ¶ˆè´¹è€…å·¥ç¨‹é‡Œå°±å¯ä»¥æ¥æ”¶åˆ°æ¶ˆæ¯äº†æ‰‹åŠ¨ç­¾æ”¶ä¸Šé¢é»˜è®¤å°±æ˜¯è‡ªåŠ¨ç­¾æ”¶ä¿®æ”¹é…ç½®æ–‡ä»¶ä¸ºæ‰‹åŠ¨ç­¾æ”¶&lt;!--å®šä¹‰ç›‘å¬å™¨å®¹å™¨acknowledge=&quot;manual&quot;:è¡¨ç¤ºæ‰‹åŠ¨ç­¾æ”¶--&gt;&lt;rabbit:listener-containerconnection-factory=&quot;connectionFactory&quot;acknowledge=&quot;manual&quot;&gt;&lt;rabbit:listenerref=&quot;ackListener&quot;queue-names=&quot;test_queue_confirm&quot;&gt;&lt;/rabbit:listener&gt;&lt;/rabbit:listener-container&gt;åœ¨consumerä¸­å¯åŠ¨ackæœºåˆ¶packagecom.cn.listener;importcom.rabbitmq.client.Channel;importorg.springframework.amqp.core.AcknowledgeMode;importorg.springframework.amqp.core.Message;importorg.springframework.amqp.core.MessageListener;importorg.springframework.amqp.rabbit.listener.api.ChannelAwareMessageListener;importorg.springframework.stereotype.Component;/***ConsumerACKæœºåˆ¶:*1.è®¾ç½®æ‰‹åŠ¨ç­¾æ”¶ï¼šacknowledge=&quot;manual&quot;*2.è®©ç›‘å¬å™¨å®ç°ChannelAwareMessageListeneræ¥å£*3.å¦‚æœæ¶ˆæ¯å¤„ç†æˆåŠŸï¼Œåˆ™è°ƒç”¨channelçš„basicAck()ç­¾æ”¶*4.å¦‚æœæ¶ˆæ¯å¤„ç†å¤±è´¥ï¼Œåˆ™è°ƒç”¨channelçš„basicNack()æ‹’ç»ç­¾æ”¶ï¼ŒrabbitMQServerå°±ä¼šé‡æ–°å‘æ¶ˆæ¯ç»™consumer*/@ComponentpublicclassAckListenerimplementsChannelAwareMessageListener{publicvoidonMessage(Messagemessage,Channelchannel)throwsException{//é»˜è®¤æ˜¯è‡ªåŠ¨ç­¾æ”¶longdeliveryTag=message.getMessageProperties().getDeliveryTag();try{//1.æ¥æ”¶æ¶ˆæ¯System.out.println(newString(message.getBody()));//2.å¤„ç†ä¸šåŠ¡inti=3/0;//æ¨¡æ‹Ÿä¸šåŠ¡å‡ºç°é—®é¢˜//3.å¦‚æœä¸šåŠ¡å¤„ç†æˆåŠŸï¼Œé‚£ä¹ˆå°±ç­¾æ”¶channel.basicAck(deliveryTag,true);}catch(Exceptione){/***4.æ‹’ç»ç­¾æ”¶*ç¬¬ä¸‰ä¸ªå‚æ•°ï¼šä¸ºtrueè¡¨ç¤ºè¯¥æ¶ˆæ¯é‡æ–°ä¼šåˆ°queueä¸­ï¼Œborkerä¼šé‡æ–°å‘é€è¯¥æ¶ˆæ¯ç»™æ¶ˆè´¹ç«¯*/channel.basicNack(deliveryTag,true,true);}}publicvoidonMessage(Messagemessage){}publicvoidcontainerAckMode(AcknowledgeModemode){}}å°ç»“åœ¨rabbit:listener-containeræ ‡ç­¾ä¸­è®¾ç½®acknowledge=&quot;manual&quot;ï¼Œè¡¨ç¤ºé‡‡ç”¨æ‰‹åŠ¨ç­¾æ”¶å¦‚æœæ¶ˆè´¹è€…æ²¡æœ‰å‡ºç°å¼‚å¸¸ï¼Œåˆ™è°ƒç”¨channel.basicAck(deliveryTag,true);ç­¾æ”¶æ¶ˆæ¯ï¼Œé‚£ä¹ˆæ¶ˆæ¯æ‰ä¼šä»rabbitmqä¸­åˆ é™¤å¦‚æœåœ¨æ¶ˆè´¹è€…å‡ºç°äº†å¼‚å¸¸ï¼Œåˆ™åœ¨catchä¸­è°ƒç”¨channel.basicNack(deliveryTag,true,true);æ‹’ç»æ¶ˆæ¯ï¼Œè®©MQé‡æ–°å‘é€æ¶ˆæ¯æ¶ˆæ¯çš„å¯é æ€§å¦‚ä½•ä¿è¯ï¼Ÿ1.æŒä¹…åŒ–â€‹exchangeè¦æŒä¹…åŒ–â€‹queueè¦æŒä¹…åŒ–â€‹messageè¦æŒä¹…åŒ–2.ç”Ÿäº§æ–¹ç¡®è®¤Confirm3.æ¶ˆè´¹æ–¹è¦Ack4.Brokeré«˜å¯ç”¨ï¼ˆrabbitMQè¦æ­å»ºé›†ç¾¤ï¼‰æ¶ˆè´¹ç«¯é™æµç¼–å†™listenerpackagecom.cn.listener;importcom.rabbitmq.client.Channel;importorg.springframework.amqp.core.AcknowledgeMode;importorg.springframework.amqp.core.Message;importorg.springframework.amqp.rabbit.listener.api.ChannelAwareMessageListener;importorg.springframework.stereotype.Component;/***é™æµæœºåˆ¶:*1.ç¡®ä¿ackæœºåˆ¶ä¸ºæ‰‹åŠ¨ç¡®è®¤*2.listener-containerä¸­é…ç½®prefetch=&quot;1&quot;ï¼Œè¡¨ç¤ºæ¶ˆè´¹ç«¯æ¯æ¬¡ä»mqå»æ‹‰å»ä¸€æ¡æ¶ˆæ¯æ¥æ¶ˆè´¹ï¼ŒçŸ¥é“æ‰‹åŠ¨ç¡®è®¤æ¶ˆæ¯æ¶ˆè´¹å®Œæ¯•åï¼Œæ‰ä¼šç»§ç»­å»æ‹‰å»æ´—ä¸€æ¡æ¶ˆæ¯*/@ComponentpublicclassQosListenerimplementsChannelAwareMessageListener{publicvoidonMessage(Messagemessage,Channelchannel)throwsException{Thread.sleep(1000);//1.è·å–æ¶ˆæ¯System.out.println(newString(message.getBody()));//2.å¤„ç†ä¸šåŠ¡é€»è¾‘//3.ç­¾æ”¶channel.basicAck(message.getMessageProperties().getDeliveryTag(),true);}publicvoidonMessage(Messagemessage){}publicvoidcontainerAckMode(AcknowledgeModemode){}}ç¼–å†™é…ç½®æ–‡ä»¶&lt;!--å®šä¹‰ç›‘å¬å™¨å®¹å™¨acknowledge=&quot;manual&quot;:è¡¨ç¤ºæ‰‹åŠ¨ç­¾æ”¶--&gt;&lt;rabbit:listener-containerconnection-factory=&quot;connectionFactory&quot;acknowledge=&quot;manual&quot;prefetch=&quot;1&quot;&gt;&lt;!--&lt;rabbit:listenerref=&quot;ackListener&quot;queue-names=&quot;test_queue_confirm&quot;&gt;&lt;/rabbit:listener&gt;--&gt;&lt;rabbit:listenerref=&quot;qosListener&quot;queue-names=&quot;test_queue_confirm&quot;&gt;&lt;/rabbit:listener&gt;&lt;/rabbit:listener-container&gt;æµ‹è¯•å…ˆé€šè¿‡producerå‘é€10æ¡æ¶ˆæ¯åˆ°rabbitmqï¼Œç„¶åå¯åŠ¨consumerï¼Œå‘ç°æ˜¯å¯ä»¥æ­£å¸¸æ¶ˆè´¹çš„ï¼Œç„¶åå°†prefetch=&quot;3&quot;ï¼Œè¡¨ç¤ºæ¯æ¬¡ä»rabbitmqæ‹‰å–3æ¡æ¶ˆæ¯ï¼Œå†å°†ç­¾æ”¶æ³¨é‡Šæ‰ï¼Œä¼šå‘ç°ä¸€æ¬¡æ€§æ‹‰å–äº†3æ¡æ¶ˆæ¯å°ç»“åœ¨listener-containerä¸­è®¾ç½®prefetchå¯ä»¥è®¾ç½®æ¶ˆè´¹ç«¯ä¸€æ¬¡æ€§å¯ä»¥æ‹‰å–å¤šå°‘æ¡æ¶ˆæ¯æ¶ˆè´¹æ®µä¸€å®šè¦ä½¿ç”¨ackæ¨¡å¼ï¼ˆæ‰‹åŠ¨ç­¾æ”¶ï¼‰æ ¹æ®ç³»ç»Ÿçš„æ‰¿è½½é‡å†³å®šæ¯æ¬¡æ‹‰å–å¤šå°‘æ¶ˆæ¯TTLç®€ä»‹TTLï¼šTimeToLiveï¼ˆå­˜æ´»æ—¶é—´/è¿‡æœŸæ—¶é—´ï¼‰å½“æ¶ˆæ¯åˆ°è¾¾å­˜æ´»æ—¶é—´åï¼Œè¿˜æ²¡æœ‰è¢«æ¶ˆè´¹ï¼Œä¼šè¢«è‡ªåŠ¨æ¸…é™¤RabbitMQå¯ä»¥å¯¹æ¶ˆæ¯è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œä¹Ÿå¯ä¹Ÿå¯¹æ•´ä¸ªé˜Ÿåˆ—ï¼ˆQueueï¼‰è®¾ç½®è¿‡æœŸæ—¶é—´åº”ç”¨åœºæ™¯é—®é¢˜1:å¦‚æœç”¨æˆ·ä¸‹äº†è®¢å•åï¼Œå¹¶æ²¡æœ‰åŠæ—¶çš„æ”¯ä»˜ï¼Œé‚£ä¹ˆåº“å­˜æ˜¯ä¸€è‡´å½’ä¸‹äº†è®¢å•çš„ç”¨æˆ·ï¼Œè¿˜æ˜¯éœ€è¦å½’è¿˜ï¼Ÿéœ€è¦é—®é¢˜2ï¼šå¦‚ä½•å½’è¿˜åº“å­˜ï¼Ÿâ€‹ä¸€èˆ¬çš„æƒ…å†µä¸‹ï¼Œè®¾ç½®ä¸€ä¸ªå®šæ—¶ä»»åŠ¡ï¼Œæ¯å¤©å‡Œæ™¨1-3ç‚¹ä¹‹é—´æ‰§è¡Œï¼ŒæŸ¥çœ‹ä½ çš„è®¢å•æ˜¯å¦åœ¨24å°æ—¶å†…æ”¯ä»˜äº†ï¼Œå¦‚æœæ²¡æœ‰æ”¯ä»˜ï¼Œé‚£ä¹ˆå°†åº“å­˜è¿”å›â€‹å¦‚æœæ˜¯ç§’æ€æƒ…å†µä¸‹ï¼Œç”¨æˆ·çš„éœ€æ±‚å°±æ˜¯å¦‚æœä¸‹äº†è®¢å•åï¼ŒåŠå°æ—¶æ²¡æœ‰æ”¯ä»˜ï¼Œå°±è¿”å›åº“å­˜ï¼ˆå¯ä»¥ä½¿ç”¨SpringTaskæ¯éš”ä¸€æ®µæ—¶é—´æŸ¥è¯¢ä¸€æ¬¡è®¢å•è¡¨å’Œæ”¯ä»˜è®°å½•è¡¨ï¼ŒæŸ¥è¯¢ç»“æœçš„æ˜¯åŠä¸ªå°æ—¶æ²¡æœ‰æ”¯ä»˜ï¼Œé‚£ä¹ˆè¿”å›åº“å­˜ï¼‰é—®é¢˜3ï¼šé‚£ä¹ˆå®šæ—¶ä»»åŠ¡è®¾ç½®æ—¶é—´é—´éš”å¤šå°‘åˆé€‚ï¼Ÿâ€‹å¦‚æœæ˜¯1åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡ï¼Œï¼ˆå¦‚ï¼š10ç‚¹å¼€å§‹ï¼Œ10ï¼š10ç§’æ€äº†ä¸€ä»¶å•†å“ï¼‰ï¼Œè‚¯å®šæ˜¯å¯ä»¥çš„ï¼Œä½†æ¯«æ— ç–‘é—®å­˜åœ¨æ—¶é—´çš„è¯¯å·®ï¼ˆè¯¯å·®1åˆ†é’Ÿå¯ä»¥æ¥æ”¶ï¼‰ï¼Œä½†æŸ¥è¯¢æ•°æ®åº“å¤ªé¢‘ç¹ï¼Œè‚¯å®šéå¸¸å½±å“ç³»ç»Ÿçš„æ€§èƒ½producerä¸­é…ç½®ttl&lt;!--ttl--&gt;&lt;rabbit:queuename=&quot;test_queue_ttl&quot;id=&quot;test_queue_ttl&quot;&gt;&lt;!--è®¾ç½®queueçš„å‚æ•°æ³¨æ„ä¸€å®šè¦åŠ value-type,å› ä¸ºç±»å‹é»˜è®¤æ˜¯stringï¼Œå¦‚æœä¸è®¾ç½®å°±ä¼šå‡ºç°ç±»å‹é”™è¯¯--&gt;&lt;rabbit:queue-arguments&gt;&lt;entrykey=&quot;x-message-ttl&quot;value=&quot;10000&quot;value-type=&quot;java.lang.Integer&quot;&gt;&lt;/entry&gt;&lt;/rabbit:queue-arguments&gt;&lt;/rabbit:queue&gt;&lt;!--å£°æ˜ä¸€ä¸ªtopicäº¤æ¢æœº--&gt;&lt;rabbit:topic-exchangename=&quot;test_exchange_ttl&quot;&gt;&lt;rabbit:bindings&gt;&lt;rabbit:bindingpattern=&quot;ttl.#&quot;queue=&quot;test_queue_ttl&quot;&gt;&lt;/rabbit:binding&gt;&lt;/rabbit:bindings&gt;&lt;/rabbit:topic-exchange&gt;åœ¨producerçš„æµ‹è¯•ç±»ä¸­ç¼–ç /***TTLï¼šè¿‡æœŸæ—¶é—´*æ­¥éª¤ï¼š*1.é˜Ÿåˆ—ç»Ÿä¸€è¿‡æœŸ*/@TestpublicvoidtestTtl(){for(inti=0;i&lt;10;i++){rabbitTemplate.convertAndSend(&quot;test_exchange_ttl&quot;,&quot;ttl.hello&quot;,&quot;messagettl....&quot;);}}åœ¨æ‰§è¡Œåï¼Œå¯ä»¥çœ‹åˆ°10ç§’é’Ÿåï¼Œqueueä¸­çš„æ¶ˆæ¯å°±æ¶ˆå¤±äº†å¯ä»¥å•ç‹¬è®¾ç½®è¿‡æœŸæ—¶é—´/***TTLï¼šè¿‡æœŸæ—¶é—´*æ­¥éª¤ï¼š*1.é˜Ÿåˆ—ç»Ÿä¸€è¿‡æœŸ**2.å•ç‹¬è®¾ç½®è¿‡æœŸ*/@TestpublicvoidtestTtl(){//ä¸€ï¼šç»Ÿä¸€è¿‡æœŸ//for(inti=0;i&lt;10;i++){//rabbitTemplate.convertAndSend(&quot;test_exchange_ttl&quot;,&quot;ttl.hello&quot;,&quot;messagettl....&quot;);//}MessagePostProcessormessagePostProcessor=newMessagePostProcessor(){publicMessagepostProcessMessage(Messagemessage)throwsAmqpException{//1.è®¾ç½®messageçš„æ¶ˆæ¯message.getMessageProperties().setExpiration(&quot;5000&quot;);//æ¶ˆæ¯çš„è¿‡æœŸæ—¶é—´ï¼Œå•ä½å­—ç¬¦ä¸²//2.è¿”å›è¯¥æ¶ˆæ¯returnmessage;}};//æ¶ˆæ¯å•ç‹¬è¿‡æœŸfor(inti=0;i&lt;10;i++){if(i==5){//è¿™æ¡æ¶ˆæ¯å°±å•ç‹¬è¿‡æœŸ(è¿‡æœŸæ—¶é—´æ˜¯5ç§’)rabbitTemplate.convertAndSend(&quot;test_exchange_ttl&quot;,&quot;ttl.hehe&quot;,&quot;messagettl....&quot;,messagePostProcessor);}else{//å…¶ä»–çš„è¿‡æœŸæ—¶é—´é»˜è®¤çš„rabbitTemplate.convertAndSend(&quot;test_exchange_ttl&quot;,&quot;ttl.hello&quot;,&quot;messagettl....&quot;);}}}æ­»ä¿¡é˜Ÿåˆ—ä»€ä¹ˆæ˜¯æ­»ä¿¡é˜Ÿåˆ—æ­»ä¿¡é˜Ÿåˆ—ï¼ˆè‹±æ–‡ç¼©å†™ï¼šDLXï¼‰ï¼Œåœ¨RabbitMQä¸­å«DeadLetterExchangeï¼ˆæ­»ä¿¡äº¤æ¢æœºï¼‰ï¼Œå½“æ¶ˆæ¯æˆä¸ºDeadMessageä¹‹åï¼Œå¯ä»¥è¢«é‡æ–°å‘é€åˆ°å¦ä¸€ä¸ªäº¤æ¢æœºä¸­ï¼Œè¿™ä¸ªäº¤æ¢æœºå°±å«DLXæ¶ˆæ¯åœ¨ä»€ä¹ˆæƒ…å†µä¸‹ä¼šæˆåŠŸæ­»ä¿¡æ¶ˆæ¯æˆä¸ºæ­»ä¿¡æœ‰ä¸‰ç§æƒ…å†µé˜Ÿåˆ—æ¶ˆæ¯é•¿åº¦è¾¾åˆ°é™åˆ¶æ¶ˆè´¹è€…æ‹’ç»æ¶ˆè´¹æ¶ˆæ¯ï¼Œå¹¶ä¸”ä¸æŠŠæ¶ˆæ¯é‡æ–°æ”¾å…¥åˆ°åŸç›®æ ‡é˜Ÿåˆ—ä¸­ï¼ˆrequeue=falseï¼‰åŸé˜Ÿåˆ—å­˜åœ¨æ¶ˆæ¯è¿‡æœŸè®¾ç½®ï¼Œæ¶ˆæ¯åˆ°è¾¾æ—¶é—´æ²¡æœ‰è¢«æ¶ˆè´¹é˜Ÿåˆ—å¦‚ä½•ç»‘å®šæ­»ä¿¡äº¤æ¢å™¨BVCXVBNM,MNBGVCXé˜Ÿåˆ—ç»‘å®šæ­»ä¿¡äº¤æ¢æœºï¼šconsumerä¸­çš„é…ç½®æ­»ä¿¡&lt;!--æ­»ä¿¡é˜Ÿåˆ—:1.å£°æ˜ä¸€ä¸ªæ­£å¸¸çš„é˜Ÿåˆ—ï¼ˆtest_queue_dlxï¼‰å’Œå®˜æ¢æœº(test_exchange_dlx)2.å£°æ˜æ­»ä¿¡é˜Ÿåˆ—(queue_dlx)å’Œæ­»ä¿¡äº¤æ¢æœº(exchange_dlx)--&gt;&lt;!--1.å£°æ˜ä¸€ä¸ªæ­£å¸¸çš„é˜Ÿåˆ—ï¼ˆtest_queue_dlxï¼‰å’Œå®˜æ¢æœº(test_exchange_dlx)--&gt;&lt;rabbit:queuename=&quot;test_queue_dlx&quot;id=&quot;test_queue_dlx&quot;&gt;&lt;!--å°†æ­£å¸¸çš„é˜Ÿåˆ—ç»‘å®šæ­»ä¿¡äº¤æ¢æœº--&gt;&lt;rabbit:queue-arguments&gt;&lt;!--x-dead-letter-exchange:æ­»ä¿¡äº¤æ¢æœºå--&gt;&lt;entrykey=&quot;x-dead-letter-exchange&quot;value=&quot;exchange_dlx&quot;/&gt;&lt;!--å‘é€ç»™æ­»ä¿¡äº¤æ¢æœºçš„routingkey--&gt;&lt;entrykey=&quot;x-dead-letter-routing-key&quot;value=&quot;dlx.hehe&quot;/&gt;&lt;!--è®¾ç½®é˜Ÿåˆ—çš„è¿‡æœŸæ—¶é—´ttl--&gt;&lt;entrykey=&quot;x-message-ttl&quot;value=&quot;10000&quot;value-type=&quot;java.lang.Integer&quot;/&gt;&lt;!--è®¾ç½®é˜Ÿåˆ—çš„é•¿åº¦é™åˆ¶--&gt;&lt;entrykey=&quot;x-max-length&quot;value=&quot;10&quot;value-type=&quot;java.lang.Integer&quot;/&gt;&lt;/rabbit:queue-arguments&gt;&lt;/rabbit:queue&gt;&lt;rabbit:topic-exchangename=&quot;test_exchange_dlx&quot;&gt;&lt;rabbit:bindings&gt;&lt;rabbit:bindingpattern=&quot;test.dlx.#&quot;queue=&quot;test_queue_dlx&quot;&gt;&lt;/rabbit:binding&gt;&lt;/rabbit:bindings&gt;&lt;/rabbit:topic-exchange&gt;&lt;!--å£°æ˜æ­»ä¿¡é˜Ÿåˆ—(queue_dlx)å’Œæ­»ä¿¡äº¤æ¢æœº(exchange_dlx)--&gt;&lt;rabbit:queuename=&quot;queue_dlx&quot;id=&quot;queue_dlx&quot;&gt;&lt;/rabbit:queue&gt;&lt;rabbit:topic-exchangename=&quot;exchange_dlx&quot;&gt;&lt;rabbit:bindings&gt;&lt;rabbit:bindingpattern=&quot;dlx.#&quot;queue=&quot;queue_dlx&quot;&gt;&lt;/rabbit:binding&gt;&lt;/rabbit:bindings&gt;&lt;/rabbit:topic-exchange&gt;åœ¨consumerä¸­æµ‹è¯•@TestpublicvoidtestDlx(){//1.æµ‹è¯•è¿‡æœŸæ—¶é—´ï¼Œåˆ°äº†è¿‡æœŸå°±ä¼šåˆ°æ­»ä¿¡ä¸­ï¼ˆä¸å¯åŠ¨æ¶ˆè´¹è€…ï¼‰//rabbitTemplate.convertAndSend(&quot;test_exchange_dlx&quot;,&quot;test.dlx.haha&quot;,&quot;æˆ‘æ˜¯ä¸€æ¡æ¶ˆæ¯ï¼Œæˆ‘ä¼šæ­»å—ï¼Ÿ&quot;);//2.æµ‹è¯•é•¿åº¦è¶…è¿‡ä¸Šé™åï¼Œå¤šä½™çš„è¿›å…¥åˆ°æ­»ä¿¡ä¸­//for(inti=0;i&lt;20;i++){//rabbitTemplate.convertAndSend(&quot;test_exchange_dlx&quot;,&quot;test.dlx.haha&quot;,&quot;æˆ‘æ˜¯ä¸€æ¡æ¶ˆæ¯ï¼Œæˆ‘ä¼šæ­»å—ï¼Ÿ&quot;);//}//3.æµ‹è¯•æ¶ˆæ¯æ‹’æ”¶rabbitTemplate.convertAndSend(&quot;test_exchange_dlx&quot;,&quot;test.dlx.haha&quot;,&quot;æˆ‘æ˜¯ä¸€æ¡æ¶ˆæ¯ï¼Œæˆ‘ä¼šæ­»å—ï¼Ÿ&quot;);}åœ¨consumerä¸­æ‹’æ”¶æ¶ˆæ¯packagecom.cn.listener;importcom.rabbitmq.client.Channel;importorg.springframework.amqp.core.AcknowledgeMode;importorg.springframework.amqp.core.Message;importorg.springframework.amqp.rabbit.listener.api.ChannelAwareMessageListener;importorg.springframework.stereotype.Component;@ComponentpublicclassDlxListenerimplementsChannelAwareMessageListener{publicvoidonMessage(Messagemessage,Channelchannel)throwsException{//é»˜è®¤æ˜¯è‡ªåŠ¨ç­¾æ”¶longdeliveryTag=message.getMessageProperties().getDeliveryTag();try{//1.æ¥æ”¶æ¶ˆæ¯System.out.println(newString(message.getBody()));//2.å¤„ç†ä¸šåŠ¡inti=3/0;//æ¨¡æ‹Ÿä¸šåŠ¡å‡ºç°é—®é¢˜//3.å¦‚æœä¸šåŠ¡å¤„ç†æˆåŠŸï¼Œé‚£ä¹ˆå°±ç­¾æ”¶channel.basicAck(deliveryTag,true);}catch(Exceptione){/***4.æ‹’ç»ç­¾æ”¶*ç¬¬ä¸‰ä¸ªå‚æ•°ï¼šä¸ºtrueè¡¨ç¤ºè¯¥æ¶ˆæ¯é‡æ–°ä¼šåˆ°queueä¸­ï¼Œborkerä¼šé‡æ–°å‘é€è¯¥æ¶ˆæ¯ç»™æ¶ˆè´¹ç«¯*ä¸ºfalseè¡¨ç¤ºä¸é‡å›é˜Ÿåˆ—ï¼Œå°†ä¼šè¿›å…¥åˆ°æ­»ä¿¡é˜Ÿåˆ—*/channel.basicNack(deliveryTag,true,false);}}publicvoidonMessage(Messagemessage){}publicvoidcontainerAckMode(AcknowledgeModemode){}}consumerçš„é…ç½®æ–‡ä»¶&lt;!--å®šä¹‰ç›‘å¬å™¨å®¹å™¨acknowledge=&quot;manual&quot;:è¡¨ç¤ºæ‰‹åŠ¨ç­¾æ”¶--&gt;&lt;rabbit:listener-containerconnection-factory=&quot;connectionFactory&quot;acknowledge=&quot;manual&quot;prefetch=&quot;3&quot;&gt;&lt;!--&lt;rabbit:listenerref=&quot;ackListener&quot;queue-names=&quot;test_queue_confirm&quot;&gt;&lt;/rabbit:listener&gt;--&gt;&lt;!--&lt;rabbit:listenerref=&quot;qosListener&quot;queue-names=&quot;test_queue_confirm&quot;&gt;&lt;/rabbit:listener&gt;--&gt;&lt;rabbit:listenerref=&quot;dlxListener&quot;queue-names=&quot;test_queue_dlx&quot;&gt;&lt;/rabbit:listener&gt;&lt;/rabbit:listener-container&gt;å°ç»“æ­»ä¿¡äº¤æ¢æœºå’Œæ­»ä¿¡é˜Ÿåˆ—å’Œæ™®é€šçš„æ²¡æœ‰åŒºåˆ«å½“æ¶ˆæ¯æˆä¸ºæ­»ä¿¡åï¼Œå¦‚æœè¯¥ç»‘å®šäº†æ­»ä¿¡äº¤æ¢æœºï¼Œåˆ™æ¶ˆæ¯ä¼šè¢«æ­»ä¿¡äº¤æ¢æœºé‡æ–°è·¯ç”±åˆ°æ­»ä¿¡é˜Ÿåˆ—æ¶ˆæ¯æˆä¸ºæ­»ä¿¡çš„ä¸‰ç§æƒ…å†µï¼šï¼ˆæ¶ˆæ¯çš„é•¿åº¦è¾¾åˆ°ä¸Šçº¿ã€æ¶ˆè´¹è€…æ‹’ç»æ¶ˆæ¯ã€å…ƒé˜Ÿåˆ—çš„æ¶ˆæ¯è¿‡æœŸåˆ°äº†æ—¶é—´æœªè¢«æ¶ˆè´¹ï¼‰é˜Ÿåˆ—å»¶è¿Ÿä»€ä¹ˆæ˜¯é˜Ÿåˆ—å»¶è¿Ÿé˜Ÿåˆ—å»¶è¿Ÿï¼šæ¶ˆæ¯è¿›å…¥é˜Ÿåˆ—åä¸ä¼šç«‹å³è¢«æ¶ˆè´¹ï¼Œåªæœ‰è¾¾åˆ°æŒ‡å®šçš„æ—¶é—´åæ‰ä¼šè¢«æ¶ˆè´¹éœ€æ±‚ï¼šä¸‹å•åï¼Œä¸‰ååˆ†é’Ÿæœªæ”¯ä»˜ï¼Œå–æ¶ˆè®¢å•ï¼Œå›æ»šåº“å­˜æ–°ç”¨æˆ·æ³¨å†Œ7å¤©åï¼Œå‘çŸ­ä¿¡é—®å€™å®ç°æ–¹å¼ï¼šå®šæ—¶å™¨å»¶è¿Ÿé˜Ÿåˆ—ï¼ˆRabbitMQæ²¡æœ‰ï¼‰å¾ˆå¯æƒœï¼Œåœ¨RabbitMQä¸­å¹¶æœªæä¾›å»¶è¿Ÿé˜Ÿåˆ—åŠŸèƒ½ä½†æ˜¯æˆ‘ä»¬å¯ä»¥ä½¿ç”¨:TTL+æ­»ä¿¡é˜Ÿåˆ—ç»„åˆæ¥å®ç°å»¶è¿Ÿé˜Ÿåˆ—çš„æ•ˆæœç”Ÿæˆè€…ç¼–ç åœ¨producerä¸­æ·»åŠ é…ç½®&lt;!--å»¶è¿Ÿé˜Ÿåˆ—:1.å®šä¹‰æ­£å¸¸çš„äº¤æ¢å™¨(order_exchange)å’Œé˜Ÿåˆ—(order_queue)2.å®šä¹‰æ­»ä¿¡äº¤æ¢æœº(order_exchange_dlx)å’Œé˜Ÿåˆ—(order_queue_dlx)3.ç»‘å®šï¼Œè®¾ç½®æ­£å¸¸çš„é˜Ÿåˆ—è¿‡æœŸæ—¶é—´æ˜¯30åˆ†é’Ÿ(ä¸ºäº†æ–¹ä¾¿æµ‹è¯•ï¼Œè®¾ç½®ä¸º10ç§’)--&gt;&lt;rabbit:queueid=&quot;order_queue&quot;name=&quot;order_queue&quot;&gt;&lt;!--ç»‘å®š--&gt;&lt;rabbit:queue-arguments&gt;&lt;entrykey=&quot;x-dead-letter-exchange&quot;value=&quot;order_exchange_dlx&quot;/&gt;&lt;entrykey=&quot;x-dead-letter-routing-key&quot;value=&quot;dlx.order.cancel&quot;/&gt;&lt;entrykey=&quot;x-message-ttl&quot;value=&quot;10000&quot;value-type=&quot;java.lang.Integer&quot;/&gt;&lt;/rabbit:queue-arguments&gt;&lt;/rabbit:queue&gt;&lt;rabbit:topic-exchangename=&quot;order_exchange&quot;&gt;&lt;rabbit:bindings&gt;&lt;rabbit:bindingpattern=&quot;order.#&quot;queue=&quot;order_queue&quot;&gt;&lt;/rabbit:binding&gt;&lt;/rabbit:bindings&gt;&lt;/rabbit:topic-exchange&gt;&lt;!--å®šä¹‰æ­»ä¿¡äº¤æ¢æœº--&gt;&lt;rabbit:queueid=&quot;order_queue_dlx&quot;name=&quot;order_queue_dlx&quot;&gt;&lt;/rabbit:queue&gt;&lt;rabbit:topic-exchangename=&quot;order_exchange_dlx&quot;&gt;&lt;rabbit:bindings&gt;&lt;rabbit:bindingpattern=&quot;dlx.order.#&quot;queue=&quot;order_queue_dlx&quot;&gt;&lt;/rabbit:binding&gt;&lt;/rabbit:bindings&gt;&lt;/rabbit:topic-exchange&gt;@TestpublicvoidtestDelay(){rabbitTemplate.convertAndSend(&quot;order_exchange&quot;,&quot;order.msg&quot;,&quot;è®¢å•ä¿¡æ¯ï¼šid=1,time=2020-6-14-17:31&quot;);}æ¶ˆè´¹è€…ç¼–ç packagecom.cn.listener;importcom.rabbitmq.client.Channel;importorg.springframework.amqp.core.AcknowledgeMode;importorg.springframework.amqp.core.Message;importorg.springframework.amqp.rabbit.listener.api.ChannelAwareMessageListener;importorg.springframework.stereotype.Component;/****/@ComponentpublicclassOrderListenerimplementsChannelAwareMessageListener{publicvoidonMessage(Messagemessage,Channelchannel)throwsException{//é»˜è®¤æ˜¯è‡ªåŠ¨ç­¾æ”¶longdeliveryTag=message.getMessageProperties().getDeliveryTag();try{//1.æ¥æ”¶æ¶ˆæ¯System.out.println(newString(message.getBody()));//2.å¤„ç†ä¸šåŠ¡System.out.println(&quot;å¤„ç†ä¸šåŠ¡é€»è¾‘....&quot;);System.out.println(&quot;æ ¹æ®idæŸ¥è¯¢è®¢å•çŠ¶æ€&quot;);System.out.println(&quot;åˆ¤æ–­å…¶æ”¯ä»˜æ˜¯å¦æˆåŠŸ&quot;);System.out.println(&quot;å¦‚æœæœªæ”¯ä»˜ï¼Œé‚£ä¹ˆä¸šåŠ¡åšåº“å­˜æ•°é‡å›æ»š&quot;);//3.å¦‚æœä¸šåŠ¡å¤„ç†æˆåŠŸï¼Œé‚£ä¹ˆå°±ç­¾æ”¶channel.basicAck(deliveryTag,true);}catch(Exceptione){System.out.println(&quot;å‡ºç°äº†å¼‚å¸¸&quot;);/***4.æ‹’ç»ç­¾æ”¶*ç¬¬ä¸‰ä¸ªå‚æ•°ï¼šä¸ºtrueè¡¨ç¤ºè¯¥æ¶ˆæ¯é‡æ–°ä¼šåˆ°queueä¸­ï¼Œborkerä¼šé‡æ–°å‘é€è¯¥æ¶ˆæ¯ç»™æ¶ˆè´¹ç«¯*ä¸ºfalseè¡¨ç¤ºä¸é‡å›é˜Ÿåˆ—ï¼Œå°†ä¼šè¿›å…¥åˆ°æ­»ä¿¡é˜Ÿåˆ—*/channel.basicNack(deliveryTag,true,false);}}publicvoidonMessage(Messagemessage){}publicvoidcontainerAckMode(AcknowledgeModemode){}}&lt;!--å®šä¹‰ç›‘å¬å™¨å®¹å™¨acknowledge=&quot;manual&quot;:è¡¨ç¤ºæ‰‹åŠ¨ç­¾æ”¶--&gt;&lt;rabbit:listener-containerconnection-factory=&quot;connectionFactory&quot;acknowledge=&quot;manual&quot;prefetch=&quot;3&quot;&gt;&lt;!--&lt;rabbit:listenerref=&quot;ackListener&quot;queue-names=&quot;test_queue_confirm&quot;&gt;&lt;/rabbit:listener&gt;--&gt;&lt;!--&lt;rabbit:listenerref=&quot;qosListener&quot;queue-names=&quot;test_queue_confirm&quot;&gt;&lt;/rabbit:listener&gt;--&gt;&lt;!--&lt;rabbit:listenerref=&quot;dlxListener&quot;queue-names=&quot;test_queue_dlx&quot;&gt;&lt;/rabbit:listener&gt;--&gt;&lt;rabbit:listenerref=&quot;orderListener&quot;queue-names=&quot;order_queue_dlx&quot;&gt;&lt;/rabbit:listener&gt;&lt;/rabbit:listener-container&gt;","link":"https://haohanya.github.io/post/rabbitmqer/"},{"title":"RabbitMQï¼ˆä¸€ï¼‰","content":"springcloudbusç®€ä»‹å®ƒæ˜¯ç”¨è½»é‡çš„æ¶ˆæ¯ä»£æ›¿å°†åˆ†å¸ƒå¼èŠ‚ç‚¹è¿æ¥èµ·æ¥ï¼Œå¯ä»¥ç”¨äºå¹¿æ’­é…ç½®æ–‡ä»¶çš„æ›´æ”¹æˆ–è€…æ˜¯æœåŠ¡çš„ç›‘æ§ç®¡ç†ã€‚ä¹Ÿå°±æ˜¯æ¶ˆæ¯æ€»çº¿å¯ä»¥ä¸ºå¾®æœåŠ¡åšç›‘æ§ï¼Œä¹Ÿå¯ä»¥å®ç°åº”ç”¨ç¨‹åºä¹‹é—´çš„ç›¸äº’é€šè®¯ã€‚SpringCloudBuså¯é€‰çš„æ¶ˆæ¯ä»£ç†æœ‰RabbitMQå’ŒKafakaMQçš„åŸºæœ¬æ¦‚å¿µMQçš„æ¦‚è¿°MQå…¨ç§°ï¼šMessageQueueï¼ˆæ¶ˆæ¯é˜Ÿåˆ—ï¼‰ï¼Œæ˜¯åœ¨æ¶ˆæ¯çš„ä¼ è¾“è¿‡ç¨‹ä¸­ä¿æŒæ¶ˆæ¯çš„å®¹å™¨ï¼Œå¤šç”¨äºåˆ†å¸ƒå¼ç³»ç»Ÿä¹‹é—´è¿›è¡Œé€šä¿¡MQçš„ä¼˜ç‚¹å’Œç¼ºç‚¹ä¼˜ç‚¹åº”ç”¨è§£è€¦å¼‚æ­¥æé€Ÿå‰Šå³°å¡«è°·ç¼ºç‚¹ç³»ç»Ÿå¯ç”¨æ€§é™ä½ç³»ç»Ÿå¤æ‚åº¦æé«˜ä¸€è‡´æ€§é—®é¢˜ä¼˜ç‚¹ä¸€ï¼šåº”ç”¨è§£è€¦ç³»ç»Ÿçš„è€¦åˆæ€§è¶Šé«˜ï¼Œå®¹é”™æ€§å°±è¶Šä½å¯ç»´æŠ¤æ€§å°±è¶Šä½ä½¿ç”¨MQä½¿å¾—åº”ç”¨è§£è€¦ï¼Œæé«˜äº†å®¹é”™æ€§å’Œå¯ç»´æŠ¤æ€§ä¼˜ç‚¹äºŒï¼šå¼‚æ­¥æé€Ÿä¸€ä¸ªè®¢å•æ“ä½œè€—æ—¶ï¼š20+300+300+300=920msç”¨æˆ·ç‚¹å‡»å®Œæˆä¸‹å•æŒ‰é’®åéœ€è¦ç­‰å¾…920msæ‰èƒ½å¾—åˆ°ä¸‹å•æˆåŠŸçš„å“åº”ï¼Œå¤ªæ…¢äº†ï¼è€Œä½¿ç”¨äº†MQç”¨æˆ·ç‚¹å‡»ä¸‹å•æŒ‰é’®ååªéœ€è¦ç­‰å¾…25mså°±èƒ½å¾—åˆ°ä¸‹å•çš„å“åº”ï¼Œæå‡ç”¨æˆ·ä½“éªŒå’Œç³»ç»Ÿååé‡ï¼ˆååé‡:å•ä½æ—¶é—´å†…å¤„ç†è¯·æ±‚çš„æ•°ç›®ï¼‰ä¼˜ç‚¹ä¸‰ï¼šå‰Šå³°å¡«è°·å‰Šå³°ä¸ºäº†æé«˜è¥ä¸šé¢ï¼Œåœ¨Aç³»ç»Ÿä¸­åšäº†ä¸€ä¸ªæ´»åŠ¨ï¼Œå«ï¼šä¸€å…ƒç§’æ€å¤–æ˜Ÿäººï¼Œåœ¨æ´»åŠ¨å¼€å§‹åï¼Œç”¨æˆ·åå¤åˆ·æ–°é¡µé¢ï¼Œå¹¶ä¸”æ–°ç”¨æˆ·å¢å¤šï¼Œè¯·æ±‚ç¬é—´å¢å¤šæ¯ç§’5000ä¸ªè¯·æ±‚è€Œåº”ç”¨Aç³»ç»Ÿèƒ½æ¯ç§’èƒ½å¤„ç†çš„è¯·æ±‚æ•°åªèƒ½æ˜¯1000ä¸ªï¼Œç°åœ¨è¯·æ±‚æ•°è¾¾åˆ°5000é‚£ä¹ˆAç³»ç»Ÿå°†ä¼šç›´æ¥å®•æœºç”¨æˆ·çš„è¯·æ±‚å…ˆå‘é€ç»™MQï¼Œ5000ä¸ªè¯·æ±‚åŒæ—¶å‘ç»™MQï¼ˆåœ¨MQçœ‹æ¥æ˜¯å°æ„æ€ï¼‰Aç³»ç»Ÿæ¯ç§’ä»MQä¸­æ‹‰å–1000ä¸ªè¯·æ±‚ï¼Œå¤„ç†å®Œäº†ä¹‹åå†ä»MQç»§ç»­æ‹‰å–ï¼Œç›´åˆ°æ¶ˆæ¯å…¨éƒ¨æ‹‰å–å®Œæ¯•å¡«è°·ä½¿ç”¨äº†MQä¹‹åï¼Œé™åˆ¶æ•ˆéæ¶ˆæ¯çš„é€Ÿåº¦ä¸º1000ï¼Œè¿™æ ·ä¾èµ–ï¼Œé«˜å³°æœŸäº§ç”Ÿçš„æ•°æ®åŠ¿å¿…ä¼šè¢«æŒ¤å‹åœ¨MQä¸­ï¼Œé«˜å³°å°±è¢«æ¶ˆæ‰äº†ï¼Œä½†æ˜¯å› ä¸ºæ¶ˆæ¯ç§¯å‹ï¼Œåœ¨é«˜å³°æœŸè¿‡åçš„ä¸€æ®µæ—¶é—´å†…ï¼Œæ¶ˆè´¹æ¶ˆæ¯çš„é€Ÿåº¦è¿˜æ˜¯ä¼šç»´æŒåœ¨1000ï¼Œç›´åˆ°æ¶ˆæ¯æ¶ˆè´¹å®Œç§¯å‹çš„æ¶ˆæ¯ï¼Œè¿™å°±å«åšâ€œå¡«è°·â€ä½¿ç”¨äº†MQåå¯ä»¥æé«˜ç³»ç»Ÿç¨³å®šæ€§å°ç»“ä¼˜ç‚¹å°ç»“åº”ç”¨è§£è€¦ï¼šæé«˜ç³»ç»Ÿå®¹é”™æ€§å’Œå¯ç»´æŠ¤æ€§å¼‚æ­¥æé€Ÿï¼šæå‡ç”¨æˆ·ä½“éªŒå’Œç³»ç»Ÿååé‡å‰Šå³°å¡«è°·ï¼šæé«˜äº†ç³»ç»Ÿçš„ç¨³å®šæ€§MQçš„ç¼ºç‚¹ç³»ç»Ÿå¯ç”¨æ€§é™ä½ç³»ç»Ÿå¼•å…¥çš„å¤–éƒ¨ä¾èµ–è¶Šå¤šï¼Œç³»ç»Ÿç¨³å®šæ€§è¶Šå·®ï¼Œä¸€æ—¦MQå®•æœºï¼Œå°±ä¼šå¯¹ä¸šåŠ¡é€ æˆå½±å“ï¼Œå¦‚ä½•ä¿è¯MQçš„é«˜å¯ç”¨ï¼Ÿç³»ç»Ÿå¤æ‚åº¦æé«˜MQçš„åŠ å…¥å¤§å¤§å¢åŠ äº†ç³»ç»Ÿçš„å¤æ‚åº¦ï¼Œä»¥å‰ç³»ç»Ÿä¹‹é—´åŒæ­¥çš„è¿œç¨‹è°ƒç”¨ï¼Œç°åœ¨æ˜¯é€šè¿‡MQè¿›è¡Œå¼‚æ­¥è°ƒç”¨ï¼Œå¦‚ä½•ä¿è¯æ¶ˆæ¯æ²¡æœ‰è¢«é‡å¤æ¶ˆè´¹ï¼Ÿæ€ä¹ˆå¤„ç†æ¶ˆæ¯ä¸¢å¤±çš„æƒ…å†µï¼Œé‚£ä¹ˆä¿è¯æ¶ˆæ¯ä¼ é€’çš„é¡ºåºæ€§ï¼Ÿä¸€è‡´æ€§é—®é¢˜Aç³»ç»Ÿå¤„ç†å®Œä¸šåŠ¡ï¼Œé€šè¿‡MQç»™Bã€Cã€Dç³»ç»Ÿä¸‰ä¸ªç³»ç»Ÿå‘é€æ¶ˆæ¯æ•°æ®ï¼Œå¦‚æœBç³»ç»Ÿã€Cç³»ç»Ÿå¤„ç†æˆåŠŸï¼Œä½†æ˜¯Dç³»ç»Ÿå¤„ç†å¤±è´¥ï¼Œå¦‚ä½•ä¿è¯æ¶ˆæ¯æ•°æ®å¤„ç†çš„ä¸€è‡´æ€§å‘¢ï¼Ÿå¸¸è§çš„MQäº§å“ç›®å‰ä¸šç•Œæœ‰å¾ˆå¤šçš„MQäº§å“ï¼Œå¦‚ï¼šRabbitMQã€RocaketMQã€ActiveMQã€Kafakaã€ZeroMQã€MetaMQç­‰ç­‰ï¼Œä¹Ÿæœ‰å…¬å¸ç›´æ¥ä½¿ç”¨Rediså……å½“æ¶ˆæ¯é˜Ÿåˆ—çš„æ¡ˆä¾‹ï¼Œè€Œè¿™äº›æ¶ˆæ¯é˜Ÿåˆ—äº§å“å„æœ‰åé‡ï¼Œåœ¨å®é™…é€‰å‹ä¸­ï¼Œéœ€è¦ç»“åˆè‡ªèº«éœ€æ±‚ä»¥åŠMQäº§å“çš„ç‰¹æ€§ï¼Œç»¼åˆè€ƒè™‘RabbitMQActiveMQRocketMQKafakaå…¬å¸/ç¤¾åŒºRabbitApacheAlibabaApacheå¼€å‘è¯­è¨€Erlangï¼ˆäºŒéƒç¥ï¼‰JavaJavaJava&amp;Scalaåè®®æ”¯æŒAMQPã€SMTP...RESTã€AMQPã€STOMP...è‡ªå®šä¹‰è‡ªå®šä¹‰åè®®ã€ç¤¾åŒºå°è£…äº†httpåè®®æ”¯æŒå®¢æˆ·ç«¯æ”¯æŒè¯­è¨€å®˜æ–¹æ”¯æŒErlangã€javaã€Rubyç­‰Javaã€Cã€C++ã€Pythonã€PHP...Javaã€C++(ä¸æˆç†Ÿ)å®˜æ–¹æ”¯æŒJAVAã€ç¤¾åŒºäº§å‡ºäº†å¤šç§APIï¼Œå¦‚PHPå’ŒPythonç­‰å•æœºååé‡ä¸‡çº§ï¼ˆå…¶æ¬¡ï¼‰ä¸‡çº§ï¼ˆæœ€å·®ï¼‰åä¸‡çº§ï¼ˆæœ€å¥½ï¼‰åä¸‡çº§ï¼ˆæ¬¡ä¹‹ï¼‰æ¶ˆæ¯å»¶è¿Ÿå¾®ç§’çº§æ¯«ç§’çº§æ¯«ç§’çº§æ¯«ç§’çº§ä»¥å†…åŠŸèƒ½ç‰¹æ€§å¹¶å‘èƒ½åŠ›å¼ºã€æ€§èƒ½æå…¶å¥½ã€å»¶è¿Ÿä½ã€ç¤¾åŒºæ´»è·ƒã€ç®¡ç†ç•Œé¢ä¸°å¯Œè€ç‰Œäº§å“ã€æˆç†Ÿåº¦é«˜ã€æ–‡æ¡£è¾ƒå¤šMQåŠŸèƒ½æ¯”è¾ƒå®Œå¤‡ã€æ‰©å±•æ€§ä½³æ”¯æ”¯æŒä¸»è¦çš„MQåŠŸèƒ½ï¼Œæ¯•ç«Ÿæ˜¯ä¸ºå¤§æ•°æ®é¢†åŸŸå‡†å¤‡çš„RabbitMQAMQPç®€ä»‹AMQPï¼šAdvancedMessageQueuingProtocol(é«˜çº§æ¶ˆæ¯é˜Ÿåˆ—åè®®)ï¼Œå®ƒæ˜¯ä¸€ä¸ªç½‘è·¯åè®®ï¼Œæ˜¯åº”ç”¨å±‚åè®®çš„ä¸€ä¸ªå¼€å‘æ ‡å‡†ï¼Œä¸ºé¢å‘æ¶ˆæ¯çš„ä¸­é—´ä»¶è®¾è®¡ã€‚åŸºäºæ­¤åè®®çš„å®¢æˆ·ç«¯ä¸æ¶ˆæ¯ä¸­é—´ä»¶å¯ä¼ é€’æ¶ˆæ¯ï¼Œå¹¶ä¸å—å®¢æˆ·ç«¯/ä¸­é—´ä»¶ä¸åŒäº§å“ï¼Œä¸åŒçš„å¼€å‘è¯­è¨€ç­‰æ¡ä»¶é™åˆ¶AMQPæ˜¯2006å¹´SUNå…¬å¸å‘å¸ƒçš„ä¸€ä¸ªè§„èŒƒRabbitMQç®€ä»‹RabbitæŠ€æœ¯å…¬å¸ï¼ˆç¾å›½ï¼‰åŸºäºAMQPæ ‡å‡†å¼€å‘çš„RabbitMQäº2007å¹´å‘å¸ƒV1.0ç‰ˆï¼ŒRabbitMQé‡‡ç”¨Erlangè¯­è¨€å¼€å‘ã€‚Erlangè¯­è¨€ä¸“é—¨ä¸ºé«˜å¹¶å‘å’Œåˆ†å¸ƒå¼ç»Ÿè®¾è®¡çš„ä¸€ç§è¯­è¨€ï¼Œåœ¨ç”µä¿¡é¢†åŸŸä½¿ç”¨å¹¿æ³›Broker:å°±æ˜¯RabbitMQServerï¼Œç”¨æ¥æ¥æ”¶å’Œåˆ†å‘æ¶ˆæ¯çš„åº”ç”¨VirtualHost:å‡ºäºå¤šç§Ÿæˆ·å’Œå®‰å…¨å› ç´ è®¾è®¡çš„ï¼ŒæŠŠAMQPçš„åŸºæœ¬ç»„ä»¶åˆ’åˆ†åˆ°ä¸€ä¸ªè™šæ‹Ÿçš„åˆ†ç»„ä¸­ï¼Œé›·é€Ÿä¸ç½‘ç»œä¸­çš„namesapceæ¦‚å¿µã€‚å½“å¤šä¸ªä¸åŒçš„ç”¨æˆ·ä½¿ç”¨ä¸€ä¸ªRabbitMQserveræä¾›æœåŠ¡çš„æ—¶å€™ï¼Œå¯ä»¥åˆ’åˆ†å‡ºå¤šä¸ªVirtualHostï¼Œæ¯ä¸ªç”¨æˆ·éƒ½åœ¨è‡ªå·±çš„vhoståˆ›å»ºexchangeå’Œqueueç­‰Connectionï¼šç”Ÿäº§è€…/æ¶ˆè´¹è€…å’Œbrokerä¹‹é—´çš„TCPè¿æ¥Channelï¼šï¼ˆä¿¡é“ï¼‰å¦‚æœæ¯ä¸€æ¬¡è®¿é—®RabbitMQéƒ½å»ºç«‹ä¸€ä¸ªConnectionï¼Œåœ¨æ¶ˆæ¯é‡å¤§çš„æ—¶å€™å»ºç«‹TcpConnectionçš„å¼€é”€å°†æ˜¯å·¨å¤§çš„ã€æ•ˆç‡ä¹Ÿè¾ƒä½ã€‚Channelæ˜¯åœ¨Connectionå†…éƒ¨å»ºç«‹çš„é€»è¾‘è¿æ¥ï¼Œå¦‚æœåº”ç”¨ç¨‹åºæ”¯æŒå¤šçº¿ç¨‹ï¼Œé€šå¸¸æ¯ä¸ªthreadåˆ›å»ºå•ç‹¬çš„channelè¿›è¡Œé€šä¿¡ï¼ŒAMQPmethodåŒ…å«äº†channelidå¸®åŠ©å®¢æˆ·ç«¯å’Œmessageborkerè¯†åˆ«channelï¼Œæ‰€ä»¥channelä¹‹é—´æ˜¯å®Œå…¨éš”ç¦»çš„ã€‚Channelä½œä¸ºè½»é‡çº§çš„Connectionæå¤§å‡å°‘äº†æ“ä½œç³»ç»Ÿå»ºç«‹TCPconnectionçš„å¼€é”€Exchangeï¼šæ¶ˆæ¯è¾¾åˆ°RabbitMQçš„ç¬¬ä¸€ç«™ï¼Œæ ¹æ®åˆ†å‘è§„åˆ™ï¼ŒåŒ¹é…æŸ¥è¯¢è¡¨ä¸­çš„routingkey(è·¯ç”±é”®)ï¼Œåˆ†å‘æ¶ˆæ¯åˆ°queueä¸­å»ï¼Œå¸¸æœ‰çš„ç±»å‹æœ‰ï¼šdirect(ç‚¹å¯¹ç‚¹å’ŒactiveMQä¸­çš„queueæ˜¯ä¸€æ ·çš„)ã€topicã€fanoutï¼ˆè¿™ä¸ªå’ŒactiveMQä¸­çš„topicæ¨¡å¼æ˜¯ä¸€æ ·çš„ï¼‰Queueï¼šæ¶ˆæ¯æœ€ç»ˆè¢«é€åˆ°è¿™é‡Œç­‰å¾…æ¶ˆè´¹è€…å–èµ°Bindingï¼šExchangeå’ŒQueueä¹‹é—´çš„è™šæ‹Ÿè¿æ¥ï¼Œbindingä¸­å¯ä»¥åŒ…å«è·¯ç”±é”®routingkeyã€Bindingä¿¡æ¯è¢«ä¿å­˜åˆ°exchangeä¸­çš„æŸ¥è¯¢è¡¨ä¸­ï¼Œç”¨äºæ¶ˆæ¯çš„åˆ†å‘ä¾æ®ä½¿ç”¨Dockerå®‰è£…RabbitMQæ‹‰å–é•œåƒdockerpullrabbitmq:3.8.4-managementé€šè¿‡å®¹å™¨å¯åŠ¨RabbitMQdockerrun-i-d--name=myrabbitmq-p5672:5672-p15672:15672imageidè®¿é—®RabbitMQIP:15672ç”¨æˆ·åå’Œå¯†ç é»˜è®¤éƒ½æ˜¯guesté€šè¿‡SpringBootæ•´åˆRabbitMQåˆ›å»ºå·¥ç¨‹é…ç½®æ–‡ä»¶#ç«¯å£å·server:port:8080#é…ç½®rabbitMQspring:rabbitmq:host:192.168.25.134username:guestpassword:guest#port:5672åˆ›å»ºExchange@AutowiredprivateAmqpAdminamqpAdmin;/***é€šè¿‡ä»£ç åˆ›å»ºexchange*/@TestpublicvoidcreateExchange(){amqpAdmin.declareExchange(newDirectExchange(&quot;amqp.exchange&quot;));}åˆ›å»ºä¸åŒçš„æ¶ˆæ¯newä¸åŒçš„å¯¹è±¡å³å¯å¸¸è§Queue@AutowiredprivateAmqpAdminamqpAdmin;@TestpublicvoidcreateQueue(){amqpAdmin.declareQueue(newQueue(&quot;amqp.queue&quot;));}ç»‘å®šexchangeå’Œqueue@AutowiredprivateAmqpAdminamqpAdmin;@TestpublicvoidbindingQueueAndExchange(){//å‚æ•°ä¸€ï¼šqueue//å‚æ•°äºŒï¼šæ˜¯queueçš„ç±»å‹//å‚æ•°ä¸‰ï¼šäº¤æ¢å™¨//å‚æ•°å››ï¼šroutingkeyï¼ˆè·¯ç”±é”®ï¼‰//å‚æ•°äº”ï¼šç»‘å®šçš„æ—¶å€™ç»™ä¸€ä¸ªåˆå§‹åŒ–çš„æ¶ˆæ¯amqpAdmin.declareBinding(newBinding(&quot;amqp.queue&quot;,Binding.DestinationType.QUEUE,&quot;amqp.exchange&quot;,&quot;amqp.test&quot;,null));}æµ‹è¯•direct@ResourceprivateRabbitTemplaterabbitTemplate;/***æµ‹è¯•directå‘é€æ¶ˆæ¯*/@TestvoidtestPublishDirect(){Map&lt;String,Object&gt;map=newHashMap&lt;&gt;();map.put(&quot;id&quot;,1);map.put(&quot;list&quot;,Arrays.asList(&quot;å¼ ä¸‰&quot;,&quot;æå››&quot;));/***å‚æ•°1ã€exchangeï¼ˆäº¤æ¢å™¨ï¼‰é€šè¿‡äº¤æ¢å™¨çš„ç±»å‹ï¼Œå¯ä»¥å†³å®šæ¶ˆæ¯å‘é€çš„æ–¹å¼ï¼Œå¦‚ï¼šdirectå°±æ˜¯ç‚¹å¯¹ç‚¹ï¼Œä¸€ä¸ªç”Ÿäº§è€…å¯¹åº”ä¸€ä¸ªæ¶ˆè´¹è€…*å‚æ•°2ã€routingKeyï¼ˆè·¯ç”±é”®ï¼‰è¡¨ç¤ºæ¶ˆæ¯åˆ°queuesä¸­å“ªä¸ªåœ°æ–¹å­˜å‚¨*å‚æ•°3ã€è·¯ç”±è¯•é¢˜*/rabbitTemplate.convertAndSend(&quot;amqp.exchange&quot;,&quot;amqp.test&quot;,map);}/***æµ‹è¯•directæ¥æ”¶æ¶ˆæ¯*/@TestpublicvoidtestReceiveDirect(){//å‚æ•°ï¼šqueueçš„nameObjectconvert=rabbitTemplate.receiveAndConvert(&quot;amqp.queue&quot;);System.out.println(convert);System.out.println(convert.getClass());}æµ‹è¯•fanout/***æµ‹è¯•fanoutå‘é€æ¶ˆæ¯(å’ŒactiveMQä¸­çš„topicä¸€æ ·çš„)*/@TestpublicvoidtestPublishFanout(){Map&lt;String,Object&gt;map=newHashMap&lt;&gt;();map.put(&quot;id&quot;,1);map.put(&quot;list&quot;,Arrays.asList(&quot;å¼ ä¸‰&quot;,&quot;æå››&quot;));rabbitTemplate.convertAndSend(&quot;amqp.exchange.fanout&quot;,&quot;amqp.exchange.fanout.test&quot;,map);}åˆ›å»ºç›‘å¬å™¨@ServicepublicclassMyListener{@RabbitListener(queues=&quot;amqp.queue&quot;)publicvoidreceive(Map&lt;String,Object&gt;map){System.out.println(&quot;ä»ç›‘å¬å™¨ä¸­å–å‡ºæ¶ˆæ¯ï¼š&quot;+map);}}æµ‹è¯•topicåœ¨RabbitMQä¸­direct==activeMQä¸­çš„queueâ€‹fanout==activeMQä¸­çš„topicâ€‹topicåŒ¹é…æ¨¡å¼.#(è¡¨ç¤ºä¸€ä¸ªå•è¯æˆ–å¤šä¸ªå•è¯)*.(è¡¨ç¤ºåŒ¹é…ä¸€ä¸ªæˆ–å¤šä¸ªå•è¯)","link":"https://haohanya.github.io/post/rabbitmqyi/"},{"title":" ç†”æ–­å™¨Hystrix","content":"ç†”æ–­å™¨Hystrixç®€ä»‹hystrixåœ¨è‹±æ–‡é‡Œçš„æ„æ€æ˜¯è±ªçŒªï¼Œå®ƒçš„logoå°±æ˜¯ä¸€å¤´è±ªçŒªï¼Œåˆºè®©æˆ‘æƒ³åˆ°çš„æ˜¯è‡ªæˆ‘ä¿æŠ¤ï¼Œhystrixå®ƒå°±æ˜¯ä¸€æ¬¾æä¾›ä¿æŠ¤æœºåˆ¶é¢ç»„ä»¶ï¼Œå®ƒå’Œeurekaä¸€æ ·ä¹Ÿæ˜¯Netflixå…¬å¸å¼€å‘çš„é›ªå´©é—®é¢˜å¾®æœåŠ¡ä¸­ï¼ŒæœåŠ¡ä¹‹é—´è°ƒç”¨å…³ç³»æ˜¯é”™ç»¼å¤æ‚çš„ï¼Œä¸€ä¸ªè¯·æ±‚ï¼Œå¯èƒ½éœ€è¦è°ƒç”¨å¤šä¸ªå¾®æœåŠ¡ç»å£æ‰èƒ½å®ç°ï¼Œä¼šå½¢æˆéå¸¸å¤æ‚çš„è°ƒç”¨é“¾è·¯å¦‚å›¾ï¼šä¸€æ¬¡ä¸šåŠ¡è¯·æ±‚ï¼Œéœ€è¦è°ƒç”¨Aã€Pã€Hã€Iå››ä¸ªæœåŠ¡ï¼Œè¿™å››ä¸ªæœåŠ¡åˆæœ‰å¯èƒ½è°ƒç”¨äº†å…¶ä»–çš„æœåŠ¡ã€‚å¦‚æœæ­¤æ—¶ï¼ŒæŸä¸ªæœåŠ¡å‡ºç°äº†å¼‚å¸¸ï¼šä¾‹å¦‚ï¼šå¾®æœåŠ¡Iå‡ºç°äº†å¼‚å¸¸ï¼Œè¯·æ±‚å°±ä¼šé˜»å¡ï¼Œç”¨çƒè¯·æ±‚å°±ä¼šå¾—ä¸åˆ°å“åº”ï¼Œåˆ™tomcatçš„è¿™ä¸ªçº¿ç¨‹å°±ä¸ä¼šé‡Šæ”¾ï¼Œäºæ˜¯è¶Šæ¥è¶Šå¤šçš„ç”¨æˆ·è¯·æ±‚åˆ°æ¥ï¼Œè¶Šæ¥è¶Šå¤šé¢çº¿ç¨‹ä¼šé˜»å¡æœåŠ¡å™¨æ”¯æŒçš„çº¿ç¨‹å’Œå¹¶å‘æ•°æ˜¯æœ‰é™çš„ï¼Œè¯·æ±‚ä¸€ç›´é˜»å¡ï¼Œä¼šå¯¼è‡´æœåŠ¡å™¨çš„èµ„æºè€—å°½ï¼Œä»è€Œå¯¼è‡´æ‰€æœ‰é¢å…¶ä»–æœåŠ¡éƒ½ä¸å¯ç”¨ï¼Œå½¢æˆé›ªå´©æ•ˆåº”ã€‚è¿™å°±å¥½æ¯”ï¼šæ‘é‡Œéƒ½ç”¨ä¸€ä¸ªå˜å‹å™¨ï¼Œæœ‰ä¸€å®¶ç”¨çƒ­å¾—å¿«çƒ§æ°´å¯¼è‡´ç”µè·¯çŸ­è·¯æœ€ç»ˆçƒ§äº†ç”µè·¯ï¼Œç»“æœå´å¯¼è‡´æ‘é‡Œæ‰€æœ‰å®¶åº­éƒ½æ— æ³•ç”¨ç”µï¼ˆè§£å†³æ–¹æ¡ˆï¼šæ¯å®¶æ¯æˆ·éƒ½è£…ä¸€ä¸ªä¿é™©ä¸ï¼Œä¸€å®¶çƒ§æ¯ï¼Œä¸æƒ³èµ¢å…¶ä»–å®¶åº­ç”¨ç”µï¼‰è¿™ä¹Ÿå¥½æ¯”ï¼šä¸€ä¸ªæ±½è½¦ç”Ÿäº§çº¿ï¼Œç”Ÿæˆä¸åŒçš„æ±½è½¦ï¼Œéœ€è¦çš„æ˜¯ä¸åŒçš„é›¶ä»¶ï¼Œè‹¥æœæŸä¸ªé›¶ä»¶å› ä¸ºç§ç§åŸå› æ— æ³•ä½¿ç”¨ï¼Œé‚£ä¹ˆå°±ä¼šæ—©æˆæ•´å°è½¦æ— æ³•è£…é…ï¼Œé™·å…¥äº†ç­‰å¾…é›¶ä»¶çš„çŠ¶æ€ï¼ŒçŸ¥é“é›¶ä»¶åˆ°ä½ï¼Œæ‰èƒ½ç»§ç»­ç»„è£…ä»¶ï¼Œæ­¤æ—¶å¦‚æœæœ‰å¾ˆå¤šçš„è½¦å‹éƒ½éœ€è¦è¿™ä¸ªé›¶ä»¶ï¼Œé‚£ä¹ˆæ•´ä¸ªå·¥å‚å°±å°†é™·å…¥ç­‰å¾…çŠ¶æ€ï¼Œå¯¼è‡´æ‰€æœ‰çš„ç”Ÿæˆéƒ½ç˜«ç—ªï¼Œä¸€ä¸ªé›¶ä»¶çš„å‰¥èŒ§èŒƒå›´ä¸æ–­çš„æ‰©å¤§.è¿™å°±æ˜¯é›ªå´©Hystrixè§£å†³çš„é›ªå´©é—®é¢˜çš„æ‰‹æ®µä¸»è¦æ˜¯æœåŠ¡é™çº§ï¼ŒåŒ…æ‹¬ï¼šçº¿ç¨‹éš”ç¦»æœåŠ¡ç†”æ–­çº¿ç¨‹éš”ç¦»&amp;æœåŠ¡é™çº§åŸç†è§£è¯»è¯¥å›¾ï¼šHystrixä¸ºæ¯ä¸ªä¾èµ–æœåŠ¡è°ƒç”¨åˆ†é…ä¸€ä¸ªå°çš„çº¿ç¨‹æ± ï¼Œå¦‚æœçº¿ç¨‹æ± å·²æ»¡è°ƒç”¨å°±ä¼šè¢«ç«‹å³æ‹’ç»ï¼Œé»˜è®¤ä¸é‡‡ç”¨æ’é˜Ÿï¼ŒåŠ é€Ÿå¤±è´¥åˆ¤å®šæ—¶é—´ã€‚ç”¨æˆ·çš„è¯·æ±‚å°†ä¸å†ç›´æ¥è®¿é—®æœåŠ¡ï¼Œè€Œæ˜¯é€šè¿‡çº¿ç¨‹æ± ä¸­çš„ç©ºé—²çº¿ç¨‹æ¥è®¿é—®æœåŠ¡ï¼Œå¦‚æœçº¿ç¨‹æ± å·²ç»æ»¡äº†ï¼Œæˆ–è€…æ˜¯è¯·æ±‚è¶…æ—¶ï¼Œåˆ™ä¼šè¿›è¡Œé™çº§å¤„ç†ï¼ˆæœåŠ¡é™çº§ï¼šæœ‰é™ä¿è¯æ ¸å¿ƒæœåŠ¡ï¼Œè€Œéæ ¸å¿ƒæœåŠ¡ä¸å¯ç”¨æˆ–å¼±å¯ç”¨ï¼‰ç”¨æˆ·çš„è¯·æ±‚æ•…éšœçš„æ—¶å€™ï¼Œä¸ä¼šè¢«é˜»å¡ï¼Œæ›´ä¸ä¼šæ— ä¼‘æ­¢çš„ç­‰å¾…æˆ–è€…æ˜¯çœ‹åˆ°ç³»ç»Ÿå´©æºƒï¼Œè‡³å°‘å¯ä»¥çœ‹åˆ°ä¸€ä¸ªæ‰§è¡Œçš„ç»“æœï¼ˆä¸€ä¸ªå‹å¥½çš„ç•Œé¢ï¼‰æœåŠ¡é™çº§è™½ç„¶ä¼šå¯¼è‡´è¯·æ±‚å¤±è´¥ï¼Œä½†æ˜¯ä¸ä¼šå¯¼è‡´é˜»å¡ï¼Œè€Œä¸”æœ€å¤šä¼šå½±å“è¿™ä¸ªä¾èµ–æœåŠ¡å¯¹åº”çš„çº¿ç¨‹æ± ä¸­çš„èµ„æºï¼Œå¯¹å…¶å®ƒæœåŠ¡å®Œå…¨æ²¡æœ‰å½±å“ã€‚hysrixæœåŠ¡é™çº§çš„æƒ…å†µçº¿ç¨‹æ± å·²æ»¡è¯·æ±‚è¶…æ—¶æ¡ˆä¾‹åœ¨user-webå·¥ç¨‹ä¸­ä¾èµ–hystrix&lt;dependency&gt;&lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;&lt;artifactId&gt;spring-cloud-starter-netflix-hystrix&lt;/artifactId&gt;&lt;/dependency&gt;å¼€å¯ç†”æ–­åœ¨å¯åŠ¨ç±»ä¸Šæ·»åŠ æ³¨è§£@EnableCircuitBreaker@SpringBootApplication@EnableDiscoveryClient//å¼€å¯å‘ç°æœåŠ¡@EnableCircuitBreakerpublicclassUserWebApplication{...}å¯ä»¥çœ‹åˆ°ï¼Œç±»ä¸Šé¢çš„æ³¨è§£è¶Šæ¥è¶Šå¤šäº†ï¼Œåœ¨å¾®æœåŠ¡ä¸­ï¼Œç»å¸¸å¼•å…¥ä¸Šé¢çš„ä¸‰ä¸ªæ³¨è§£ï¼Œå­¦ä¹ ä¸€ä¸ªç»„åˆæ³¨è§£@SpringCloudApplicationå®ƒçš„æºç å¦‚ä¸‹ï¼š@SpringBootApplication@EnableDiscoveryClient@EnableCircuitBreakerpublic@interfaceSpringCloudApplication{}æ‰€ä»¥æˆ‘ä»¬å°±å¯ä»¥ç›´æ¥ä½¿ç”¨è¯¥æ³¨è§£@SpringCloudApplicationpublicclassUserWebApplication{....}ç¼–å†™é™çº§é€»è¾‘å½“ç›®æ ‡æœåŠ¡çš„è°ƒç”¨å‡ºç°æ•…éšœï¼Œæˆ‘ä»¬å¸Œæœ›å¿«é€Ÿå¤±è´¥ï¼Œç»™ç”¨æˆ·ä¸€ä¸ªå‹å¥½çš„æç¤ºï¼Œå› æ­¤éœ€è¦æå‰ç¼–å†™å¥½å¤±è´¥çš„æ—¶å€™çš„é™çº§é€»è¾‘ï¼Œä½¿ç”¨HystrixCommandæ¥å®Œæˆå¯¹User-webä¸­çš„controllerè¿›è¡Œæ”¹é€ @RestController@RequestMapping(&quot;/consumer&quot;)publicclassConsumerController{@AutowiredprivateRestTemplaterestTemplate;@AutowiredprivateDiscoveryClientdiscoveryClient;@RequestMapping(&quot;/{id}&quot;)@HystrixCommand(fallbackMethod=&quot;queryByIdFallback&quot;)publicUsergetByyid(@PathVariable(&quot;id&quot;)Longid){//ä½¿ç”¨è´Ÿè½½å‡è¡¡ï¼ˆRibbonï¼‰Stringurl=&quot;http://user-service/user/&quot;+id;returnrestTemplate.getForObject(url,User.class);}//ç†”æ–­çš„æ–¹æ³•ï¼šæ–¹æ³•åå’Œæ­£å¸¸çš„æ–¹æ³•åä¸€è‡´ï¼Œå‚æ•°ä¸€è‡´publicUserqueryByIdFallback(Longid){Useruser=newUser();user.setId(id);user.setNote(&quot;å¯¹ä¸èµ·ç½‘ç»œå¤ªç”¨æ‹¥æŒ¤äº†ï¼&quot;);returnuser;}}å¯ä»¥åœæ‰user-serviceæœåŠ¡ï¼Œåœ¨è¿›è¡Œuse-webçš„è®¿é—®æµ‹è¯•è¯´æ˜ï¼š@HystrixCommand(fallbackMethod=&quot;queryByIdFallback&quot;)ï¼›ç”¨æ¥å£°æ˜ä¸€ä¸ªé™çº§é€»è¾‘çš„æ–¹æ³•é»˜è®¤çš„fallbackåˆšæ‰æ˜¯å§fallbackå†™åœ¨äº†æŸä¸ªä¸šåŠ¡çš„æ–¹æ³•ä¸Šï¼Œå¦‚æœè¿™æ ·çš„æ–¹æ³•å¤šäº†ï¼Œå°±ä¼šå¯¼è‡´æ¯ä¸ªæ–¹æ³•éƒ½å†™ä¸€ä¸ªfallbackï¼Œå®é™…ä¸Šå¯èƒ½æ„ä¹‰ä¸å¤§ï¼Œæˆ‘ä»¬å°±å¯ä»¥å†™é»˜è®¤çš„fallbackå¯¹controlleræ”¹é€ @RestController@RequestMapping(&quot;/consumer&quot;)@DefaultProperties(defaultFallback=&quot;defaultFallback&quot;)publicclassConsumerController{@AutowiredprivateRestTemplaterestTemplate;@AutowiredprivateDiscoveryClientdiscoveryClient;@RequestMapping(&quot;/{id}&quot;)//@HystrixCommand(fallbackMethod=&quot;queryByIdFallback&quot;)@HystrixCommandpublicUsergetByyid(@PathVariable(&quot;id&quot;)Longid){//ä½¿ç”¨è´Ÿè½½å‡è¡¡ï¼ˆRibbonï¼‰Stringurl=&quot;http://user-service/user/&quot;+id;returnrestTemplate.getForObject(url,User.class);}//ç†”æ–­çš„æ–¹æ³•ï¼šæ–¹æ³•åå’Œæ­£å¸¸çš„æ–¹æ³•åä¸€è‡´ï¼Œå‚æ•°ä¸€è‡´publicUserqueryByIdFallback(Longid){Useruser=newUser();user.setId(id);user.setNote(&quot;å¯¹ä¸èµ·ç½‘ç»œå¤ªç”¨æ‹¥æŒ¤äº†ï¼&quot;);returnuser;}//é»˜è®¤æœåŠ¡ç†”æ–­publicUserdefaultFallback(){Useruser=newUser();user.setNote(&quot;é»˜è®¤æç¤ºï¼šå¯¹ä¸èµ·,ç½‘ç»œå¤ªç”¨æ‹¥æŒ¤äº†ï¼&quot;);returnuser;}}è¶…æ—¶è®¾ç½®åœ¨æ¡ˆä¾‹ä¸­ï¼Œè¯·æ±‚åœ¨è¶…è¿‡1ç§’åéƒ½ä¼šè¿”å›é”™è¯¯ä¿¡æ¯ï¼Œè¿™æ˜¯å› ä¸ºHystirxçš„é»˜è®¤è¶…æ—¶æ—¶é—´æ˜¯1ç§’hystrix:command:default:execution:isolation:thread:timeoutInMilliseconds:2000è¿™ä¸ªé…ç½®ä¼šä½œç”¨äºå…¨å±€æ‰€æœ‰çš„æ–¹æ³•ä¸ºäº†æ¼”ç¤ºè¿™ä¸ªæ•ˆæœï¼Œæˆ‘å…ˆå°†ä¸Šé¢çš„2000æ¢å¤åˆ°é»˜è®¤å€¼æ˜¯1000ï¼Œç„¶åä¿®æ”¹äº†user-serviceä¸­çš„serviceæ–¹æ³•ï¼Œç»™2ç§’çš„è®¿é—®å»¶è¿Ÿ@ServicepublicclassUserServiceImplimplementsUserService{@AutowiredprivateUserRepositoryuserRepository;@OverridepublicUsergetUserById(Longid){try{Thread.sleep(2000);}catch(InterruptedExceptione){e.printStackTrace();}returnuserRepository.findUserById(id);}}æ¥ç€æˆ‘ä»¬å†è®¿é—®user-webï¼Œå‘ç°å³ä½¿user-serviceæœåŠ¡æ˜¯èƒ½æ­£å¸¸æä¾›æœåŠ¡ï¼Œä½†æ˜¯ä»–ä»¬çš„é€šè®¯æ—¶é—´è¶…è¿‡äº†1ç§’è¿˜æ˜¯ä¼šå‡ºç°é—®é¢˜ã€‚æ¥ä¸‹æ¥ï¼Œå°†ä¸Šé¢çš„é…ç½®æ”¹ä¸º3000æ¯«ç§’ï¼Œæ¥ä¸‹æ¥å°±èƒ½æ­£å¸¸è®¿é—®äº†æœåŠ¡ç†”æ–­åŸç†åœ¨æœåŠ¡ç†”æ–­ä¸­ï¼Œä½¿ç”¨çš„æ˜¯ç†”æ–­å™¨ï¼Œä¹Ÿå«æ–­è·¯å™¨ï¼Œè‹±æ–‡å«ï¼šCircuitBreakerç†”æ–­å™¨è·Ÿå®¶ç”¨çš„ä¿é™©ä¸åŸç†ç±»ä¼¼ï¼šå½“å¦‚æœç”µè·¯å‘ç”Ÿäº†çŸ­è·¯çš„æ—¶å€™èƒ½å¤Ÿç«‹å³ç†”æ–­ç”µè·¯ï¼Œé¿å…ç¾éš¾çš„å‘ç”Ÿã€‚åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿçš„åº”ç”¨ä¸­åº”ç”¨æœåŠ¡ç†”æ–­åï¼ŒæœåŠ¡è°ƒç”¨æ–¹å¯ä»¥è‡ªå·±è¿›è¡Œåˆ¤æ–­å“ªäº›æœåŠ¡ååº”æ…¢æˆ–è€…æ˜¯å­˜åœ¨å¤§é‡çš„è¶…æ—¶ï¼Œå¯ä»¥é’ˆå¯¹è¿™äº›æœåŠ¡è¿›è¡Œä¸»åŠ¨ç†”æ–­ï¼Œé˜²æ­¢æ•´ä¸ªç³»ç»Ÿè¢«æ‹–å®Hystrixçš„æœåŠ¡ç†”æ–­æœºåˆ¶ï¼Œå¯ä»¥å®ç°å¼¹æ€§å®¹é”™ï¼Œå½“æœåŠ¡è¯·æ±‚æƒ…å†µå¥½è½¬ä¹‹åï¼Œå¯ä»¥è‡ªåŠ¨é‡è¿ã€‚é€šè¿‡çŸ­è·¯çš„æ–¹å¼ï¼Œå°†åç»­è¯·æ±‚ç›´æ¥æ‹’ç»ï¼Œä¸€æ®µæ—¶é—´ï¼ˆé»˜è®¤æ—¶é—´æ˜¯5ç§’ï¼‰ä¹‹åå…è®¸éƒ¨åˆ†è¯·æ±‚é€šè¿‡ï¼Œå¦‚æœè°ƒç”¨æˆåŠŸåˆ™å›åˆ°æ–­è·¯å™¨å…³é—­çŠ¶æ€ï¼Œå¦åˆ™å°†ç»§ç»­æ‰“å¼€ï¼Œæ‹’ç»è¯·æ±‚çš„æœåŠ¡ã€‚Hystirxçš„ç†”æ–­çŠ¶æ€æ¨¡å‹ï¼š","link":"https://haohanya.github.io/post/rong-duan-qi-hystrix/"},{"title":" Ribbonè´Ÿè½½å‡è¡¡å™¨","content":"Ribbonä»€ä¹ˆæ˜¯RibbonRibbonæ˜¯Netflixå‘å¸ƒçš„ä¸€ä¸ªè´Ÿè½½å‡è¡¡å™¨ï¼Œå®ƒæœ‰åŠ©äºæ§åˆ¶Httpå’ŒTCPå®¢æˆ·ç«¯çš„è¡Œä¸ºã€‚ä¸ºRibboné…ç½®æœåŠ¡æä¾›è€…åˆ—è¡¨åï¼ŒRibbonå°±å¯ä»¥åŸºäºæŸç§è´Ÿè½½å‡è¡¡çš„ç®—æ³•ï¼Œè‡ªåŠ¨åœ°å¸®åŠ©æˆ‘ä»¬é€‰æ‹©å…¶ä¸­çš„ä¸€ä¸ªæœåŠ¡ç»™æ¶ˆè´¹è€…ã€‚Ribboné»˜è®¤è´Ÿè½½å‡è¡¡ç®—æ³•æ˜¯è½®è¯¢ï¼Œé™¤æ­¤ä¹‹å¤–è¿˜æœ‰éšæœºç­‰ï¼Œå½“ç„¶å®é™…å¼€å‘ä¸­ä¹Ÿå¯ä»¥è‡ªå®šä¹‰è´Ÿè½½å‡è¡¡çš„ç®—æ³•æœåŠ¡ä¹‹é—´çš„é€šè®¯é—®é¢˜æ°¸è¿œæ˜¯ä»eurekaä¸­æ‹‰å–åˆ°äº†æœåŠ¡æä¾›è€…çš„åˆ—è¡¨ï¼Œä½†æ˜¯æ°¸è¿œåªç”¨ç¬¬ä¸€ä¸ªæœåŠ¡ï¼Œå…¶ä»–çš„æœåŠ¡å°±éƒ½é—²ç½®ç€äº†@RequestMapping(&quot;/{id}&quot;)publicUsergetByyid(@PathVariable(&quot;id&quot;)Longid){//åœ°å€ä»eurekaä¸­è·å–List&lt;ServiceInstance&gt;instancesList=discoveryClient.getInstances(&quot;user-service&quot;);//æœ‰å¯èƒ½æœ‰å¤šä¸ªæœåŠ¡ï¼Œæˆ‘åªéœ€è¦æ‹¿ä¸€ä¸ªServiceInstanceserviceInstance=instancesList.get(0);//ç»„è£…Stringurl=&quot;http://&quot;+serviceInstance.getHost()+&quot;:&quot;+serviceInstance.getPort()+&quot;/user/&quot;+id;//é‡‡ç”¨httpçš„æ–¹å¼ç³»ç»Ÿä¹‹é—´é€šè®¯returnrestTemplate.getForObject(url,User.class);}è§£å†³æ–¹æ¡ˆï¼šé€šè¿‡ä¸€ç§ç®—æ³•ï¼Œåˆç†çš„é€‰æ‹©å…¶ä¸­çš„ä¸€ä¸ªæœåŠ¡ã€‚å¯ä»¥é€šè¿‡ç¼–å†™è´Ÿè½½å‡è¡¡çš„ç®—æ³•ï¼Œåœ¨å¤šä¸ªå®ä¾‹åˆ—è¡¨ä¸­é€‰æ‹©ä¸€ä¸ªæœåŠ¡ä¸è¿‡Eurkeaä¸­å·²ç»é›†æˆäº†è´Ÿè½½å‡è¡¡ç»„ä»¶ï¼šRibbonï¼ˆç®€å•çš„ä¿®æ”¹ä»£ç å³å¯ä½¿ç”¨ï¼‰å®æˆ˜1ã€å…ˆå¯åŠ¨2ä¸ªuser-serviceå®ä¾‹2ã€åœ¨user-webå·¥ç¨‹ä¸­å¼€å¯è´Ÿè½½å‡è¡¡åœ¨eureka-clientçš„åŒ…ä¸­å·²ç»é›†æˆäº†Ribbonï¼Œæ‰€ä»¥ä¸éœ€è¦å¯¼å…¥æ–°çš„ä¾èµ–ç›´æ¥ä¿®æ”¹å¯åŠ¨ç±»ï¼Œæ·»åŠ å¼€å¯çš„æ³¨è§£ï¼ˆåœ¨RestTemplateä¸Šé¢æ·»åŠ @LoadBalancedï¼‰@SpringBootApplication@EnableDiscoveryClient//å¼€å¯å‘ç°æœåŠ¡publicclassUserWebApplication{publicstaticvoidmain(String[]args){SpringApplication.run(UserWebApplication.class,args);}@Bean@LoadBalancedpublicRestTemplaterestTemplate(){returnnewRestTemplate();}}3ã€ä¿®æ”¹controllerä¸­è·å–æœåŠ¡çš„æ–¹æ³•@RequestMapping(&quot;/{id}&quot;)publicUsergetByyid(@PathVariable(&quot;id&quot;)Longid){//ä½¿ç”¨è´Ÿè½½å‡è¡¡ï¼ˆRibbonï¼‰Stringurl=&quot;http://user-service/user/&quot;+id;returnrestTemplate.getForObject(url,User.class);}æ¥ä¸‹æ¥æµ‹è¯•å°±å¯ä»¥é€šäº†å…³æ‰ä¸€ä¸ªuser-serviceåæµ‹è¯•æ˜¯å¦å¯ä»¥æ­£å¸¸è·å–åˆ°æœåŠ¡å†å¯åŠ¨å…³æ‰çš„é‚£ä¸ªuser-serviceåå…³æ‰ç¬¬äºŒä¸ªuser-serviceæœåŠ¡å†æµ‹è¯•ã€‚","link":"https://haohanya.github.io/post/ribbon-fu-zai-jun-heng-qi/"},{"title":"Eureka","content":"ä»€ä¹ˆæ˜¯Eurekaç™¾åº¦ç™¾ç§‘ï¼šä»€ä¹ˆæ˜¯Eurekaé—®é¢˜åˆ†æåˆšæ‰çš„æ¡ˆä¾‹ï¼Œuser-serviceå¯¹å¤–æä¾›æœåŠ¡ï¼Œéœ€è¦å¯¹å¤–æš´æ¼è‡ªå·±çš„åœ°å€ã€‚user-webéœ€è¦è®°å½•æœåŠ¡æä¾›è€…çš„åœ°å€ã€‚å°†æ¥åœ°å€å‡ºç°å˜æ›´ï¼Œè¿˜éœ€è¦åŠæ—¶çš„å»æ›´æ–°ã€‚è¿™åœ¨æœåŠ¡è¾ƒå°‘çš„æ—¶å€™ä¸ä¼šè§‰å¾—æœ‰ä»€ä¹ˆï¼Œä½†æ˜¯åœ¨å¤§å‹çš„äº’è”ç½‘é¡¹ç›®ä¸­ï¼Œä¸€ä¸ªé¡¹ç›®å¯èƒ½å·®åˆ†å¤„å‡ åä¸ªå¾®æœåŠ¡ï¼Œæ­¤æ—¶å¦‚æœè¿˜æ˜¯äººä¸ºçš„ç®¡ç†ï¼Œä¸ä»…å¼€å‘å›°éš¾ï¼Œå¥–åŠ±å•Šæµ‹è¯•ã€å‘å¸ƒä¸Šçº¿éƒ½ä¼šæœ‰å¤§éº»çƒ¦ä¸DevOpsæ€æƒ³è¿èƒŒï¼šå°±æ˜¯ç³»ç»Ÿå¯ä»¥é€šè¿‡ä¸€ç»„è¿‡ç¨‹ã€æ–¹æ³•æˆ–è€…æ˜¯ç³»ç»Ÿï¼Œæé«˜åº”ç”¨å‘å¸ƒå’Œè¿ç»´çš„æ•ˆç‡ï¼Œé™ä½ç®¡ç†æˆæœ¬Eurekaåšä»€ä¹ˆå¥½æ¯”æ˜¯æˆ¿äº§ä¸­ä»‹ï¼Œè´Ÿè´£ç®¡ç†ã€è®°å½•æœåŠ¡æä¾›è€…çš„ä¿¡æ¯ã€‚æœåŠ¡è°ƒç”¨è€…å°±æ— éœ€è‡ªå·±å»æ‰¾æœåŠ¡ï¼Œè€Œæ˜¯æŠŠè‡ªå·±çš„éœ€æ±‚å‘Šè¯‰Eurekaï¼Œç„¶åEurekaæŠŠç¬¦åˆä½ è¦æ±‚çš„æœåŠ¡å‘Šè¯‰ä½ åŒæ—¶ï¼ŒæœåŠ¡çš„æä¾›æ–¹ä¸Eurekaä¹‹é—´é€šè¿‡â€œå¿ƒè·³â€æœºåˆ¶è¿›è¡Œç›‘æ§ï¼Œå½“æŸä¸ªæœåŠ¡æä¾›æ–¹å‡ºç°é—®é¢˜ï¼ŒEurekaè‡ªç„¶ä¼šæŠŠå®ƒä»æœåŠ¡åˆ—è¡¨ä¸­å‰”é™¤è¿™å°±å®ç°äº†æœåŠ¡çš„è‡ªåŠ¨æ³¨å†Œã€å‘ç°å’ŒçŠ¶æ€ç›‘æ§Eurekaæ³¨å†Œä¸­å¿ƒè¯´æ˜Eurekaçš„ä¸»è¦åŠŸèƒ½æ˜¯è¿›è¡ŒæœåŠ¡ç®¡ç†ï¼Œå®šæœŸæ£€æŸ¥æœåŠ¡çŠ¶æ€ï¼Œè¿”å›æœåŠ¡åœ°å€åˆ—è¡¨ã€‚å…¥é—¨æ¡ˆä¾‹1ã€åˆ›å»ºspringbooté¡¹ç›®å¹¶æ·»åŠ ä¾èµ–2ã€åœ¨å¯åŠ¨ç±»ä¸­æ·»åŠ æ³¨è§£@SpringBootApplication@EnableEurekaServer//å£°æ˜å½“å‰åº”ç”¨æ˜¯eurekaæœåŠ¡publicclassEurekaServiceApplication{publicstaticvoidmain(String[]args){SpringApplication.run(EurekaServiceApplication.class,args);}}3ã€é…ç½®eureka#ç«¯å£å·server:port:10086spring:application:name:eureka-server#åº”ç”¨åç§°ï¼Œä¼šåœ¨eurekaä¸­ä½œä¸ºæœåŠ¡çš„idæ ‡è¯†#é…ç½®eurkeaeureka:client:service-url:defaultZone:http://127.0.0.1:10086/eurekaregister-with-eureka:false#ä¸æ³¨å†Œè‡ªå·±ï¼Œé»˜è®¤å€¼æ˜¯trueï¼ˆå¦‚æœæ­å»ºeurekaé›†ç¾¤ï¼Œéœ€è¦ç›¸äº’ä¹‹é—´æ³¨å†Œï¼‰fetch-registry:false#ä¸æ‹‰å–è‡ªå·±çš„æœåŠ¡åˆ—è¡¨4ã€å¯åŠ¨æœåŠ¡è®¿é—®ï¼šhttp://localhost:10086/æœåŠ¡æ³¨å†Œæ³¨å†ŒæœåŠ¡ï¼Œå°±æ˜¯åœ¨æœåŠ¡ä¸Šæ·»åŠ Eurekaçš„å®¢æˆ·ç«¯ä¾èµ–ï¼Œå®¢æˆ·ç«¯ä»£ç ä¼šè‡ªåŠ¨æŠŠæœåŠ¡æ³¨å†Œåˆ°EurekaServiceä¸­æ·»åŠ ä¾èµ–&lt;!--æ·»åŠ mapperçš„å¯åŠ¨å™¨--&gt;&lt;dependency&gt;&lt;groupId&gt;tk.mybatis&lt;/groupId&gt;&lt;artifactId&gt;mapper-spring-boot-starter&lt;/artifactId&gt;&lt;version&gt;2.0.3&lt;/version&gt;&lt;/dependency&gt;&lt;!--lombok--&gt;&lt;dependency&gt;&lt;groupId&gt;org.projectlombok&lt;/groupId&gt;&lt;artifactId&gt;lombok&lt;/artifactId&gt;&lt;/dependency&gt;1ã€ä¿®æ”¹å¯åŠ¨ç±»@SpringBootApplication@MapperScan(basePackages=&quot;com.kgc.mapper&quot;)//æ‰«æmapperåŒ…ï¼Œå¦‚æœä½¿ç”¨çš„æ˜¯tb.mybatis@EnableEurekaClient//å¼€å¯Eurekaå®¢æˆ·ç«¯å‘ç°åŠŸèƒ½publicclassUserServiceApplication{publicstaticvoidmain(String[]args){SpringApplication.run(UserServiceApplication.class,args);}}2ã€ä¿®æ”¹é…ç½®æ–‡ä»¶#ç«¯å£å·server:port:9091#æ•°æ®æºspring:datasource:driver-class-name:com.mysql.jdbc.Driverurl:jdbc:mysql://localhost:3306/springcloud?useUnicode=true&amp;characterEncoding=utf-8&amp;serverTimezone=Asia/Shanghaiusername:rootpassword:rootapplication:name:user-service#åº”ç”¨å#æ·»åŠ Eurekaæ³¨å†Œçš„é…ç½®eureka:client:service-url:defaultZone:http://127.0.0.1:10086/eureka3ã€æµ‹è¯•å¯åŠ¨user-serviceå·¥ç¨‹æœåŠ¡å‘ç°1ã€ä¿®æ”¹å¯åŠ¨ç±»@SpringBootApplication@EnableDiscoveryClient//å¼€å¯Eureakå®¢æˆ·ç«¯publicclassUserWebApplication{@BeanpublicRestTemplaterestTemplate(){returnnewRestTemplate();}publicstaticvoidmain(String[]args){SpringApplication.run(UserWebApplication.class,args);}}2ã€ä¿®æ”¹é…ç½®æ–‡ä»¶server:port:8080spring:application:name:user-web#åº”ç”¨åç§°eureka:client:service-url:defaultZone:http://127.0.0.1:10086/eureka#eurekaSereråœ°å€3ã€ä¿®æ”¹å¤„ç†å™¨packagecom.cn.controller;importcom.cn.pojo.User;importcom.netflix.appinfo.InstanceInfo;importorg.springframework.beans.factory.annotation.Autowired;importorg.springframework.cloud.client.ServiceInstance;importorg.springframework.cloud.client.discovery.DiscoveryClient;importorg.springframework.web.bind.annotation.PathVariable;importorg.springframework.web.bind.annotation.RequestMapping;importorg.springframework.web.bind.annotation.RestController;importorg.springframework.web.client.RestTemplate;importjava.util.List;@RestController@RequestMapping(&quot;/consumer&quot;)publicclassConsumerController{@AutowiredprivateRestTemplaterestTemplate;//DiscoveryClientçš„ç”¨springCloudåŒ…ä¸­çš„@Autowired(required=false)privateDiscoveryClientdiscoveryClient;@RequestMapping(&quot;/{id}&quot;)publicUsergetByid(@PathVariable(&quot;id&quot;)Longid){/*//é€šè¿‡httpçš„æ–¹å¼å®ç°ç³»ç»Ÿä¹‹é—´çš„é€šè®¯Stringurl=&quot;http://localhost:9091/user/&quot;+id;//è¿™ä¸ªæ˜¯user-serviceæä¾›çš„restapié£æ ¼çš„æ¥å£Useruser=restTemplate.getForObject(url,User.class);returnuser;*///ä»eurekaServeræ³¨å†Œä¸­å¿ƒå»è·å–user-serviceçš„å®ä¾‹åˆ—è¡¨List&lt;ServiceInstance&gt;instancesList=discoveryClient.getInstances(&quot;user-service&quot;);//å› ä¸ºæˆ‘å°±ä¸€ä¸ªæœåŠ¡ï¼Œæ‰€ä»¥æˆ‘å°±æ‹¿é›†åˆä¸­çš„ç¬¬ä¸€ä¸ªå°±æˆServiceInstanceserviceInstance=instancesList.get(0);//æœåŠ¡çš„resutApiæ¥å£Stringurl=&quot;http://&quot;+serviceInstance.getHost()+&quot;:&quot;+serviceInstance.getPort()+&quot;/user/&quot;+id;returnrestTemplate.getForObject(url,User.class);}}4ã€æµ‹è¯•Eureakæ€»ç»“ä¸‰ä¸ªè§’è‰²æœåŠ¡æ³¨å†Œä¸­å¿ƒEurekaçš„æœåŠ¡ç«¯åº”ç”¨ï¼Œæä¾›æœåŠ¡æ³¨å†Œå’Œå‘ç°åŠŸèƒ½ï¼Œå°±æ˜¯æˆ‘ä»¬å»ºç«‹çš„eureka-serveræœåŠ¡æä¾›è€…æä¾›æœåŠ¡çš„åº”ç”¨ï¼Œå¯ä»¥æ˜¯springBootåº”ç”¨ï¼Œä¹Ÿå¯ä»¥æ˜¯å…¶ä»–ä»»æ„æŠ€æœ¯å®ç°ï¼Œåªè¦å¯¹å¤–æä¾›çš„æ˜¯Resté£æ ¼æœåŠ¡å°±å¯ã€‚å°±æ˜¯æˆ‘ä»¬å»ºç«‹çš„user-serviceæœåŠ¡æ¶ˆè´¹è€…æ¶ˆè´¹è€…åº”ç”¨å°±æ˜¯ä»æ³¨å†Œä¸­å¿ƒè·å–æœåŠ¡åˆ—è¡¨ï¼Œä»è€Œå¾—çŸ¥æ¯ä¸ªæœåŠ¡æ”¾çš„ä¿¡æ¯ï¼ŒçŸ¥é“å»å“ªé‡Œè°ƒç”¨æœåŠ¡ï¼Œå°±æ˜¯æˆ‘ä»¬å»ºç«‹çš„user-webé«˜å¯ç”¨çš„EurekaServeræˆ‘ä»¬åªæœ‰ä¸€ä¸ªEureakï¼Œäº‹å®ä¸Šå¯ä»¥æ­å»ºä¸€ä¸ªé›†ç¾¤ï¼Œå½¢æˆä¸€ä¸ªé«˜å¯ç”¨çš„Eurekaæ³¨å†Œä¸­å¿ƒæœåŠ¡åŒæ­¥å¤šä¸ªEurekaServerä¹‹é—´ä¼šç›¸äº’æ³¨å†Œä¸ºæœåŠ¡ï¼Œå½“æœåŠ¡æä¾›è€…æ³¨å†Œåˆ°EurekaServerç»“ç¾¤ä¸­çš„æŸä¸ªèŠ‚ç‚¹çš„æ—¶å€™ï¼Œè¯¥èŠ‚ç‚¹ä¼šæŠŠæœåŠ¡çš„ä¿¡æ¯åŒæ­¥åˆ°é›†ç¾¤ä¸­çš„æ¯ä¸ªèŠ‚ç‚¹ï¼Œä»è€Œå®ç°æ•°æ®çš„åŒæ­¥ï¼Œä¸€æ—¦æœ‰ä¸€ä¸ªèŠ‚ç‚¹æŒ‚æ‰äº†ï¼Œé‚£ä¹ˆå…¶ä»–çš„èŠ‚ç‚¹ä¾ç„¶èƒ½æä¾›æœåŠ¡æ³¨å†Œå’Œå‘ç°çš„åŠŸèƒ½1ã€ä¿®æ”¹EurekaServeré…ç½®#ç«¯å£å·server:port:${port:10086}spring:application:name:eureka-server#åº”ç”¨åç§°ï¼Œä¼šåœ¨eurekaä¸­ä½œä¸ºæœåŠ¡çš„idæ ‡è¯†#é…ç½®eurkeaeureka:client:service-url:defaultZone:${defualtZone:http://127.0.0.1:10086/eureka}#register-with-eureka:false#ä¸æ³¨å†Œè‡ªå·±ï¼Œé»˜è®¤å€¼æ˜¯trueï¼ˆå¦‚æœæ­å»ºeurekaé›†ç¾¤ï¼Œéœ€è¦ç›¸äº’ä¹‹é—´æ³¨å†Œï¼‰#fetch-registry:false#ä¸æ‹‰å–è‡ªå·±çš„æœåŠ¡åˆ—è¡¨2ã€ä¿®æ”¹å¯åŠ¨é…ç½®æ–‡ä»¶3ã€å¤åˆ¶ä¸€ä»½å¹¶ä¿®æ”¹VMoptions4ã€å¯åŠ¨eurekaé›†ç¾¤æœåŠ¡æ³¨å†ŒEurekaé›†ç¾¤å› ä¸ºEurekaä¸æ­¢ä¸€ä¸ªï¼Œä¿®æ”¹user-serviceå…³äºæ³¨å†Œä¸­å¿ƒçš„é…ç½®æœåŠ¡æä¾›è€…åœ¨å¯åŠ¨çš„æ—¶å€™ï¼Œä¼šæ£€æµ‹é…ç½®å±æ€§ä¸­eureka.client.register-with-eureka=trueå‚æ•°æ˜¯å¦æ­£ç¡®ï¼Œäº‹å®ä¸Šé»˜è®¤æ˜¯trueï¼Œæ‰€ä»¥æˆ‘ä»¬æ²¡æœ‰é…ç½®ï¼Œå¦‚æœå€¼ç¡®å®æ˜¯trueï¼Œåˆ™ä¼šå‘EurekaServerå‘èµ·ä¸€ä¸ªRestè¯·æ±‚ï¼Œå¹¶ä¸”æºå¸¦è‡ªå·±çš„å…ƒæ•°æ®ä¿¡æ¯ï¼ŒEurekaServerä¼šæŠŠè¿™äº›ä¿¡æ¯ä¿å­˜åˆ°ä¸€ä¸ªåŒå±‚çš„Mapç»“æ„ä¸­ç¬¬ä¸€å±‚Mapçš„keyå°±æ˜¯æœåŠ¡çš„idï¼Œä¸€èˆ¬å°±æ˜¯é…ç½®spring.applicaton.nameå±æ€§ç¬¬äºŒå±‚Mapçš„keyå°±æ˜¯æœåŠ¡çš„å®ä¾‹idï¼Œä¸€èˆ¬host+serviceId+portï¼Œä¾‹å¦‚ï¼šlocalhost:user-service:9091å€¼åˆ™æ˜¯æœåŠ¡çš„å®ä¾‹å¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸€ä¸ªæœåŠ¡ï¼Œå¯ä»¥åŒæ—¶å¯åŠ¨å¤šä¸ªä¸åŒçš„å®ä¾‹ï¼Œå½¢æˆé›†ç¾¤é»˜è®¤æ³¨å†Œçš„æ—¶å€™æ˜¯ä¸»æœºåæˆ–è€…æ˜¯localhostï¼Œå¦‚æœæƒ³ç”¨ipè¿›è¡Œæ³¨å†Œï¼Œå¯ä»¥åœ¨user-serverä¸­æ·»åŠ é…ç½®#ç«¯å£å·server:port:9091#æ•°æ®æºspring:datasource:driver-class-name:com.mysql.jdbc.Driverurl:jdbc:mysql://localhost:3306/springcloud?useUnicode=true&amp;characterEncoding=utf-8&amp;serverTimezone=Asia/Shanghaiusername:rootpassword:rootapplication:name:user-service#åº”ç”¨å#æ·»åŠ Eurekaæ³¨å†Œçš„é…ç½®eureka:client:service-url:#EurekaServeråœ°å€ï¼Œå¤šä¸ªåœ°å€ä¹‹é—´ç”¨é€—å·åˆ†éš”defaultZone:http://127.0.0.1:10086/eureka,http://127.0.0.1:10087/eurekainstance:ip-address:127.0.0.1#ipåœ°å€prefer-ip-address:true#æ›´å€¾å‘äºä½¿ç”¨ipï¼Œè€Œä¸æ˜¯hoståä¿®æ”¹å®Œæˆåé‡å¯user-serverå·¥ç¨‹å’Œuser-webå·¥ç¨‹å¯ä»¥æµ‹è¯•ä¸€ä¸‹ï¼Œå…ˆå…³æ‰10086ï¼Œç„¶ååœ¨æµ‹è¯•æ˜¯å¦èƒ½æ­£å¸¸é€šè®¯å¤±æ•ˆçš„å‰”é™¤å’Œè‡ªæˆ‘ä¿æŠ¤æœåŠ¡ç»­çº¦åœ¨æ³¨å†ŒæœåŠ¡å®Œæˆä»¥åï¼ŒæœåŠ¡æä¾›è€…ä¼šæŒç»­ä¸€ä¸ªå¿ƒè·³ï¼ˆå®šæ—¶å‘EurekaServerå‘èµ·Restè¯·æ±‚ï¼‰ï¼Œå‘Šè¯‰EurekaServerï¼šâ€œæˆ‘è¿˜æ´»ç€â€ï¼Œè¿™ä¸ªæˆ‘ä»¬å°±ç§°ä¹‹ä¸ºæœåŠ¡çš„ç»­çº¦(renew)ï¼›å‘user-serverå·¥ç¨‹é…ç½®æ–‡ä»¶ä¸­æ·»åŠ å¦‚ä¸‹é…ç½®#æ·»åŠ Eurekaæ³¨å†Œçš„é…ç½®eureka:client:service-url:#EurekaServeråœ°å€ï¼Œå¤šä¸ªåœ°å€ä¹‹é—´ç”¨é€—å·åˆ†éš”defaultZone:http://127.0.0.1:10086/eureka,http://127.0.0.1:10087/eurekainstance:ip-address:127.0.0.1#ipåœ°å€prefer-ip-address:true#æ›´å€¾å‘äºä½¿ç”¨ipï¼Œè€Œä¸æ˜¯hostålease-expiration-duration-in-seconds:5#æœåŠ¡ç»­çº¦çš„æ—¶é—´é—´éš”ï¼Œé»˜è®¤æ˜¯30ç§’ï¼Œç°åœ¨æˆ‘è¿™é‡Œè®¾ç½®ä¸º5ç§’lease-renewal-interval-in-seconds:5#æœåŠ¡å¤±æ•ˆæ—¶é—´ï¼Œé»˜è®¤æ˜¯90ç§’ï¼Œæˆ‘è¿™é‡Œè®¾ç½®ä¸º5ç§’ä¹Ÿå°±æ˜¯è¯´ï¼Œé»˜è®¤æƒ…å†µä¸‹æ¯ä¸ª30ç§’æœåŠ¡ä¼šå‘æ³¨å†Œä¸­å¿ƒå‘é€ä¸€æ¬¡å¿ƒè·³ï¼Œè¯æ˜è‡ªå·±è¿˜æ´»ç€ï¼Œå¦‚æœè¶…è¿‡90ç§’è¿˜æ²¡æœ‰å‘é€å¿ƒè·³ï¼ŒEurekaServerå°±ä¼šè®¤ä¸ºè¯¥æœåŠ¡å·²ç»å®•æœºï¼Œä¼šå®šæ—¶ä»æœåŠ¡åˆ—è¡¨ä¸­ç§»é™¤ï¼Œè¿™ä¸¤ä¸ªå€¼åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä¸è¦ä¿®æ”¹ï¼ˆæˆ‘è¿™é‡Œä¿®æ”¹æ˜¯ä¸ºäº†æ–¹ä¾¿æµ‹è¯•ï¼‰æœåŠ¡ä¸‹çº¿å½“æœåŠ¡è¿›è¡Œæ­£å¸¸å…³é—­æ“ä½œçš„æ—¶å€™ï¼Œå®ƒä¼šè§¦å‘ä¸€ä¸ªæœåŠ¡ä¸‹çº¿çš„RESTè¯·æ±‚ç»™EurekaSeverï¼Œå‘Šè¯‰æœåŠ¡æ³¨å†Œä¸­å¿ƒï¼šâ€œæˆ‘è¦ä¸‹çº¿äº†â€ã€‚æœåŠ¡ä¸­å¿ƒæ¥æ”¶åˆ°è¯·æ±‚ä¹‹åï¼Œä¼šè®²è¯¥æœåŠ¡ç½®ä¸ºä¸‹çº¿çŠ¶æ€å¤±æ•ˆå‰”é™¤è‡ªæˆ‘ä¿æŠ¤æˆ‘ä»¬å…³åœä¸€ä¸ªæœåŠ¡ï¼Œå¾ˆå¯èƒ½ä¼šåœ¨eurekaé¢æ¿å‡ºç°ä¸€æ¡è­¦å‘Šï¼šè¿™ä¸ªå°±æ˜¯eurekaçš„è‡ªæˆ‘ä¿æŠ¤æœºåˆ¶ã€‚å½“æœåŠ¡æœªæŒ‰æ—¶è¿›è¡Œå¿ƒè·³ç»­çº¦ï¼ŒEurekaä¼šç»Ÿè®¡æœåŠ¡å®ä¾‹æœ€è¿‘15åˆ†é’Ÿå¿ƒè·³ç»­çº¦çš„æ¯”ä¾‹æ˜¯å¦ä½äº85%ï¼Œåœ¨ç”Ÿäº§ç¯å¢ƒä¸‹ï¼Œå› ä¸ºç½‘ç»œå»¶è¿Ÿç­‰åŸå› ï¼Œå¿ƒè·³å¤±è´¥å®ä¾‹çš„æ¯”ä¾‹å¾ˆæœ‰å¯èƒ½ä¼šè¶…æ ‡ï¼Œä½†æ˜¯æ­¤æ—¶å°±æŠŠæœåŠ¡å‰”é™¤åˆ—è¡¨å¹¶ä¸å¦¥å½“ï¼Œå› ä¸ºæœåŠ¡å¹¶æ²¡æœ‰å®•æœºã€‚Eruekaåœ¨è¿™æ®µæ—¶é—´å†…ä¸ä¼šå‰”é™¤ä»»ä½•æœåŠ¡å®ä¾‹ï¼Œç›´åˆ°ç½‘ç»œæ¢å¤æ­£å¸¸ã€‚ç”Ÿäº§ç¯å¢ƒä¸‹è¿™å¾ˆæœ‰æ•ˆ,å› æ­¤æœåŠ¡è°ƒç”¨è€…å¿…é¡»åšå¥½æœåŠ¡çš„å¤±è´¥å®¹é”™å¯ä»¥å…³é—­è‡ªæˆ‘ä¿æŠ¤ï¼ˆç”Ÿäº§ç¯å¢ƒä¸‹ï¼Œåƒä¸‡åˆ«å¹²è¿™äº‹ï¼ï¼‰#é…ç½®eurkeaeureka:client:service-url:defaultZone:${defualtZone:http://127.0.0.1:10086/eureka}#register-with-eureka:false#ä¸æ³¨å†Œè‡ªå·±ï¼Œé»˜è®¤å€¼æ˜¯trueï¼ˆå¦‚æœæ­å»ºeurekaé›†ç¾¤ï¼Œéœ€è¦ç›¸äº’ä¹‹é—´æ³¨å†Œï¼‰#fetch-registry:false#ä¸æ‹‰å–è‡ªå·±çš„æœåŠ¡åˆ—è¡¨server:enable-self-preservation:false#å…³é—­è‡ªæˆ‘ä¿æŠ¤æ¨¡å¼(ç¼ºçœä¸ºæ‰“å¼€)","link":"https://haohanya.github.io/post/eureka/"},{"title":"åˆè¯†SpringCloud","content":"ç³»ç»Ÿæ¶æ„çš„æ¼”å˜éšç€äº’è”ç½‘çš„å‘å±•ï¼Œç½‘ç«™çš„åº”ç”¨è§„æ¨¡ä¸æ–­æ‰©å¤§ï¼Œéœ€æ±‚çš„æ¿€å¢ï¼Œå¸¦æ¥çš„æ˜¯æŠ€æœ¯ä¸Šçš„å‹åŠ›ã€‚ç³»ç»Ÿæ¶æ„ä¹Ÿå› æ­¤åœ¨ä¸æ–­çš„æ¼”å˜ã€å‡çº§ã€è¿­ä»£ã€‚é›†ä¸­å¼æ¶æ„å½“ç½‘ç«™æµé‡å¾ˆå°çš„æ—¶å€™ï¼Œåªéœ€è¦ä¸€ä¸ªåº”ç”¨ï¼Œå°†æ‰€æœ‰çš„åŠŸèƒ½éƒ½éƒ¨ç½²åˆ°ä¸€èµ·ï¼Œä»¥å‡å°‘éƒ¨ç½²èŠ‚ç‚¹å’Œæˆæœ¬ã€‚ä¼˜ç‚¹ï¼šç³»ç»Ÿå¼€å‘é€Ÿåº¦å¿«ï¼Œç»´æŠ¤æˆæœ¬ä½ï¼Œé€‚åˆå¼€å‘å¹¶å‘è¦æ±‚è¾ƒä½çš„ç³»ç»Ÿç¼ºç‚¹ï¼šå•ç‚¹å®¹é”™ç‡ä½ï¼Œå¹¶å‘èƒ½åŠ›å·®å‚ç›´åº”ç”¨æ¶æ„å½“è®¿é—®é‡é€æ¸å¢å¤§ï¼Œå•ä¸€åº”ç”¨æ— æ³•æ»¡è¶³éœ€æ±‚ï¼Œæ­¤æ—¶ä¸ºäº†åº”å¯¹æ›´é«˜çš„å¹¶å‘å’Œä¸šåŠ¡éœ€æ±‚ï¼Œæˆ‘ä»¬æ ¹æ®ä¸šåŠ¡åŠŸèƒ½å¯¹ç³»ç»Ÿè¿›è¡Œæ‹†åˆ†ï¼šä¼˜ç‚¹ï¼šç³»ç»Ÿæ‹†åˆ†å®ç°äº†æµé‡åˆ†æ‹…ï¼Œè§£å†³äº†å¹¶å‘é—®é¢˜å¯ä»¥é’ˆå¯¹ä¸åŒçš„æ¨¡å—è¿›è¡Œä¼˜åŒ–æ–¹ä¾¿æ°´å¹³æ‰©å±•ï¼Œè´Ÿè½½å‡è¡¡ï¼Œå®¹é”™ç‡é«˜ç¼ºç‚¹ï¼šç³»ç»Ÿä¹‹é—´ç›¸äº’ç‹¬ç«‹ï¼Œå¼€å‘ä¸­ä¼šæœ‰å¾ˆå¤šé‡å¤ä»£ç ï¼Œå½±å“å¼€å‘æ•ˆç‡åˆ†å¸ƒå¼æœåŠ¡å½“å‚ç›´åº”ç”¨è¶Šæ¥è¶Šå¤šçš„æ—¶å€™ï¼Œåº”ç”¨ä¹‹é—´äº¤äº’ä¸å¯é¿å…ï¼Œä½œä¸ºç‹¬ç«‹çš„æœåŠ¡ï¼Œé€æ¸å½¢æˆç¨³å®šçš„æœåŠ¡ä¸­å¿ƒï¼Œæ˜¯å‰æ®µåº”ç”¨èƒ½æ›´å¿«é€Ÿçš„å½±å“å¤šå˜çš„å¸‚åœºéœ€æ±‚ä¼˜ç‚¹ï¼šå°†åŸºç¡€æœåŠ¡è¿›è¡Œäº†æŠ½å–ï¼Œç³»ç»Ÿä¹‹é—´äº’ç›¸é€šç”¨ï¼Œæé«˜äº†ä»£ç çš„é‡ç”¨æ€§å’Œå¼€å‘æ•ˆç‡ç¼ºç‚¹ï¼šç³»ç»Ÿä¹‹é—´è€¦åˆè¾ƒé«˜ï¼Œè°ƒç”¨å…³ç³»å¤æ‚ï¼Œéš¾ä»¥ç»´æŠ¤é¢å‘æœåŠ¡æ¶æ„SOA(ServiceOrientedArchitecure)é¢å‘æœåŠ¡çš„æ¶æ„ï¼šå®ƒæ˜¯ä¸€ç§è®¾è®¡æ–¹æ³•ï¼Œå…¶ä¸­åŒ…å«äº†å¤šä¸ªæœåŠ¡ï¼ŒæœåŠ¡ä¸æœåŠ¡ä¹‹é—´é€šè¿‡äº’ç›¸ä¾èµ–æœ€ç»ˆæä¾›ä¸€ç³»åˆ—çš„åŠŸèƒ½ã€‚ä¸€ä¸ªæœåŠ¡é€šå¸¸ä»¥ç‹¬ç«‹çš„å½¢å¼å­˜åœ¨ä¸æ“ä½œç³»ç»Ÿè¿›è¡Œä¸­ï¼Œå„ä¸ªæœåŠ¡ä¹‹é—´é€šè¿‡ç½‘ç»œè°ƒç”¨ã€‚ESB(ä¼ä¸šæœåŠ¡æ€»çº¿)ï¼šç®€å•çš„è¯´ESBå°±æ˜¯ä¸€æ ¹ç®¡é“ï¼Œç”¨æ¥è¿æ¥å„ä¸ªæœåŠ¡èŠ‚ç‚¹ï¼Œä¸ºäº†ç»§æ‰¿ä¸åŒç³»ç»Ÿï¼Œä¸åŒåè®®çš„æœåŠ¡ï¼ŒESBåšäº†æ¶ˆæ¯çš„è½¬æ¢è§£é‡Šå’Œè·¯ç”±å·¥ä½œï¼Œè®©ä¸åŒçš„æœåŠ¡äº’è”äº’é€šSOAç¼ºç‚¹æ¯ä¸ªä¾›åº”å•†çš„ESBäº§å“æœ‰åå·®ï¼Œè‡ªèº«å®ç°è¾ƒä¸ºå¤æ‚ï¼›åº”ç”¨æœåŠ¡ç²’åº¦è¾ƒå¤§ï¼ŒESBç»§æ‰¿æ•´åˆæ‰€æœ‰çš„æœåŠ¡å’Œåè®®ï¼Œæ•°æ®è½¬æ¢ä½¿å¾—è¿ç»´ã€æµ‹è¯•å’Œéƒ¨ç½²æ¯”è¾ƒå›°éš¾ï¼Œæ‰€æœ‰çš„æœåŠ¡éƒ½é€šè¿‡ä¸€ä¸ªé€šè·¯é€šè®¯ï¼Œç›´æ¥é™ä½äº†é€šä¿¡é€Ÿåº¦(dubboè¦æ¯”è¿™ä¸ªä¼˜åŒ–ï¼Œç³»ç»Ÿä¹‹é—´é€šè®¯é‡‡ç”¨RPCè¿™ç§æ–¹å¼ï¼Œè¿™ç§æ–¹å¼æ˜¯ç›´æ¥ä½¿ç”¨äºŒè¿›åˆ¶ï¼Œæ•ˆç‡æ¯”è¾ƒé«˜)å¾®æœåŠ¡æ¶æ„å¾®æœåŠ¡æ¶æ„æ˜¯ä½¿ç”¨ä¸€å¥—å°æœåŠ¡å¼€å‘å•ä¸ªåº”ç”¨çš„æ–¹å¼æˆ–é€”å¾„ï¼Œæ¯ä¸ªæœåŠ¡åŸºäºå•ä¸€ä¸šåŠ¡èƒ½åŠ›æ„å»ºï¼ˆèŒèƒ½å•ä¸€ï¼‰ï¼Œè¿è¡Œåœ¨è‡ªå·±çš„è¿›ç¨‹ä¸­ï¼Œå¹¶ä½¿ç”¨è½»é‡çº§æœºåˆ¶é€šä¿¡ï¼Œé€šå¸¸æ˜¯HttpAPIï¼Œå¹¶èƒ½å¤Ÿé€šè¿‡è‡ªåŠ¨åŒ–éƒ¨ç½²æœºåˆ¶æ¥ç‹¬ç«‹éƒ¨ç½²ï¼Œè¿™äº›æœåŠ¡å¯ä»¥ä½¿ç”¨ä¸åŒçš„ç¼–ç¨‹è¯­è¨€ï¼Œä»¥åŠä¸åŒçš„æ•°æ®å­˜å‚¨æŠ€æœ¯ï¼Œå¹¶ä¿æŒæœ€ä½çš„é›†ä¸­å¼ç®¡ç†(dubboï¼šä½¿ç”¨RPCåè®®é€šè®¯ï¼Œé‡‡ç”¨çš„å°±æ˜¯äºŒè¿›åˆ¶é€šè®¯ï¼Œå¦‚æœè¦ä½¿ç”¨dubboå®ç°ç³»ç»Ÿä¹‹é—´çš„é€šè®¯ï¼Œå¿…é¡»ä¿è¯é¡¹ç›®æ˜¯javaè¯­è¨€å¼€å‘çš„ã€‚dubboæ˜¯ä¸èƒ½å®ç°è·¨è¯­è¨€å¹³å°é€šè®¯dubboxï¼šåæ¥æ˜¯å½“å½“ç½‘å¯¹å®ƒè¿›è¡Œå‡çº§ï¼Œè®©dubboåœ¨æ”¯æŒRPCçš„åŒæ—¶ï¼Œä¹Ÿæ”¯æŒHttpAPIï¼ˆRestAPIï¼‰é€šè®¯)APIGateway:ç½‘å…³æ˜¯ä¸€ä¸ªæœåŠ¡å™¨ï¼Œæ˜¯ç³»ç»Ÿçš„å”¯ä¸€å…¥å£ï¼Œä¸ºæ¯ä¸ªå®¢æˆ·ç«¯æä¾›äº†ä¸€ä¸ªå®šåˆ¶çš„APIã€‚APIç½‘å…³æ ¸å¿ƒæ˜¯ï¼Œæ‰€æœ‰çš„å®¢æˆ·ç«¯å’Œæ¶ˆè´¹ç«¯éƒ½é€šè¿‡ç»Ÿä¸€çš„ç½‘å…³ä»‹å…¥å¾®æœåŠ¡ï¼Œåœ¨ç½‘ç®¡å±‚å¤„ç†æ‰€æœ‰çš„éä¸šåŠ¡åŠŸèƒ½ã€‚å¦‚å®ƒè¿˜å¯ä»¥å…·æœ‰å…¶ä»–èŒè´£ï¼šèº«ä»½éªŒè¯ã€ç›‘æ§ã€è´Ÿè½½å‡è¡¡ã€ç¼“å­˜ã€è¯·æ±‚åˆ†ç‰‡ä¸ç®¡ç†ã€‚é€šå¸¸ç½‘å…³æä¾›RESTFUL/httpçš„æ–¹å¼è®¿é—®æœåŠ¡ï¼Œè€ŒæœåŠ¡ç«¯é€šè¿‡æœåŠ¡æ³¨å†Œä¸­å¿ƒè¿›è¡ŒæœåŠ¡æ³¨å†Œå’Œç®¡ç†å¾®æœåŠ¡ç‰¹ç‚¹å•ä¸€èŒè´£ï¼šå¾®æœåŠ¡ä¸­æ¯ä¸ªæœåŠ¡éƒ½å¯¹åº”å”¯ä¸€çš„ä¸šåŠ¡èƒ½åŠ›,åšåˆ°å•ä¸€èŒè´£å¾®ï¼šå¾®æœåŠ¡çš„æœåŠ¡æ‹†åˆ†ç²’åº¦å¾ˆå°ï¼Œä¾‹å¦‚ä¸€ä¸ªç”¨æˆ·ç®¡ç†å°±å¯ä»¥ä½œä¸ºä¸€ä¸ªæœåŠ¡ï¼Œæ¯ä¸ªæœåŠ¡è™½ç„¶å°ï¼Œä½†æ˜¯â€œäº”è„ä¿±å…¨â€é¢å‘æœåŠ¡ï¼šæ¯ä¸ªæœåŠ¡éƒ½è¦å¯¹å¤–æš´æ¼Resté£æ ¼æœåŠ¡æ¥å£APIã€‚å¹¶ä¸å…³å¿ƒæœåŠ¡çš„æŠ€æœ¯å®ç°ï¼Œåšåˆ°ä¸å¹³å°å’Œè¯­è¨€æ— å…³ï¼Œä¹Ÿä¸é™å®šç”¨ä»€ä¹ˆæŠ€æœ¯å®ç°ï¼Œåªè¦æä¾›Restçš„æ¥å£å³å¯è‡ªæ²»ï¼šæœåŠ¡ä¹‹é—´ç›¸äº’ç‹¬ç«‹ï¼Œäº’ä¸å¹²æ‰°å›¢é˜Ÿç‹¬ç«‹ï¼šæ¯ä¸ªæœåŠ¡éƒ½å¯ä»¥ä¸€ä¸ªç‹¬ç«‹çš„å›¢é˜Ÿå¼€å‘ï¼Œäººæ•°ä¸èƒ½è¿‡å¤šæŠ€æœ¯ç‹¬ç«‹ï¼šé¢å‘çš„æ˜¯æœåŠ¡ï¼Œæä¾›Restæ¥å£ï¼Œä½¿ç”¨ä»€ä¹ˆæŠ€æœ¯æ²¡æœ‰äººå¹²æ¶‰å‰åç«¯åˆ†ç¦»ï¼šé‡‡ç”¨å‰åç«¯åˆ†ç¦»å¼€å‘ï¼Œæä¾›ç»Ÿä¸€Restæ¥å£ï¼Œåç«¯ä¸ç”¨å†ä¸ºPCã€ç§»åŠ¨ç«¯å¼€å‘ä¸åŒçš„æ¥å£éƒ¨ç½²ç‹¬ç«‹ï¼šæœåŠ¡ä¹‹é—´è™½ç„¶æœ‰è°ƒç”¨ï¼Œä½†æ˜¯è¦åšåˆ°æœåŠ¡å™¨é‡å¯ä¸å½±å“å…¶ä»–çš„æœåŠ¡å™¨ã€‚æœ‰åˆ©äºæŒç»­é›†æˆå’ŒæŒç»­äº¤ä»˜ã€‚æ¯ä¸ªæœåŠ¡éƒ½æ˜¯ç‹¬ç«‹çš„ç»„ä»¶ï¼Œå¯ä»¥å¤ç”¨ã€å¯ä»¥æ›¿æ¢ã€é™ä½äº†è€¦åˆåº¦ï¼Œæ˜“äºç»´æŠ¤äº’è”ç½‘ç²¾ç¥ï¼šå…ˆä¸Šçº¿ï¼Œåè¿­ä»£å¾®æœåŠ¡æ¶æ„ä¸SOAéƒ½æ˜¯å¯¹ç³»ç»Ÿè¿›è¡Œäº†æ‹†åˆ†ï¼›å¾®æœåŠ¡æ¶æ„å¸ˆåŸºäºSOAæ€æƒ³ï¼Œå¯ä»¥æŠŠå¾®æœåŠ¡å½“ä½œå»é™¤äº†ESBæ€»çº¿çš„SOAã€‚ESBæ˜¯SOAæ¶æ„ä¸­çš„ä¸­å¿ƒæ€»çº¿æœåŠ¡è°ƒç”¨æ–¹å¼å¸¸è§çš„è¿œç¨‹è°ƒç”¨æ–¹å¼1ã€RPCRemoteProduceCallã€‚åŸºäºSocketçš„é€šè®¯ï¼ˆæ˜¯ç”¨æœ€åº•å±‚çš„æ–¹å¼æ¥å®ç°é€šè®¯ï¼Œé‡‡ç”¨äºŒè¿›åˆ¶çš„å½¢å¼ï¼Œé€šè®¯çš„æ•ˆç‡æœ€é«˜çš„ï¼‰ã€‚å·¥ä½œåœ¨ä¼šè¯å±‚ã€‚è‡ªå®šä¹‰æ•°æ®æ ¼å¼ï¼Œé€Ÿåº¦å¿«ï¼Œæ•ˆç‡é«˜ã€‚æ—©æœŸçš„webserviceï¼Œç°åœ¨çƒ­é—¨çš„dubboxï¼Œéƒ½æ˜¯RPCçš„å…¸å‹ä»£è¡¨ï¼ˆåªèƒ½æ˜¯javaè¯­è¨€ç¼–å†™çš„æœåŠ¡ä¹‹é—´é€šè®¯ï¼‰2ã€Httphttpå…¶å®æ˜¯ä¸€ç§ç½‘ç»œä¼ è¾“åè®®ï¼ŒåŸºäºTCPï¼Œå·¥ä½œåœ¨åº”ç”¨å±‚ï¼Œè§„å®šäº†æ•°æ®ä¼ è¾“çš„æ ¼å¼ã€‚ç°åœ¨å®¢æˆ·ç«¯æµè§ˆå™¨ä¸æœåŠ¡å™¨é€šè®¯åŸºæœ¬ä¸Šéƒ½æ˜¯é‡‡ç”¨çš„httpåè®®ï¼Œä¹Ÿå¯ä»¥ç”¨æ¥è¿›è¡Œè¿œç¨‹æœåŠ¡è°ƒç”¨ã€‚ç¼ºç‚¹æ˜¯æ¶ˆæ¯å°è£…è‡ƒè‚¿ï¼Œä¼˜åŠ¿æ˜¯å¯¹æœåŠ¡çš„æä¾›å’Œè°ƒç”¨æ–¹æ²¡æœ‰ä»»ä½•æŠ€æœ¯é™å®šï¼ˆå¯ä»¥è·¨è¯­è¨€ï¼‰ï¼Œè‡ªç”±çµæ´»ï¼Œæ›´ç¬¦åˆå¾®æœåŠ¡çš„ç†å¿µå¦‚æœä½ ä»¬çš„å…¬å¸å…¨éƒ¨é‡‡ç”¨çš„javaæŠ€æœ¯æ ˆï¼Œé‚£ä¹ˆä½¿ç”¨dubboä½œä¸ºå¾®æœåŠ¡æ¶æ„å¸ˆä¸€ä¸ªä¸é”™çš„é€‰æ‹©ã€‚ç›¸åå¦‚æœå…¬å¸çš„æŠ€æœ¯æ ˆå¤šæ ·åŒ–ï¼Œè€Œä¸”ä½ æ›´åŠ é’çäºSpringå®¶æ—ï¼Œé‚£ä¹ˆSpringCloudæ­å»ºå¾®æœåŠ¡å°±æ˜¯ä¸äºŒé€‰æ‹©ï¼Œåœ¨æˆ‘ä»¬çš„é¡¹ç›®ä¸­ï¼Œä¼šæ‰€é€‰æ‹©SpringCloudå¥—ä»¶ï¼Œå› æ­¤ä¼šä½¿ç”¨httpæ–¹å¼æ¥å®ç°å¾®æœåŠ¡ä¹‹é—´çš„è°ƒç”¨Httpå®¢æˆ·ç«¯å·¥å…·æ—¢ç„¶å¾®æœåŠ¡é€‰æ‹©äº†httpï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±éœ€è¦è€ƒè™‘è‡ªå·±æ¥å®ç°å¯¹è¯·æ±‚å’Œå“åº”çš„å¤„ç†ï¼Œä¸è¿‡å¼€æºä¸–ç•Œå·²ç»æœ‰å¾ˆå¤šçš„httpå®¢æˆ·ç«¯å·¥å…·ï¼Œèƒ½å¤Ÿå¸®åŠ©æˆ‘ä»¬åšè¿™äº›äº‹æƒ…ï¼Œä¾‹å¦‚ï¼šHttpClientOkHttpURLConnectionä»–ä»¬ä¹‹é—´çš„APIå„ä¸ç›¸åŒï¼Œè€Œspringä¹Ÿæœ‰å¯¹httpçš„å®¢æˆ·ç«¯å·¥å…·è¿›è¡Œäº†å°è£…ï¼ˆè¿™ä¸‰ç§éƒ½æœ‰ï¼‰ï¼Œæä¾›äº†å·¥å…·ç±»ï¼šRestTemplateSpringçš„RestTemplateä½¿ç”¨springæä¾›çš„ä¸€ä¸ªRestTemplateæ¥å®ç°httpçš„äº¤äº’åˆ›å»ºspringbooté¡¹ç›®1ã€åˆ›å»ºä¸šåŠ¡é€»è¾‘å±‚(user-service)ä¾èµ–&lt;!--mapperå¯åŠ¨å™¨(å‡†å¤‡ä½¿ç”¨mybatisä½œä¸ºæŒä¹…å±‚)--&gt;&lt;dependency&gt;&lt;groupId&gt;tk.mybatis&lt;/groupId&gt;&lt;artifactId&gt;mapper-spring-boot-starter&lt;/artifactId&gt;&lt;version&gt;2.0.3&lt;/version&gt;&lt;/dependency&gt;&lt;!--mysqlé©±åŠ¨--&gt;&lt;dependency&gt;&lt;groupId&gt;mysql&lt;/groupId&gt;&lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;&lt;/dependency&gt;&lt;!--ä¸ºäº†å¼€å‘æ–¹ä¾¿ï¼Œæˆ‘è¿™é‡Œå¼•å…¥lombok--&gt;&lt;dependency&gt;&lt;groupId&gt;org.projectlombok&lt;/groupId&gt;&lt;artifactId&gt;lombok&lt;/artifactId&gt;&lt;/dependency&gt;pojo@Data@Table(name=&quot;tb_user&quot;)publicclassUser{@Id@KeySql(useGeneratedKeys=true)privateLongid;privateStringuserName;/*ç”¨æˆ·å*/privateStringpassword;/*å¯†ç */privateStringname;/*å§“å*/privateIntegerage;/*å¹´é¾„*/privateIntegersex;/*æ€§åˆ«ï¼Œ1ç”·æ€§ï¼Œ2å¥³æ€§*/privateDatebirthday;/*ç”Ÿæ—¥*/privateStringnote;/*å¤‡æ³¨*/privateDatecreated;/*åˆ›å»ºæ—¶é—´*/privateDateupdated;/*ä¿®æ”¹æ—¶é—´*/}mapperæ¥å£importtk.mybatis.mapper.common.Mapper;publicinterfaceUserMapperextendsMapper&lt;User&gt;{}åœ¨å¯åŠ¨ç±»ä¸­æ‰«æmapper@SpringBootApplication@MapperScan(basePackages=&quot;com.cn.mapper&quot;)publicclassUserServiceApplication{publicstaticvoidmain(String[]args){SpringApplication.run(UserServiceApplication.class,args);}}servicepublicinterfaceUserService{/***æ ¹æ®ä¸»é”®æŸ¥è¯¢å¯¹è±¡*@paramidä¸»é”®*@returnå¯¹è±¡*/UsergetUserById(Longid);}-------------@ServicepublicclassUserServiceImplimplementsUserService{@Autowired(required=false)privateUserMapperuserMapper;@OverridepublicUsergetUserById(Longid){returnuserMapper.selectByPrimaryKey(id);}}ç¼–å†™æ§åˆ¶å±‚æä¾›Rstfulæ¥å£@RestController@RequestMapping(&quot;/user&quot;)publicclassUserContorller{@AutowiredprivateUserServiceuserService;@RequestMapping(&quot;/{id}&quot;)publicUsergetById(@PathVariable(&quot;id&quot;)Longid){returnuserService.getUserById(id);}}2ã€åˆ›å»ºè¡¨ç°å±‚ï¼ˆuser-webï¼‰pojoï¼šåŒä¸Šå¯åŠ¨ç±»é…ç½®RestTemplate@SpringBootApplicationpublicclassUserWebApplication{@BeanpublicRestTemplaterestTemplate(){returnnewRestTemplate();}publicstaticvoidmain(String[]args){SpringApplication.run(UserWebApplication.class,args);}}importcom.cn.pojo.User;importorg.springframework.beans.factory.annotation.Autowired;importorg.springframework.web.bind.annotation.PathVariable;importorg.springframework.web.bind.annotation.RequestMapping;importorg.springframework.web.bind.annotation.RestController;importorg.springframework.web.client.RestTemplate;@RestController@RequestMapping(&quot;/consumer&quot;)publicclassConsumerController{@AutowiredprivateRestTemplaterestTemplate;@RequestMapping(&quot;/{id}&quot;)publicUsergetByid(@PathVariable(&quot;id&quot;)Longid){//é€šè¿‡httpçš„æ–¹å¼å®ç°ç³»ç»Ÿä¹‹é—´çš„é€šè®¯Stringurl=&quot;http://localhost:9091/user/&quot;+id;//è¿™ä¸ªæ˜¯user-serviceæä¾›çš„restapié£æ ¼çš„æ¥å£Useruser=restTemplate.getForObject(url,User.class);returnuser;}}ä¸Šé¢çš„æ“ä½œæˆ‘ä»¬æ˜¯ä½¿ç”¨user-serviceå¯¹å¤–æä¾›äº†æ ¹æ®ä¸»é”®æŸ¥è¯¢ç”¨æˆ·çš„æ¥å£ï¼Œç„¶ååœ¨user-webé€šè¿‡RestTemplateè°ƒç”¨serviceçš„æ¥å£è¿™æ ·å†™ä¼šå­˜åœ¨ç¡¬ç¼–ç çš„é—®é¢˜ï¼Œä¸æ–¹ä¾¿åæœŸç»´æŠ¤ï¼Œå¹¶ä¸”æˆ‘ä»¬éœ€è¦è®°ä½urlçš„åœ°å€ï¼Œå¦‚æœå‘ç”Ÿæ”¹å˜ï¼Œæ”¶ä¸åˆ°é€šçŸ¥ï¼Œåœ°å€å°†ä¼šå¤±æ•ˆwebå±‚å¹¶ä¸çŸ¥é“serviceå±‚çš„çŠ¶æ€ï¼Œä¾‹å¦‚æœåŠ¡å™¨å®•æœºserviceå±‚ä¹Ÿåªæœ‰ä¸€å°ï¼Œä¸å…·å¤‡é«˜å¯ç”¨å³ä¾¿æ˜¯serviceæ­å»ºæˆäº†é›†ç¾¤ï¼Œwebè¿˜éœ€è¦å»å®ç°è´Ÿè½½å‡è¡¡å…¶å®ä¸Šé¢è¯´çš„é—®é¢˜ï¼Œæ¦‚æ‹¬ä¸€ä¸‹å°±æ˜¯åˆ†å¸ƒå¼æœåŠ¡å¿…ç„¶è¦é¢ä¸´çš„é—®é¢˜ï¼šæœåŠ¡ç®¡ç†å¦‚ä½•è‡ªåŠ¨æ³¨å†Œå’Œå‘ç°å¦‚ä½•å®ç°çŠ¶æ€ç›‘æ§å¦‚ä½•å®ç°åŠ¨æ€è·¯ç”±æœåŠ¡å¦‚ä½•å®ç°è´Ÿè½½å‡è¡¡æœåŠ¡å¦‚ä½•è§£å†³å®¹ç¾é—®é¢˜æœåŠ¡å¦‚ä½•å®ç°ç»Ÿä¸€é…ç½®","link":"https://haohanya.github.io/post/chu-shi-springcloud/"},{"title":"Spring-Data-Jpa","content":"ä»€ä¹ˆæ˜¯JAPJPAæ˜¯JavaPersistenceAPIçš„ç®€ç§°ï¼Œä¸­æ–‡åJavaæŒä¹…å±‚APIï¼Œæ˜¯JDK5.0æ³¨è§£æˆ–XMLæè¿°å¯¹è±¡ï¼å…³ç³»è¡¨çš„æ˜ å°„å…³ç³»ï¼Œå¹¶å°†è¿è¡ŒæœŸçš„å®ä½“å¯¹è±¡æŒä¹…åŒ–åˆ°æ•°æ®åº“ä¸­Sunå¼•å…¥æ–°çš„JPAORMè§„èŒƒå‡ºäºä¸¤ä¸ªåŸå› ï¼šå…¶ä¸€ï¼Œç®€åŒ–ç°æœ‰JavaEEå’ŒJavaSEåº”ç”¨å¼€å‘å·¥ä½œï¼›å…¶äºŒï¼ŒSunå¸Œæœ›æ•´åˆORMæŠ€æœ¯ï¼Œå®ç°å¤©ä¸‹å½’ä¸€ã€‚mybatiså’Œhibernateçš„åŒºåˆ«mybatiså’Œhibernateä¸€æ ·æ˜¯ä¸ªormæ•°æ®åº“æ¡†æ¶1).hibernateæ˜¯å…¨è‡ªåŠ¨ï¼Œè€Œmybatisæ˜¯åŠè‡ªåŠ¨ã€‚mybatiså¼€å‘æ˜¯éœ€è¦å»å†™sqlè¯­å¥ï¼Œè€Œä½¿ç”¨hibernateä¸éœ€è¦å†™ä»»ä½•çš„sqlè¯­å¥å°±èƒ½å®ç°å„ç§æ“ä½œ2).hibernateæ•°æ®åº“ç§»æ¤æ€§è¿œå¤§äºmybatisã€‚å¦‚æœä½¿ç”¨mybatisï¼Œä¸€æ—¦æ•°æ®åº“å‘ç”Ÿå˜åŒ–ï¼Œéœ€è¦é‡å†™ç¼–ç ï¼ˆæ¯”å¦‚mysqlæ•°æ®åº“çš„sqlè¯­å¥å’Œoracleä»¥åŠsqlServeræ•°æ®åº“ä»–ä»¬ç”¨çš„sqlè¯­å¥ä¼šæœ‰ä¸€äº›å·®åˆ«ï¼‰ã€‚ä½†æ˜¯ä½¿ç”¨hibernateä¸€æ—¦æ•°æ®åº“å‘ç”Ÿå˜åŒ–ï¼Œæˆ‘ä»¬ä¸éœ€è¦é‡å†™ç¼–ç ï¼Œåªéœ€è¦æ”¹å°‘è®¸çš„é…ç½®å°±èƒ½å®ç°3).hibernateæ‹¥æœ‰å®Œæ•´çš„æ—¥å¿—ç³»ç»Ÿï¼Œmybatisåˆ™æ¬ ç¼ºä¸€äº›ã€‚4).mybatisç›¸æ¯”hibernateéœ€è¦å…³å¿ƒå¾ˆå¤šç»†èŠ‚hibernateé…ç½®è¦æ¯”mybatiså¤æ‚çš„å¤šï¼Œå­¦ä¹ æˆæœ¬ä¹Ÿæ¯”mybatisé«˜ã€‚ä½†ä¹Ÿæ­£å› ä¸ºmybatisä½¿ç”¨ç®€å•ï¼Œæ‰å¯¼è‡´å®ƒè¦æ¯”hibernateå…³å¿ƒå¾ˆå¤šæŠ€æœ¯ç»†èŠ‚ã€‚mybatisç”±äºä¸ç”¨è€ƒè™‘å¾ˆå¤šç»†èŠ‚ï¼Œå¼€å‘æ¨¡å¼ä¸Šä¸ä¼ ç»ŸjdbcåŒºåˆ«å¾ˆå°ï¼Œå› æ­¤å¾ˆå®¹æ˜“ä¸Šæ‰‹å¹¶å¼€å‘é¡¹ç›®ï¼Œä½†å¿½ç•¥ç»†èŠ‚ä¼šå¯¼è‡´é¡¹ç›®å‰æœŸbugè¾ƒå¤šï¼Œå› è€Œå¼€å‘å‡ºç›¸å¯¹ç¨³å®šçš„è½¯ä»¶å¾ˆæ…¢ï¼Œè€Œå¼€å‘å‡ºè½¯ä»¶å´å¾ˆå¿«ã€‚hibernateåˆ™æ­£å¥½ä¸ä¹‹ç›¸åã€‚ä½†æ˜¯å¦‚æœä½¿ç”¨hibernateå¾ˆç†Ÿç»ƒçš„è¯ï¼Œå®é™…ä¸Šå¼€å‘æ•ˆç‡ä¸æ¯«ä¸å·®äºç”šè‡³è¶…è¶Šmybatisã€‚5).sqlç›´æ¥ä¼˜åŒ–ä¸Šï¼Œmybatisè¦æ¯”hibernateæ–¹ä¾¿å¾ˆå¤šè¿™ä¹Ÿæ˜¯hibernateæ²¡è½çš„åŸå› ä¹‹ä¸€ã€‚å› ä¸ºsqlè¯­å¥è‡ªåŠ¨ç”Ÿæˆçš„ï¼Œæ•ˆç‡ä¸Šä¸å¥½æ§åˆ¶ä¸ºä»€ä¹ˆç°åœ¨mybatisè¦æ¯”hiernateæµè¡Œï¼Ÿå¾ˆé‡è¦çš„åŸå› ï¼šhibernateçš„å­¦ä¹ éš¾åº¦æ˜¯ç›®å‰å¤§å®¶æ¥è§¦çš„æ¡†æ¶ä¸­æœ€å¤§çš„ï¼Œå­¦ä¹ æˆæœ¬è¿œè¿œé«˜äºmybatisï¼Œæ‰€ä»¥mybatisæ›´æµè¡Œå…¥é—¨1ã€å¼•å…¥ä¾èµ–.....2ã€é…ç½®æ•°æ®æºspring.datasource.url=jdbc:mysql://localhost:3306/springboot?serverTimezone=UTC&amp;useUnicode=true&amp;characterEncoding=utf8&amp;useSSL=truespring.datasource.username=rootspring.datasource.password=root3ã€ç¼–å†™å®ä½“ç±»åœ¨mybatisçš„å¼€å‘ä¸­ï¼Œå®ä½“ç±»æ‰€åœ¨åŒ…åéƒ½ç”¨çš„æ˜¯pojoï¼Œä½†æ˜¯åœ¨spring-data-jpaä¸­ï¼Œå› ä¸ºspringä¸­å®ä½“ç±»çš„åŒ…åä¸€èˆ¬éƒ½æ˜¯å«åšdomainï¼Œæ‰€ä»¥æˆ‘ä»¬å¼€å‘çš„æ—¶å€™å®ä½“ç±»çš„åŒ…åä¹Ÿå«domainimportjavax.persistence.*;/**@Entityï¼šè¯¥æ³¨è§£è¡¨ç¤ºè¿™ä¸ªç±»æ˜¯ä¸€ä¸ªå®ä½“ç±»ï¼Œï¼ˆå‡†å¤‡ç”¨æ¥å»ºç«‹æ•°æ®åº“è¡¨çš„æ˜ å°„å…³ç³»ï¼‰@Tableï¼šç”¨æ¥å»ºç«‹å®ä½“ç±»å’Œæ•°æ®åº“è¡¨çš„çœŸå®æ˜ å°„å…³ç³»ï¼Œå±æ€§nameä¸ºè¡¨åï¼Œè¡¨åå’Œç±»åä¸€è‡´å¯ä»¥çœç•¥@idï¼šè¡¨ç¤ºä¸»é”®@GeneratedValue(strategy=GenerationType.IDENTITY)ï¼šè¯¥å­—æ®µæ˜¯è‡ªå¢çš„@Columnï¼šå»ºç«‹æ•°æ®åº“åˆ—åçš„æ˜ å°„*/@Entity@Table(name=&quot;grade&quot;)publicclassGrade{@Id@GeneratedValue(strategy=GenerationType.IDENTITY)@Column(name=&quot;id&quot;,nullable=false)privateIntegerid;@Column(name=&quot;name&quot;,nullable=false,length=50)privateStringname;....}4ã€ç¼–å†™æ¥å£åœ¨spring-data-jpaä¸­ï¼Œæ¥å£æ‰€åœ¨çš„åŒ…åï¼Œå®˜æ–¹ç”¨çš„æ˜¯repositoryï¼Œæ‰€ä»¥æˆ‘ä»¬ä¹Ÿè¿™ä¹ˆç”¨ï¼Œå®ƒç­‰åŒäºæˆ‘ä»¬ä¹‹å‰çš„daoæˆ–è€…æ˜¯mapper/***ç¼–å†™spring-data-jpaæ¥å£è¦ç‚¹ï¼š*1.ç»§æ‰¿JpaRepository&lt;å‚æ•°ä¸€è¦æ“ä½œçš„ç±»,å‚æ•°äºŒæ”¹ç±»çš„ä¸»é”®ç±»å‹&gt;*2.åœ¨æ¥å£ä¸Šæ·»åŠ æ³¨è§£@Repositoryï¼Œå¦‚æœè¯¥æ¥å£åœ¨å¯åŠ¨ç±»çš„åŒä¸€ä¸ªåŒ…æˆ–è€…æ˜¯åœ¨å¯åŠ¨ç±»çš„å­åŒ…ä¸­ï¼Œé‚£ä¹ˆè¯¥ç±»å°†äº¤ç»™springç®¡ç†*spring-data-jpaæ¥å£ç¼–å†™çš„è§„åˆ™ï¼ˆå› ä¸ºå¢åˆ æ”¹æ˜¯å°±ç”¨å°è£…å¥½çš„å°±å¯ä»¥ï¼Œè¯¥æ¥å£ä¸»è¦æ˜¯ç”¨äºæŸ¥è¯¢ï¼‰*ç²¾ç¡®æŸ¥è¯¢çš„è§„åˆ™ï¼šfind+è¡¨å+By+domainä¸­çš„å±æ€§å*æ¨¡ç³ŠæŸ¥è¯¢çš„è§„åˆ™ï¼šfind+è¡¨å+By+domainä¸­çš„å±æ€§å+Like*/@RepositorypublicinterfaceGradeAreaRepositoryextendsJpaRepository&lt;Grade,Integer&gt;{/***æ ¹æ®å¹´çº§åç§°æŸ¥è¯¢å¹´çº§*@paramname*@return*/GradefindGradeByName(Stringname);/***æ ¹æ®å¹´çº§åç§°åšæ¨¡ç³ŠæŸ¥è¯¢*@paramname*@return*/List&lt;Grade&gt;findGradeByNameLike(Stringname);/***æ ¹æ®ä¸»é”®æŸ¥è¯¢*/GradefindGradeById(Integerid);/***æ ¹æ®idå’Œå¹´çº§åç§°åšè”åˆæŸ¥è¯¢*/GradefindGradeByIdAndNameLike(Integerid,Stringname);/***å•ç‹¬çš„åˆ†é¡µæ“ä½œ*å¦‚æœå¸Œæœ›åšåˆ†é¡µæ“ä½œï¼Œè¿”å›çš„æ•°æ®ç±»å‹å¿…é¡»æ˜¯spring-data-jpaè·Ÿæˆ‘ä»¬å°è£…å¥½çš„Pageï¼Œå‚æ•°æ”¾Pageableæ¥å£*/Page&lt;Grade&gt;findAll(Pageablepage);}5ã€æµ‹è¯•&lt;!--spring-data-jpaæµ‹è¯•éœ€è¦æ·»åŠ çš„ä¾èµ–,å¦‚æœç›´æ¥åœ¨tomcatä¸­è¿è¡Œä¸éœ€è¦è¯¥åŒ…--&gt;&lt;dependency&gt;&lt;groupId&gt;net.minidev&lt;/groupId&gt;&lt;artifactId&gt;asm&lt;/artifactId&gt;&lt;version&gt;1.0.2&lt;/version&gt;&lt;scope&gt;test&lt;/scope&gt;&lt;/dependency&gt;//æµ‹è¯•å¢åŠ @TestpublicvoidtestSave(){Gradegrade=newGrade();grade.setName(&quot;äº”å¹´çº§&quot;);Gradeg=gradeRepository.save(grade);//å¢åŠ åå¾ˆå®¹æ˜“æ‹¿åˆ°ä¸»é”®System.out.println(g);}//æµ‹è¯•ä¿®æ”¹(å¦‚æœä¸ç»™ä¸»é”®æ˜¯å¢åŠ ï¼Œç»™ä¸»é”®å°±æ˜¯ä¿®æ”¹)@TestpublicvoidtestUpdate(){Gradegrade=newGrade();grade.setId(4);grade.setName(&quot;åŸå­å¼¹è®¾ç½®ä¸åˆ¶é€ &quot;);Gradeg=gradeRepository.save(grade);System.out.println(g);}//æµ‹è¯•åˆ é™¤--æ ¹æ®ä¸»é”®åˆ é™¤@TestpublicvoidtestDeleteById(){//æ‰§è¡Œåˆ é™¤gradeRepository.deleteById(5);}//æµ‹è¯•åˆ é™¤--æ ¹æ®å¯¹è±¡åˆ é™¤@TestpublicvoidtestDeleteByObject(){//æ‰§è¡Œåˆ é™¤Gradegrade=newGrade();grade.setId(4);gradeRepository.delete(grade);}//æµ‹è¯•åˆ é™¤--åˆ é™¤å…¨éƒ¨@TestpublicvoidtestDeleteAll(){gradeRepository.deleteAll();}@TestpublicvoidtestSave100(){for(inti=1;i&lt;=100;i++){Gradegrade=newGrade();grade.setName(i+&quot;å¹´çº§&quot;);gradeRepository.save(grade);}}//æµ‹è¯•æŸ¥è¯¢--æŸ¥è¯¢å…¨éƒ¨@TestpublicvoidtestGetAll(){List&lt;Grade&gt;list=gradeRepository.findAll();for(Gradegrade:list){System.out.println(grade);}}//æµ‹è¯•æŸ¥è¯¢--æ ¹æ®idæŸ¥è¯¢@TestpublicvoidtestGetById(){//æ ¹æ®ä¸»é”®æŸ¥è¯¢Gradegrade=gradeRepository.findById(1).get();System.out.println(grade);}//æµ‹è¯•æŸ¥è¯¢--æ ¹æ®idæŸ¥è¯¢(åœ¨tomcatå®¹å™¨ä¸­ä¸ä¼šæœ‰é—®é¢˜ï¼Œä½†æ˜¯åœ¨æµ‹è¯•çš„æ—¶å€™ä¼šå‡ºç°æ‡’åŠ è½½å¯¼è‡´sessionå…³é—­çš„é—®é¢˜)@TestpublicvoidtestGetById2(){//æ ¹æ®ä¸»é”®æŸ¥è¯¢//ä½¿ç”¨getOneæ–¹æ³•éœ€è¦åœ¨é…ç½®æ–‡ä»¶ä¸­æ·»åŠ spring.jpa.properties.hibernate.enable_lazy_load_no_trans=trueGradegrade=gradeRepository.getOne(1);System.out.println(grade);}//æµ‹è¯•æŸ¥è¯¢--éä¸»é”®çš„ç²¾ç¡®æŸ¥è¯¢--æ ¹æ®å¹´çº§åç§°åšç²¾ç¡®æŸ¥è¯¢@TestpublicvoidtestGetGradeByName(){Gradegrade=gradeRepository.findGradeByName(&quot;1å¹´çº§&quot;);System.out.println(grade);}//æµ‹è¯•æŸ¥è¯¢--æ¨¡ç³ŠæŸ¥è¯¢--æ ¹æ®å¹´çº§åç§°åšæ¨¡ç³ŠæŸ¥è¯¢@TestpublicvoidtestGetGradeByNameLike(){Stringname=&quot;ç«&quot;;List&lt;Grade&gt;list=gradeRepository.findGradeByNameLike(&quot;%&quot;+name+&quot;%&quot;);for(Gradegrade:list){System.out.println(grade);}}@TestpublicvoidtestGetById3(){Gradegrade=gradeRepository.findGradeById(2);System.out.println(grade);}//æµ‹è¯•æŸ¥è¯¢--å¤šæ¡ä»¶è”åˆæŸ¥è¯¢@TestpublicvoidtestGetGradeByIdAndNameLike(){Gradegrade=gradeRepository.findGradeByIdAndNameLike(1,&quot;%1å¹´çº§%&quot;);System.out.println(grade);}//æµ‹è¯•æŸ¥è¯¢--åˆ†é¡µæŸ¥è¯¢@TestpublicvoidtestFindAllPages(){//æ„é€ Pageableä½¿ç”¨PageRequest.of(å‚æ•°ä¸€å½“å‰è¦å±•ç¤ºçš„é¡µç ï¼Œå‚æ•°äºŒæ¯é¡µæ˜¾ç¤ºçš„ä¿¡æ¯æ¡æ•°)//æ³¨æ„ï¼šåœ¨mybatisçš„pagehelperä¸­ï¼Œå½“å‰æºç æ˜¯ä»1å¼€å§‹çš„ï¼Œä½†æ˜¯åœ¨spring-data-jpaä¸­åˆ†é¡µé¡µç æ˜¯ä»0å¼€å§‹//PageRequestä¸­çš„å…¶ä»–å‚æ•°//Pageablepageable=PageRequest.of(0,10,Sort.by(Sort.Direction.DESC,&quot;id&quot;));//Pageablepageable=PageRequest.of(0,10,Sort.Direction.DESC,&quot;id&quot;);Pageablepageable=PageRequest.of(1,10);Page&lt;Grade&gt;all=gradeRepository.findAll(pageable);System.out.println(&quot;æ€»æ¡æ•°&quot;+all.getTotalElements());System.out.println(&quot;æ€»é¡µæ•°&quot;+all.getTotalPages());System.out.println(&quot;æ˜¯å¦æœ‰ä¸‹ä¸€é¡µ&quot;+all.hasNext());System.out.println(&quot;æ˜¯å¦æœ‰ä¸Šä¸€é¡µ&quot;+all.hasPrevious());System.out.println(&quot;æ˜¯å¦æœ‰å†…å®¹&quot;+all.hasContent());System.out.println(&quot;æ˜¯å¦é¦–é¡µ&quot;+all.isFirst());System.out.println(&quot;æ˜¯å¦æœ€åä¸€é¡µ&quot;+all.isLast());System.out.println(&quot;å…ƒç´ æ•°é‡&quot;+all.getNumberOfElements());//è·å–åˆ°ä¸€é¡µæ•°æ®List&lt;Grade&gt;list=all.getContent();for(Gradegrade:list){System.out.println(grade);}}","link":"https://haohanya.github.io/post/spring-data-jpa/"},{"title":"MongoDB","content":"Mongoä»€ä¹ˆæ˜¯MongoDBMongoDBæ˜¯ä¸€ä¸ªåŸºäºåˆ†å¸ƒå¼æ–‡ä»¶å­˜å‚¨çš„æ•°æ®åº“ã€‚ç”±C++è¯­è¨€ç¼–å†™ã€‚æ—¨åœ¨ä¸ºWEBåº”ç”¨æä¾›å¯æ‰©å±•çš„é«˜æ€§èƒ½æ•°æ®å­˜å‚¨è§£å†³æ–¹æ¡ˆã€‚MongoDBæ˜¯ä¸€ä¸ªä»‹äºå…³ç³»æ•°æ®åº“å’Œéå…³ç³»æ•°æ®åº“ä¹‹é—´çš„äº§å“ï¼Œæ˜¯éå…³ç³»æ•°æ®åº“å½“ä¸­åŠŸèƒ½æœ€ä¸°å¯Œï¼Œæœ€åƒå…³ç³»æ•°æ®åº“çš„ã€‚å®ƒæ”¯æŒçš„æ•°æ®ç»“æ„éå¸¸æ¾æ•£ï¼Œæ˜¯ç±»ä¼¼jsonçš„bsonæ ¼å¼ï¼Œå› æ­¤å¯ä»¥å­˜å‚¨æ¯”è¾ƒå¤æ‚çš„æ•°æ®ç±»å‹ã€‚Mongoæœ€å¤§çš„ç‰¹ç‚¹æ˜¯å®ƒæ”¯æŒçš„æŸ¥è¯¢è¯­è¨€éå¸¸å¼ºå¤§ï¼Œå…¶è¯­æ³•æœ‰ç‚¹ç±»ä¼¼äºé¢å‘å¯¹è±¡çš„æŸ¥è¯¢è¯­è¨€ï¼Œå‡ ä¹å¯ä»¥å®ç°ç±»ä¼¼å…³ç³»æ•°æ®åº“å•è¡¨æŸ¥è¯¢çš„ç»å¤§éƒ¨åˆ†åŠŸèƒ½ï¼Œè€Œä¸”è¿˜æ”¯æŒå¯¹æ•°æ®å»ºç«‹ç´¢å¼•ã€‚MongoDBç‰¹ç‚¹å®ƒçš„ç‰¹ç‚¹æ˜¯é«˜æ€§èƒ½ã€æ˜“éƒ¨ç½²ã€æ˜“ä½¿ç”¨ï¼Œå­˜å‚¨æ•°æ®éå¸¸æ–¹ä¾¿ã€‚ä¸»è¦åŠŸèƒ½ç‰¹æ€§æœ‰ï¼š*é¢å‘é›†åˆå­˜å‚¨çš„ï¼Œæ˜“äºå­˜å‚¨å¯¹è±¡ç±»å‹çš„æ•°æ®*æ¨¡å¼è‡ªç”±ã€‚*æ”¯æŒåŠ¨æ€[æŸ¥è¯¢]*æ”¯æŒå®Œå…¨ç´¢å¼•ï¼ŒåŒ…å«å†…éƒ¨å¯¹è±¡ã€‚*æ”¯æŒæŸ¥è¯¢ã€‚*æ”¯æŒå¤åˆ¶å’Œæ•…éšœæ¢å¤ã€‚*ä½¿ç”¨é«˜æ•ˆçš„äºŒè¿›åˆ¶æ•°æ®å­˜å‚¨ï¼ŒåŒ…æ‹¬å¤§å‹å¯¹è±¡ï¼ˆå¦‚è§†é¢‘ç­‰ï¼‰ã€‚*è‡ªåŠ¨å¤„ç†ç¢ç‰‡ï¼Œä»¥æ”¯æŒäº‘è®¡ç®—å±‚æ¬¡çš„æ‰©å±•æ€§ã€‚*æ”¯æŒGolangï¼ŒRUBYï¼ŒPYTHONï¼ŒJAVAï¼ŒC++ï¼ŒPHPï¼ŒC#ç­‰å¤šç§è¯­è¨€ã€‚*æ–‡ä»¶å­˜å‚¨æ ¼å¼ä¸ºBSONï¼ˆä¸€ç§JSONçš„æ‰©å±•ï¼‰ã€‚*å¯é€šè¿‡ç½‘ç»œè®¿é—®ã€‚MongoDBä½“ç³»ç»“æ„mongoçš„é€»è¾‘ç»“æœæ˜¯ä¸€ç§å±‚æ¬¡ç»“æ„ä¸»è¦ç”±å¦‚ä¸‹å‡ ä¸ªä¸œè¥¿ç»„æˆï¼šæ–‡æ¡£(document)ã€é›†åˆ(collection)ã€æ•°æ®åº“(database)è¿™ä¸‰éƒ¨åˆ†ç»„æˆï¼Œé€»è¾‘ç»“æ„æ˜¯é¢å‘ç”¨æˆ·çš„ã€‚ç”¨æˆ·å°±å¯ä»¥é€šè¿‡MongoDBå¼€å‘åº”ç”¨ç¨‹åºä½¿ç”¨çš„å°±æ˜¯é€»è¾‘ç»“æ„(1)MongoDBçš„documentï¼Œç›¸å½“äºæ˜¯MySQLï¼ˆå…³ç³»å‹æ•°æ®åº“ï¼‰ä¸­çš„ä¸€è¡Œè®°å½•(2)å¤šä¸ªæ–‡æ¡£ç»„æˆä¸€ä¸ªé›†åˆï¼Œåœ¨MySQLä¸­å¤šæ¡è®°å½•ç»„æˆçš„æ˜¯è¡¨(3)å¤šä¸ªé›†åˆï¼Œé€»è¾‘ä¸Šç»„ç»‡åœ¨ä¸€èµ·ï¼Œå°±æ˜¯ä¸€ä¸ªæ•°æ®åº“(4)ä¸€ä¸ªMongoDBå®ä¾‹æ”¯æŒå¤šä¸ªæ•°æ®åº“MongoDBMysqlæ•°æ®åº“(database)æ•°æ®åº“(database)é›†åˆ(collection)è¡¨(table)æ–‡æ¡£(document)è¡Œ(row)å®‰è£…Mongo1ã€æ‹‰å–é•œåƒdockerpullmongo:latest2ã€åˆ›å»ºå®¹å™¨dockerrun-di--name=mymongo-p27017:27017mongo--auth27017ï¼šmongoé»˜è®¤çš„ç«¯å£--authï¼šå¯ç”¨éªŒè¯ï¼Œé»˜è®¤å…³é—­3ã€åˆ›å»ºç”¨æˆ·#è¿›å…¥å®¹å™¨dockerexec-itmymongo/bin/bash#è¿›å…¥Mongomongo#é€‰æ‹©æ•°æ®åº“useadmin#åˆ›å»ºç”¨æˆ·db.createUser({user:&quot;root&quot;,pwd:&quot;root&quot;,roles:[{role:&quot;root&quot;,db:&quot;admin&quot;}]})CRUDå¦‚æœæ¶‰åŠåˆ°è®¤è¯é—®é¢˜ï¼Œå¿…é¡»åœ¨æ“ä½œä¹‹å‰ç™»é™†db.auth(&quot;è´¦å·&quot;,&quot;å¯†ç &quot;)æ·»åŠ è¯­æ³•ï¼šdb.collection.save(json)db.student.save({name:&quot;å¼ ä¸‰&quot;,sex:&quot;ç”·&quot;,address:&quot;æ¹–åŒ—&quot;})æŸ¥è¯¢æŸ¥è¯¢å…¨éƒ¨è¯­æ³•ï¼šdb.collection.find()db.student.find()#ç»“æœ#{&quot;_id&quot;:ObjectId(&quot;5ece87413b6767c1aa235b37&quot;),&quot;name&quot;:&quot;å¼ ä¸‰&quot;,&quot;sex&quot;:&quot;å¥³&quot;,&quot;address&quot;:&quot;æ¹–åŒ—&quot;}è¿™é‡Œå¤§å®¶ä¼šå‘ç°æ¯æ¡æ–‡æ¡£éƒ½æœ‰ä¸€ä¸ªå«&quot;_id&quot;å­—æ®µï¼Œè¿™ä¸ªç›¸å½“äºmysqlæ•°æ®åº“ä¸­è¡¨çš„ä¸»é”®ï¼Œå½“ä½ åœ¨æ’å…¥è®°å½•çš„æ—¶å€™ï¼Œæ²¡æœ‰æŒ‡å®šè¯¥å­—æ®µï¼Œmongoä¼šè‡ªåŠ¨åˆ›å»ºï¼Œç±»å‹æ˜¯ObjectIdç±»å‹å¦‚æœæˆ‘ä»¬åœ¨æ’å…¥æ–‡æ¡£è®°å½•çš„æ—¶å€™æŒ‡å®šäº†è¯¥å­—æ®µï¼Œå…¶ç±»å‹å¯ä»¥æ˜¯ObjectIdï¼Œä¹Ÿå¯ä»¥æ˜¯mongoæ”¯æŒçš„ä»»æ„æ•°æ®ç±»å‹å¦‚ï¼šdb.student.save({_id:1,name:&quot;å¼ ä¸‰&quot;,sex:15,address:&quot;æ¹–åŒ—&quot;})å¦‚æœ_idçš„å€¼æ˜¯ä¸€æ ·çš„ä¼šè¦†ç›–åŸæœ‰çš„æ•°æ®æ¡ä»¶æŸ¥è¯¢è¯­æ³•ï¼šdb.collection.find({key:&quot;value&quot;})db.student.find({name:&quot;æå››&quot;})æŸ¥è¯¢å•ä¸ªè¯­æ³•ï¼šdb.collection.findOne({key:value})ä¿®æ”¹å®Œå…¨ä¿®æ”¹è¯­æ³•ï¼šdb.collection.update(æ¡ä»¶json,ä¿®æ”¹åçš„json)éƒ¨åˆ†ä¿®æ”¹è¯­æ³•ï¼šdb.collection.update(æ¡ä»¶json,{$set:{key:value,key:value}})åˆ é™¤è¯­æ³•ï¼šdb.collection.remove(jsonæ¡ä»¶)é«˜çº§æŸ¥è¯¢æ¨¡ç³ŠæŸ¥è¯¢è¯­æ³•ï¼šdb.collection.find({key:/value/})æŸ¥è¯¢keyä¸­å¸¦æœ‰valueçš„æ–‡æ¡£æŸ¥è¯¢NULLè¯­æ³•ï¼šdb.collection.find({key:null})æŸ¥è¯¢æ²¡æœ‰keyçš„æ–‡æ¡£æ¯”è¾ƒæŸ¥è¯¢#å¤§äºdb.collection.find({key:{$gt:value}})#å°äºdb.collection.find({key:{$lt:value}})#å¤§äºæˆ–ç­‰äºdb.collection.find({key:{$gte:value}})#å°äºç­‰äºdb.collection.find({key:{$lte:value}})#ä¸ç­‰äºdb.collection.find({key:{$ne:value}})åˆ¤æ–­åŸŸ/å­—æ®µæ˜¯å¦å­˜åœ¨#è¯­æ³•db.collection.find({key:{$exists:true}})#ä¾‹å­ï¼šæŸ¥è¯¢å¸¦æœ‰addressçš„æ–‡æ¡£db.student.find({address:{$exists:true}})#ä¾‹å­ï¼šæŸ¥è¯¢æ²¡æœ‰addressçš„æ–‡æ¡£db.student.find({address:{$exists:false}})åŒ…å«ç±»ä¼¼äºmysqlçš„inè¯­æ³•ï¼šdb.collection.find({key:{$in:[v1,v2,v3,.....]}})ç»Ÿè®¡æ•°é‡è¯­æ³•ï¼šdb.collection.count()æ·»åŠ æ¡ä»¶è¯­æ³•ï¼šdb.collection.count(jsonæ¡ä»¶)é€»è¾‘è¿ç®—ç¬¦å¹¶ä¸”#è¯­æ³•db.collection.find($and:[{k1:v1},{k2:{è¡¨è¾¾å¼:v2}}])#ä¾‹å­ï¼šæŸ¥è¯¢å¹´é¾„å¤§äº10å¹¶ä¸”å°äº20db.student.find($and:[{age:{$gt:10}},{age:{$lt:20}}])æˆ–è€…#è¯­æ³•db.collection.find($or:[{k1:v1},{v2:{è¡¨è¾¾å¼:v2}}])#ä¾‹å­ï¼šæŸ¥è¯¢å¹´é¾„å¤§äº18æˆ–è€…æ€§åˆ«ä¸ºå¥³db.student.find($or:[{age:{$gt:18}},{sex:&quot;å¥³&quot;}])édb.collection.find({key:{$ne:value}})JAVAæ“ä½œMongo1ã€æ·»åŠ ä¾èµ–&lt;!--mongodbå®¢æˆ·ç«¯--&gt;&lt;dependency&gt;&lt;groupId&gt;org.mongodb&lt;/groupId&gt;&lt;artifactId&gt;mongo-java-driver&lt;/artifactId&gt;&lt;version&gt;3.9.1&lt;/version&gt;&lt;/dependency&gt;2ã€è¿æ¥æµ‹è¯•@TestpublicvoidtestConnection(){//åˆ›å»ºè®¤è¯å¯¹è±¡ï¼Œå‚æ•°1ï¼šç”¨æˆ·åã€å‚æ•°2ï¼šæ•°æ®åº“ã€å‚æ•°3ï¼šå¯†ç MongoCredentialcredential=MongoCredential.createCredential(&quot;root&quot;,&quot;admin&quot;,&quot;root&quot;.toCharArray());//åˆ›å»ºmongoå®¢æˆ·ç«¯å¯¹è±¡ï¼Œå‚æ•°1ï¼šæœåŠ¡å™¨åœ°å€ï¼Œå‚æ•°2ï¼šmongodbçš„ç«¯å£å·ServerAddressserverAddress=newServerAddress(&quot;192.168.25.146&quot;,27017);MongoClientclient=newMongoClient(serverAddress,Arrays.asList(credential));//è·å–åˆ°é›†åˆï¼ˆæ•°æ®åº“ï¼‰MongoDatabasedatabase=client.getDatabase(&quot;admin&quot;);//è·å–collectionMongoCollection&lt;Document&gt;student=database.getCollection(&quot;student&quot;);//è·å–åˆ°documenté›†åˆï¼ˆä¸€è¡Œè®°å½•ï¼‰FindIterable&lt;Document&gt;documents=student.find();for(Documentdocument:documents){System.out.println(document.getString(&quot;name&quot;));System.out.println(document.getDouble(&quot;age&quot;));System.out.println(document.getString(&quot;sex&quot;));}}3ã€æ¡ä»¶æŸ¥è¯¢-åŒ¹é…@TestpublicvoidtestFindBasi(){//åˆ›å»ºè®¤è¯å¯¹è±¡ï¼Œå‚æ•°1ï¼šç”¨æˆ·åã€å‚æ•°2ï¼šæ•°æ®åº“ã€å‚æ•°3ï¼šå¯†ç MongoCredentialcredential=MongoCredential.createCredential(&quot;root&quot;,&quot;admin&quot;,&quot;root&quot;.toCharArray());//åˆ›å»ºmongoå®¢æˆ·ç«¯å¯¹è±¡ï¼Œå‚æ•°1ï¼šæœåŠ¡å™¨åœ°å€ï¼Œå‚æ•°2ï¼šmongodbçš„ç«¯å£å·ServerAddressserverAddress=newServerAddress(&quot;192.168.25.146&quot;,27017);MongoClientclient=newMongoClient(serverAddress,Arrays.asList(credential));//è·å–åˆ°é›†åˆï¼ˆæ•°æ®åº“ï¼‰MongoDatabasedatabase=client.getDatabase(&quot;admin&quot;);//è·å–collectionMongoCollection&lt;Document&gt;student=database.getCollection(&quot;student&quot;);/*------------------------------------åˆ›å»ºæŸ¥è¯¢æ¡ä»¶----------------------------------------------*/Map&lt;String,Object&gt;map=newHashMap&lt;&gt;();map.put(&quot;name&quot;,&quot;å¼ ä¸‰&quot;);BasicDBObjectbasicDBObject=newBasicDBObject(map);/*------------------------------------åˆ›å»ºæŸ¥è¯¢æ¡ä»¶----------------------------------------------*///è·å–åˆ°documenté›†åˆï¼ˆä¸€è¡Œè®°å½•ï¼‰FindIterable&lt;Document&gt;documents=student.find(basicDBObject);for(Documentdocument:documents){System.out.println(document.getString(&quot;name&quot;));System.out.println(document.getDouble(&quot;age&quot;));System.out.println(document.getString(&quot;sex&quot;));}}4ã€æ¡ä»¶æŸ¥è¯¢-æ¨¡ç³Šå®Œå…¨åŒ¹é…/*------------------------------------åˆ›å»ºæŸ¥è¯¢æ¡ä»¶----------------------------------------------*/Patternpattern=Pattern.compile(&quot;^å¼ ä¸‰$&quot;);Map&lt;String,Object&gt;map=newHashMap&lt;&gt;();map.put(&quot;name&quot;,pattern);BasicDBObjectbasicDBObject=newBasicDBObject(map);/*------------------------------------åˆ›å»ºæŸ¥è¯¢æ¡ä»¶----------------------------------------------*/å³åŒ¹é…Patternpattern=Pattern.compile(&quot;^å¼ .*$&quot;);å·¦åŒ¹é…Patternpattern=Pattern.compile(&quot;^.*å¼ $&quot;);æ¨¡ç³ŠåŒ¹é…Patternpattern=Pattern.compile(&quot;^.*å¼ .*$&quot;);5ã€æ•°å­—æ¯”è¾ƒ//æŸ¥è¯¢å¹´é¾„å¤§äº10/*------------------------------------åˆ›å»ºæŸ¥è¯¢æ¡ä»¶----------------------------------------------*/BasicDBObjectbasicDBObject=newBasicDBObject(&quot;age&quot;,newBasicDBObject(&quot;$gt&quot;,10));/*------------------------------------åˆ›å»ºæŸ¥è¯¢æ¡ä»¶----------------------------------------------*/6ã€æ¡ä»¶è¿æ¥-å¹¶ä¸”//æŸ¥è¯¢æ€§åˆ«ä¸ºç”·å¹¶ä¸”å¹´é¾„å¤§äº10å²/*------------------------------------åˆ›å»ºæŸ¥è¯¢æ¡ä»¶----------------------------------------------*/BasicDBObjectbasicDBObject1=newBasicDBObject(&quot;sex&quot;,&quot;ç”·&quot;);BasicDBObjectbasicDBObject2=newBasicDBObject(&quot;age&quot;,newBasicDBObject(&quot;$gt&quot;,10));BasicDBObjectbasicDBObject=newBasicDBObject(&quot;$and&quot;,Arrays.asList(basicDBObject1,basicDBObject2));/*------------------------------------åˆ›å»ºæŸ¥è¯¢æ¡ä»¶----------------------------------------------*/7ã€æ¡ä»¶è¿æ¥-æˆ–è€…//æŸ¥è¯¢æ€§åˆ«ä¸ºç”·æˆ–è€…å¹´é¾„å¤§äº20/*------------------------------------åˆ›å»ºæŸ¥è¯¢æ¡ä»¶----------------------------------------------*/BasicDBObjectbasicDBObject1=newBasicDBObject(&quot;sex&quot;,&quot;ç”·&quot;);BasicDBObjectbasicDBObject2=newBasicDBObject(&quot;age&quot;,newBasicDBObject(&quot;$gt&quot;,20));BasicDBObjectbasicDBObject=newBasicDBObject(&quot;$or&quot;,Arrays.asList(basicDBObject1,basicDBObject2));/*------------------------------------åˆ›å»ºæŸ¥è¯¢æ¡ä»¶----------------------------------------------*/8ã€æ·»åŠ //åˆ›å»ºè®¤è¯å¯¹è±¡ï¼Œå‚æ•°1ï¼šç”¨æˆ·åã€å‚æ•°2ï¼šæ•°æ®åº“ã€å‚æ•°3ï¼šå¯†ç MongoCredentialcredential=MongoCredential.createCredential(&quot;root&quot;,&quot;admin&quot;,&quot;root&quot;.toCharArray());//åˆ›å»ºmongoå®¢æˆ·ç«¯å¯¹è±¡ï¼Œå‚æ•°1ï¼šæœåŠ¡å™¨åœ°å€ï¼Œå‚æ•°2ï¼šmongodbçš„ç«¯å£å·ServerAddressserverAddress=newServerAddress(&quot;192.168.25.146&quot;,27017);MongoClientclient=newMongoClient(serverAddress,Arrays.asList(credential));//è·å–åˆ°é›†åˆï¼ˆæ•°æ®åº“ï¼‰MongoDatabasedatabase=client.getDatabase(&quot;admin&quot;);//è·å–collectionMongoCollection&lt;Document&gt;student=database.getCollection(&quot;student&quot;);Map&lt;String,Object&gt;map=newHashMap&lt;&gt;();map.put(&quot;name&quot;,&quot;ç‹äº”&quot;);map.put(&quot;sex&quot;,&quot;ç”·&quot;);map.put(&quot;age&quot;,15);map.put(&quot;address&quot;,&quot;æ¹–å—&quot;);Documentdocument=newDocument(map);student.insertOne(document);9ã€ä¿®æ”¹//æŠŠ_idä¸º1çš„æ–‡æ¡£ä¸­ageä¿®æ”¹ä¸º55publicvoidupdate(){//åˆ›å»ºè®¤è¯å¯¹è±¡ï¼Œå‚æ•°1ï¼šç”¨æˆ·åã€å‚æ•°2ï¼šæ•°æ®åº“ã€å‚æ•°3ï¼šå¯†ç MongoCredentialcredential=MongoCredential.createCredential(&quot;root&quot;,&quot;admin&quot;,&quot;root&quot;.toCharArray());//åˆ›å»ºmongoå®¢æˆ·ç«¯å¯¹è±¡ï¼Œå‚æ•°1ï¼šæœåŠ¡å™¨åœ°å€ï¼Œå‚æ•°2ï¼šmongodbçš„ç«¯å£å·ServerAddressserverAddress=newServerAddress(&quot;192.168.25.146&quot;,27017);MongoClientclient=newMongoClient(serverAddress,Arrays.asList(credential));//è·å–åˆ°é›†åˆï¼ˆæ•°æ®åº“ï¼‰MongoDatabasedatabase=client.getDatabase(&quot;admin&quot;);//è·å–collectionMongoCollection&lt;Document&gt;student=database.getCollection(&quot;student&quot;);//ä¿®æ”¹çš„æ¡ä»¶BasicDBObjectfilter=newBasicDBObject(&quot;_id&quot;,1);//ä¿®æ”¹åçš„åŸŸå’Œå€¼BasicDBObjectupdate=newBasicDBObject(&quot;$set&quot;,newBasicDBObject(&quot;age&quot;,55));student.updateOne(filter,update);}10ã€åˆ é™¤æ–‡æ¡£publicvoiddelete(){//åˆ›å»ºè®¤è¯å¯¹è±¡ï¼Œå‚æ•°1ï¼šç”¨æˆ·åã€å‚æ•°2ï¼šæ•°æ®åº“ã€å‚æ•°3ï¼šå¯†ç MongoCredentialcredential=MongoCredential.createCredential(&quot;root&quot;,&quot;admin&quot;,&quot;root&quot;.toCharArray());//åˆ›å»ºmongoå®¢æˆ·ç«¯å¯¹è±¡ï¼Œå‚æ•°1ï¼šæœåŠ¡å™¨åœ°å€ï¼Œå‚æ•°2ï¼šmongodbçš„ç«¯å£å·ServerAddressserverAddress=newServerAddress(&quot;192.168.25.146&quot;,27017);MongoClientclient=newMongoClient(serverAddress,Arrays.asList(credential));//è·å–åˆ°é›†åˆï¼ˆæ•°æ®åº“ï¼‰MongoDatabasedatabase=client.getDatabase(&quot;admin&quot;);//è·å–collectionMongoCollection&lt;Document&gt;student=database.getCollection(&quot;student&quot;);//åˆ é™¤æ¡ä»¶BasicDBObjectbasicDBObject=newBasicDBObject(&quot;_id&quot;,1);student.deleteOne(basicDBObject);//åˆ é™¤ä¸€ä¸ªstudent.deleteMany(basicDBObject);//åˆ é™¤æ‰€æœ‰æ»¡è¶³æ¡ä»¶çš„}MongoDBå·¥å…·ç±»MongoClientè¢«è®¾è®¡æˆçº¿ç¨‹å®‰å…¨çš„ç±»ï¼ˆå•çº¿ç¨‹ï¼‰ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬åœ¨ä½¿ç”¨è¯¥ç±»çš„æ—¶å€™ä¸ç”¨è€ƒè™‘å¹¶å‘çš„æƒ…å†µï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥è€ƒè™‘å°†mongoClientåšæˆä¸€ä¸ªé™æ€å˜é‡ï¼Œä¸ºæ‰€æœ‰çš„çº¿ç¨‹å…±ç”¨ï¼Œä¸å¿…æ¯æ¬¡éƒ½é”€æ¯ï¼Œè¿™æ ·å°±å¯ä»¥æå¤§çš„æé«˜æ‰§è¡Œçš„æ•ˆç‡ï¼Œå®é™…ä¸Šmongodbæä¾›äº†å†…ç½®çš„è¿æ¥æ± æ¥å®ç°packagecom.mongo.util;importcom.mongodb.*;importcom.mongodb.client.MongoDatabase;importjava.util.Arrays;/***@program:mongodb*@author:æ½˜*@create:2020-05-2812:57**/publicclassMongoManager{privatestaticMongoClientclient=null;privatestaticvoidinit(){MongoCredentialcredential=MongoCredential.createCredential(&quot;root&quot;,&quot;admin&quot;,&quot;root&quot;.toCharArray());ServerAddressserverAddress=newServerAddress(&quot;192.168.25.146&quot;,27017);//é€‰é¡¹æ„é€ è€…MongoClientOptions.Builderbuilder=newMongoClientOptions.Builder();//è¯»å–æ•°æ®çš„è¶…æ—¶æ—¶é—´builder.socketTimeout(5000);//æ¯ä¸ªåœ°å€æœ€å¤§è¯·æ±‚æ•°builder.connectionsPerHost(30);//å†™å…¥çš„ç­–ç•¥,ä»…ä»…æŠ›å‡ºç½‘ç»œå¼‚å¸¸builder.writeConcern(WriteConcern.NORMAL);MongoClientOptionsoptions=builder.build();client=newMongoClient(serverAddress,Arrays.asList(credential),options);}publicstaticMongoDatabasegetDatabase(Stringdb){if(client==null){init();}returnclient.getDatabase(db);}}daopublicclassStudentDao{publicvoidsave(Stringname,Stringsex,doubleage,Stringaddress){//2.è·å–æ•°æ®åº“(æ•°æ®åº“)MongoDatabasedatabase=MongoManager.getDatabase(&quot;admin&quot;);//3.è·å–åˆ°collection(è¡¨)MongoCollection&lt;Document&gt;collection=database.getCollection(&quot;student&quot;);//4.å‡†å¤‡è¦æ·»åŠ çš„æ•°æ®Map&lt;String,Object&gt;map=newHashMap&lt;String,Object&gt;();map.put(&quot;name&quot;,name);map.put(&quot;sex&quot;,sex);map.put(&quot;age&quot;,age);map.put(&quot;address&quot;,address);Documentdocument=newDocument(map);//5.æ·»åŠ æ•°æ®collection.insertOne(document);}}","link":"https://haohanya.github.io/post/mongodb/"},{"title":"Docker","content":"Dockerå®‰è£…Docker1ã€ä½¿ç”¨yumå‘½ä»¤åœ¨çº¿å®‰è£…yuminstalldocker#é‡äº‹ä¸å†³å°±é€‰y2ã€æŸ¥çœ‹dockerç‰ˆæœ¬docker-v3ã€å¯åŠ¨ä¸åœæ­¢systemctlå‘½ä»¤æ˜¯ç³»ç»ŸæœåŠ¡ç®¡ç†å™¨æŒ‡ä»¤ï¼Œå®ƒæ˜¯serviceå’Œchkconfigä¸¤ä¸ªå‘½ä»¤ç»„åˆ#å¯åŠ¨dockersystemctlstartdocker#åœæ­¢dockersystemctlstopdocker#é‡å¯dockersystemctlrestartdocker#æŸ¥çœ‹dockerçŠ¶æ€systemctlstatusdocker#å¼€æœºè‡ªå¯systemctlenabledocker#æŸ¥çœ‹dockeræ¦‚è¦ä¿¡æ¯dockerinfo#æŸ¥çœ‹dockerå¸®åŠ©æ–‡æ¡£docker--infoDockeré•œåƒæ“ä½œ1ã€åˆ—å‡ºé•œåƒdockerimages#REPOSITORYé•œåƒæ‰€åœ¨çš„ä»“åº“åç§°#TAGé•œåƒæ ‡ç­¾ï¼ˆç‰ˆæœ¬å·ï¼‰#IMAGEIDé•œåƒID#CREATEé•œåƒåˆ›å»ºçš„æ—¶é—´ï¼ˆä»“åº“ä¸­åˆ›å»ºçš„æ—¶é—´ï¼‰#SIZEé•œåƒå¤§å°2ã€æœç´¢é•œåƒdockersearché•œåƒåç§°#INDEX#NAMEä»“åº“åç§°#DESCRIPTIONé•œåƒæè¿°#STARSç”¨æˆ·è¯„ä»·ï¼Œååº”ä¸€ä¸ªé•œåƒçš„å—æ¬¢è¿ç¨‹åº¦#OFFICIALæ˜¯å¦æ˜¯å®˜æ–¹#AUTOMATEDè‡ªåŠ¨æ„å»ºï¼Œè¡¨ç¤ºè¯¥é•œåƒç”±DockerHubè‡ªåŠ¨æ„å»ºæµç¨‹åˆ›å»ºçš„3ã€æ‹‰å–é•œåƒä»DockerHubä¸Šæ‹‰å–dockerpullcentos:7ustcçš„é•œåƒhttps://lug.ustc.edu.cn/wiki/mirrors/help/dockeré˜¿é‡Œäº‘é•œåƒ1ã€è¿›å…¥é˜¿é‡Œäº‘https://cr.console.aliyun.com/cn-hangzhou/instances/mirrors2ã€å¾—åˆ°é•œåƒURLå¹¶ä¿®æ”¹daemon.json3ã€é‡å¯daemonsystemctldaemon-reload4ã€é‡å¯dockeræœåŠ¡systemctlrestartdockerä¿®æ”¹daemon.json1ã€ç¼–è¾‘æ–‡ä»¶vi/etc/docker/daemon.json2ã€ä¿®æ”¹æ–‡ä»¶å†…å®¹{&quot;registry-mirrors&quot;:[&quot;https://docker.mirrors.ustc.edu.cn&quot;]}3ã€é‡å¯4ã€åˆ é™¤é•œåƒ#åˆ é™¤æŒ‡å®šé•œåƒdockerrmi$IMAGE_ID#åˆ é™¤æ‰€æœ‰é•œåƒdockerrmi`dockerimages-q`Dockerå®¹å™¨æ“ä½œ1ã€æŸ¥çœ‹å®¹å™¨#æŸ¥çœ‹æ­£åœ¨è¿è¡Œçš„å®¹å™¨dockerps#æŸ¥çœ‹è¿è¡Œè¿‡çš„å®¹å™¨dockerps-a#æŸ¥çœ‹æœ€åä¸€æ¬¡è¿è¡Œçš„å®¹å™¨dockerps-i#æŸ¥çœ‹åœæ­¢çš„å®¹å™¨dockerps-fstatus=exited2ã€åˆ›å»ºä¸å¯åŠ¨å®¹å™¨åˆ›å»ºå®¹å™¨å¸¸ç”¨çš„å‚æ•°è¯´æ˜dockerrunåˆ›å»ºå®¹å™¨å‘½ä»¤-iè¿è¡Œè¯¥å®¹å™¨-tè¡¨ç¤ºå®¹å™¨å¯åŠ¨åä¼šè¿›å…¥å…¶å‘½ä»¤è¡Œã€‚åŠ å…¥è¿™ä¸¤ä¸ªå‚æ•°åï¼Œå®¹å™¨åˆ›å»ºå°±èƒ½ç™»å½•è¿›å»ã€‚å³åˆ†é…ä¸€ä¸ªä¼ªç»ˆç«¯ã€‚--nameä¸ºåˆ›å»ºçš„å®¹å™¨å‘½å-vè¡¨ç¤ºç›®å½•æ˜ å°„å…³ç³»ï¼ˆå‰è€…æ˜¯å®¿ä¸»æœºç›®å½•ï¼Œåè€…æ˜¯æ˜ å°„åˆ°å®¿ä¸»æœºä¸Šçš„ç›®å½•ï¼‰ï¼Œå¯ä»¥ä½¿ç”¨å¤šä¸ªï¼våšå¤šä¸ªç›®å½•æˆ–æ–‡ä»¶æ˜ å°„ã€‚æ³¨æ„ï¼šæœ€å¥½åšç›®å½•æ˜ å°„ï¼Œåœ¨å®¿ä¸»æœºä¸Šåšä¿®æ”¹ï¼Œç„¶åå…±äº«åˆ°å®¹å™¨ä¸Šã€‚-dåœ¨runåé¢åŠ ä¸Š-då‚æ•°åˆ™ä¼šåˆ›å»ºä¸€ä¸ªå®ˆæŠ¤å¼å®¹å™¨åœ¨åå°è¿è¡Œï¼ˆè¿™æ ·åˆ›å»ºå®¹å™¨åä¸ä¼šè‡ªåŠ¨ç™»é™†å®¹å™¨ï¼Œå¦‚æœåªåŠ -i-tä¸¤ä¸ªå‚æ•°ï¼Œåˆ›å»ºåå°±ä¼šè‡ªåŠ¨è¿›å…¥å®¹å™¨ï¼‰-pç«¯å£æ˜ å°„ï¼Œå‰è€…æ˜¯å®¿ä¸»æœºç«¯å£ï¼Œåè€…æ˜¯å®¹å™¨å†…çš„æ˜ å°„ç«¯å£ï¼Œå¯ä»¥ä½¿ç”¨å¤šä¸ª-påšå¤šä¸ªç«¯å£æ˜ å°„äº¤äº’å¼å®¹å™¨åˆ›å»ºä¸€ä¸ªäº¤äº’å¼å®¹å™¨å¹¶å‘½åä¸ºï¼šmycentosdockerrun-it--name=mycentoscentos:7/bin/bashä½¿ç”¨exitå‘½ä»¤é€€å‡ºå½“å‰å®¹å™¨åˆ›å»ºå®ˆæŠ¤å¼å®¹å™¨åˆ›å»ºä¸€ä¸ªå®ˆæŠ¤å¼å®¹å™¨ï¼šå¦‚æœå¯¹äºä¸€ä¸ªéœ€è¦é•¿æœŸè¿è¡Œçš„å®¹å™¨æ¥è¯´ï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªå®ˆæŠ¤å¼å®¹å™¨ã€‚å‘½ä»¤å¦‚ä¸‹ï¼ˆå®¹å™¨åç§°ä¸èƒ½é‡å¤ï¼‰dockerrun-id--name=mycentos2centos:7ç™»é™†å®ˆæŠ¤å¼å®¹å™¨dockerexec-itcontainer_name(æˆ–è€…container_id)/bin/bash(exité€€å‡ºæ—¶å®¹å™¨ä¸ä¼šåœæ­¢)3ã€åœæ­¢ä¸å¯åŠ¨å®¹å™¨#åœæ­¢æ­£åœ¨è¿è¡Œçš„å®¹å™¨dockerstop$CONTAINER_NAME/ID#è¿è¡Œå·²åœæ­¢çš„å®¹å™¨dockerstart$CONTAINER_NAME/ID4ã€æ–‡ä»¶æ‹·è´#å°†æ–‡ä»¶æ‹·è´åˆ°å®¹å™¨å†…dockercpå®¿ä¸»æœºå†…è¦æ‹·è´çš„æ–‡ä»¶æˆ–ç›®å½•å®¹å™¨åç§°:æ‹·è´åˆ°å®¹å™¨ç›®å½•#å°†å®¹å™¨å†…çš„æ–‡ä»¶æ‹·è´å‡ºæ¥dockercpå®¹å™¨åç§°:å®¹å™¨è¦æ‹·è´å‡ºå¼€çš„æ–‡ä»¶æˆ–ç›®å½•æ‹·è´åˆ°å®¿ä¸»æœºé‚£ä¸ªç›®å½•5ã€ç›®å½•æŒ‚è½½æˆ‘ä»¬å¯ä»¥åœ¨åˆ›å»ºå®¹å™¨çš„æ—¶å€™ï¼Œå°†å®¿ä¸»æœºçš„ç›®å½•ä¸å®¹å™¨å†…çš„ç›®å½•è¿›è¡Œæ˜ å°„ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥é€šè¿‡ä¿®æ”¹å®¿ä¸»æœºæŸä¸ªç›®å½•çš„æ–‡ä»¶ä»è€Œå»å½±å“å®¹å™¨ã€‚åˆ›å»ºå®¹å™¨æ·»åŠ -vå‚æ•°åè¾¹ä¸ºå®¿ä¸»æœºç›®å½•:å®¹å™¨ç›®å½•å¦‚æœå…±äº«å¤šçº§ç›®å½•å¯èƒ½ä¼šå‡ºç°æƒé™ä¸è¶³çš„æƒ…å†µè¿™æ˜¯å› ä¸ºCentOS7ä¸­çš„å®‰å…¨æ¨¡å—selinuxæŠŠæƒé™ç¦æ‰äº†ï¼Œæˆ‘ä»¬éœ€è¦æ·»åŠ å‚æ•°--privileged=trueæ¥è§£å†³æŒ‚è½½çš„ç›®å½•æ²¡æœ‰æƒé™çš„é—®é¢˜dockerrun-di-v/usr/test:/usr/test--name=mycentoscentos:76ã€æŸ¥çœ‹å®¹å™¨IPåœ°å€#å¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹å®¹å™¨è¿è¡Œçš„å„ç§æ•°æ®dockerinspectcontainer_name#ä¹Ÿå¯ä»¥ç›´æ¥æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ç›´æ¥è¾“å‡ºIPåœ°å€dockerinspect--format='{{.NetworkSettings.IPAddress}}'container_name7ã€åˆ é™¤å®¹å™¨#åˆ é™¤æŒ‡å®šå®¹å™¨dockerrmcontainer_id/name#åˆ é™¤æ‰€æœ‰å®¹å™¨ï¼ˆä»¥åœæ­¢è¿è¡Œçš„ï¼‰dockerrm`dockerps-a-q`éƒ¨ç½²åº”ç”¨MySQLéƒ¨ç½²1ã€æ‹‰å–MySQLé•œåƒdockerpullmysql2ã€åˆ›å»ºMySQLå®¹å™¨#-på®¿ä¸»æœºæ˜ å°„ç«¯å£:å®¹å™¨è¿è¡Œç«¯å£#-eè¡¨ç¤ºæ·»åŠ ç¯å¢ƒå˜é‡ï¼ŒMYSQL_ROOT_PASSWORDä¸ºrootç”¨æˆ·çš„ç™»é™†å¯†ç dockerrun-di--name=jd_mysql-p33306:3306-eMYSQL_ROOT_PASSWORD=rootmysql3ã€è¿›å…¥MySQLå®¹å™¨dockerexec-itjd_mysql/bin/bash4ã€ç™»é™†MySQL#-uç”¨æˆ·åï¼Œ-uåé¢éœ€è¦æ‰“ç©ºæ ¼#-på¯†ç ï¼Œ-påé¢æ²¡æœ‰ç©ºæ ¼,åŠ äº†ç©ºæ ¼ä¼šå†è¾“å…¥ä¸€éå¯†ç mysql-uroot-proot5ã€é€€å‡ºMySQL#é€€å‡ºmysqlquit#é€€å‡ºå®¹å™¨exitTomcatéƒ¨ç½²1ã€æ‹‰å–Tomcaté•œåƒdockerpulltomcat:7-jre72ã€åˆ›å»ºtomcatå®¹å™¨åˆ›å»ºå®¹å™¨ç”¨äºéƒ¨ç½²å•ç‚¹ç™»å½•ç³»ç»Ÿï¼ˆCASï¼‰-pè¡¨ç¤ºåœ°å€æ˜ å°„dockerrun-di--name=jd_tomcat-p9100:8080-v/usr/local/webapps:/usr/local/tomcat/webapps--privileged=truetomcat:7-jre73ã€è®¿é—®ip:9100/casç™»é™†æµ‹è¯•ï¼Œå¦‚æœå‡ºç°Invalidcredentialsé‡å¯.dockerrestartjd_tomcatnginxéƒ¨ç½²1ã€æ‹‰å–é•œåƒdockerpullnginx2ã€åˆ›å»ºå®¹å™¨dockerrun-di--name=mynginx-p80:80nginx/bin/bash3ã€æµ‹è¯•æ— æ³•è®¿é—®éœ€è¦æ‰‹åŠ¨å¯åŠ¨nginxdockerexec-itjd_nginx/bin/bash/etc/init.d/nginxstart4ã€ç¼–è¾‘é…ç½®æ–‡ä»¶#å°†nginxé…ç½®æ–‡ä»¶å¤åˆ¶å‡ºæ¥dockercpjd_nginx:/etc/nginx/nginx.confnginx.conf#ä¿®æ”¹nginx.conf.......#å°†æ–‡ä»¶æ‹·è´åˆ°å®¹å™¨dockercpnginx.confjd_nginx:/etc/nginx/nginx.conf#é‡å¯å®¹å™¨dockerrestartjd_nginxRediséƒ¨ç½²1ã€æ‹‰å–é•œåƒdockerpullredis2ã€åˆ›å»ºå®¹å™¨dockerrun-di--name=jd_redis-p6379:6379redis3ã€æµ‹è¯•è¿æ¥redisDesktopå¤‡ä»½ä¸è¿ç§»1ã€å°†å®¹å™¨ä¿å­˜ä¸ºé•œåƒdockercommitjd_nginxmynginxjd_nginxï¼šå®¹å™¨åç§°mynginxï¼šæ–°é•œåƒåç§°2ã€é•œåƒå¤‡ä»½dockersave-omynginx.tarmynginx-oï¼šè¾“å‡ºåˆ°çš„æ–‡ä»¶3ã€é•œåƒæ¢å¤ä¸è¿ç§»dockerload-imynginx.tar-iï¼šè¾“å…¥çš„æ–‡ä»¶","link":"https://haohanya.github.io/post/docker/"},{"title":"Redis-Cluster","content":"æ­å»ºRedis-Clusteræ­å»ºè¦æ±‚éœ€è¦6å°redisæœåŠ¡å™¨ã€‚æ­å»ºä¼ªé›†ç¾¤ã€‚éœ€è¦6ä¸ªrediså®ä¾‹ã€‚éœ€è¦è¿è¡Œåœ¨ä¸åŒçš„ç«¯å£7001-7006å‡†å¤‡å·¥ä½œ1ã€å®‰è£…gccyuminstallgcc-c++2ã€ä½¿ç”¨yumå‘½ä»¤å®‰è£…rubyï¼ˆæˆ‘ä»¬éœ€è¦ä½¿ç”¨rubyè„šæœ¬æ¥å®ç°é›†ç¾¤æ­å»ºï¼‰yuminstallrubyyuminstallrubygemsä»¥ä¸Šä¸¤æ­¥é‡åˆ°é€‰æ‹©y/Nç›´æ¥å¡«yå³å¯3ã€å°†redisæºç åŒ…ä¸Šä¼ åˆ°linuxç³»ç»Ÿï¼Œè§£å‹redisæºç åŒ…tar-zxvfredis-3.0.0.tar.gz4ã€ç¼–è¯‘redisæºç ï¼Œè¿›å…¥redisæºç æ–‡ä»¶å¤¹cdredis-3.0.0make5ã€åˆ›å»ºç›®å½•/usr/local/redis-clusterç›®å½•ï¼Œå®‰è£…6ä¸ªrediså®ä¾‹ï¼Œåˆ†åˆ«å®‰è£…åœ¨ä»¥ä¸‹ç›®å½•mkdir/usr/local/redis-clustercdredis-3.0.0makeinstallPREFIX=/usr/local/redis-cluster/redis-1......makeinstallPREFIX=/usr/local/redis-cluster/redis-66ã€å¤åˆ¶é…ç½®æ–‡ä»¶å°†/redis-3.0.0/redis.confå¤åˆ¶åˆ°redisä¸‹çš„binç›®å½•ä¸‹cpredis.conf/usr/local/redis-cluster/redis-1/bin......cpredis.conf/usr/local/redis-cluster/redis-6/biné…ç½®é›†ç¾¤1ã€ä¿®æ”¹æ¯ä¸ªredisèŠ‚ç‚¹çš„é…ç½®æ–‡ä»¶redis.confä¿®æ”¹è¿è¡Œç«¯å£ä¸º7001ï¼ˆ70027003.....ï¼‰(45è¡Œ)å°†cluster-enabledyeså‰çš„æ³¨é‡Šå»æ‰(632è¡Œ)daemonizenoæ”¹ä¸ºyesï¼ˆ43è¡Œï¼‰cd/usr/local/redis-cluster/viredis-1/bin/redis.conf......viredis-6/bin/redis.conf2ã€å¯åŠ¨æ¯ä¸ªrediså®ä¾‹cdredis-1/bin/./redis-serverredis.conf.......3ã€ä¸Šä¼ redis-3.0.0.gemï¼Œå®‰è£…rubyç”¨äºæ­å»ºredisé›†ç¾¤çš„è„šæœ¬ã€‚cd~cpredis-3.0.0.gem/usr/local/redis-cluster/cdredis-3.0.0/src/cpredis-trib.rb/usr/local/redis-cluster/cd/usr/local/redis-cluster/geminstallredis-3.0.0.gem4ã€ä½¿ç”¨rubyè„šæœ¬æ­å»ºé›†ç¾¤ã€‚è¿›å…¥redisæºç ç›®å½•ä¸­çš„srcç›®å½•æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤./redis-trib.rbcreate--replicas1192.168.25.144:7001192.168.25.144:7002192.168.25.144:7003192.168.25.144:7004192.168.25.144:7005192.168.25.144:70065ã€æŸ¥çœ‹æ˜¯å¦å¯åŠ¨æˆåŠŸps-ef|grepredisSpringDataRedisè¿æ¥Redisé›†ç¾¤&lt;?xmlversion=&quot;1.0&quot;encoding=&quot;UTF-8&quot;?&gt;&lt;beansxmlns=&quot;http://www.springframework.org/schema/beans&quot;xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;xmlns:p=&quot;http://www.springframework.org/schema/p&quot;xmlns:context=&quot;http://www.springframework.org/schema/context&quot;xsi:schemaLocation=&quot;http://www.springframework.org/schema/beanshttp://www.springframework.org/schema/beans/spring-beans.xsdhttp://www.springframework.org/schema/contexthttp://www.springframework.org/schema/context/spring-context.xsd&quot;&gt;&lt;!--åŠ è½½é…ç½®å±æ€§æ–‡ä»¶--&gt;&lt;context:property-placeholderignore-unresolvable=&quot;true&quot;location=&quot;classpath:properties/redis-cluster-config.properties&quot;/&gt;&lt;beanid=&quot;redis-clusterConfiguration&quot;class=&quot;org.springframework.data.redis.connection.redis-clusterConfiguration&quot;&gt;&lt;propertyname=&quot;maxRedirects&quot;value=&quot;${redis.maxRedirects}&quot;&gt;&lt;/property&gt;&lt;propertyname=&quot;clusterNodes&quot;&gt;&lt;set&gt;&lt;beanclass=&quot;org.springframework.data.redis.connection.redis-clusterNode&quot;&gt;&lt;constructor-argname=&quot;host&quot;value=&quot;${redis.host1}&quot;&gt;&lt;/constructor-arg&gt;&lt;constructor-argname=&quot;port&quot;value=&quot;${redis.port1}&quot;&gt;&lt;/constructor-arg&gt;&lt;/bean&gt;&lt;beanclass=&quot;org.springframework.data.redis.connection.redis-clusterNode&quot;&gt;&lt;constructor-argname=&quot;host&quot;value=&quot;${redis.host2}&quot;&gt;&lt;/constructor-arg&gt;&lt;constructor-argname=&quot;port&quot;value=&quot;${redis.port2}&quot;&gt;&lt;/constructor-arg&gt;&lt;/bean&gt;&lt;beanclass=&quot;org.springframework.data.redis.connection.redis-clusterNode&quot;&gt;&lt;constructor-argname=&quot;host&quot;value=&quot;${redis.host3}&quot;&gt;&lt;/constructor-arg&gt;&lt;constructor-argname=&quot;port&quot;value=&quot;${redis.port3}&quot;&gt;&lt;/constructor-arg&gt;&lt;/bean&gt;&lt;beanclass=&quot;org.springframework.data.redis.connection.redis-clusterNode&quot;&gt;&lt;constructor-argname=&quot;host&quot;value=&quot;${redis.host4}&quot;&gt;&lt;/constructor-arg&gt;&lt;constructor-argname=&quot;port&quot;value=&quot;${redis.port4}&quot;&gt;&lt;/constructor-arg&gt;&lt;/bean&gt;&lt;beanclass=&quot;org.springframework.data.redis.connection.redis-clusterNode&quot;&gt;&lt;constructor-argname=&quot;host&quot;value=&quot;${redis.host5}&quot;&gt;&lt;/constructor-arg&gt;&lt;constructor-argname=&quot;port&quot;value=&quot;${redis.port5}&quot;&gt;&lt;/constructor-arg&gt;&lt;/bean&gt;&lt;beanclass=&quot;org.springframework.data.redis.connection.redis-clusterNode&quot;&gt;&lt;constructor-argname=&quot;host&quot;value=&quot;${redis.host6}&quot;&gt;&lt;/constructor-arg&gt;&lt;constructor-argname=&quot;port&quot;value=&quot;${redis.port6}&quot;&gt;&lt;/constructor-arg&gt;&lt;/bean&gt;&lt;/set&gt;&lt;/property&gt;&lt;/bean&gt;&lt;beanid=&quot;jedisPoolConfig&quot;class=&quot;redis.clients.jedis.JedisPoolConfig&quot;&gt;&lt;propertyname=&quot;maxIdle&quot;value=&quot;${redis.maxIdle}&quot;/&gt;&lt;propertyname=&quot;maxTotal&quot;value=&quot;${redis.maxTotal}&quot;/&gt;&lt;/bean&gt;&lt;beanid=&quot;jeidsConnectionFactory&quot;class=&quot;org.springframework.data.redis.connection.jedis.JedisConnectionFactory&quot;&gt;&lt;constructor-argref=&quot;redis-clusterConfiguration&quot;/&gt;&lt;constructor-argref=&quot;jedisPoolConfig&quot;/&gt;&lt;/bean&gt;&lt;beanid=&quot;redisTemplate&quot;class=&quot;org.springframework.data.redis.core.RedisTemplate&quot;&gt;&lt;propertyname=&quot;connectionFactory&quot;ref=&quot;jeidsConnectionFactory&quot;/&gt;&lt;/bean&gt;&lt;/beans&gt;redis-cluster-config.propertiesredis.host1=192.168.25.140redis.port1=7001redis.host2=192.168.25.140redis.port2=7002redis.host3=192.168.25.140redis.port3=7003redis.host4=192.168.25.140redis.port4=7004redis.host5=192.168.25.140redis.port5=7005redis.host6=192.168.25.140redis.port6=7006redis.maxRedirects=3redis.maxIdle=100redis.maxTotal=600æ¨¡æ‹Ÿé›†ç¾¤å¼‚å¸¸æµ‹è¯•å…³é—­èŠ‚ç‚¹å‘½ä»¤./redis-cli-pç«¯å£shutdownæµ‹è¯•å…³é—­7001å’Œ7004,çœ‹çœ‹ä¼šå‘ç”Ÿä»€ä¹ˆã€‚æµ‹è¯•å…³é—­7001ã€7002ã€7003ä¼šå‘ç”Ÿä»€ä¹ˆã€‚","link":"https://haohanya.github.io/post/redis-cluster/"},{"title":" Zookeeper-Cluster","content":"æŸ¥çœ‹tomcatè¿è¡Œæ—¥å¿—ï¼štail-flogs/catalina.outZooKeeperå®‰è£…å®˜ç½‘ä¸‹è½½ï¼šhttp://zookeeper.apache.org/releases.htmlç¬¬ä¸€æ¬¡å¯åŠ¨ä¼šå‡ºç°é”™è¯¯è§£å†³æ–¹æ¡ˆï¼šæŠŠconfç›®å½•ä¸‹çš„zoo_sample.cfgå¤åˆ¶ä¸€ä»½ï¼Œå¹¶æ”¹åä¸ºzoo.cfgåœ¨zookeeperæ ¹ç›®å½•æ–°å»ºä¸€ä¸ªdataç›®å½•ä¿®æ”¹zoo.cfgé‡Œé¢çš„dataDir=/tmp/zookeeperä¿®æ”¹ä¸ºï¼š../dataæœåŠ¡æä¾›è€…&lt;!--ä½¿ç”¨dubboæš´æ¼æœåŠ¡--&gt;&lt;dubbo:protocolname=&quot;dubbo&quot;port=&quot;20881&quot;/&gt;&lt;!--å°†å·¥ç¨‹æ³¨å†Œåˆ°dubboä¸­--&gt;&lt;dubbo:applicationname=&quot;jd-sellergoods-service&quot;/&gt;&lt;!--æ³¨å†Œä¸­å¿ƒåœ°å€--&gt;&lt;dubbo:registryaddress=&quot;zookeeper://192.168.25.128:2181&quot;/&gt;&lt;!--å¼€å¯æ³¨è§£å¼€å‘--&gt;&lt;dubbo:annotationpackage=&quot;com.jd.service.impl&quot;/&gt;æœåŠ¡æ¶ˆè´¹è€…&lt;!--å¼•ç”¨dubboæœåŠ¡--&gt;&lt;dubbo:applicationname=&quot;jd-sellergoods-web&quot;/&gt;&lt;dubbo:registryaddress=&quot;zookeeper://192.168.25.128:2181&quot;timeout=&quot;30000&quot;/&gt;&lt;dubbo:annotationpackage=&quot;com.jd.controller&quot;/&gt;Zookeeperé›†ç¾¤ç®€ä»‹ä¸ºä»€ä¹ˆæ­å»ºZookeeperé›†ç¾¤å¤§éƒ¨åˆ†åˆ†å¸ƒå¼åº”ç”¨éœ€è¦ä¸€ä¸ªä¸»æ§ã€åè°ƒå™¨æˆ–è€…æ§åˆ¶å™¨æ¥ç®¡ç†ç‰©ç†åˆ†å¸ƒçš„å­è¿›ç¨‹ã€‚ç›®å‰ï¼Œå¤§å¤šæ•°éƒ½è¦å¼€å‘ç§æœ‰çš„åè°ƒç¨‹åºï¼Œç¼ºä¹ä¸€ä¸ªé€šç”¨æœºåˆ¶ï¼Œåè°ƒç¨‹åºçš„åå¤ç¼–å†™æµªè´¹ï¼Œä¸”éš¾ä»¥å½¢æˆé€šç”¨ã€ä¼¸ç¼©æ€§å¥½çš„åè°ƒå™¨ï¼Œzookeeperæä¾›é€šç”¨çš„åˆ†å¸ƒå¼é”æœåŠ¡ï¼Œç”¨ä»¥åè°ƒåˆ†å¸ƒå¼åº”ç”¨ã€‚æ‰€ä»¥è¯´zookeeperæ˜¯åˆ†å¸ƒå¼åº”ç”¨çš„åä½œæœåŠ¡ã€‚zookeeperä½œä¸ºæ³¨å†Œä¸­å¿ƒï¼ŒæœåŠ¡å™¨å’Œå®¢æˆ·ç«¯éƒ½è¦è®¿é—®ï¼Œå¦‚æœæœ‰å¤§é‡çš„å¹¶å‘ï¼Œè‚¯å®šä¼šæœ‰ç­‰å¾…ã€‚æ‰€ä»¥å¯ä»¥é€šè¿‡zookeeperé›†ç¾¤è§£å†³ã€‚ä¸‹é¢æ˜¯zookeeperé›†ç¾¤éƒ¨ç½²ç»“æ„å›¾ï¼šäº†è§£Leaderé€‰ä¸¾Zookeeperçš„å¯åŠ¨è¿‡ç¨‹ä¸­leaderé€‰ä¸¾æ˜¯éå¸¸é‡è¦è€Œä¸”æœ€å¤æ‚çš„ä¸€ä¸ªç¯èŠ‚ã€‚é‚£ä¹ˆä»€ä¹ˆæ˜¯leaderé€‰ä¸¾å‘¢ï¼Ÿzookeeperä¸ºä»€ä¹ˆéœ€è¦leaderé€‰ä¸¾å‘¢ï¼Ÿzookeeperçš„leaderé€‰ä¸¾çš„è¿‡ç¨‹åˆæ˜¯ä»€ä¹ˆæ ·å­çš„ï¼Ÿé¦–å…ˆæˆ‘ä»¬æ¥çœ‹çœ‹ä»€ä¹ˆæ˜¯leaderé€‰ä¸¾ã€‚å…¶å®è¿™ä¸ªå¾ˆå¥½ç†è§£ï¼Œleaderé€‰ä¸¾å°±åƒæ€»ç»Ÿé€‰ä¸¾ä¸€æ ·ï¼Œæ¯äººä¸€ç¥¨ï¼Œè·å¾—å¤šæ•°ç¥¨çš„äººå°±å½“é€‰ä¸ºæ€»ç»Ÿäº†ã€‚åœ¨zookeeperé›†ç¾¤ä¸­ä¹Ÿæ˜¯ä¸€æ ·ï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½ä¼šæŠ•ç¥¨ï¼Œå¦‚æœæŸä¸ªèŠ‚ç‚¹è·å¾—è¶…è¿‡åŠæ•°ä»¥ä¸Šçš„èŠ‚ç‚¹çš„æŠ•ç¥¨ï¼Œåˆ™è¯¥èŠ‚ç‚¹å°±æ˜¯leaderèŠ‚ç‚¹äº†ã€‚ä»¥ä¸€ä¸ªç®€å•çš„ä¾‹å­æ¥è¯´æ˜æ•´ä¸ªé€‰ä¸¾çš„è¿‡ç¨‹.å‡è®¾æœ‰äº”å°æœåŠ¡å™¨ç»„æˆçš„zookeeperé›†ç¾¤,å®ƒä»¬çš„idä»1-5,åŒæ—¶å®ƒä»¬éƒ½æ˜¯æœ€æ–°å¯åŠ¨çš„,ä¹Ÿå°±æ˜¯æ²¡æœ‰å†å²æ•°æ®,åœ¨å­˜æ”¾æ•°æ®é‡è¿™ä¸€ç‚¹ä¸Š,éƒ½æ˜¯ä¸€æ ·çš„.å‡è®¾è¿™äº›æœåŠ¡å™¨ä¾åºå¯åŠ¨,æ¥çœ‹çœ‹ä¼šå‘ç”Ÿä»€ä¹ˆã€‚1)æœåŠ¡å™¨1å¯åŠ¨,æ­¤æ—¶åªæœ‰å®ƒä¸€å°æœåŠ¡å™¨å¯åŠ¨äº†,å®ƒå‘å‡ºå»çš„æŠ¥æ²¡æœ‰ä»»ä½•å“åº”,æ‰€ä»¥å®ƒçš„é€‰ä¸¾çŠ¶æ€ä¸€ç›´æ˜¯LOOKINGçŠ¶æ€2)æœåŠ¡å™¨2å¯åŠ¨,å®ƒä¸æœ€å¼€å§‹å¯åŠ¨çš„æœåŠ¡å™¨1è¿›è¡Œé€šä¿¡,äº’ç›¸äº¤æ¢è‡ªå·±çš„é€‰ä¸¾ç»“æœ,ç”±äºä¸¤è€…éƒ½æ²¡æœ‰å†å²æ•°æ®,æ‰€ä»¥idå€¼è¾ƒå¤§çš„æœåŠ¡å™¨2èƒœå‡º,ä½†æ˜¯ç”±äºæ²¡æœ‰è¾¾åˆ°è¶…è¿‡åŠæ•°ä»¥ä¸Šçš„æœåŠ¡å™¨éƒ½åŒæ„é€‰ä¸¾å®ƒ(è¿™ä¸ªä¾‹å­ä¸­çš„åŠæ•°ä»¥ä¸Šæ˜¯3),æ‰€ä»¥æœåŠ¡å™¨1,2è¿˜æ˜¯ç»§ç»­ä¿æŒLOOKINGçŠ¶æ€.3)æœåŠ¡å™¨3å¯åŠ¨,æ ¹æ®å‰é¢çš„ç†è®ºåˆ†æ,æœåŠ¡å™¨3æˆä¸ºæœåŠ¡å™¨1,2,3ä¸­çš„è€å¤§,è€Œä¸ä¸Šé¢ä¸åŒçš„æ˜¯,æ­¤æ—¶æœ‰ä¸‰å°æœåŠ¡å™¨é€‰ä¸¾äº†å®ƒ,æ‰€ä»¥å®ƒæˆä¸ºäº†è¿™æ¬¡é€‰ä¸¾çš„leader.4)æœåŠ¡å™¨4å¯åŠ¨,æ ¹æ®å‰é¢çš„åˆ†æ,ç†è®ºä¸ŠæœåŠ¡å™¨4åº”è¯¥æ˜¯æœåŠ¡å™¨1,2,3,4ä¸­æœ€å¤§çš„,ä½†æ˜¯ç”±äºå‰é¢å·²ç»æœ‰åŠæ•°ä»¥ä¸Šçš„æœåŠ¡å™¨é€‰ä¸¾äº†æœåŠ¡å™¨3,æ‰€ä»¥å®ƒåªèƒ½æ¥æ”¶å½“å°å¼Ÿçš„å‘½äº†.5)æœåŠ¡å™¨5å¯åŠ¨,åŒ4ä¸€æ ·,å½“å°å¼ŸZooKeeperé›†ç¾¤æ­å»ºçœŸå®çš„é›†ç¾¤æ˜¯éœ€è¦éƒ¨ç½²åœ¨ä¸åŒçš„æœåŠ¡å™¨ä¸Šçš„ï¼Œä½†æ˜¯åœ¨æˆ‘ä»¬æµ‹è¯•æ—¶åŒæ—¶å¯åŠ¨åå‡ ä¸ªè™šæ‹Ÿæœºå†…å­˜ä¼šåƒä¸æ¶ˆï¼Œæ‰€ä»¥æˆ‘ä»¬é€šå¸¸ä¼šæ­å»ºä¼ªé›†ç¾¤ï¼Œä¹Ÿå°±æ˜¯æŠŠæ‰€æœ‰çš„æœåŠ¡éƒ½æ­å»ºåœ¨ä¸€å°è™šæ‹Ÿæœºä¸Šï¼Œç”¨ç«¯å£è¿›è¡ŒåŒºåˆ†ã€‚æˆ‘ä»¬è¿™é‡Œè¦æ±‚æ­å»ºä¸€ä¸ªä¸‰ä¸ªèŠ‚ç‚¹çš„Zookeeperé›†ç¾¤ï¼ˆä¼ªé›†ç¾¤ï¼‰ã€‚æµ‹è¯•ç¯å¢ƒâ€‹jdkï¼š1.7â€‹zookeeperï¼š3.4.6â€‹centosï¼š6.x1ã€åˆ›å»ºä¸€ä¸ªç›®å½•mkdir/usr/local/zookeeper-cluster2ã€ä¸Šä¼ zookeeperæ–‡ä»¶å¹¶è§£å‹tar-zxvfzookeeper-3.4.6.tar.gz#æ–°å»ºæ–‡ä»¶å¤¹mkdirzookeeper-3.4.6/data#ä¿®æ”¹coo.cfgåcdzookeeper-3.4.6/conf/mvzoo_sample.cfgzoo.cfg3ã€å¤åˆ¶zookeepercp-rzookeeper-3.4.6/usr/local/zookeeper-cluster/zookeeper-1cp-rzookeeper-3.4.6/usr/local/zookeeper-cluster/zookeeper-2cp-rzookeeper-3.4.6/usr/local/zookeeper-cluster/zookeeper-34ã€é…ç½®æ¯ä¸€ä¸ªZookeeperé…ç½®æ¯ä¸€ä¸ªZookeeperçš„dataDirï¼ˆzoo.cfgï¼‰clientPortåˆ†åˆ«ä¸º218121822183vi/usr/local/zookeeper-cluster/zookeeper-1/conf/zoo.cfgclientPort=2181dataDir=/usr/local/zookeeper-cluster/zookeeper-1/datavi/usr/local/zookeeper-cluster/zookeeper-2/conf/zoo.cfgclientPort=2182dataDir=/usr/local/zookeeper-cluster/zookeeper-2/datavi/usr/local/zookeeper-cluster/zookeeper-3/conf/zoo.cfgclientPort=2183dataDir=/usr/local/zookeeper-cluster/zookeeper-3/data5ã€é…ç½®é›†ç¾¤åœ¨æ¯ä¸ªzookeeperçš„dataç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªmyidæ–‡ä»¶ï¼Œå†…å®¹åˆ†åˆ«æ˜¯1ã€2ã€3ã€‚è¿™ä¸ªæ–‡ä»¶å°±æ˜¯è®°å½•æ¯ä¸ªæœåŠ¡å™¨çš„IDï¼ˆå†…å®¹ä¸ºè‡ªå®šä¹‰ï¼Œåé¢ä¼šç”¨åˆ°ï¼Œåªè¦ä¸é‡å¤å³å¯ï¼‰cd/usr/local/zookeeper-cluster/echo1&gt;zookeeper-1/data/myidecho2&gt;zookeeper-2/data/myidecho3&gt;zookeeper-3/data/myidåœ¨æ¯ä¸€ä¸ªzookeeperçš„zoo.cfgé…ç½®å®¢æˆ·ç«¯è®¿é—®ç«¯å£ï¼ˆclientPortï¼‰å’Œé›†ç¾¤æœåŠ¡å™¨IPåˆ—è¡¨ã€‚è§£é‡Šï¼šserver.æœåŠ¡å™¨ID=æœåŠ¡å™¨IPåœ°å€:æœåŠ¡å™¨ä¹‹é—´é€šä¿¡ç«¯å£:æœåŠ¡å™¨ä¹‹é—´æŠ•ç¥¨é€‰ä¸¾ç«¯å£æœåŠ¡å™¨IDä¸ºä¸Šé¢è‡ªå®šä¹‰çš„å†…å®¹server.1=192.168.25.143:2881:3881server.2=192.168.25.143:2882:3882server.3=192.168.25.143:2883:3883vizookeeper-1/conf/zoo.cfgvizookeeper-2/conf/zoo.cfgvizookeeper-3/conf/zoo.cfg6ã€å¯åŠ¨é›†ç¾¤å¯åŠ¨é›†ç¾¤å°±æ˜¯åˆ†åˆ«å¯åŠ¨æ¯ä¸ªå®ä¾‹ã€‚./zookeeper-1/bin/zkServer.shstart./zookeeper-2/bin/zkServer.shstart./zookeeper-3/bin/zkServer.shstart#æŸ¥çœ‹å¯åŠ¨çŠ¶æ€./zookeeper-1/bin/zkServer.shstatus./zookeeper-2/bin/zkServer.shstatus./zookeeper-3/bin/zkServer.shstatus#å¦‚æœå‡ºç°é”™è¯¯ï¼Œåˆ™éœ€è¦æŸ¥çœ‹æ—¥å¿—vizookeeper.outModeä¸ºfollowerè¡¨ç¤ºæ˜¯è·Ÿéšè€…ï¼ˆä»ï¼‰Modä¸ºleaderè¡¨ç¤ºæ˜¯é¢†å¯¼è€…ï¼ˆä¸»ï¼‰7ã€æ¨¡æ‹Ÿé›†ç¾¤å¼‚å¸¸é¦–å…ˆæˆ‘ä»¬å…ˆæµ‹è¯•å¦‚æœæ˜¯ä»æœåŠ¡å™¨æŒ‚æ‰ï¼Œä¼šæ€ä¹ˆæ ·æŠŠ3å·æœåŠ¡å™¨åœæ‰ï¼Œè§‚å¯Ÿ1å·å’Œ2å·ï¼Œå‘ç°çŠ¶æ€å¹¶æ²¡æœ‰å˜åŒ–ç”±æ­¤å¾—å‡ºç»“è®ºï¼Œ3ä¸ªèŠ‚ç‚¹çš„é›†ç¾¤ï¼Œä»æœåŠ¡å™¨æŒ‚æ‰ï¼Œé›†ç¾¤æ­£å¸¸æˆ‘ä»¬å†æŠŠ1å·æœåŠ¡å™¨ï¼ˆä»æœåŠ¡å™¨ï¼‰ä¹Ÿåœæ‰ï¼ŒæŸ¥çœ‹2å·ï¼ˆä¸»æœåŠ¡å™¨ï¼‰çš„çŠ¶æ€ï¼Œå‘ç°å·²ç»åœæ­¢è¿è¡Œäº†ã€‚ç”±æ­¤å¾—å‡ºç»“è®ºï¼Œ3ä¸ªèŠ‚ç‚¹çš„é›†ç¾¤ï¼Œ2ä¸ªä»æœåŠ¡å™¨éƒ½æŒ‚æ‰ï¼Œä¸»æœåŠ¡å™¨ä¹Ÿæ— æ³•è¿è¡Œã€‚å› ä¸ºå¯è¿è¡Œçš„æœºå™¨æ²¡æœ‰è¶…è¿‡é›†ç¾¤æ€»æ•°é‡çš„åŠæ•°ã€‚æˆ‘ä»¬å†æ¬¡æŠŠ1å·æœåŠ¡å™¨å¯åŠ¨èµ·æ¥ï¼Œå‘ç°2å·æœåŠ¡å™¨åˆå¼€å§‹æ­£å¸¸å·¥ä½œäº†ã€‚è€Œä¸”ä¾ç„¶æ˜¯é¢†å¯¼è€…ã€‚æˆ‘ä»¬æŠŠ3å·æœåŠ¡å™¨ä¹Ÿå¯åŠ¨èµ·æ¥ï¼ŒæŠŠ2å·æœåŠ¡å™¨åœæ‰ï¼ˆæ±—~~å¹²å˜›ï¼Ÿé¢†å¯¼æŒ‚äº†ï¼Ÿï¼‰åœæ‰åè§‚å¯Ÿ1å·å’Œ3å·çš„çŠ¶æ€ã€‚å‘ç°æ–°çš„leaderäº§ç”Ÿäº†~ç”±æ­¤æˆ‘ä»¬å¾—å‡ºç»“è®ºï¼Œå½“é›†ç¾¤ä¸­çš„ä¸»æœåŠ¡å™¨æŒ‚äº†ï¼Œé›†ç¾¤ä¸­çš„å…¶ä»–æœåŠ¡å™¨ä¼šè‡ªåŠ¨è¿›è¡Œé€‰ä¸¾çŠ¶æ€ï¼Œç„¶åäº§ç”Ÿæ–°å¾—leaderæˆ‘ä»¬å†æ¬¡æµ‹è¯•ï¼Œå½“æˆ‘ä»¬æŠŠ2å·æœåŠ¡å™¨é‡æ–°å¯åŠ¨èµ·æ¥ï¼ˆæ±—~~è¿™æ˜¯è¯ˆå°¸å•Š!ï¼‰å¯åŠ¨åï¼Œä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ2å·æœåŠ¡å™¨ä¼šå†æ¬¡æˆä¸ºæ–°çš„é¢†å¯¼å—ï¼Ÿæˆ‘ä»¬çœ‹ç»“æœæˆ‘ä»¬ä¼šå‘ç°ï¼Œ2å·æœåŠ¡å™¨å¯åŠ¨åä¾ç„¶æ˜¯è·Ÿéšè€…ï¼ˆä»æœåŠ¡å™¨ï¼‰ï¼Œ3å·æœåŠ¡å™¨ä¾ç„¶æ˜¯é¢†å¯¼è€…ï¼ˆä¸»æœåŠ¡å™¨ï¼‰ï¼Œæ²¡æœ‰æ’¼åŠ¨3å·æœåŠ¡å™¨çš„é¢†å¯¼åœ°ä½ã€‚å“~é€€ä¼‘äº†å°±æ˜¯é€€ä¼‘äº†ï¼Œè¯´äº†ä¸ç®—äº†ï¼Œå“ˆå“ˆã€‚ç”±æ­¤æˆ‘ä»¬å¾—å‡ºç»“è®ºï¼Œå½“é¢†å¯¼è€…äº§ç”Ÿåï¼Œå†æ¬¡æœ‰æ–°æœåŠ¡å™¨åŠ å…¥é›†ç¾¤ï¼Œä¸ä¼šå½±å“åˆ°ç°ä»»é¢†å¯¼è€…ã€‚Dubboxè¿æ¥zookeeperé›†ç¾¤ä¿®æ”¹æœåŠ¡æä¾›è€…å’ŒæœåŠ¡è°ƒç”¨è€…çš„springé…ç½®æ–‡ä»¶,å¤šä¸ªèŠ‚ç‚¹ä½¿ç”¨â€œ,â€åˆ†å‰²&lt;!--æŒ‡å®šæ³¨å†Œä¸­å¿ƒåœ°å€--&gt;&lt;dubbo:registryprotocol=&quot;zookeeper&quot;address=&quot;192.168.25.129:2181,192.168.25.129:2182,192.168.25.129:2183&quot;/&gt;","link":"https://haohanya.github.io/post/zookeeper-cluster/"},{"title":"å•ç‚¹ç™»é™†-CAS","content":"ä»€ä¹ˆæ˜¯å•ç‚¹ç™»å½•å•ç‚¹ç™»å½•ï¼ˆSingleSignOnï¼‰ï¼Œç®€ç§°ä¸ºSSOï¼Œæ˜¯ç›®å‰æ¯”è¾ƒæµè¡Œçš„ä¼ä¸šä¸šåŠ¡æ•´åˆçš„è§£å†³æ–¹æ¡ˆä¹‹ä¸€ã€‚SSOçš„å®šä¹‰æ˜¯åœ¨å¤šä¸ªåº”ç”¨ç³»ç»Ÿä¸­ï¼Œç”¨æˆ·åªéœ€è¦ç™»å½•ä¸€æ¬¡å°±å¯ä»¥è®¿é—®æ‰€æœ‰ç›¸äº’ä¿¡ä»»çš„åº”ç”¨ç³»ç»Ÿã€‚æˆ‘ä»¬ç›®å‰çš„ç³»ç»Ÿå­˜åœ¨è¯¸å¤šå­ç³»ç»Ÿï¼Œè€Œè¿™äº›å­ç³»ç»Ÿæ˜¯åˆ†åˆ«éƒ¨ç½²åœ¨ä¸åŒçš„æœåŠ¡å™¨ä¸­ï¼Œé‚£ä¹ˆä½¿ç”¨ä¼ ç»Ÿæ–¹å¼çš„sessionæ˜¯æ— æ³•è§£å†³çš„ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨ç›¸å…³çš„å•ç‚¹ç™»å½•æŠ€æœ¯æ¥è§£å†³ã€‚ä»€ä¹ˆæ˜¯CASCASæ˜¯Yaleå¤§å­¦å‘èµ·çš„ä¸€ä¸ªå¼€æºé¡¹ç›®ï¼Œæ—¨åœ¨ä¸ºWebåº”ç”¨ç³»ç»Ÿæä¾›ä¸€ç§å¯é çš„å•ç‚¹ç™»å½•æ–¹æ³•ï¼ŒCASåœ¨2004å¹´12æœˆæ­£å¼æˆä¸ºJA-SIGçš„ä¸€ä¸ªé¡¹ç›®ã€‚CASå…·æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼šã€1ã€‘å¼€æºçš„ä¼ä¸šçº§å•ç‚¹ç™»å½•è§£å†³æ–¹æ¡ˆã€‚ã€2ã€‘CASServerä¸ºéœ€è¦ç‹¬ç«‹éƒ¨ç½²çš„Webåº”ç”¨ã€‚ã€3ã€‘CASClientæ”¯æŒéå¸¸å¤šçš„å®¢æˆ·ç«¯(è¿™é‡ŒæŒ‡å•ç‚¹ç™»å½•ç³»ç»Ÿä¸­çš„å„ä¸ªWebåº”ç”¨)ï¼ŒåŒ…æ‹¬Java,.Net,PHP,Perl,Apache,uPortal,Rubyç­‰ã€‚ä»ç»“æ„ä¸Šçœ‹ï¼ŒCASåŒ…å«ä¸¤ä¸ªéƒ¨åˆ†ï¼šCASServerå’ŒCASClientã€‚CASServeréœ€è¦ç‹¬ç«‹éƒ¨ç½²ï¼Œä¸»è¦è´Ÿè´£å¯¹ç”¨æˆ·çš„è®¤è¯å·¥ä½œï¼›CASClientè´Ÿè´£å¤„ç†å¯¹å®¢æˆ·ç«¯å—ä¿æŠ¤èµ„æºçš„è®¿é—®è¯·æ±‚ï¼Œéœ€è¦ç™»å½•æ—¶ï¼Œé‡å®šå‘åˆ°CASServerã€‚ä¸‹å›¾æ˜¯CASæœ€åŸºæœ¬çš„åè®®è¿‡ç¨‹ï¼šSSOå•ç‚¹ç™»å½•è®¿é—®æµç¨‹ä¸»è¦æœ‰ä»¥ä¸‹æ­¥éª¤ï¼šè®¿é—®æœåŠ¡ï¼šSSOå®¢æˆ·ç«¯å‘é€è¯·æ±‚è®¿é—®åº”ç”¨ç³»ç»Ÿæä¾›çš„æœåŠ¡èµ„æºã€‚å®šå‘è®¤è¯ï¼šSSOå®¢æˆ·ç«¯ä¼šé‡å®šå‘ç”¨æˆ·è¯·æ±‚åˆ°SSOæœåŠ¡å™¨ã€‚ç”¨æˆ·è®¤è¯ï¼šç”¨æˆ·èº«ä»½è®¤è¯ã€‚å‘æ”¾ç¥¨æ®ï¼šSSOæœåŠ¡å™¨ä¼šäº§ç”Ÿä¸€ä¸ªéšæœºçš„ServiceTicketã€‚éªŒè¯ç¥¨æ®ï¼šSSOæœåŠ¡å™¨éªŒè¯ç¥¨æ®ServiceTicketçš„åˆæ³•æ€§ï¼ŒéªŒè¯é€šè¿‡åï¼Œå…è®¸å®¢æˆ·ç«¯è®¿é—®æœåŠ¡ã€‚ä¼ è¾“ç”¨æˆ·ä¿¡æ¯ï¼šSSOæœåŠ¡å™¨éªŒè¯ç¥¨æ®é€šè¿‡åï¼Œä¼ è¾“ç”¨æˆ·è®¤è¯ç»“æœä¿¡æ¯ç»™å®¢æˆ·ç«¯ã€‚CASæœåŠ¡ç«¯éƒ¨ç½²1ã€caså®‰è£…åœ¨èµ„æº\\cas\\source\\cas-server-4.0.0-release\\cas-server-4.0.0\\modulesç›®å½•ä¸‹cas-server-webapp-4.0.0.warå°†å…¶æ”¹åä¸ºcas.waræ”¾å…¥tomcatç›®å½•ä¸‹çš„webappsä¸‹ã€‚å¯åŠ¨tomcatè‡ªåŠ¨è§£å‹waråŒ…ã€‚æµè§ˆå™¨è¾“å…¥http://localhost:8080/cas/loginï¼Œå¯çœ‹åˆ°ç™»å½•é¡µé¢è¿™é‡Œæœ‰ä¸ªå›ºå®šçš„ç”¨æˆ·åå’Œå¯†ç casuser/Mellonç™»å½•æˆåŠŸåä¼šè·³åˆ°ç™»å½•æˆåŠŸçš„æç¤ºé¡µé¢2ã€ä¿®æ”¹ç«¯å£ä¿®æ”¹tomcatç«¯å£æ‰“å¼€tomcatç›®å½•conf\\server.xmlæ‰¾åˆ°ä¸‹é¢çš„é…ç½®&lt;Connectorport=&quot;8080&quot;protocol=&quot;HTTP/1.1&quot;connectionTimeout=&quot;20000&quot;redirectPort=&quot;8443&quot;/&gt;&lt;!--ä¿®æ”¹portä¸º9100--&gt;ä¿®æ”¹CASé…ç½®æ–‡ä»¶WEB-INF/cas.propertiesserver.name=http://localhost:91003ã€å»é™¤httpsè®¤è¯CASé»˜è®¤ä½¿ç”¨çš„æ˜¯HTTPSåè®®ï¼Œå¦‚æœä½¿ç”¨HTTPSåè®®éœ€è¦SSLå®‰å…¨è¯ä¹¦ï¼ˆéœ€å‘ç‰¹å®šçš„æœºæ„ç”³è¯·å’Œè´­ä¹°ï¼‰ã€‚å¦‚æœå¯¹å®‰å…¨è¦æ±‚ä¸é«˜æˆ–æ˜¯åœ¨å¼€å‘æµ‹è¯•é˜¶æ®µï¼Œå¯ä½¿ç”¨HTTPåè®®ã€‚æˆ‘ä»¬è¿™é‡Œè®²è§£é€šè¿‡ä¿®æ”¹é…ç½®ï¼Œè®©CASä½¿ç”¨HTTPåè®®ã€‚ä¿®æ”¹casçš„WEB-INF/deployerConfigContext.xml&lt;beanclass=&quot;org.jasig.cas.authentication.handler.support.HttpBasedServiceCredentialsAuthenticationHandler&quot;p:httpClient-ref=&quot;httpClient&quot;/&gt;&lt;!--è¿™é‡Œéœ€è¦å¢åŠ å‚æ•°p:requireSecure=&quot;false&quot;requireSecureå±æ€§æ„æ€ä¸ºæ˜¯å¦éœ€è¦å®‰å…¨éªŒè¯å³HTTPSï¼Œfalseä¸ºä¸é‡‡ç”¨--&gt;ä¿®æ”¹casçš„/WEB-INF/spring-configuration/ticketGrantingTicketCookieGenerator.xml&lt;beanid=&quot;ticketGrantingTicketCookieGenerator&quot;class=&quot;org.jasig.cas.web.support.CookieRetrievingCookieGenerator&quot;p:cookieSecure=&quot;true&quot;p:cookieMaxAge=&quot;-1&quot;p:cookieName=&quot;CASTGC&quot;p:cookiePath=&quot;/cas&quot;/&gt;&lt;!--å‚æ•°p:cookieSecure=&quot;true&quot;ï¼ŒåŒç†ä¸ºHTTPSéªŒè¯ç›¸å…³ï¼ŒTRUEä¸ºé‡‡ç”¨HTTPSéªŒè¯ï¼ŒFALSEä¸ºä¸é‡‡ç”¨httpséªŒè¯ã€‚å‚æ•°p:cookieMaxAge=&quot;-1&quot;ï¼Œæ˜¯COOKIEçš„æœ€å¤§ç”Ÿå‘½å‘¨æœŸï¼Œ-1ä¸ºæ— ç”Ÿå‘½å‘¨æœŸï¼Œå³åªåœ¨å½“å‰æ‰“å¼€çš„çª—å£æœ‰æ•ˆï¼Œå…³é—­æˆ–é‡æ–°æ‰“å¼€å…¶å®ƒçª—å£ï¼Œä»ä¼šè¦æ±‚éªŒè¯ã€‚å¯ä»¥æ ¹æ®éœ€è¦ä¿®æ”¹ä¸ºå¤§äº0çš„æ•°å­—ï¼Œæ¯”å¦‚3600ç­‰ï¼Œæ„æ€æ˜¯åœ¨3600ç§’å†…ï¼Œæ‰“å¼€ä»»æ„çª—å£ï¼Œéƒ½ä¸éœ€è¦éªŒè¯ã€‚æˆ‘ä»¬è¿™é‡Œå°†cookieSecureæ”¹ä¸ºfalse,cookieMaxAgeæ”¹ä¸º3600--&gt;ä¿®æ”¹casçš„WEB-INF/spring-configuration/warnCookieGenerator.xml&lt;beanid=&quot;warnCookieGenerator&quot;class=&quot;org.jasig.cas.web.support.CookieRetrievingCookieGenerator&quot;p:cookieSecure=&quot;true&quot;p:cookieMaxAge=&quot;-1&quot;p:cookieName=&quot;CASPRIVACY&quot;p:cookiePath=&quot;/cas&quot;/&gt;&lt;!--å°†cookieSecureæ”¹ä¸ºfalse,cookieMaxAgeæ”¹ä¸º3600--&gt;CASå®¢æˆ·ç«¯å…¥é—¨å°Demoå®¢æˆ·ç«¯å·¥ç¨‹1æ­å»º1ã€æ­å»ºå·¥ç¨‹å¼•å…¥ä¾èµ–åˆ›å»ºMavenå·¥ç¨‹ï¼ˆwarï¼‰casclient_demo1å¼•å…¥caså®¢æˆ·ç«¯ä¾èµ–å¹¶åˆ¶å®štomcatè¿è¡Œç«¯å£ä¸º9001&lt;dependencies&gt;&lt;!--cas--&gt;&lt;dependency&gt;&lt;groupId&gt;org.jasig.cas.client&lt;/groupId&gt;&lt;artifactId&gt;cas-client-core&lt;/artifactId&gt;&lt;version&gt;3.3.3&lt;/version&gt;&lt;/dependency&gt;&lt;dependency&gt;&lt;groupId&gt;javax.servlet&lt;/groupId&gt;&lt;artifactId&gt;servlet-api&lt;/artifactId&gt;&lt;version&gt;2.5&lt;/version&gt;&lt;scope&gt;provided&lt;/scope&gt;&lt;/dependency&gt;&lt;/dependencies&gt;&lt;build&gt;&lt;plugins&gt;&lt;!--é…ç½®Tomcatæ’ä»¶--&gt;&lt;plugin&gt;&lt;groupId&gt;org.apache.tomcat.maven&lt;/groupId&gt;&lt;artifactId&gt;tomcat7-maven-plugin&lt;/artifactId&gt;&lt;configuration&gt;&lt;port&gt;9001&lt;/port&gt;&lt;path&gt;/&lt;/path&gt;&lt;uriEncoding&gt;utf-8&lt;/uriEncoding&gt;&lt;/configuration&gt;&lt;/plugin&gt;&lt;/plugins&gt;&lt;/build&gt;2ã€ä¿®æ”¹web.xml&lt;?xmlversion=&quot;1.0&quot;encoding=&quot;UTF-8&quot;?&gt;&lt;web-appxmlns=&quot;http://xmlns.jcp.org/xml/ns/javaee&quot;xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;xsi:schemaLocation=&quot;http://xmlns.jcp.org/xml/ns/javaeehttp://xmlns.jcp.org/xml/ns/javaee/web-app_4_0.xsd&quot;version=&quot;4.0&quot;&gt;&lt;!--ç”¨äºå•ç‚¹é€€å‡ºï¼Œè¯¥è¿‡æ»¤å™¨ç”¨äºå®ç°å•ç‚¹ç™»å‡ºåŠŸèƒ½ï¼Œå¯é€‰é…ç½®--&gt;&lt;listener&gt;&lt;listener-class&gt;org.jasig.cas.client.session.SingleSignOutHttpSessionListener&lt;/listener-class&gt;&lt;/listener&gt;&lt;!--è¯¥è¿‡æ»¤å™¨ç”¨äºå®ç°å•ç‚¹ç™»å‡ºåŠŸèƒ½ï¼Œå¯é€‰é…ç½®ã€‚--&gt;&lt;filter&gt;&lt;filter-name&gt;CASSingleSignOutFilter&lt;/filter-name&gt;&lt;filter-class&gt;org.jasig.cas.client.session.SingleSignOutFilter&lt;/filter-class&gt;&lt;/filter&gt;&lt;filter-mapping&gt;&lt;filter-name&gt;CASSingleSignOutFilter&lt;/filter-name&gt;&lt;url-pattern&gt;/*&lt;/url-pattern&gt;&lt;/filter-mapping&gt;&lt;!--è¯¥è¿‡æ»¤å™¨è´Ÿè´£ç”¨æˆ·çš„è®¤è¯å·¥ä½œï¼Œå¿…é¡»å¯ç”¨å®ƒ--&gt;&lt;filter&gt;&lt;filter-name&gt;CASFilter&lt;/filter-name&gt;&lt;filter-class&gt;org.jasig.cas.client.authentication.AuthenticationFilter&lt;/filter-class&gt;&lt;init-param&gt;&lt;param-name&gt;casServerLoginUrl&lt;/param-name&gt;&lt;param-value&gt;http://localhost:9100/cas/login&lt;/param-value&gt;&lt;!--è¿™é‡Œçš„serveræ˜¯æœåŠ¡ç«¯çš„IP--&gt;&lt;/init-param&gt;&lt;init-param&gt;&lt;param-name&gt;serverName&lt;/param-name&gt;&lt;param-value&gt;http://localhost:9001&lt;/param-value&gt;&lt;/init-param&gt;&lt;/filter&gt;&lt;filter-mapping&gt;&lt;filter-name&gt;CASFilter&lt;/filter-name&gt;&lt;url-pattern&gt;/*&lt;/url-pattern&gt;&lt;/filter-mapping&gt;&lt;!--è¯¥è¿‡æ»¤å™¨è´Ÿè´£å¯¹Ticketçš„æ ¡éªŒå·¥ä½œï¼Œå¿…é¡»å¯ç”¨å®ƒ--&gt;&lt;filter&gt;&lt;filter-name&gt;CASValidationFilter&lt;/filter-name&gt;&lt;filter-class&gt;org.jasig.cas.client.validation.Cas20ProxyReceivingTicketValidationFilter&lt;/filter-class&gt;&lt;init-param&gt;&lt;param-name&gt;casServerUrlPrefix&lt;/param-name&gt;&lt;param-value&gt;http://localhost:9100/cas&lt;/param-value&gt;&lt;/init-param&gt;&lt;init-param&gt;&lt;param-name&gt;serverName&lt;/param-name&gt;&lt;param-value&gt;http://localhost:9001&lt;/param-value&gt;&lt;/init-param&gt;&lt;/filter&gt;&lt;filter-mapping&gt;&lt;filter-name&gt;CASValidationFilter&lt;/filter-name&gt;&lt;url-pattern&gt;/*&lt;/url-pattern&gt;&lt;/filter-mapping&gt;&lt;!--è¯¥è¿‡æ»¤å™¨è´Ÿè´£å®ç°HttpServletRequestè¯·æ±‚çš„åŒ…è£¹ï¼Œæ¯”å¦‚å…è®¸å¼€å‘è€…é€šè¿‡HttpServletRequestçš„getRemoteUser()æ–¹æ³•è·å¾—SSOç™»å½•ç”¨æˆ·çš„ç™»å½•åï¼Œå¯é€‰é…ç½®ã€‚--&gt;&lt;filter&gt;&lt;filter-name&gt;CASHttpServletRequestWrapperFilter&lt;/filter-name&gt;&lt;filter-class&gt;org.jasig.cas.client.util.HttpServletRequestWrapperFilter&lt;/filter-class&gt;&lt;/filter&gt;&lt;filter-mapping&gt;&lt;filter-name&gt;CASHttpServletRequestWrapperFilter&lt;/filter-name&gt;&lt;url-pattern&gt;/*&lt;/url-pattern&gt;&lt;/filter-mapping&gt;&lt;!--è¯¥è¿‡æ»¤å™¨ä½¿å¾—å¼€å‘è€…å¯ä»¥é€šè¿‡org.jasig.cas.client.util.AssertionHolderæ¥è·å–ç”¨æˆ·çš„ç™»å½•åã€‚æ¯”å¦‚AssertionHolder.getAssertion().getPrincipal().getName()ã€‚--&gt;&lt;filter&gt;&lt;filter-name&gt;CASAssertionThreadLocalFilter&lt;/filter-name&gt;&lt;filter-class&gt;org.jasig.cas.client.util.AssertionThreadLocalFilter&lt;/filter-class&gt;&lt;/filter&gt;&lt;filter-mapping&gt;&lt;filter-name&gt;CASAssertionThreadLocalFilter&lt;/filter-name&gt;&lt;url-pattern&gt;/*&lt;/url-pattern&gt;&lt;/filter-mapping&gt;&lt;/web-app&gt;3ã€ç¼–å†™index.jsp&lt;%@pagelanguage=&quot;java&quot;contentType=&quot;text/html;charset=utf-8&quot;pageEncoding=&quot;utf-8&quot;%&gt;&lt;!DOCTYPEhtmlPUBLIC&quot;-//W3C//DTDHTML4.01Transitional//EN&quot;&quot;http://www.w3.org/TR/html4/loose.dtd&quot;&gt;&lt;html&gt;&lt;head&gt;&lt;metahttp-equiv=&quot;Content-Type&quot;content=&quot;text/html;charset=utf-8&quot;&gt;&lt;title&gt;Hello&lt;/title&gt;&lt;/head&gt;&lt;body&gt;æ¬¢è¿ç™»é™†ä¸€ï¼š&lt;%--ä¸ºè·å–è¿œç¨‹ç™»å½•å--%&gt;&lt;%=request.getRemoteUser()%&gt;&lt;/body&gt;&lt;/html&gt;å®¢æˆ·ç«¯å·¥ç¨‹2æ­å»º1ã€æ­å»ºå·¥ç¨‹åˆ›å»ºMavenå·¥ç¨‹ï¼ˆwarï¼‰casclient_demo2å¼•å…¥caså®¢æˆ·ç«¯ä¾èµ–å¹¶åˆ¶å®štomcatè¿è¡Œç«¯å£ä¸º90022ã€ä¿®æ”¹web.xmlåˆ›å»ºweb.xmlï¼Œå‚ç…§casclient_demo1,å°†serverNameçš„å€¼æ”¹ä¸ºhttp://localhost:9002ï¼Œä¸€å…±ä¸¤å¤„3ã€ç¼–å†™index.jspåˆ›å»ºindex.jsp,å†…å®¹æ˜¾ç¤ºâ€œæ¬¢è¿ç™»é™†äºŒï¼šâ€å•ç‚¹é€€å‡ºç™»å½•åœ°å€æ è¾“å…¥http://localhost:9100/cas/logoutå³å¯çœ‹åˆ°é€€å‡ºåçš„æç¤ºé¡µé¢æŒ‡å®šé€€å‡ºåè·³è½¬åœ°å€1ã€ä¿®æ”¹casç³»ç»Ÿçš„é…ç½®æ–‡ä»¶cas-servlet.xmlï¼ˆ217è¡Œï¼‰&lt;beanid=&quot;logoutAction&quot;class=&quot;org.jasig.cas.web.flow.LogoutAction&quot;p:servicesManager-ref=&quot;servicesManager&quot;p:followServiceRedirects=&quot;${cas.logout.followServiceRedirects:false}&quot;/&gt;&lt;!--æŠŠp:followServiceRedirectsçš„falseä¿®æ”¹ä¸ºtrue--&gt;2ã€å¡«å…¥è·³è½¬åœ°å€&lt;!--serviceå‚æ•°ä¸ºé€€å‡ºåè·³è½¬çš„åœ°å€--&gt;&lt;ahref=&quot;http://localhost:9100/cas/logout?service=http://www.baidu.com&quot;&gt;é€€å‡ºç™»å½•&lt;/a&gt;CASæœåŠ¡ç«¯æ•°æ®æºè®¾ç½®1ã€é…ç½®æ•°æ®æºä¿®æ”¹casæœåŠ¡ç«¯ä¸­web-infä¸‹deployerConfigContext.xmlï¼Œæ·»åŠ å¦‚ä¸‹é…ç½®&lt;!--é…ç½®æ•°æ®æºc3p0è¿æ¥æ± --&gt;&lt;beanid=&quot;dataSource&quot;class=&quot;com.mchange.v2.c3p0.ComboPooledDataSource&quot;p:driverClass=&quot;com.mysql.jdbc.Driver&quot;p:jdbcUrl=&quot;jdbc:mysql://127.0.0.1:3306/jd?characterEncoding=utf8&quot;p:user=&quot;root&quot;p:password=&quot;root&quot;/&gt;&lt;!--å¯†ç åŠ å¯†çš„æ–¹å¼ä¸ºmd5,åœ¨ç™»é™†æ—¶å…ˆåŠ å¯†å¯†ç ç„¶åå†å»æ•°æ®åº“æ¯”å¯¹--&gt;&lt;beanid=&quot;passwordEncoder&quot;class=&quot;org.jasig.cas.authentication.handler.DefaultPasswordEncoder&quot;c:encodingAlgorithm=&quot;MD5&quot;p:characterEncoding=&quot;UTF-8&quot;/&gt;&lt;!--æ•°æ®æ ¡éªŒ--&gt;&lt;beanid=&quot;dbAuthHandler&quot;class=&quot;org.jasig.cas.adaptors.jdbc.QueryDatabaseAuthenticationHandler&quot;p:dataSource-ref=&quot;dataSource&quot;p:sql=&quot;selectpasswordfromtb_userwhereusername=?&quot;p:passwordEncoder-ref=&quot;passwordEncoder&quot;/&gt;ç„¶ååœ¨é…ç½®æ–‡ä»¶å¼€å§‹éƒ¨åˆ†æ‰¾åˆ°å¦‚ä¸‹é…ç½®&lt;beanid=&quot;authenticationManager&quot;class=&quot;org.jasig.cas.authentication.PolicyBasedAuthenticationManager&quot;&gt;&lt;constructor-arg&gt;&lt;map&gt;&lt;entrykey-ref=&quot;proxyAuthenticationHandler&quot;value-ref=&quot;proxyPrincipalResolver&quot;/&gt;&lt;entrykey-ref=&quot;primaryAuthenticationHandler&quot;value-ref=&quot;primaryPrincipalResolver&quot;/&gt;&lt;/map&gt;&lt;/constructor-arg&gt;&lt;propertyname=&quot;authenticationPolicy&quot;&gt;&lt;beanclass=&quot;org.jasig.cas.authentication.AnyAuthenticationPolicy&quot;/&gt;&lt;/property&gt;&lt;/bean&gt;&lt;!--å…¶ä¸­&lt;entrykey-ref=&quot;primaryAuthenticationHandler&quot;value-ref=&quot;primaryPrincipalResolver&quot;/&gt;ä¸€å¥æ˜¯ä½¿ç”¨å›ºå®šçš„ç”¨æˆ·åå’Œå¯†ç ï¼Œæˆ‘ä»¬åœ¨ä¸‹é¢å¯ä»¥çœ‹åˆ°è¿™ä¸¤ä¸ªbean,å¦‚æœæˆ‘ä»¬ä½¿ç”¨æ•°æ®åº“è®¤è¯ç”¨æˆ·åå’Œå¯†ç ï¼Œéœ€è¦å°†è¿™å¥æ³¨é‡Šæ‰ã€‚æ·»åŠ ä¸‹é¢è¿™ä¸€å¥é…ç½®(54è¡Œ)&lt;entrykey-ref=&quot;dbAuthHandler&quot;value-ref=&quot;primaryPrincipalResolver&quot;/&gt;--&gt;2ã€æ·»åŠ jaråŒ…å°†ä»¥ä¸‹ä¸‰ä¸ªjaråŒ…æ”¾å…¥webapps\\cas\\WEB-INF\\libä¸‹c3p0-0.9.1.2.jarcas-server-support-jdbc-4.0.0.jarmysql-connector-java-5.1.32.jar3ã€æµ‹è¯•ç”¨æ•°æ®åº“ä¸­çš„ç”¨æˆ·åå’Œå¯†ç è¿›è¡Œæµ‹è¯•ä¿®æ”¹é»˜è®¤ç™»é™†é¡µé¢1ã€ä¸Šä¼ æ–‡ä»¶ä¸Šä¼ è‡ªå·±çš„ç™»é™†é¡µé¢åˆ°WEB-INF\\view\\jsp\\default\\ui\\casLoginView.jsp2ã€ç¼–è¾‘casLoginView.jspå†…å®¹1ã€æ·»åŠ æŒ‡ä»¤&lt;%@pagepageEncoding=&quot;UTF-8&quot;%&gt;&lt;%@pagecontentType=&quot;text/html;charset=UTF-8&quot;%&gt;&lt;%@taglibprefix=&quot;c&quot;uri=&quot;http://java.sun.com/jsp/jstl/core&quot;%&gt;&lt;%@taglibprefix=&quot;spring&quot;uri=&quot;http://www.springframework.org/tags&quot;%&gt;&lt;%@taglibprefix=&quot;form&quot;uri=&quot;http://www.springframework.org/tags/form&quot;%&gt;&lt;%@taglibprefix=&quot;fn&quot;uri=&quot;http://java.sun.com/jsp/jstl/functions&quot;%&gt;2ã€ä¿®æ”¹formæ ‡ç­¾&lt;form:formmethod=&quot;post&quot;id=&quot;fm1&quot;commandName=&quot;${commandName}&quot;htmlEscape=&quot;true&quot;class=&quot;sui-form&quot;&gt;......&lt;/form:form&gt;3ã€ä¿®æ”¹ç”¨æˆ·åæ¡†&lt;form:inputid=&quot;username&quot;tabindex=&quot;1&quot;accesskey=&quot;${userNameAccessKey}&quot;path=&quot;username&quot;autocomplete=&quot;off&quot;htmlEscape=&quot;true&quot;placeholder=&quot;é‚®ç®±/ç”¨æˆ·å/æ‰‹æœºå·&quot;class=&quot;span2input-xfat&quot;/&gt;4ã€ä¿®æ”¹å¯†ç æ¡†&lt;form:passwordid=&quot;password&quot;tabindex=&quot;2&quot;path=&quot;password&quot;accesskey=&quot;${passwordAccessKey}&quot;htmlEscape=&quot;true&quot;autocomplete=&quot;off&quot;placeholder=&quot;è¯·è¾“å…¥å¯†ç &quot;class=&quot;span2input-xfat&quot;/&gt;5ã€ä¿®æ”¹ç™»é™†æŒ‰é’®&lt;inputtype=&quot;hidden&quot;name=&quot;lt&quot;value=&quot;${loginTicket}&quot;/&gt;&lt;inputtype=&quot;hidden&quot;name=&quot;execution&quot;value=&quot;${flowExecutionKey}&quot;/&gt;&lt;inputtype=&quot;hidden&quot;name=&quot;_eventId&quot;value=&quot;submit&quot;/&gt;&lt;inputclass=&quot;sui-btnbtn-blockbtn-xlargebtn-danger&quot;accesskey=&quot;l&quot;value=&quot;ç™»é™†&quot;type=&quot;submit&quot;/&gt;3ã€é”™è¯¯æç¤ºåœ¨è¡¨å•å†…åŠ å…¥é”™è¯¯æç¤ºæ¡†&lt;form:errorspath=&quot;*&quot;id=&quot;msg&quot;cssClass=&quot;errors&quot;element=&quot;div&quot;htmlEscape=&quot;false&quot;/&gt;è®¾ç½®ç™»é™†å¤±è´¥ä¸­æ–‡æç¤ºä¿®æ”¹cas-servlet.xmlä¸­çš„enï¼ˆ61è¡Œï¼‰&lt;beanid=&quot;localeResolver&quot;class=&quot;org.springframework.web.servlet.i18n.CookieLocaleResolver&quot;p:defaultLocale=&quot;zh_CN&quot;/&gt;å°†æ­¤ä¿¡æ¯æ‹·è´åˆ°WEB-INF\\classes\\messages_zh_CN.propertiesä¸‹ï¼Œå¹¶æ”¹ä¸ºä¸­æ–‡æç¤ºï¼ˆè½¬ç ï¼‰authenticationFailure.AccountNotFoundException=\\u7528\\u6237\\u4E0D\\u5B58\\u5728.authenticationFailure.FailedLoginException=\\u5BC6\\u7801\\u9519\\u8BEF.ç¬¬ä¸€ä¸ªæ˜¯ç”¨æˆ·åä¸å­˜åœ¨æ—¶çš„é”™è¯¯æç¤ºç¬¬äºŒä¸ªæ˜¯å¯†ç é”™è¯¯çš„æç¤ºCASå®¢æˆ·ç«¯ä¸SpringSecurityé›†æˆ1ã€åˆ›å»ºå·¥ç¨‹å»ºç«‹Mavené¡¹ç›®casclient_demo3ï¼Œå¼•å…¥springä¾èµ–å’Œspringsecrityç›¸å…³ä¾èµ–ï¼Œtomcatç«¯å£è®¾ç½®ä¸º90032ã€å¼•å…¥ä¾èµ–&lt;dependencies&gt;&lt;dependency&gt;&lt;groupId&gt;org.springframework&lt;/groupId&gt;&lt;artifactId&gt;spring-webmvc&lt;/artifactId&gt;&lt;version&gt;4.2.4.RELEASE&lt;/version&gt;&lt;/dependency&gt;&lt;dependency&gt;&lt;groupId&gt;com.fasterxml.jackson.core&lt;/groupId&gt;&lt;artifactId&gt;jackson-databind&lt;/artifactId&gt;&lt;version&gt;2.4.2&lt;/version&gt;&lt;/dependency&gt;&lt;dependency&gt;&lt;groupId&gt;javax.servlet&lt;/groupId&gt;&lt;artifactId&gt;servlet-api&lt;/artifactId&gt;&lt;version&gt;2.5&lt;/version&gt;&lt;scope&gt;provided&lt;/scope&gt;&lt;/dependency&gt;&lt;!--èº«ä»½éªŒè¯--&gt;&lt;dependency&gt;&lt;groupId&gt;org.springframework.security&lt;/groupId&gt;&lt;artifactId&gt;spring-security-web&lt;/artifactId&gt;&lt;version&gt;4.1.0.RELEASE&lt;/version&gt;&lt;/dependency&gt;&lt;dependency&gt;&lt;groupId&gt;org.springframework.security&lt;/groupId&gt;&lt;artifactId&gt;spring-security-config&lt;/artifactId&gt;&lt;version&gt;4.1.0.RELEASE&lt;/version&gt;&lt;/dependency&gt;&lt;dependency&gt;&lt;groupId&gt;com.github.penggle&lt;/groupId&gt;&lt;artifactId&gt;kaptcha&lt;/artifactId&gt;&lt;version&gt;2.3.2&lt;/version&gt;&lt;exclusions&gt;&lt;exclusion&gt;&lt;groupId&gt;javax.servlet&lt;/groupId&gt;&lt;artifactId&gt;javax.servlet-api&lt;/artifactId&gt;&lt;/exclusion&gt;&lt;/exclusions&gt;&lt;/dependency&gt;&lt;dependency&gt;&lt;groupId&gt;org.springframework.security&lt;/groupId&gt;&lt;artifactId&gt;spring-security-cas&lt;/artifactId&gt;&lt;version&gt;4.1.0.RELEASE&lt;/version&gt;&lt;/dependency&gt;&lt;dependency&gt;&lt;groupId&gt;org.jasig.cas.client&lt;/groupId&gt;&lt;artifactId&gt;cas-client-core&lt;/artifactId&gt;&lt;version&gt;3.3.3&lt;/version&gt;&lt;!--æ’é™¤log4jåŒ…å†²çª--&gt;&lt;exclusions&gt;&lt;exclusion&gt;&lt;groupId&gt;org.slf4j&lt;/groupId&gt;&lt;artifactId&gt;log4j-over-slf4j&lt;/artifactId&gt;&lt;/exclusion&gt;&lt;/exclusions&gt;&lt;/dependency&gt;&lt;/dependencies&gt;&lt;build&gt;&lt;plugins&gt;&lt;!--é…ç½®Tomcatæ’ä»¶--&gt;&lt;plugin&gt;&lt;groupId&gt;org.apache.tomcat.maven&lt;/groupId&gt;&lt;artifactId&gt;tomcat7-maven-plugin&lt;/artifactId&gt;&lt;configuration&gt;&lt;port&gt;9003&lt;/port&gt;&lt;path&gt;/&lt;/path&gt;&lt;uriEncoding&gt;utf-8&lt;/uriEncoding&gt;&lt;/configuration&gt;&lt;/plugin&gt;&lt;/plugins&gt;&lt;resources&gt;&lt;resource&gt;&lt;directory&gt;src/main/java&lt;/directory&gt;&lt;includes&gt;&lt;include&gt;**/*.*&lt;/include&gt;&lt;/includes&gt;&lt;/resource&gt;&lt;resource&gt;&lt;directory&gt;src/main/resources&lt;/directory&gt;&lt;includes&gt;&lt;include&gt;**/*.*&lt;/include&gt;&lt;/includes&gt;&lt;/resource&gt;&lt;/resources&gt;&lt;/build&gt;3ã€åˆ›å»ºspring-mvc.xml&lt;?xmlversion=&quot;1.0&quot;encoding=&quot;UTF-8&quot;?&gt;&lt;beansxmlns=&quot;http://www.springframework.org/schema/beans&quot;xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;xmlns:context=&quot;http://www.springframework.org/schema/context&quot;xmlns:mvc=&quot;http://www.springframework.org/schema/mvc&quot;xsi:schemaLocation=&quot;http://www.springframework.org/schema/beanshttp://www.springframework.org/schema/beans/spring-beans.xsdhttp://www.springframework.org/schema/mvchttp://www.springframework.org/schema/mvc/spring-mvc.xsdhttp://www.springframework.org/schema/contexthttp://www.springframework.org/schema/context/spring-context.xsd&quot;&gt;&lt;!--æ‰«æç”¨@Controlleræ³¨è§£çš„ç±»ï¼Œå¹¶ä¸”åŠ è½½åˆ°springä¸­è¿›è¡Œç®¡ç†--&gt;&lt;context:component-scanbase-package=&quot;com.cn.controller&quot;/&gt;&lt;!--é…ç½®æ³¨è§£é©±åŠ¨--&gt;&lt;mvc:annotation-driven&gt;&lt;!--æ·»åŠ è½¬æ¢å™¨ï¼Œæ·»åŠ å¯¹äºå¯¹è±¡çš„æ”¯æŒ--&gt;&lt;mvc:message-converters&gt;&lt;refbean=&quot;stringHttpMessageConverter&quot;/&gt;&lt;refbean=&quot;mappingJackson2HttpMessageConverter&quot;/&gt;&lt;/mvc:message-converters&gt;&lt;/mvc:annotation-driven&gt;&lt;beanid=&quot;stringHttpMessageConverter&quot;class=&quot;org.springframework.http.converter.StringHttpMessageConverter&quot;/&gt;&lt;!--è§£å†³IEæµè§ˆå™¨jsonæ–‡ä»¶ä¸‹è½½å’Œjsonæ•°æ®ä¸­åˆä¹±ç çš„é—®é¢˜--&gt;&lt;beanid=&quot;mappingJackson2HttpMessageConverter&quot;class=&quot;org.springframework.http.converter.json.MappingJackson2HttpMessageConverter&quot;&gt;&lt;propertyname=&quot;supportedMediaTypes&quot;&gt;&lt;list&gt;&lt;value&gt;text/html;charset=UTF-8&lt;/value&gt;&lt;/list&gt;&lt;/property&gt;&lt;/bean&gt;&lt;mvc:default-servlet-handler/&gt;&lt;!--jackson--&gt;&lt;mvc:annotation-driven&gt;&lt;mvc:message-converters&gt;&lt;beanclass=&quot;org.springframework.http.converter.StringHttpMessageConverter&quot;/&gt;&lt;beanclass=&quot;org.springframework.http.converter.json.MappingJackson2HttpMessageConverter&quot;/&gt;&lt;/mvc:message-converters&gt;&lt;/mvc:annotation-driven&gt;&lt;/beans&gt;4ã€åˆ›å»ºspring-security.xml&lt;?xmlversion=&quot;1.0&quot;encoding=&quot;UTF-8&quot;?&gt;&lt;beans:beansxmlns=&quot;http://www.springframework.org/schema/security&quot;xmlns:beans=&quot;http://www.springframework.org/schema/beans&quot;xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;xsi:schemaLocation=&quot;http://www.springframework.org/schema/beanshttp://www.springframework.org/schema/beans/spring-beans.xsdhttp://www.springframework.org/schema/securityhttp://www.springframework.org/schema/security/spring-security.xsd&quot;&gt;&lt;!--entry-point-refå…¥å£ç‚¹å¼•ç”¨--&gt;&lt;httpuse-expressions=&quot;false&quot;entry-point-ref=&quot;casProcessingFilterEntryPoint&quot;&gt;&lt;intercept-urlpattern=&quot;/**&quot;access=&quot;ROLE_USER&quot;/&gt;&lt;csrfdisabled=&quot;true&quot;/&gt;&lt;!--custom-filterä¸ºè¿‡æ»¤å™¨ï¼Œpositionè¡¨ç¤ºå°†è¿‡æ»¤å™¨æ”¾åœ¨æŒ‡å®šçš„ä½ç½®ä¸Š(å‚ç…§ä½ç½®è¡¨)ï¼Œbeforeè¡¨ç¤ºæ”¾åœ¨æŒ‡å®šä½ç½®ä¹‹å‰ï¼Œafterè¡¨ç¤ºæ”¾åœ¨æŒ‡å®šçš„ä½ç½®ä¹‹å--&gt;&lt;custom-filterref=&quot;casAuthenticationFilter&quot;position=&quot;CAS_FILTER&quot;/&gt;&lt;custom-filterref=&quot;requestSingleLogoutFilter&quot;before=&quot;LOGOUT_FILTER&quot;/&gt;&lt;custom-filterref=&quot;singleLogoutFilter&quot;before=&quot;CAS_FILTER&quot;/&gt;&lt;/http&gt;&lt;!--CASå…¥å£ç‚¹å¼€å§‹--&gt;&lt;beans:beanid=&quot;casProcessingFilterEntryPoint&quot;class=&quot;org.springframework.security.cas.web.CasAuthenticationEntryPoint&quot;&gt;&lt;!--å•ç‚¹ç™»å½•æœåŠ¡å™¨ç™»å½•URL--&gt;&lt;beans:propertyname=&quot;loginUrl&quot;value=&quot;http://localhost:9100/cas/login&quot;/&gt;&lt;beans:propertyname=&quot;serviceProperties&quot;ref=&quot;serviceProperties&quot;/&gt;&lt;/beans:bean&gt;&lt;beans:beanid=&quot;serviceProperties&quot;class=&quot;org.springframework.security.cas.ServiceProperties&quot;&gt;&lt;!--serviceé…ç½®è‡ªèº«å·¥ç¨‹çš„æ ¹åœ°å€+/login/cas--&gt;&lt;beans:propertyname=&quot;service&quot;value=&quot;http://localhost:9003/login/cas&quot;/&gt;&lt;/beans:bean&gt;&lt;!--CASå…¥å£ç‚¹ç»“æŸ--&gt;&lt;!--è®¤è¯è¿‡æ»¤å™¨å¼€å§‹--&gt;&lt;beans:beanid=&quot;casAuthenticationFilter&quot;class=&quot;org.springframework.security.cas.web.CasAuthenticationFilter&quot;&gt;&lt;beans:propertyname=&quot;authenticationManager&quot;ref=&quot;authenticationManager&quot;/&gt;&lt;/beans:bean&gt;&lt;!--è®¤è¯ç®¡ç†å™¨--&gt;&lt;authentication-manageralias=&quot;authenticationManager&quot;&gt;&lt;authentication-providerref=&quot;casAuthenticationProvider&quot;&gt;&lt;/authentication-provider&gt;&lt;/authentication-manager&gt;&lt;!--è®¤è¯æä¾›è€…--&gt;&lt;beans:beanid=&quot;casAuthenticationProvider&quot;class=&quot;org.springframework.security.cas.authentication.CasAuthenticationProvider&quot;&gt;&lt;beans:propertyname=&quot;authenticationUserDetailsService&quot;&gt;&lt;beans:beanclass=&quot;org.springframework.security.core.userdetails.UserDetailsByNameServiceWrapper&quot;&gt;&lt;beans:constructor-argref=&quot;userDetailsService&quot;/&gt;&lt;/beans:bean&gt;&lt;/beans:property&gt;&lt;beans:propertyname=&quot;serviceProperties&quot;ref=&quot;serviceProperties&quot;/&gt;&lt;!--ticketValidatorä¸ºç¥¨æ®éªŒè¯å™¨--&gt;&lt;beans:propertyname=&quot;ticketValidator&quot;&gt;&lt;beans:beanclass=&quot;org.jasig.cas.client.validation.Cas20ServiceTicketValidator&quot;&gt;&lt;beans:constructor-argindex=&quot;0&quot;value=&quot;http://localhost:9100/cas&quot;/&gt;&lt;/beans:bean&gt;&lt;/beans:property&gt;&lt;beans:propertyname=&quot;key&quot;value=&quot;an_id_for_this_auth_provider_only&quot;/&gt;&lt;/beans:bean&gt;&lt;!--è®¤è¯ç±»--&gt;&lt;beans:beanid=&quot;userDetailsService&quot;class=&quot;com.cn.service.impl.UserDetailServiceImpl&quot;/&gt;&lt;!--è®¤è¯è¿‡æ»¤å™¨ç»“æŸ--&gt;&lt;!--å•ç‚¹ç™»å‡ºå¼€å§‹--&gt;&lt;beans:beanid=&quot;singleLogoutFilter&quot;class=&quot;org.jasig.cas.client.session.SingleSignOutFilter&quot;/&gt;&lt;beans:beanid=&quot;requestSingleLogoutFilter&quot;class=&quot;org.springframework.security.web.authentication.logout.LogoutFilter&quot;&gt;&lt;beans:constructor-argvalue=&quot;http://localhost:9100/cas/logout?service=http://www.baidu.com&quot;/&gt;&lt;beans:constructor-arg&gt;&lt;beans:beanclass=&quot;org.springframework.security.web.authentication.logout.SecurityContextLogoutHandler&quot;/&gt;&lt;/beans:constructor-arg&gt;&lt;beans:propertyname=&quot;filterProcessesUrl&quot;value=&quot;/logout/cas&quot;/&gt;&lt;/beans:bean&gt;&lt;!--å•ç‚¹ç™»å‡ºç»“æŸ--&gt;&lt;/beans:beans&gt;5ã€åˆ›å»ºè®¤è¯ç±»publicclassUserDetailServiceImplimplementsUserDetailsService{@OverridepublicUserDetailsloadUserByUsername(Stringusername)throwsUsernameNotFoundException{//æ„å»ºè§’è‰²é›†åˆList&lt;GrantedAuthority&gt;authorities=newArrayList();authorities.add(newSimpleGrantedAuthority(&quot;ROLE_USER&quot;));returnnewUser(username,&quot;&quot;,authorities);}}6ã€ä¿®æ”¹web.xml,æ·»åŠ è¿‡æ»¤å™¨ç­‰é…ç½®&lt;?xmlversion=&quot;1.0&quot;encoding=&quot;UTF-8&quot;?&gt;&lt;web-appxmlns=&quot;http://xmlns.jcp.org/xml/ns/javaee&quot;xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;xsi:schemaLocation=&quot;http://xmlns.jcp.org/xml/ns/javaeehttp://xmlns.jcp.org/xml/ns/javaee/web-app_4_0.xsd&quot;version=&quot;4.0&quot;&gt;&lt;context-param&gt;&lt;param-name&gt;contextConfigLocation&lt;/param-name&gt;&lt;param-value&gt;classpath:spring-security.xml&lt;/param-value&gt;&lt;/context-param&gt;&lt;listener&gt;&lt;listener-class&gt;org.springframework.web.context.ContextLoaderListener&lt;/listener-class&gt;&lt;/listener&gt;&lt;filter&gt;&lt;filter-name&gt;springSecurityFilterChain&lt;/filter-name&gt;&lt;filter-class&gt;org.springframework.web.filter.DelegatingFilterProxy&lt;/filter-class&gt;&lt;/filter&gt;&lt;filter-mapping&gt;&lt;filter-name&gt;springSecurityFilterChain&lt;/filter-name&gt;&lt;url-pattern&gt;/*&lt;/url-pattern&gt;&lt;/filter-mapping&gt;&lt;!--------------------------------------------------------------------------------&gt;&lt;!--è§£å†³postä¹±ç --&gt;&lt;filter&gt;&lt;filter-name&gt;CharacterEncodingFilter&lt;/filter-name&gt;&lt;filter-class&gt;org.springframework.web.filter.CharacterEncodingFilter&lt;/filter-class&gt;&lt;init-param&gt;&lt;param-name&gt;encoding&lt;/param-name&gt;&lt;param-value&gt;utf-8&lt;/param-value&gt;&lt;/init-param&gt;&lt;init-param&gt;&lt;param-name&gt;forceEncoding&lt;/param-name&gt;&lt;param-value&gt;true&lt;/param-value&gt;&lt;/init-param&gt;&lt;/filter&gt;&lt;filter-mapping&gt;&lt;filter-name&gt;CharacterEncodingFilter&lt;/filter-name&gt;&lt;url-pattern&gt;/*&lt;/url-pattern&gt;&lt;/filter-mapping&gt;&lt;servlet&gt;&lt;servlet-name&gt;springmvc&lt;/servlet-name&gt;&lt;servlet-class&gt;org.springframework.web.servlet.DispatcherServlet&lt;/servlet-class&gt;&lt;!--æŒ‡å®šåŠ è½½çš„é…ç½®æ–‡ä»¶ï¼Œé€šè¿‡å‚æ•°contextConfigLocationåŠ è½½--&gt;&lt;init-param&gt;&lt;param-name&gt;contextConfigLocation&lt;/param-name&gt;&lt;param-value&gt;classpath:spring-mvc.xml&lt;/param-value&gt;&lt;/init-param&gt;&lt;load-on-startup&gt;1&lt;/load-on-startup&gt;&lt;/servlet&gt;&lt;servlet-mapping&gt;&lt;servlet-name&gt;springmvc&lt;/servlet-name&gt;&lt;url-pattern&gt;/&lt;/url-pattern&gt;&lt;/servlet-mapping&gt;&lt;/web-app&gt;7ã€åˆ›å»ºUserController@RestControllerpublicclassUserController{@RequestMapping(&quot;/findLoginUser&quot;)publicvoidfindLoginUser(){Stringname=SecurityContextHolder.getContext().getAuthentication().getName();System.out.println(name);}}8ã€é€€å‡ºç™»é™†ä¿®æ”¹spring-security.xmlhttp://localhost:9100/cas/logout?service=http://www.baidu.comserviceç­‰äºç™»å‡ºåè·³è½¬çš„åœ°å€&lt;!--å•ç‚¹ç™»å‡ºå¼€å§‹--&gt;&lt;beans:beanid=&quot;singleLogoutFilter&quot;class=&quot;org.jasig.cas.client.session.SingleSignOutFilter&quot;/&gt;&lt;beans:beanid=&quot;requestSingleLogoutFilter&quot;class=&quot;org.springframework.security.web.authentication.logout.LogoutFilter&quot;&gt;&lt;beans:constructor-argvalue=&quot;http://localhost:9100/cas/logout?service=http://www.baidu.com&quot;/&gt;&lt;beans:constructor-arg&gt;&lt;beans:beanclass=&quot;org.springframework.security.web.authentication.logout.SecurityContextLogoutHandler&quot;/&gt;&lt;/beans:constructor-arg&gt;&lt;beans:propertyname=&quot;filterProcessesUrl&quot;value=&quot;/logout/cas&quot;/&gt;&lt;/beans:bean&gt;&lt;!--å•ç‚¹ç™»å‡ºç»“æŸ--&gt;åœ¨é¡µé¢ä¸Šæ·»åŠ &lt;ahref=&quot;/logout/cas&quot;&gt;é€€å‡ºç™»å½•&lt;/a&gt;","link":"https://haohanya.github.io/post/dan-dian-deng-lu-cas/"},{"title":"Redis","content":"rediså®‰è£…å®‰è£…gccyuminstallgcc-c++è§£å‹æºç tar-zxvfredis-3.0.0.tar.gzè¿›å…¥è§£å‹åçš„ç›®å½•è¿›è¡Œç¼–è¯‘cd/usr/local/redis-3.0.0makePREFIX=/usr/local/redisinstallæ‹·è´é…ç½®æ–‡ä»¶åˆ°å®‰è£…ç›®å½•ä¸‹cd/usr/local/redismkdirconfcp/usr/local/redis-3.0.0/redis.conf/usr/local/redis/binè¿è¡Œbin/redis-serveråç«¯æ¨¡å¼è¿è¡Œä¿®æ”¹redis.confæ–‡ä»¶:daemonizeyes./bin/redis-serverredis.confSpringDataRedisç®€ä»‹Redisredisæ˜¯ä¸€æ¬¾å¼€æºçš„Key-Valueæ•°æ®åº“ï¼Œè¿è¡Œåœ¨å†…å­˜ä¸­ï¼Œç”±ANSICç¼–å†™ã€‚ä¼ä¸šå¼€å‘é€šå¸¸é‡‡ç”¨Redisæ¥å®ç°ç¼“å­˜ã€‚åŒç±»çš„äº§å“è¿˜æœ‰memcacheã€MongoDBç­‰ã€‚JedisJedisæ˜¯Rediså®˜æ–¹æ¨å‡ºçš„ä¸€æ¬¾é¢å‘Javaçš„å®¢æˆ·ç«¯ï¼Œæä¾›äº†å¾ˆå¤šæ¥å£ä¾›Javaè¯­è¨€è°ƒç”¨ã€‚å¯ä»¥åœ¨Rediså®˜ç½‘ä¸‹è½½ï¼Œå½“ç„¶è¿˜æœ‰ä¸€äº›å¼€æºçˆ±å¥½è€…æä¾›çš„å®¢æˆ·ç«¯ï¼Œå¦‚Jredisã€SRPç­‰ç­‰ï¼Œæ¨èä½¿ç”¨Jedisã€‚SpringDataRedisSpring-data-redisæ˜¯springå¤§å®¶æ—çš„ä¸€éƒ¨åˆ†ï¼Œæä¾›äº†åœ¨srpingåº”ç”¨ä¸­é€šè¿‡ç®€å•çš„é…ç½®è®¿é—®redisæœåŠ¡ï¼Œå¯¹reidsåº•å±‚å¼€å‘åŒ…(Jedis,JRedis,andRJC)è¿›è¡Œäº†é«˜åº¦å°è£…ï¼ŒRedisTemplateæä¾›äº†rediså„ç§æ“ä½œã€å¼‚å¸¸å¤„ç†åŠåºåˆ—åŒ–ï¼Œæ”¯æŒå‘å¸ƒè®¢é˜…ï¼Œå¹¶å¯¹spring3.1cacheè¿›è¡Œäº†å®ç°ã€‚spring-data-redisé’ˆå¯¹jedisæä¾›äº†å¦‚ä¸‹åŠŸèƒ½ï¼š1ã€è¿æ¥æ± è‡ªåŠ¨ç®¡ç†ï¼Œæä¾›äº†ä¸€ä¸ªé«˜åº¦å°è£…çš„â€œRedisTemplateâ€ç±»â€‹2ã€é’ˆå¯¹jediså®¢æˆ·ç«¯ä¸­å¤§é‡apiè¿›è¡Œäº†å½’ç±»å°è£…,å°†åŒä¸€ç±»å‹æ“ä½œå°è£…ä¸ºoperationæ¥å£â€‹ValueOperationsï¼šç®€å•K-Væ“ä½œâ€‹SetOperationsï¼šsetç±»å‹æ•°æ®æ“ä½œâ€‹ZSetOperationsï¼šzsetç±»å‹æ•°æ®æ“ä½œâ€‹HashOperationsï¼šé’ˆå¯¹mapç±»å‹çš„æ•°æ®æ“ä½œâ€‹ListOperationsï¼šé’ˆå¯¹listç±»å‹çš„æ•°æ®æ“ä½œSpringDataRediså…¥é—¨å°Demo1ã€å¼•å…¥ä¾èµ–&lt;!--ç¼“å­˜--&gt;&lt;dependency&gt;&lt;groupId&gt;redis.clients&lt;/groupId&gt;&lt;artifactId&gt;jedis&lt;/artifactId&gt;&lt;version&gt;2.8.1&lt;/version&gt;&lt;/dependency&gt;&lt;dependency&gt;&lt;groupId&gt;org.springframework.data&lt;/groupId&gt;&lt;artifactId&gt;spring-data-redis&lt;/artifactId&gt;&lt;version&gt;1.7.2.RELEASE&lt;/version&gt;&lt;/dependency&gt;2ã€åˆ›å»ºredis-config.propertiesredis.host=127.0.0.1redis.port=6379redis.pass=redis.database=0redis.maxIdle=300redis.maxWait=3000redis.testOnBorrow=true3ã€ç¼–å†™redisé…ç½®æ–‡ä»¶applicationContext-redis.xml&lt;context:property-placeholderlocation=&quot;classpath*:properties/*.properties&quot;/&gt;&lt;!--redisç›¸å…³é…ç½®--&gt;&lt;beanid=&quot;poolConfig&quot;class=&quot;redis.clients.jedis.JedisPoolConfig&quot;&gt;&lt;propertyname=&quot;maxIdle&quot;value=&quot;${redis.maxIdle}&quot;/&gt;&lt;propertyname=&quot;maxWaitMillis&quot;value=&quot;${redis.maxWait}&quot;/&gt;&lt;propertyname=&quot;testOnBorrow&quot;value=&quot;${redis.testOnBorrow}&quot;/&gt;&lt;/bean&gt;&lt;beanid=&quot;JedisConnectionFactory&quot;class=&quot;org.springframework.data.redis.connection.jedis.JedisConnectionFactory&quot;p:host-name=&quot;${redis.host}&quot;p:port=&quot;${redis.port}&quot;p:password=&quot;${redis.pass}&quot;p:pool-config-ref=&quot;poolConfig&quot;/&gt;&lt;beanid=&quot;redisTemplate&quot;class=&quot;org.springframework.data.redis.core.RedisTemplate&quot;&gt;&lt;propertyname=&quot;connectionFactory&quot;ref=&quot;JedisConnectionFactory&quot;/&gt;&lt;/bean&gt;maxIdleï¼šæœ€å¤§ç©ºé—²æ•°maxWaitMillis:è¿æ¥æ—¶çš„æœ€å¤§ç­‰å¾…æ¯«ç§’æ•°testOnBorrowï¼šåœ¨æå–ä¸€ä¸ªjediså®ä¾‹æ—¶ï¼Œæ˜¯å¦æå‰è¿›è¡ŒéªŒè¯æ“ä½œï¼›å¦‚æœä¸ºtrueï¼Œåˆ™å¾—åˆ°çš„jediså®ä¾‹å‡æ˜¯å¯ç”¨çš„ï¼›4ã€å€¼ç±»å‹æ“ä½œ@RunWith(SpringJUnit4ClassRunner.class)@ContextConfiguration(locations=&quot;classpath:spring/applicationContext-redis.xml&quot;)publicclassTestValue{@AutowiredprivateRedisTemplateredisTemplate;@TestpublicvoidsetValue(){redisTemplate.boundValueOps(&quot;name&quot;).set(&quot;zhangsan&quot;);}@TestpublicvoidgetValue(){Stringstr=(String)redisTemplate.boundValueOps(&quot;name&quot;).get();System.out.println(str);}@TestpublicvoiddeleteValue(){redisTemplate.delete(&quot;name&quot;);;}}5ã€Setç±»å‹æ“ä½œ@RunWith(SpringJUnit4ClassRunner.class)@ContextConfiguration(locations=&quot;classpath:spring/applicationContext-redis.xml&quot;)publicclassTestSet{@AutowiredprivateRedisTemplateredisTemplate;/***å­˜å…¥å€¼*/@TestpublicvoidsetValue(){redisTemplate.boundSetOps(&quot;nameset&quot;).add(&quot;ç½—å¿—ç¥¥&quot;);redisTemplate.boundSetOps(&quot;nameset&quot;).add(&quot;å‘¨æ‰¬é’&quot;);redisTemplate.boundSetOps(&quot;nameset&quot;).add(&quot;è´è¶å§&quot;);}/***æå–å€¼*/@TestpublicvoidgetValue(){Setmembers=redisTemplate.boundSetOps(&quot;nameset&quot;).members();System.out.println(members);}/***åˆ é™¤é›†åˆä¸­çš„æŸä¸€ä¸ªå€¼*/@TestpublicvoiddeleteValue(){redisTemplate.boundSetOps(&quot;nameset&quot;).remove(&quot;è´è¶å§&quot;);}/***åˆ é™¤æ•´ä¸ªé›†åˆ*/@TestpublicvoiddeleteAllValue(){redisTemplate.delete(&quot;nameset&quot;);}}6ã€Listç±»å‹æ“ä½œ6.1ã€å³å‹æ ˆ/***å³å‹æ ˆï¼šåæ·»åŠ çš„å¯¹è±¡æ’åœ¨åè¾¹*/@TestpublicvoidtestSetValue1(){redisTemplate.boundListOps(&quot;namelist1&quot;).rightPush(&quot;åˆ˜å¤‡&quot;);redisTemplate.boundListOps(&quot;namelist1&quot;).rightPush(&quot;å…³ç¾½&quot;);redisTemplate.boundListOps(&quot;namelist1&quot;).rightPush(&quot;å¼ é£&quot;);}/***æ˜¾ç¤ºå³å‹æ ˆé›†åˆ*/@TestpublicvoidtestGetValue1(){Listlist=redisTemplate.boundListOps(&quot;namelist1&quot;).range(0,10);System.out.println(list);}//è¿è¡Œç»“æœï¼š[åˆ˜å¤‡,å…³ç¾½,å¼ é£]6.2ã€å·¦å‹æ ˆ/***å·¦å‹æ ˆï¼šåæ·»åŠ çš„å¯¹è±¡æ’åœ¨å‰è¾¹*/@TestpublicvoidtestSetValue2(){redisTemplate.boundListOps(&quot;namelist2&quot;).leftPush(&quot;åˆ˜å¤‡&quot;);redisTemplate.boundListOps(&quot;namelist2&quot;).leftPush(&quot;å…³ç¾½&quot;);redisTemplate.boundListOps(&quot;namelist2&quot;).leftPush(&quot;å¼ é£&quot;);}/***æ˜¾ç¤ºå·¦å‹æ ˆé›†åˆ*/@TestpublicvoidtestGetValue2(){Listlist=redisTemplate.boundListOps(&quot;namelist2&quot;).range(0,10);System.out.println(list);}//è¿è¡Œç»“æœï¼š[å¼ é£,å…³ç¾½,åˆ˜å¤‡]6.3ã€æ ¹æ®ç´¢å¼•æŸ¥è¯¢å…ƒç´ /***æŸ¥è¯¢é›†åˆæŸä¸ªå…ƒç´ */@TestpublicvoidtestSearchByIndex(){Strings=(String)redisTemplate.boundListOps(&quot;namelist1&quot;).index(1);System.out.println(s);}6.4ã€ç§»é™¤æŸä¸ªå…ƒç´ çš„å€¼/***ç§»é™¤é›†åˆæŸä¸ªå…ƒç´ */@TestpublicvoidtestRemoveByIndex(){redisTemplate.boundListOps(&quot;namelist1&quot;).remove(1,&quot;å…³ç¾½&quot;);}7ã€Hashç±»å‹æ“ä½œ7.1ã€å­˜å…¥å€¼@TestpublicvoidtestSetValue(){redisTemplate.boundHashOps(&quot;namehash&quot;).put(&quot;a&quot;,&quot;å”åƒ§&quot;);redisTemplate.boundHashOps(&quot;namehash&quot;).put(&quot;b&quot;,&quot;æ‚Ÿç©º&quot;);redisTemplate.boundHashOps(&quot;namehash&quot;).put(&quot;c&quot;,&quot;å…«æˆ’&quot;);redisTemplate.boundHashOps(&quot;namehash&quot;).put(&quot;d&quot;,&quot;æ²™åƒ§&quot;);}7.2ã€æå–æ‰€æœ‰çš„KEY@TestpublicvoidtestGetKeys(){Sets=redisTemplate.boundHashOps(&quot;namehash&quot;).keys();System.out.println(s);}//è¿è¡Œç»“æœï¼š[a,b,c,d]7.3ã€æå–æ‰€æœ‰çš„å€¼@TestpublicvoidtestGetValues(){Listvalues=redisTemplate.boundHashOps(&quot;namehash&quot;).values();System.out.println(values);}//è¿è¡Œç»“æœï¼š[å”åƒ§,æ‚Ÿç©º,å…«æˆ’,æ²™åƒ§]7.4ã€æ ¹æ®KEYæå–å€¼@TestpublicvoidtestGetValueByKey(){Objectobject=redisTemplate.boundHashOps(&quot;namehash&quot;).get(&quot;b&quot;);System.out.println(object);}//è¿è¡Œç»“æœï¼šæ‚Ÿç©º7.5ã€æ ¹æ®KEYç§»é™¤å€¼@TestpublicvoidtestRemoveValueByKey(){redisTemplate.boundHashOps(&quot;namehash&quot;).delete(&quot;c&quot;);}//è¿è¡Œç»“æœï¼š[å”åƒ§,æ‚Ÿç©º,æ²™åƒ§]","link":"https://haohanya.github.io/post/redis/"},{"title":"ActiveMQ","content":"ä»€ä¹ˆæ˜¯jmsJMSï¼ˆjavaMessagingServiceï¼‰æ˜¯Javaå¹³å°ä¸Šæœ‰å…³é¢å‘æ¶ˆæ¯ä¸­é—´ä»¶çš„æŠ€æœ¯è§„èŒƒï¼Œå®ƒä¾¿äºæ¶ˆæ¯ç³»ç»Ÿä¸­çš„Javaåº”ç”¨ç¨‹åºè¿›è¡Œæ¶ˆæ¯äº¤æ¢,å¹¶ä¸”é€šè¿‡æä¾›æ ‡å‡†çš„äº§ç”Ÿã€å‘é€ã€æ¥æ”¶æ¶ˆæ¯çš„æ¥å£ç®€åŒ–ä¼ä¸šåº”ç”¨çš„å¼€å‘ã€‚â€‹JMSæœ¬èº«åªå®šä¹‰äº†ä¸€ç³»åˆ—çš„æ¥å£è§„èŒƒï¼Œæ˜¯ä¸€ç§ä¸å‚å•†æ— å…³çš„APIï¼Œç”¨æ¥è®¿é—®æ¶ˆæ¯æ”¶å‘ç³»ç»Ÿã€‚å®ƒç±»ä¼¼äºJDBC(javaDatabaseConnectivity)ï¼šè¿™é‡Œï¼ŒJDBCæ˜¯å¯ä»¥ç”¨æ¥è®¿é—®è®¸å¤šä¸åŒå…³ç³»æ•°æ®åº“çš„APIï¼Œè€ŒJMSåˆ™æä¾›åŒæ ·ä¸å‚å•†æ— å…³çš„è®¿é—®æ–¹æ³•ï¼Œä»¥è®¿é—®æ¶ˆæ¯æ”¶å‘æœåŠ¡ã€‚è®¸å¤šå‚å•†ç›®å‰éƒ½æ”¯æŒJMSï¼ŒåŒ…æ‹¬IBMçš„MQSeriesã€BEAçš„WeblogicJMSserviceå’ŒProgressçš„SonicMQï¼Œè¿™åªæ˜¯å‡ ä¸ªä¾‹å­ã€‚JMSä½¿æ‚¨èƒ½å¤Ÿé€šè¿‡æ¶ˆæ¯æ”¶å‘æœåŠ¡ï¼ˆæœ‰æ—¶ç§°ä¸ºæ¶ˆæ¯ä¸­ä»‹ç¨‹åºæˆ–è·¯ç”±å™¨ï¼‰ä»ä¸€ä¸ªJMSå®¢æˆ·æœºå‘å¦ä¸€ä¸ªJMLå®¢æˆ·æœºå‘é€æ¶ˆæ¯ã€‚æ¶ˆæ¯æ˜¯JMSä¸­çš„ä¸€ç§ç±»å‹å¯¹è±¡ï¼Œç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼šæŠ¥å¤´å’Œæ¶ˆæ¯ä¸»ä½“ã€‚æŠ¥å¤´ç”±è·¯ç”±ä¿¡æ¯ä»¥åŠæœ‰å…³è¯¥æ¶ˆæ¯çš„å…ƒæ•°æ®ç»„æˆã€‚æ¶ˆæ¯ä¸»ä½“åˆ™æºå¸¦ç€åº”ç”¨ç¨‹åºçš„æ•°æ®æˆ–æœ‰æ•ˆè´Ÿè½½ã€‚JMSå®šä¹‰äº†äº”ç§ä¸åŒçš„æ¶ˆæ¯æ­£æ–‡æ ¼å¼ï¼Œä»¥åŠè°ƒç”¨çš„æ¶ˆæ¯ç±»å‹ï¼Œå…è®¸ä½ å‘é€å¹¶æ¥æ”¶ä»¥ä¸€äº›ä¸åŒå½¢å¼çš„æ•°æ®ï¼Œæä¾›ç°æœ‰æ¶ˆæ¯æ ¼å¼çš„ä¸€äº›çº§åˆ«çš„å…¼å®¹æ€§ã€‚TextMessage--ä¸€ä¸ªå­—ç¬¦ä¸²å¯¹è±¡ï¼ˆåº”ç”¨æœ€å¹¿æ³›çš„ä¸€ç§ï¼‰MapMessage--ä¸€å¥—åç§°-å€¼å¯¹ObjectMessage--ä¸€ä¸ªåºåˆ—åŒ–çš„Javaå¯¹è±¡BytesMessage--ä¸€ä¸ªå­—èŠ‚çš„æ•°æ®æµStreamMessage--JavaåŸå§‹å€¼çš„æ•°æ®æµJMSæ¶ˆæ¯ä¼ é€’ç±»å‹å¯¹äºæ¶ˆæ¯çš„ä¼ é€’æœ‰ä¸¤ç§ç±»å‹ï¼šä¸€ç§æ˜¯ç‚¹å¯¹ç‚¹çš„ï¼Œå³ä¸€ä¸ªç”Ÿäº§è€…å’Œä¸€ä¸ªæ¶ˆè´¹è€…ä¸€ä¸€å¯¹åº”ï¼›å¦ä¸€ç§æ˜¯å‘å¸ƒ/è®¢é˜…æ¨¡å¼ï¼Œå³ä¸€ä¸ªç”Ÿäº§è€…äº§ç”Ÿæ¶ˆæ¯å¹¶è¿›è¡Œå‘é€åï¼Œå¯ä»¥ç”±å¤šä¸ªæ¶ˆè´¹è€…è¿›è¡Œæ¥æ”¶ã€‚å®‰è£…1ã€ä¸Šä¼ activeMQåˆ°æœåŠ¡å™¨2ã€è§£å‹tar-zxvfapache-activemq-5.12.0-bin.tar.gz3ã€ç§»åŠ¨æ–‡ä»¶mvapache-activemq-5.12.0/usr/local/java/activemq-5.12.04ã€è¿›å…¥bincd/usr/local/java/activemq-5.12.0/bin5ã€å¯åŠ¨activeMQ./activemqstart6ã€è®¿é—®ï¼šip:8161è´¦å·ï¼šadminå¯†ç ï¼šadminJMSæµ‹è¯•ç‚¹å¯¹ç‚¹æ¨¡å¼1ã€å¼•å…¥ä¾èµ–&lt;dependencies&gt;&lt;dependency&gt;&lt;groupId&gt;org.apache.activemq&lt;/groupId&gt;&lt;artifactId&gt;activemq-client&lt;/artifactId&gt;&lt;version&gt;5.13.4&lt;/version&gt;&lt;/dependency&gt;&lt;/dependencies&gt;2ã€åˆ›å»ºæ¶ˆæ¯ç”Ÿäº§è€…QueueProducerpublicstaticvoidmain(String[]args)throwsJMSException{//1ã€åˆ›å»ºå·¥å‚ConnectionFactoryconnectionFactory=newActiveMQConnectionFactory(&quot;tcp://192.168.25.135:61616&quot;);//2ã€è·å–è¿æ¥Connectionconnection=connectionFactory.createConnection();//3ã€å¯åŠ¨è¿æ¥connection.start();/**4ã€è·å–sessionå‚æ•°1ï¼šæ˜¯å¦å¯ç”¨äº‹åŠ¡å‚æ•°2ï¼šæ¶ˆæ¯ç¡®è®¤æ¨¡å¼AUTO_ACKNOWLEDGE=1è‡ªåŠ¨ç¡®è®¤CLIENT_ACKNOWLEDGE=2å®¢æˆ·ç«¯æ‰‹åŠ¨ç¡®è®¤DUPS_OK_ACKNOWLEDGE=3è‡ªåŠ¨æ‰¹é‡ç¡®è®¤SESSION_TRANSACTED=0äº‹åŠ¡æäº¤å¹¶ç¡®è®¤*/Sessionsession=connection.createSession(false,Session.AUTO_ACKNOWLEDGE);//5ã€åˆ›å»ºé˜Ÿåˆ—å¯¹è±¡Queuequeue=session.createQueue(&quot;test-queue&quot;);//6ã€åˆ›å»ºæ¶ˆæ¯ç”Ÿäº§ç€MessageProducermessageProducer=session.createProducer(queue);//7ã€åˆ›å»ºæ¶ˆæ¯TextMessagetextMessage=session.createTextMessage(&quot;æµ‹è¯•æ–‡æœ¬å†…å®¹&quot;);//8ã€å‘é€æ¶ˆæ¯messageProducer.send(textMessage);//9ã€å…³é—­èµ„æºmessageProducer.close();session.close();connection.close();}3ã€åˆ›å»ºæ¶ˆæ¯æ¶ˆè´¹è€…QueueConsumerpublicstaticvoidmain(String[]args)throwsJMSException,IOException{//1ã€åˆ›å»ºè¿æ¥å·¥å‚ConnectionFactoryconnectionFactory=newActiveMQConnectionFactory(&quot;tcp://192.168.25.135:61616&quot;);//2ã€è·å–è¿æ¥Connectionconnection=connectionFactory.createConnection();//3ã€å¯åŠ¨è¿æ¥connection.start();//4ã€è·å–sessionSessionsession=connection.createSession(false,Session.AUTO_ACKNOWLEDGE);//5ã€åˆ›å»ºé˜Ÿåˆ—å¯¹è±¡Queuequeue=session.createQueue(&quot;test-queue&quot;);//6ã€åˆ›å»ºæ¶ˆæ¯æ¶ˆè´¹MessageConsumerconsumer=session.createConsumer(queue);//7ã€ç›‘å¬æ¶ˆæ¯consumer.setMessageListener(newMessageListener(){@OverridepublicvoidonMessage(Messagemessage){TextMessagetextMessage=(TextMessage)message;try{System.out.println(&quot;æ¥æ”¶æ¶ˆæ¯ä¸ºï¼š&quot;+textMessage.getText());}catch(JMSExceptione){e.printStackTrace();}}});//8ã€ç­‰å¾…é”®ç›˜è¾“å…¥System.in.read();//9ã€å…³é—­èµ„æºconsumer.close();session.close();connection.close();}å‘å¸ƒ/è®¢é˜…æ¨¡å¼1ã€æ¶ˆæ¯ç”Ÿäº§è€…TopicProducerpublicstaticvoidmain(String[]args)throwsJMSException,IOException{//1ã€åˆ›å»ºè¿æ¥å·¥å‚ConnectionFactoryconnectionFactory=newActiveMQConnectionFactory(&quot;tcp://192.168.25.135:61616&quot;);//2ã€è·å–è¿æ¥Connectionconnection=connectionFactory.createConnection();//3ã€å¯åŠ¨è¿æ¥connection.start();//4ã€è·å–sessionSessionsession=connection.createSession(false,Session.AUTO_ACKNOWLEDGE);//5ã€åˆ›å»ºä¸»é¢˜å¯¹è±¡Topictopic=session.createTopic(&quot;test-topic&quot;);//6ã€åˆ›å»ºæ¶ˆæ¯æ¶ˆè´¹è€…MessageConsumerconsumer=session.createConsumer(topic);//7ã€ç›‘å¬æ¶ˆæ¯consumer.setMessageListener(newMessageListener(){@OverridepublicvoidonMessage(Messagemessage){TextMessagetextMessage=(TextMessage)message;try{System.out.println(&quot;æ¥æ”¶æ¶ˆæ¯ï¼š&quot;+textMessage.getText());}catch(JMSExceptione){e.printStackTrace();}}});//8ã€ç­‰å¾…é”®ç›˜è¾“å…¥System.in.read();//9ã€å…³é—­èµ„æºconsumer.close();session.close();connection.close();}2ã€æ¶ˆæ¯æ¶ˆè´¹è€…TopicProducerpublicstaticvoidmain(String[]args)throwsJMSException{//1ã€åˆ›å»ºè¿æ¥å·¥å‚ConnectionFactoryconnectionFactory=newActiveMQConnectionFactory(&quot;tcp://192.168.25.135:61616&quot;);//2ã€è·å–è¿æ¥Connectionconnection=connectionFactory.createConnection();//3ã€å¯åŠ¨è¿æ¥connection.start();//4ã€è·å–sessionSessionsession=connection.createSession(false,Session.AUTO_ACKNOWLEDGE);//5ã€åˆ›å»ºä¸»é¢˜å¯¹è±¡Topictopic=session.createTopic(&quot;test-topic&quot;);//6ã€åˆ›å»ºæ¶ˆæ¯ç”Ÿäº§è€…MessageProducerproducer=session.createProducer(topic);//7ã€åˆ›å»ºæ¶ˆæ¯TextMessagetopicTest=session.createTextMessage(&quot;topicTest&quot;);//8ã€å‘é€æ¶ˆæ¯producer.send(topicTest);//9ã€å…³é—­èµ„æºproducer.close();session.close();connection.close();}springæ•´åˆjmsç‚¹å¯¹ç‚¹æ¨¡å¼1ã€å¼•å…¥ä¾èµ–&lt;!--spring-jms--&gt;&lt;dependency&gt;&lt;groupId&gt;org.springframework&lt;/groupId&gt;&lt;artifactId&gt;spring-jms&lt;/artifactId&gt;&lt;version&gt;4.2.4.RELEASE&lt;/version&gt;&lt;/dependency&gt;&lt;!--activemq--&gt;&lt;dependency&gt;&lt;groupId&gt;org.apache.activemq&lt;/groupId&gt;&lt;artifactId&gt;activemq-all&lt;/artifactId&gt;&lt;version&gt;5.11.2&lt;/version&gt;&lt;/dependency&gt;&lt;!--å•å…ƒæµ‹è¯•--&gt;&lt;!--springJunit--&gt;&lt;dependency&gt;&lt;groupId&gt;org.springframework&lt;/groupId&gt;&lt;artifactId&gt;spring-test&lt;/artifactId&gt;&lt;version&gt;4.2.4.RELEASE&lt;/version&gt;&lt;scope&gt;test&lt;/scope&gt;&lt;/dependency&gt;&lt;dependency&gt;&lt;groupId&gt;junit&lt;/groupId&gt;&lt;artifactId&gt;junit&lt;/artifactId&gt;&lt;version&gt;4.12&lt;/version&gt;&lt;scope&gt;test&lt;/scope&gt;&lt;/dependency&gt;2ã€åˆ›å»ºç”Ÿäº§è€…é…ç½®æ–‡ä»¶applicationContext-jms-producer-queue.xml&lt;?xmlversion=&quot;1.0&quot;encoding=&quot;UTF-8&quot;?&gt;&lt;beansxmlns=&quot;http://www.springframework.org/schema/beans&quot;xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;xmlns:context=&quot;http://www.springframework.org/schema/context&quot;xsi:schemaLocation=&quot;http://www.springframework.org/schema/beanshttp://www.springframework.org/schema/beans/spring-beans.xsdhttp://www.springframework.org/schema/contexthttp://www.springframework.org/schema/context/spring-context.xsd&quot;&gt;&lt;!--æ¶ˆæ¯ç”Ÿäº§è€…:ç‚¹å¯¹ç‚¹--&gt;&lt;context:component-scanbase-package=&quot;com.springjms&quot;/&gt;&lt;!--jmsæœåŠ¡å‚å•†æä¾›çš„è¿æ¥å·¥å‚--&gt;&lt;beanid=&quot;targetConnectionFactory&quot;class=&quot;org.apache.activemq.ActiveMQConnectionFactory&quot;&gt;&lt;propertyname=&quot;brokerURL&quot;value=&quot;tcp://192.168.25.137:61616&quot;/&gt;&lt;/bean&gt;&lt;!--springç”¨äºç®¡ç†çœŸæ­£çš„ConnectionFactory--&gt;&lt;beanid=&quot;connectionFactory&quot;class=&quot;org.springframework.jms.connection.SingleConnectionFactory&quot;&gt;&lt;propertyname=&quot;targetConnectionFactory&quot;ref=&quot;targetConnectionFactory&quot;/&gt;&lt;/bean&gt;&lt;!--springæä¾›çš„å·¥å…·ç±»--&gt;&lt;beanid=&quot;jmsTemplate&quot;class=&quot;org.springframework.jms.core.JmsTemplate&quot;&gt;&lt;constructor-argname=&quot;connectionFactory&quot;ref=&quot;connectionFactory&quot;/&gt;&lt;/bean&gt;&lt;!--queue--&gt;&lt;beanid=&quot;queueTextDestination&quot;class=&quot;org.apache.activemq.command.ActiveMQQueue&quot;&gt;&lt;constructor-argname=&quot;name&quot;value=&quot;queue_text&quot;/&gt;&lt;/bean&gt;&lt;/beans&gt;3ã€å‘é€æ¶ˆæ¯@ComponentpublicclassQueueProducer{@ResourceprivateJmsTemplatejmsTemplate;@ResourceprivateDestinationqueueTextDestination;/***å‘é€æ–‡æœ¬æ¶ˆæ¯*@paramtextå‘é€çš„æ–‡æœ¬å†…å®¹*/publicvoidsendTextMessage(finalStringtext){jmsTemplate.send(queueTextDestination,newMessageCreator(){@OverridepublicMessagecreateMessage(Sessionsession)throwsJMSException{returnsession.createTextMessage(text);}});}}4ã€æµ‹è¯•å‘é€æ¶ˆæ¯@RunWith(SpringJUnit4ClassRunner.class)@ContextConfiguration(locations=&quot;classpath:applicationContext-jms-producer-queue.xml&quot;)publicclassMyTest{@ResourceprivateQueueProducerqueueProducer;@Testpublicvoidtest(){queueProducer.sendTextMessage(&quot;Hello!queue&quot;);}}5ã€åˆ›å»ºæ¶ˆè´¹è€…é…ç½®æ–‡ä»¶applicationContext-jms-consumer-queue.xml&lt;?xmlversion=&quot;1.0&quot;encoding=&quot;UTF-8&quot;?&gt;&lt;beansxmlns=&quot;http://www.springframework.org/schema/beans&quot;xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;xsi:schemaLocation=&quot;http://www.springframework.org/schema/beanshttp://www.springframework.org/schema/beans/spring-beans.xsd&quot;&gt;&lt;!--æœåŠ¡æ¶ˆè´¹è€…:ç‚¹å¯¹ç‚¹--&gt;&lt;!--jsmæœåŠ¡å‚å•†æä¾›çš„è¿æ¥å·¥å‚--&gt;&lt;beanid=&quot;targetConnectionFactory&quot;class=&quot;org.apache.activemq.ActiveMQConnectionFactory&quot;&gt;&lt;propertyname=&quot;brokerURL&quot;value=&quot;tcp://192.168.25.137:61616&quot;/&gt;&lt;/bean&gt;&lt;!--springç”¨äºç®¡ç†çœŸæ­£çš„ConnectionFactory--&gt;&lt;beanid=&quot;connectionFactory&quot;class=&quot;org.springframework.jms.connection.SingleConnectionFactory&quot;&gt;&lt;propertyname=&quot;targetConnectionFactory&quot;ref=&quot;targetConnectionFactory&quot;/&gt;&lt;/bean&gt;&lt;!--springæä¾›çš„å·¥å…·ç±»--&gt;&lt;beanid=&quot;jmsTemplate&quot;class=&quot;org.springframework.jms.core.JmsTemplate&quot;&gt;&lt;constructor-argname=&quot;connectionFactory&quot;ref=&quot;connectionFactory&quot;/&gt;&lt;/bean&gt;&lt;!--queue--&gt;&lt;beanid=&quot;queueTextDestination&quot;class=&quot;org.apache.activemq.command.ActiveMQQueue&quot;&gt;&lt;constructor-argname=&quot;name&quot;value=&quot;queue_text&quot;/&gt;&lt;/bean&gt;&lt;!--ç›‘å¬ç±»,ç”¨æ¥ç›‘å¬mqä¸­æ˜¯å¦æœ‰æ¶ˆæ¯--&gt;&lt;beanid=&quot;myMessageListener&quot;class=&quot;com.springjms.MyMessageListener&quot;/&gt;&lt;!--æ¶ˆæ¯çš„ç›‘å¬å™¨--&gt;&lt;beanclass=&quot;org.springframework.jms.listener.DefaultMessageListenerContainer&quot;&gt;&lt;propertyname=&quot;connectionFactory&quot;ref=&quot;connectionFactory&quot;/&gt;&lt;propertyname=&quot;destination&quot;ref=&quot;queueTextDestination&quot;/&gt;&lt;propertyname=&quot;messageListener&quot;ref=&quot;myMessageListener&quot;/&gt;&lt;/bean&gt;&lt;/beans&gt;6ã€ç¼–å†™ç›‘å¬ç±»publicclassMyMessageListenerimplementsMessageListener{@OverridepublicvoidonMessage(Messagemessage){TextMessagetextMessage=(TextMessage)message;try{System.out.println(&quot;æ¥æ”¶åˆ°æ¶ˆæ¯ï¼š&quot;+textMessage.getText());}catch(JMSExceptione){e.printStackTrace();}}}7ã€æµ‹è¯•@RunWith(SpringJUnit4ClassRunner.class)@ContextConfiguration(locations=&quot;classpath:applicationContext-jms-consumer-queue.xml&quot;)publicclassMyTest1{@TestpublicvoidtestQueue(){try{System.in.read();}catch(IOExceptione){e.printStackTrace();}}}å‘å¸ƒ/è®¢é˜…æ¨¡å¼1ã€åˆ›å»ºç”Ÿäº§è€…ï¼Œåœ¨applicationContext-jms-producer-queue.xmlæ–°å¢å†…å®¹&lt;!--è¿™ä¸ªæ˜¯è®¢é˜…æ¨¡å¼æ–‡æœ¬ä¿¡æ¯--&gt;&lt;beanid=&quot;topicTextDestination&quot;class=&quot;org.apache.activemq.command.ActiveMQTopic&quot;&gt;&lt;constructor-argvalue=&quot;topic_text&quot;/&gt;&lt;/bean&gt;2ã€å‘é€æ¶ˆæ¯@ComponentpublicclassTopicProducer{@ResourceprivateJmsTemplatejmsTemplate;@ResourceprivateDestinationtopicTextDestination;/***å‘é€æ¶ˆæ¯*@paramtext*/publicvoidsendMessage(finalStringtext){jmsTemplate.send(topicTextDestination,newMessageCreator(){@OverridepublicMessagecreateMessage(Sessionsession)throwsJMSException{returnsession.createTextMessage(text);}});}}3ã€æµ‹è¯•@RunWith(SpringJUnit4ClassRunner.class)@ContextConfiguration(locations=&quot;classpath:applicationContext-jms-producer-topic.xml&quot;)publicclassMyTest2{@ResourceprivateTopicProducertopicProducer;@Testpublicvoidtest(){topicProducer.sendMessage(&quot;Hello!topic&quot;);}}4ã€åˆ›å»ºæ¶ˆè´¹è€…ï¼Œåœ¨applicationContext-jms-consumer-queue.xmlæ–°å¢å†…å®¹&lt;!--topic--&gt;&lt;beanid=&quot;topicTextDestination&quot;class=&quot;org.apache.activemq.command.ActiveMQTopic&quot;&gt;&lt;constructor-argname=&quot;name&quot;value=&quot;topic_text&quot;/&gt;&lt;/bean&gt;&lt;!--ç›‘å¬ç±»,ç”¨æ¥ç›‘å¬mqä¸­æ˜¯å¦æœ‰æ¶ˆæ¯--&gt;&lt;beanid=&quot;topicMessageListener&quot;class=&quot;com.springjms.TopicMessageListener&quot;/&gt;&lt;!--æ¶ˆæ¯çš„ç›‘å¬å™¨--&gt;&lt;beanclass=&quot;org.springframework.jms.listener.DefaultMessageListenerContainer&quot;&gt;&lt;propertyname=&quot;connectionFactory&quot;ref=&quot;connectionFactory&quot;/&gt;&lt;propertyname=&quot;destination&quot;ref=&quot;topicTextDestination&quot;/&gt;&lt;propertyname=&quot;messageListener&quot;ref=&quot;topicMessageListener&quot;/&gt;&lt;/bean&gt;5ã€ç¼–å†™ç›‘å¬ç±»publicclassTopicMessageListenerimplementsMessageListener{@OverridepublicvoidonMessage(Messagemessage){TextMessagetextMessage=(TextMessage)message;try{System.out.println(&quot;æ¥æ”¶åˆ°æ¶ˆæ¯ï¼š&quot;+textMessage.getText());}catch(JMSExceptione){e.printStackTrace();}}}6ã€ç¼–å†™æµ‹è¯•ç±»@RunWith(SpringJUnit4ClassRunner.class)@ContextConfiguration(locations=&quot;classpath:applicationContext-jms-consumer-topic.xml&quot;)publicclassMyTest3{@TestpublicvoidtestQueue(){try{System.in.read();}catch(IOExceptione){e.printStackTrace();}}}","link":"https://haohanya.github.io/post/activemq/"},{"title":"solrå®‰è£…ä½¿ç”¨","content":"ä»€ä¹ˆæ˜¯Solrå¤§å¤šæ•°æœç´¢å¼•æ“åº”ç”¨éƒ½å¿…é¡»å…·æœ‰æŸç§æœç´¢åŠŸèƒ½ï¼Œé—®é¢˜æ˜¯æœç´¢åŠŸèƒ½å¾€å¾€æ˜¯å·¨å¤§çš„èµ„æºæ¶ˆè€—å¹¶ä¸”å®ƒä»¬ç”±äºæ²‰é‡çš„æ•°æ®åº“åŠ è½½è€Œæ‹–å®ä½ çš„åº”ç”¨çš„æ€§èƒ½ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆè½¬ç§»è´Ÿè½½åˆ°ä¸€ä¸ªå¤–éƒ¨çš„æœç´¢æœåŠ¡å™¨æ˜¯ä¸€ä¸ªä¸é”™çš„ä¸»æ„ï¼ŒApacheSolræ˜¯ä¸€ä¸ªæµè¡Œçš„å¼€æºæœç´¢æœåŠ¡å™¨ï¼Œå®ƒé€šè¿‡ä½¿ç”¨ç±»ä¼¼RESTçš„HTTPAPIï¼Œè¿™å°±ç¡®ä¿ä½ èƒ½ä»å‡ ä¹ä»»ä½•ç¼–ç¨‹è¯­è¨€æ¥ä½¿ç”¨solrã€‚Solræ˜¯ä¸€ä¸ªå¼€æºæœç´¢å¹³å°ï¼Œç”¨äºæ„å»ºæœç´¢åº”ç”¨ç¨‹åºã€‚å®ƒå»ºç«‹åœ¨Lucene(å…¨æ–‡æœç´¢å¼•æ“)ä¹‹ä¸Šã€‚Solræ˜¯ä¼ä¸šçº§çš„ï¼Œå¿«é€Ÿçš„å’Œé«˜åº¦å¯æ‰©å±•çš„ã€‚ä½¿ç”¨Solræ„å»ºçš„åº”ç”¨ç¨‹åºéå¸¸å¤æ‚ï¼Œå¯æä¾›é«˜æ€§èƒ½ã€‚ä¸ºäº†åœ¨CNETç½‘ç»œçš„å…¬å¸ç½‘ç«™ä¸Šæ·»åŠ æœç´¢åŠŸèƒ½ï¼ŒYonikSeelyäº2004å¹´åˆ›å»ºäº†Solrã€‚å¹¶åœ¨2006å¹´1æœˆï¼Œå®ƒæˆä¸ºApacheè½¯ä»¶åŸºé‡‘ä¼šä¸‹çš„ä¸€ä¸ªå¼€æºé¡¹ç›®ã€‚å¹¶äº2016å¹´å‘å¸ƒæœ€æ–°ç‰ˆæœ¬Solr6.0ï¼Œæ”¯æŒå¹¶è¡ŒSQLæŸ¥è¯¢çš„æ‰§è¡Œã€‚Solrå¯ä»¥å’ŒHadoopä¸€èµ·ä½¿ç”¨ã€‚ç”±äºHadoopå¤„ç†å¤§é‡æ•°æ®ï¼ŒSolrå¸®åŠ©æˆ‘ä»¬ä»è¿™ä¹ˆå¤§çš„æºä¸­æ‰¾åˆ°æ‰€éœ€çš„ä¿¡æ¯ã€‚ä¸ä»…é™äºæœç´¢ï¼ŒSolrä¹Ÿå¯ä»¥ç”¨äºå­˜å‚¨ç›®çš„ã€‚åƒå…¶ä»–NoSQLæ•°æ®åº“ä¸€æ ·ï¼Œå®ƒæ˜¯ä¸€ç§éå…³ç³»æ•°æ®å­˜å‚¨å’Œå¤„ç†æŠ€æœ¯ã€‚æ€»ä¹‹ï¼ŒSolræ˜¯ä¸€ä¸ªå¯æ‰©å±•çš„ï¼Œå¯éƒ¨ç½²ï¼Œæœç´¢/å­˜å‚¨å¼•æ“ï¼Œä¼˜åŒ–æœç´¢å¤§é‡ä»¥æ–‡æœ¬ä¸ºä¸­å¿ƒçš„æ•°æ®ã€‚solrå®‰è£…1ä¸Šä¼ æ–‡ä»¶apache-tomcat-7.0.82.tar.gzsolr-4.10.3.tgz.tgzIKAnalyzer2012FF_hf12åˆ›å»ºç›®å½•mkdir/usr/soft/solr3è§£å‹tomcatå¹¶ç§»åŠ¨åˆ°solrç›®å½•tar-zxvfapache-tomcat-7.0.82.tar.gzmvapache-tomcat-7.0.82/usr/soft/solr/tomcat7tar-zxvfsolr-4.10.3.tgz.tgzåœ¨solr-4.10.3/distç›®å½•ä¸‹æœ‰ä¸€ä¸ªwaråŒ…éœ€è¦æŠŠwaråŒ…ç§»åŠ¨åˆ°tomcaté‡Œè¿è¡Œcp~/solr-4.10.3/dist/solr-4.10.3.war/usr/soft/solr/tomcat7/webapps/solr.war4å¯åŠ¨tomcatcd/usr/soft/solr/tomcat7./bin/startup.shæŸ¥çœ‹tomcatæ—¥å¿—(å¯é€‰)tail-flogs/catalina.out5å¼•å…¥ä¾èµ–jaråŒ…cd~/solr-4.10.3/example/lib/extcp*/usr/soft/solr/tomcat7/webapps/solr/WEB-INF/lib6å¤åˆ¶é…ç½®æ–‡ä»¶cd~/solr-4.10.3/examplecp-rsolr/usr/soft/solr/solrhome7solrå’Œsolrhomeå»ºç«‹è”ç³»cd/usr/soft/solr/tomcat7/webapps/solr/WEB-INFviweb.xml/usr/soft/solr/solrhome&lt;env-entry&gt;&lt;env-entry-name&gt;solr/home&lt;/env-entry-name&gt;&lt;!--è¿™é‡Œè®¾ç½®ä¸ºè‡ªå·±çš„solrhomeè·¯å¾„--&gt;&lt;env-entry-value&gt;/usr/soft/solr/solrhome&lt;/env-entry-value&gt;&lt;env-entry-type&gt;java.lang.String&lt;/env-entry-type&gt;&lt;/env-entry&gt;:wq8é‡å¯tomcatcd/usr/soft/solr/tomcat7/bin./shutdown.sh./startup.sh9è®¿é—®solrhttp://192.168.25.132:8080/solr/é…ç½®IKåˆ†è¯å™¨IKAnalyzerç®€ä»‹IKAnalyzeræ˜¯ä¸€ä¸ªå¼€æºçš„ï¼ŒåŸºäºjavaè¯­è¨€å¼€å‘çš„è½»é‡çº§çš„ä¸­æ–‡åˆ†è¯å·¥å…·åŒ…ã€‚ä»2006å¹´12æœˆæ¨å‡º1.0ç‰ˆå¼€å§‹ï¼ŒIKAnalyzerå·²ç»æ¨å‡ºäº†4ä¸ªå¤§ç‰ˆæœ¬ã€‚æœ€åˆï¼Œå®ƒæ˜¯ä»¥å¼€æºé¡¹ç›®Luenceä¸ºåº”ç”¨ä¸»ä½“çš„ï¼Œç»“åˆè¯å…¸åˆ†è¯å’Œæ–‡æ³•åˆ†æç®—æ³•çš„ä¸­æ–‡åˆ†è¯ç»„ä»¶ã€‚ä»3.0ç‰ˆæœ¬å¼€å§‹ï¼ŒIKå‘å±•ä¸ºé¢å‘Javaçš„å…¬ç”¨åˆ†è¯ç»„ä»¶ï¼Œç‹¬ç«‹äºLuceneé¡¹ç›®ï¼ŒåŒæ—¶æä¾›äº†å¯¹Luceneçš„é»˜è®¤ä¼˜åŒ–å®ç°ã€‚åœ¨2012ç‰ˆæœ¬ä¸­ï¼ŒIKå®ç°äº†ç®€å•çš„åˆ†è¯æ­§ä¹‰æ’é™¤ç®—æ³•ï¼Œæ ‡å¿—ç€IKåˆ†è¯å™¨ä»å•çº¯çš„è¯å…¸åˆ†è¯å‘æ¨¡æ‹Ÿè¯­ä¹‰åˆ†è¯è¡åŒ–ã€‚1å°†ikåˆ†è¯å™¨jaråŒ…ç§»åŠ¨åˆ°solrä¸­cp~/IK\\Analyzer\\2012FF_hf1/IKAnalyzer2012FF_u1.jar/usr/soft/solr/tomcat7/webapps/solr/WEB-INF/lib2åœ¨solré¡¹ç›®çš„WEB-INFç›®å½•åˆ›å»ºä¸€ä¸ªclassesç›®å½•mkdir/usr/soft/solr/tomcat7/webapps/solr/WEB-INF/classes3ç§»åŠ¨é…ç½®æ–‡ä»¶åˆ°classesç›®å½•cpIKAnalyzer.cfg.xmlext_stopword.dicmydict.dic/usr/soft/solr/tomcat7/webapps/solr/WEB-INF/classes4å¯ç”¨---ç¼–è¾‘é…ç½®æ–‡ä»¶ä½¿ç”¨nppç¼–è¾‘æœåŠ¡å™¨ä¸Šçš„æ–‡ä»¶1å®‰è£…npp(ç•¥)2å®‰è£…NppFTP(ç•¥)3è¿æ¥æœåŠ¡å™¨(è™)4ç¼–è¾‘xmlæ–‡ä»¶:/usr/soft/solr/solrhome/collection1/conf/schema.xml&lt;!--é…ç½®IKåˆ†è¯å™¨--&gt;&lt;fieldTypename=&quot;text_ik&quot;class=&quot;solr.TextField&quot;&gt;&lt;analyzerclass=&quot;org.wltea.analyzer.lucene.IKAnalyzer&quot;&gt;&lt;/analyzer&gt;&lt;/fieldType&gt;5é‡å¯tomcatcd/usr/soft/solr/tomcat7/bin./shutdown.sh./startup.sh6è®¿é—®urlhttp://192.168.25.132:8080/solr/åŸŸåŸŸ:ç›¸å½“äºæ•°æ®åº“è¡¨çš„å­—æ®µ&lt;!--name:æŒ‡å®šåŸŸçš„åç§°type:æŒ‡å®šåŸŸçš„ç±»å‹indexed:æ˜¯å¦ç´¢å¼•stored:æ˜¯å¦å­˜å‚¨required:æ˜¯å¦å¿…é¡»multiValued:æ˜¯å¦å¤šå€¼--&gt;&lt;fieldname=&quot;id&quot;type=&quot;string&quot;indexed=&quot;true&quot;stored=&quot;true&quot;required=&quot;true&quot;multiValued=&quot;false&quot;/&gt;SpringDataSolrDemo1ã€å¼•å…¥ä¾èµ–&lt;dependency&gt;&lt;groupId&gt;org.springframework.data&lt;/groupId&gt;&lt;artifactId&gt;spring-data-solr&lt;/artifactId&gt;&lt;version&gt;1.5.5.RELEASE&lt;/version&gt;&lt;/dependency&gt;2ã€applicationContext-solr.xml&lt;?xmlversion=&quot;1.0&quot;encoding=&quot;UTF-8&quot;?&gt;&lt;beansxmlns=&quot;http://www.springframework.org/schema/beans&quot;xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;xmlns:p=&quot;http://www.springframework.org/schema/p&quot;xmlns:context=&quot;http://www.springframework.org/schema/context&quot;xmlns:solr=&quot;http://www.springframework.org/schema/data/solr&quot;xsi:schemaLocation=&quot;http://www.springframework.org/schema/data/solrhttp://www.springframework.org/schema/data/solr/spring-solr-1.0.xsdhttp://www.springframework.org/schema/beanshttp://www.springframework.org/schema/beans/spring-beans.xsdhttp://www.springframework.org/schema/contexthttp://www.springframework.org/schema/context/spring-context.xsd&quot;&gt;&lt;!--solræœåŠ¡å™¨åœ°å€--&gt;&lt;solr:solr-serverid=&quot;solrServer&quot;url=&quot;http://127.0.0.1:8080/solr&quot;/&gt;&lt;!--solræ¨¡æ¿ï¼Œä½¿ç”¨solræ¨¡æ¿å¯å¯¹ç´¢å¼•åº“è¿›è¡ŒCRUDçš„æ“ä½œ--&gt;&lt;beanid=&quot;solrTemplate&quot;class=&quot;org.springframework.data.solr.core.SolrTemplate&quot;&gt;&lt;constructor-argref=&quot;solrServer&quot;/&gt;&lt;/bean&gt;&lt;/beans&gt;3ã€@Fieldæ³¨è§£ä½œç”¨ï¼šå¦‚æœåœ¨pojoä¸Šæ·»åŠ äº†è¿™ä¸ªæ³¨è§£ï¼Œé‚£ä¹ˆè¿™ä¸ªå±æ€§ä¼šè¢«å¼•ç”¨åˆ°solrï¼Œvalueä¸ºæŒ‡å®šsolrä¸­fieldå®šä¹‰çš„nameï¼Œå¦‚æœä¸€æ ·å¯ä»¥çœç•¥@Dynamicæ³¨è§£ï¼Œåœ¨å±æ€§ä¸Šå®šä¹‰å°±è¡¨ç¤ºæ˜¯ä¸€ä¸ªåŠ¨æ€åŸŸ4ã€æ·»åŠ @AutowiredprivateSolrTemplatesolrTemplate;solrTemplate.saveBean(item);//æ·»åŠ å¤šæ¡æ•°æ®å¯ä»¥ä½¿ç”¨saveBeanssolrTemplate.commit();//æäº¤äº‹åŠ¡5ã€æŒ‰ä¸»é”®æŸ¥è¯¢//å‚æ•°1ï¼šè¦æŸ¥è¯¢çš„ä¸»é”®ID//å‚æ•°2ï¼šè¿”å›çš„æ•°æ®ç±»å‹solrTemplate.getById(1,TbItem.class)6ã€æŒ‰ä¸»é”®åˆ é™¤solrTemplate.deleteById(&quot;1&quot;);7ã€åˆ†é¡µæŸ¥è¯¢//æ¡ä»¶Queryquery=newSimpleQuery(&quot;*:*&quot;);//æŸ¥è¯¢æ¡ä»¶Criteriacriteria=newCriteria();//andï¼šæŸ¥è¯¢çš„åŸŸ//containsï¼šæŸ¥è¯¢çš„å…³é”®å­—criteria.and(&quot;item_title&quot;).contains(&quot;æ‰‹æœº&quot;);//å°†æŸ¥è¯¢æ¡ä»¶æ·»åŠ åˆ°queyrä¸­query.addCriteria(criteria);query.setOffset(0);//å¼€å§‹ç´¢å¼•ï¼Œé»˜è®¤ä¸º0ï¼Œç¿»é¡µè§„åˆ™(pageNow-1)*pageSizequery.setRows(20);//æ¯é¡µè®°å½•æ¡æ•°//ScoredPageï¼šsolrçš„åˆ†é¡µæŸ¥è¯¢//å‚æ•°1ï¼šæŸ¥è¯¢æ¡ä»¶//å‚æ•°2ï¼šè¿”å›ç±»å‹ScoredPage&lt;TbItem&gt;page=solrTemplate.queryForPage(query,TbItem.class)System.out.pringln(&quot;æ€»è®°å½•æ•°:&quot;+page.getTotalElements());List&lt;TbItem&gt;list=page.getContent();8ã€é«˜äº®æŸ¥è¯¢@ResourceprivateSolrTemplatesolrTemplate;@OverridepublicMap&lt;String,Object&gt;search(Map&lt;String,Object&gt;searchMap){Map&lt;String,Object&gt;map=newHashMap&lt;String,Object&gt;();//è®¾ç½®æœç´¢é«˜äº®HighlightQueryquery=newSimpleHighlightQuery();//è®¾ç½®é«˜äº®çš„åŸŸHighlightOptionshighlightOptions=newHighlightOptions().addField(&quot;item_title&quot;);//è®¾ç½®é«˜äº®å‰ç¼€highlightOptions.setSimplePrefix(&quot;&lt;emstyle='color:red'&gt;&quot;);//è®¾ç½®é«˜äº®åç¼€highlightOptions.setSimplePostfix(&quot;&lt;/em&gt;&quot;);//è®¾ç½®é«˜äº®é€‰é¡¹query.setHighlightOptions(highlightOptions);//æŒ‰ç…§å…³é”®å­—æŸ¥è¯¢Criteriacriteria=newCriteria(&quot;item_keywords&quot;).is(searchMap.get(&quot;keywords&quot;));//æ·»åŠ æ¡ä»¶query.addCriteria(criteria);//åˆ°solrä¸­æŸ¥è¯¢HighlightPage&lt;TbItem&gt;page=solrTemplate.queryForHighlightPage(query,TbItem.class);//å¾ªç¯é«˜äº®å…¥å£é›†åˆfor(HighlightEntry&lt;TbItem&gt;entry:page.getHighlighted()){//è·å–åŸå®ä½“ç±»TbItemtbItem=entry.getEntity();//åˆ¤æ–­æ˜¯å¦æœ‰é«˜äº®å†…å®¹if(entry.getHighlights().size()&gt;0&amp;&amp;entry.getHighlights().get(0).getSnipplets().size()&gt;0){//è®¾ç½®é«˜äº®çš„ç»“æœtbItem.setTitle(entry.getHighlights().get(0).getSnipplets().get(0));}}map.put(&quot;rows&quot;,page.getContent());returnmap;}","link":"https://haohanya.github.io/post/solr-an-zhuang-shi-yong/"},{"title":"Spring-Security","content":"SpringSecurityç®€ä»‹SpringSecurityæ˜¯ä¸€ä¸ªèƒ½å¤Ÿä¸ºåŸºäºSpringçš„ä¼ä¸šåº”ç”¨ç³»ç»Ÿæä¾›å£°æ˜å¼çš„å®‰å…¨è®¿é—®æ§åˆ¶è§£å†³æ–¹æ¡ˆçš„å®‰å…¨æ¡†æ¶ã€‚å®ƒæä¾›äº†ä¸€ç»„å¯ä»¥åœ¨Springåº”ç”¨ä¸Šä¸‹æ–‡ä¸­é…ç½®çš„Beanï¼Œå……åˆ†åˆ©ç”¨äº†SpringIoCï¼ŒDIï¼ˆæ§åˆ¶åè½¬InversionofControl,DI:DependencyInjectionä¾èµ–æ³¨å…¥ï¼‰å’ŒAOPï¼ˆé¢å‘åˆ‡é¢ç¼–ç¨‹ï¼‰åŠŸèƒ½ï¼Œä¸ºåº”ç”¨ç³»ç»Ÿæä¾›å£°æ˜å¼çš„å®‰å…¨è®¿é—®æ§åˆ¶åŠŸèƒ½ï¼Œå‡å°‘äº†ä¸ºä¼ä¸šç³»ç»Ÿå®‰å…¨æ§åˆ¶ç¼–å†™å¤§é‡é‡å¤ä»£ç çš„å·¥ä½œã€‚å•æœºç‰ˆ1.å¼•å…¥ä¾èµ–&lt;!--èº«ä»½éªŒè¯--&gt;&lt;dependency&gt;&lt;groupId&gt;org.springframework.security&lt;/groupId&gt;&lt;artifactId&gt;spring-security-web&lt;/artifactId&gt;&lt;/dependency&gt;&lt;dependency&gt;&lt;groupId&gt;org.springframework.security&lt;/groupId&gt;&lt;artifactId&gt;spring-security-config&lt;/artifactId&gt;&lt;/dependency&gt;2.é…ç½®æ ¸å¿ƒé…ç½®æ–‡ä»¶&lt;?xmlversion=&quot;1.0&quot;encoding=&quot;UTF-8&quot;?&gt;&lt;beans:beansxmlns=&quot;http://www.springframework.org/schema/security&quot;xmlns:beans=&quot;http://www.springframework.org/schema/beans&quot;xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;xsi:schemaLocation=&quot;http://www.springframework.org/schema/beanshttp://www.springframework.org/schema/beans/spring-beans.xsdhttp://www.springframework.org/schema/securityhttp://www.springframework.org/schema/security/spring-security.xsd&quot;&gt;&lt;!--ä»¥ä¸‹é¡µé¢ä¸è¢«æ‹¦æˆª--&gt;&lt;httppattern=&quot;/login.html&quot;security=&quot;none&quot;/&gt;&lt;httppattern=&quot;/css/**&quot;security=&quot;none&quot;/&gt;&lt;httppattern=&quot;/img/**&quot;security=&quot;none&quot;/&gt;&lt;httppattern=&quot;/js/**&quot;security=&quot;none&quot;/&gt;&lt;httppattern=&quot;/plugins/**&quot;security=&quot;none&quot;/&gt;&lt;!--é¡µé¢æ‹¦æˆªè§„åˆ™use-expressions:æ˜¯å¦å¯ç”¨spelè¡¨è¾¾å¼,å¦‚æœä¸ºtrueé‚£ä¹ˆaccess=&quot;hasRole('ROLE_USER')&quot;--&gt;&lt;!--é¡µé¢æ‹¦æˆªè§„åˆ™--&gt;&lt;httpuse-expressions=&quot;false&quot;&gt;&lt;!--pattern:æ‹¦æˆªçš„urlaccess:æ‹¥æœ‰å¦‚ä¸‹æƒé™å…è®¸è®¿é—®--&gt;&lt;intercept-urlpattern=&quot;/**&quot;access=&quot;ROLE_ADMIN&quot;/&gt;&lt;!--login-page:è‡ªå®šä¹‰ç™»é™†é¡µé¢default-target-url:ç™»é™†æˆåŠŸåè·³è½¬çš„é¡µé¢,ä¸è®¾å®šé»˜è®¤è·³è½¬ä¸Šä¸€æ¬¡è®¿é—®çš„é¡µé¢authentication-failure-url:ç™»é™†å¤±è´¥æ—¶è·³è½¬çš„urlalways-use-default-target:ç™»é™†æˆåŠŸåæ€»æ˜¯è·³è½¬åˆ°default-target-urlè®¾å®šçš„url--&gt;&lt;form-loginlogin-page=&quot;/login.html&quot;default-target-url=&quot;/admin/index.html&quot;authentication-failure-url=&quot;/login.html&quot;always-use-default-target=&quot;true&quot;/&gt;&lt;csrfdisabled=&quot;true&quot;/&gt;&lt;!--logout-url:é€€å‡ºçš„åœ°å€logout-success-url:é€€å‡ºåè·³è½¬çš„åœ°å€--&gt;&lt;logoutlogout-url=&quot;/logout&quot;logout-success-url=&quot;/login.html&quot;/&gt;&lt;!--å¦‚æœä½¿ç”¨äº†iframe,éœ€è¦æŒ‡å®šæ¡†æ¶é¡µçš„ç­–ç•¥ä¸ºSAMEORIGIN--&gt;&lt;headers&gt;&lt;frame-optionspolicy=&quot;SAMEORIGIN&quot;/&gt;&lt;!--å…è®¸ä½¿ç”¨frameset--&gt;&lt;/headers&gt;&lt;/http&gt;&lt;!--è®¤è¯ç®¡ç†å™¨--&gt;&lt;authentication-manager&gt;&lt;authentication-provider&gt;&lt;user-service&gt;&lt;!--ç”¨æˆ·åå’Œå¯†ç ,æƒé™--&gt;&lt;username=&quot;root&quot;password=&quot;root&quot;authorities=&quot;ROLE_ADMIN&quot;/&gt;&lt;/user-service&gt;&lt;/authentication-provider&gt;&lt;/authentication-manager&gt;&lt;/beans:beans&gt;3.é…ç½®web.xml&lt;context-param&gt;&lt;param-name&gt;contextConfigLocation&lt;/param-name&gt;&lt;param-value&gt;classpath:spring/spring-security.xml&lt;/param-value&gt;&lt;/context-param&gt;&lt;listener&gt;&lt;listener-class&gt;org.springframework.web.context.ContextLoaderListener&lt;/listener-class&gt;&lt;/listener&gt;&lt;filter&gt;&lt;filter-name&gt;springSecurityFilterChain&lt;/filter-name&gt;&lt;filter-class&gt;org.springframework.web.filter.DelegatingFilterProxy&lt;/filter-class&gt;&lt;/filter&gt;&lt;filter-mapping&gt;&lt;filter-name&gt;springSecurityFilterChain&lt;/filter-name&gt;&lt;url-pattern&gt;/*&lt;/url-pattern&gt;&lt;/filter-mapping&gt;è¿æ¥æ•°æ®åº“1.å¼•å…¥ä¾èµ–2.å®ç°UserDetailsServiceæ¥å£packagecom.jd.shop.service.impl;importcom.jd.pojo.TbSeller;importcom.jd.sellergoods.service.TbSellerService;importorg.springframework.security.core.GrantedAuthority;importorg.springframework.security.core.authority.SimpleGrantedAuthority;importorg.springframework.security.core.userdetails.User;importorg.springframework.security.core.userdetails.UserDetails;importorg.springframework.security.core.userdetails.UserDetailsService;importorg.springframework.security.core.userdetails.UsernameNotFoundException;importjava.util.ArrayList;importjava.util.List;/***è®¤è¯ç±»*@program:jd*@author:æ½˜*@create:2020-04-2922:43**/publicclassUserDetailsServiceImplimplementsUserDetailsService{privateTbSellerServicetbSellerService;publicvoidsetTbSellerService(TbSellerServicetbSellerService){this.tbSellerService=tbSellerService;}@OverridepublicUserDetailsloadUserByUsername(Stringusername)throwsUsernameNotFoundException{if(username==null){returnnull;}TbSellerbyId=tbSellerService.findById(username);if(byId==null){returnnull;}//æ„å»ºè§’è‰²åˆ—è¡¨List&lt;GrantedAuthority&gt;list=newArrayList&lt;&gt;();//ç”¨æˆ·çš„æƒé™é›†åˆlist.add(newSimpleGrantedAuthority(&quot;ROLE_USER&quot;));returnnewUser(username,byId.getPassword(),list);}}3.é…ç½®æ ¸å¿ƒé…ç½®æ–‡ä»¶&lt;?xmlversion=&quot;1.0&quot;encoding=&quot;UTF-8&quot;?&gt;&lt;beans:beansxmlns=&quot;http://www.springframework.org/schema/security&quot;xmlns:beans=&quot;http://www.springframework.org/schema/beans&quot;xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;xmlns:dubbo=&quot;http://code.alibabatech.com/schema/dubbo&quot;xsi:schemaLocation=&quot;http://www.springframework.org/schema/beanshttp://www.springframework.org/schema/beans/spring-beans.xsdhttp://www.springframework.org/schema/securityhttp://www.springframework.org/schema/security/spring-security.xsdhttp://code.alibabatech.com/schema/dubbohttp://code.alibabatech.com/schema/dubbo/dubbo.xsd&quot;&gt;&lt;!--ä»¥ä¸‹é¡µé¢ä¸è¢«æ‹¦æˆª--&gt;&lt;httppattern=&quot;/login.html&quot;security=&quot;none&quot;/&gt;&lt;httppattern=&quot;/css/**&quot;security=&quot;none&quot;/&gt;&lt;httppattern=&quot;/img/**&quot;security=&quot;none&quot;/&gt;&lt;httppattern=&quot;/js/**&quot;security=&quot;none&quot;/&gt;&lt;httppattern=&quot;/plugins/**&quot;security=&quot;none&quot;/&gt;&lt;httppattern=&quot;/*.html&quot;security=&quot;none&quot;/&gt;&lt;!--&lt;httppattern=&quot;/login&quot;security=&quot;none&quot;/&gt;--&gt;&lt;!--é¡µé¢æ‹¦æˆªè§„åˆ™use-expressions:æ˜¯å¦å¯ç”¨spelè¡¨è¾¾å¼,å¦‚æœä¸ºtrueé‚£ä¹ˆaccess=&quot;hasRole('ROLE_USER')&quot;--&gt;&lt;!--é¡µé¢æ‹¦æˆªè§„åˆ™--&gt;&lt;httpuse-expressions=&quot;false&quot;&gt;&lt;!--pattern:æ‹¦æˆªçš„urlaccess:æ‹¥æœ‰å¦‚ä¸‹æƒé™å…è®¸è®¿é—®--&gt;&lt;intercept-urlpattern=&quot;/**&quot;access=&quot;ROLE_USER&quot;/&gt;&lt;!--login-page:è‡ªå®šä¹‰ç™»é™†é¡µé¢default-target-url:ç™»é™†æˆåŠŸåè·³è½¬çš„é¡µé¢,ä¸è®¾å®šé»˜è®¤è·³è½¬ä¸Šä¸€æ¬¡è®¿é—®çš„é¡µé¢authentication-failure-url:ç™»é™†å¤±è´¥æ—¶è·³è½¬çš„urlalways-use-default-target:ç™»é™†æˆåŠŸåæ€»æ˜¯è·³è½¬åˆ°default-target-urlè®¾å®šçš„url--&gt;&lt;form-loginlogin-processing-url=&quot;/login&quot;login-page=&quot;/shoplogin.html&quot;default-target-url=&quot;/admin/index.html&quot;authentication-failure-url=&quot;/shoplogin.html&quot;always-use-default-target=&quot;true&quot;/&gt;&lt;csrfdisabled=&quot;true&quot;/&gt;&lt;!--logout-url:é€€å‡ºçš„åœ°å€logout-success-url:é€€å‡ºåè·³è½¬çš„åœ°å€--&gt;&lt;logoutlogout-url=&quot;/logout&quot;logout-success-url=&quot;/shoplogin.html&quot;/&gt;&lt;!--å¦‚æœä½¿ç”¨äº†iframe,éœ€è¦æŒ‡å®šæ¡†æ¶é¡µçš„ç­–ç•¥ä¸ºSAMEORIGIN--&gt;&lt;headers&gt;&lt;frame-optionspolicy=&quot;SAMEORIGIN&quot;/&gt;&lt;!--å…è®¸ä½¿ç”¨frameset--&gt;&lt;/headers&gt;&lt;/http&gt;&lt;!--è®¤è¯ç®¡ç†å™¨--&gt;&lt;authentication-manager&gt;&lt;authentication-provideruser-service-ref=&quot;userDetailsServiceImpl&quot;/&gt;&lt;/authentication-manager&gt;&lt;!--å¼•ç”¨dubboæœåŠ¡--&gt;&lt;dubbo:applicationname=&quot;jd-shop-web&quot;/&gt;&lt;dubbo:registryaddress=&quot;zookeeper://47.98.157.69:2181&quot;timeout=&quot;30000&quot;/&gt;&lt;dubbo:annotationpackage=&quot;com.jd.shop.controller&quot;/&gt;&lt;dubbo:referenceinterface=&quot;com.jd.sellergoods.service.TbSellerService&quot;id=&quot;tbSellerService&quot;/&gt;&lt;beans:beanid=&quot;userDetailsServiceImpl&quot;class=&quot;com.jd.shop.service.impl.UserDetailsServiceImpl&quot;&gt;&lt;beans:propertyname=&quot;tbSellerService&quot;ref=&quot;tbSellerService&quot;/&gt;&lt;/beans:bean&gt;&lt;/beans:beans&gt;4.é…ç½®web.xmlæ–‡ä»¶BrcyåŠ å¯†1.ç¼–å†™javaBCryptPasswordEncoderpasswordEncoder=newBCryptPasswordEncoder();Stringencode=passwordEncoder.encode(tbSeller.getPassword());2.ç¼–å†™é…ç½®æ–‡ä»¶&lt;!--è®¤è¯ç®¡ç†å™¨--&gt;&lt;authentication-manager&gt;&lt;authentication-provideruser-service-ref=&quot;userDetailsServiceImpl&quot;&gt;&lt;!--è¿™å¥è¯è¡¨ç¤ºåœ¨ç™»é™†æ—¶ä½¿ç”¨bcryåŠ å¯†éªŒè¯--&gt;&lt;password-encoderref=&quot;bCryptPasswordEncoder&quot;/&gt;&lt;/authentication-provider&gt;&lt;/authentication-manager&gt;&lt;!--é…ç½®åŠ å¯†,åœ¨è®¤è¯ç®¡ç†å™¨ä¸­å¼•ç”¨--&gt;&lt;beans:beanid=&quot;bCryptPasswordEncoder&quot;class=&quot;org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder&quot;/&gt;è®°ä½æˆ‘&lt;inputvalue=&quot;1&quot;name=&quot;remember-me&quot;/&gt;","link":"https://haohanya.github.io/post/spring-security/"},{"title":"MyBatis","content":"å¿«é€Ÿå¼€å§‹1ã€MyBatisæ ¸å¿ƒé…ç½®æ–‡ä»¶&lt;?xmlversion=&quot;1.0&quot;encoding=&quot;UTF-8&quot;?&gt;&lt;!DOCTYPEconfigurationPUBLIC&quot;-//mybatis.org//DTDConfig3.0//EN&quot;&quot;http://mybatis.org/dtd/mybatis-3-config.dtd&quot;&gt;&lt;configuration&gt;&lt;!--é…ç½®æ•°æ®æº--&gt;&lt;environmentsdefault=&quot;development&quot;&gt;&lt;environmentid=&quot;development&quot;&gt;&lt;!--äº‹åŠ¡å¤„ç†æ–¹å¼--&gt;&lt;transactionManagertype=&quot;JDBC&quot;/&gt;&lt;dataSourcetype=&quot;POOLED&quot;&gt;&lt;propertyname=&quot;driver&quot;value=&quot;com.mysql.jdbc.Driver&quot;/&gt;&lt;propertyname=&quot;url&quot;value=&quot;jdbc:mysql://localhost:3306/mybatis&quot;/&gt;&lt;propertyname=&quot;username&quot;value=&quot;root&quot;/&gt;&lt;propertyname=&quot;password&quot;value=&quot;root&quot;/&gt;&lt;/dataSource&gt;&lt;/environment&gt;&lt;/environments&gt;&lt;!--æ˜ å°„å™¨ï¼šæ¯ä¸€ä¸ªMapperæ¥å£éƒ½åº”è¯¥åœ¨æ ¸å¿ƒé…ç½®æ–‡ä»¶&lt;mappers&gt;æ ‡ç­¾ä¸­æ³¨å†Œ--&gt;&lt;mappers&gt;&lt;!--ä½¿ç”¨XMLé…ç½®æ–‡ä»¶æ³¨å†Œ--&gt;&lt;mapperresource=&quot;com/cn/mybatis/dao/IcpInfoMapper.xml&quot;/&gt;&lt;!--ä½¿ç”¨ç±»æ³¨å†Œæ–¹å¼--&gt;&lt;mapperclass=&quot;com.cn.mybatis.dao.IcpInfoMapper&quot;/&gt;&lt;/mappers&gt;&lt;/configuration&gt;2ã€ORMæ˜ å°„æ–‡ä»¶mapper.xml&lt;?xmlversion=&quot;1.0&quot;encoding=&quot;UTF-8&quot;?&gt;&lt;!DOCTYPEmapperPUBLIC&quot;-//mybatis.org//DTDMapper3.0//EN&quot;&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;&gt;&lt;!--è¿™ä¸ªé…ç½®æ–‡ä»¶ä¸»è¦æ˜¯é…ç½®å®ä½“ç±»å’Œæ•°æ®åº“ä¸­çš„è¡¨æ˜ å°„å…³ç³»--&gt;&lt;!--mapperï¼šæ˜ å°„ä¿¡æ¯é…ç½®namesapce:å¦‚æœæ˜¯åœ¨ibatisçš„å¼€å‘ä¸­ï¼Œåå­—å¯ä»¥éšä¾¿å–ï¼Œä½†æ˜¯åœ¨mybatisä¸­å°†æœ‰ç‰¹æ®Šçš„æ„ä¹‰--&gt;&lt;mappernamespace=&quot;test&quot;&gt;&lt;!--æŸ¥è¯¢æ‰€æœ‰çš„ä¹¦ç±ä¿¡æ¯select:ä¸“é—¨ç”¨äºæŸ¥è¯¢çš„statementid:æ˜¯statementçš„å”¯ä¸€æ ‡è¯†ç¬¦resultType:è¿”å›å€¼å¾—ç±»å‹ï¼ˆè·Ÿè¿”å›çš„ä¸ªæ•°æ— å…³ï¼‰ï¼Œå°†è¿”å›ç±»å‹çš„å…¨é™å®šåå†™åˆ°è¿™é‡Œ--&gt;&lt;selectid=&quot;selectAllBooks&quot;resultType=&quot;cn.kgc.pojo.Book&quot;&gt;select*frombook&lt;/select&gt;&lt;/mapper&gt;3ã€æ—¥å¿—æ–‡ä»¶log4j.propertieslog4j.rootLogger=DEBUG,A1log4j.logger.org.mybatis=DEBUGlog4j.appender.A1=org.apache.log4j.ConsoleAppenderlog4j.appender.A1.layout=org.apache.log4j.PatternLayoutlog4j.appender.A1.layout.ConversionPattern=%-d{yyyy-MM-ddHH:mm:ss,SSS}[%t][%c]-[%p]%m%n4ã€æµ‹è¯•//æŸ¥è¯¢å…¨éƒ¨@TestpublicvoidtestFindAll()throwsException{//é€šè¿‡æµçš„æ–¹å¼è¯»å–é…ç½®æ–‡ä»¶InputStreaminputStream=Resources.getResourceAsStream(&quot;mybatis-config.xml&quot;);//1.è¯»å–é…ç½®æ–‡ä»¶,å¾—åˆ°SqlSessionFactorySqlSessionFactorysqlSessionFactory=newSqlSessionFactoryBuilder().build(inputStream);//2.åˆ›å»ºSqlSessionSqlSessionsqlSession=sqlSessionFactory.openSession();//3.æŸ¥è¯¢æ‰€æœ‰(å‚æ•°ï¼šæ˜¯namespace.statementId)List&lt;Book&gt;list=sqlSession.selectList(&quot;test.selectAllBooks&quot;);System.out.println(list);}propertieså±æ€§åˆ›å»ºä¸€ä¸ªå¤–éƒ¨çš„propertiesæ–‡ä»¶jdbc.dirver=com.mysql.jdbc.Driverjdbc.url=jdbc:mysql://localhost:3306/mybatis?useUnicode=true&amp;amp;characterEncoding=utf-8jdbc.username=rootjdbc.password=rootåœ¨æ ¸å¿ƒé…ç½®æ–‡ä»¶ä¸­å¼•ç”¨propertiesæ–‡ä»¶&lt;propertiesresource=&quot;jdbc.properties&quot;/&gt;ä½¿ç”¨${jdbc.dirver}${jdbc.url}${jdbc.username}settingsmapUnderscoreToCamelCase:å¼€å¯é©¼å³°å‘½åï¼Œå¯ä»¥å¸®åŠ©æˆ‘ä»¬å®Œæˆæ•°æ®åº“çš„ç»å…¸å‘½åè§„åˆ™ï¼Œåˆ°javaçš„ç»å…¸å‘½åè§„åˆ™ï¼ˆé©¼å³°å‘½åå‘ï¼‰å¦‚ï¼šæ•°æ®åº“å«user_nameåˆ°javaç±»ï¼ˆpojoï¼‰ä¸­æ˜¯userName&lt;settings&gt;&lt;!--å¼€å¯é©¼å³°å‘½å--&gt;&lt;settingname=&quot;mapUnderscoreToCamelCase&quot;value=&quot;true&quot;/&gt;&lt;!--æŒ‡å®šMyBatisæ‰€ç”¨æ—¥å¿—çš„å…·ä½“å®ç°ï¼ŒæœªæŒ‡å®šæ—¶å°†è‡ªåŠ¨æŸ¥æ‰¾ã€‚æ—¥å¿—ç±»å‹ï¼šSTDOUT_LOGGINGä¸éœ€è¦å¯¼å…¥jaråŒ…ï¼Œå› ä¸ºæ˜¯mybatisè‡ªå¸¦NO_LOGGINGä»£è¡¨ä¸éœ€è¦æ—¥å¿—è¾“å‡ºSLF4J|LOG4J|LOG4J2|JDK_LOGGING|COMMONS_LOGGING|STDOUT_LOGGING|NO_LOGGING--&gt;&lt;settingname=&quot;logImpl&quot;value=&quot;STDOUT_LOGGING&quot;/&gt;&lt;/settings&gt;åˆ†ææ—¥å¿—è¾“å‡ºtypeAliasesï¼ˆç±»å‹åˆ«åï¼‰è‡ªå®šä¹‰åˆ«å&lt;!--åˆ«åï¼Œç”¨äºç®€åŒ–--&gt;&lt;typeAliases&gt;&lt;!--typeï¼šåŒ…+ç±»åï¼Œaliasï¼šåˆ«å--&gt;&lt;typeAliastype=&quot;com.cn.mybatis.entity.IcpInfo&quot;alias=&quot;Icp&quot;/&gt;&lt;!--ä½¿ç”¨åŒ…çš„æ–¹å¼æ¯ä¸€ä¸ªåœ¨åŒ…domain.blogä¸­çš„JavaBeanï¼Œåœ¨æ²¡æœ‰æ³¨è§£çš„æƒ…å†µä¸‹ä¼šä½¿ç”¨Beançš„é¦–å­—æ¯å°å†™çš„éé™å®šç±»åæ¥ä½œä¸ºå®ƒçš„åˆ«å(è¿™å¥è¯æ„æ€æ˜¯ï¼š@Alias(&quot;author&quot;)åœ¨ä½¿ç”¨åŒ…æ–¹å¼æ—¶ï¼ŒjavaBeanæ²¡æœ‰æ·»åŠ æ³¨è§£æŒ‡å®šåˆ«åæ—¶è‡ªåŠ¨ä½¿ç”¨ç±»å{é¦–å­—æ¯å°å†™})--&gt;&lt;packagename=&quot;com.cn.mybatis.entity&quot;/&gt;&lt;/typeAliases&gt;pluginsï¼ˆæ’ä»¶ï¼‰XMLæ˜ å°„cacheâ€“å¯¹ç»™å®šå‘½åç©ºé—´çš„ç¼“å­˜é…ç½®ã€‚cache-refâ€“å¯¹å…¶ä»–å‘½åç©ºé—´ç¼“å­˜é…ç½®çš„å¼•ç”¨ã€‚resultMapâ€“æ˜¯æœ€å¤æ‚ä¹Ÿæ˜¯æœ€å¼ºå¤§çš„å…ƒç´ ï¼Œç”¨æ¥æè¿°å¦‚ä½•ä»æ•°æ®åº“ç»“æœé›†ä¸­æ¥åŠ è½½å¯¹è±¡ã€‚parameterMapâ€“å·²è¢«åºŸå¼ƒï¼è€å¼é£æ ¼çš„å‚æ•°æ˜ å°„ã€‚æ›´å¥½çš„åŠæ³•æ˜¯ä½¿ç”¨å†…è”å‚æ•°ï¼Œæ­¤å…ƒç´ å¯èƒ½åœ¨å°†æ¥è¢«ç§»é™¤ã€‚æ–‡æ¡£ä¸­ä¸ä¼šä»‹ç»æ­¤å…ƒç´ ã€‚sqlâ€“å¯è¢«å…¶ä»–è¯­å¥å¼•ç”¨çš„å¯é‡ç”¨è¯­å¥å—ã€‚insertâ€“æ˜ å°„æ’å…¥è¯­å¥updateâ€“æ˜ å°„æ›´æ–°è¯­å¥deleteâ€“æ˜ å°„åˆ é™¤è¯­å¥selectâ€“æ˜ å°„æŸ¥è¯¢è¯­å¥selectæŸ¥è¯¢è¯­å¥&lt;!--idï¼šä¸€èˆ¬å’ŒMepperæ¥å£çš„æ–¹æ³•åç§°ç›¸åŒï¼Œåœ¨å‘½åç©ºé—´ä¸­å”¯ä¸€çš„æ ‡è¯†ç¬¦ï¼Œå¯ä»¥è¢«ç”¨æ¥å¼•ç”¨è¿™æ¡è¯­å¥ã€‚parameterTypeï¼šæ¥æ”¶ä¸€ä¸ªintç±»å‹çš„å‚æ•°æ¥æ”¶å‚æ•°ä½¿ç”¨#{}åŒ…è£¹ç€ï¼Œè¿™ä¸ªå‚æ•°å¯¹åº”ç€æ¥å£çš„å‚æ•°resultTypeï¼šè¿”å›ä¸€ä¸ªhashmapç±»å‹çš„æ•°æ®--&gt;&lt;selectid=&quot;selectPerson&quot;parameterType=&quot;int&quot;resultType=&quot;hashmap&quot;&gt;SELECT*FROMPERSONWHEREID=#{id}&lt;/select&gt;insertupdateadeleteåœ¨ä½¿ç”¨è¿™äº›è¯­å¥çš„æ—¶å€™éœ€è¦æäº¤äº‹åŠ¡ï¼šsession.commit();&lt;insertid=&quot;addIcpInfo&quot;parameterType=&quot;icpInfo&quot;&gt;insertintoicpinfo(icp,name,address,home,introduce,author,email,date,type)values(#{icp},#{name},#{address},#{home},#{introduce},#{author},#{email},#{date},#{type})&lt;/insert&gt;è·å–æ’å…¥æ•°æ®åçš„ä¸»é”®idï¼šuseGeneratedKeys=&quot;true&quot;keyProperty=&quot;cip&quot;&lt;insertid=&quot;addIcpInfo&quot;useGeneratedKeys=&quot;true&quot;keyProperty=&quot;cip&quot;&gt;insertintoicpinfo(icp,name,address,home,introduce,author,email,date,type)values(#{icp},#{name},#{address},#{home},#{introduce},#{author},#{email},#{date},#{type})&lt;/insert&gt;æ’å…¥å¤šæ¡æ•°æ®ï¼šä¼ å…¥ä¸€ä¸ªæ•°ç»„æˆ–é›†åˆï¼Œå¹¶è¿”å›è‡ªåŠ¨ç”Ÿæˆçš„ä¸»é”®ã€‚&lt;insertid=&quot;addIcpInfoList&quot;useGeneratedKeys=&quot;true&quot;keyProperty=&quot;cip&quot;&gt;insertintoicpinfo(icp,name,address,home,introduce,author,email,date,type)values&lt;foreachcollection=&quot;list&quot;item=&quot;item&quot;separator=&quot;,&quot;&gt;(#{item.icp},#{item.name},#{item.address},#{item.home},#{item.introduce},#{item.author},#{item.email},#{item.date},#{item.type})&lt;/foreach&gt;&lt;/insert&gt;åŠ¨æ€SQLifå¯¹äºè¾“å…¥æ˜ å°„ç±»å‹ä¸ºpojoç±»å‹ï¼š#{pojoä¸­çš„å±æ€§å}${pojoä¸­çš„å±æ€§å}&lt;iftest=&quot;gradeId!=null&quot;&gt;andgrade_id=#{gradeId}&lt;/if&gt;sqlæ³¨å…¥çš„é—®é¢˜åœ¨ä½¿ç”¨${}ä¼šå‡ºç°sqlæ³¨å…¥çš„é—®é¢˜ï¼ˆæ‹¼æ¥å­—ç¬¦ä¸²ï¼Œæ²¡æœ‰ä½¿ç”¨é¢„ç¼–è¯‘ï¼‰å¦‚æœä¸ºç®€å•æ•°æ®ç±»å‹éœ€è¦æŠŠnameæ¢æˆ_parameter&lt;bindname=&quot;n&quot;value=&quot;'%'+name+'%'&quot;/&gt;andnamelike#{n}whenåº”ç”¨åœºæ™¯ï¼šå¯èƒ½æŸ¥è¯¢å…¨éƒ¨ï¼Œæœ‰å¯èƒ½æ ¹æ®æ¡ä»¶æŸ¥è¯¢ï¼Œå¹¶ä¸”å¦‚æœç¬¬ä¸€ä¸ªæ¡ä»¶å‰é¢æœ‰andï¼Œwhereå­å¥ä¼šè‡ªåŠ¨æŠŠè¿™ä¸ªandåˆ é™¤å†ä½œä¸ºsqlè¯­å¥è¿è¡Œ&lt;selectid=&quot;findStudentByLike&quot;resultType=&quot;student&quot;parameterType=&quot;student&quot;&gt;select*fromstudent&lt;where&gt;&lt;iftest=&quot;name!=nullandname!=''&quot;&gt;&lt;bindname=&quot;n&quot;value=&quot;'%'+name+'%'&quot;/&gt;andnamelike#{n}&lt;/if&gt;&lt;iftest=&quot;gradeId!=null&quot;&gt;andgrade_id=#{gradeId}&lt;/if&gt;&lt;/where&gt;&lt;/select&gt;chooseå…¶å®å°±æ˜¯javaä¸­çš„switchæˆ–è€…if...elseif...elsesetsetæ ‡ç­¾ä½œç”¨ï¼šèƒ½è‡ªåŠ¨çš„åˆ¤æ–­æ˜¯å¦åœ¨sqlè¯­å¥çš„ç»“å°¾å¤„æ˜¯å¦è¦æ·»åŠ é€—å·ï¼Œå¦‚æœä¸éœ€è¦é€—å·å®ƒè‡ªåŠ¨å¸®æˆ‘ä»¬åˆ é™¤(å’Œwhereä¸€æ ·ä¸ä¼šè‡ªåŠ¨æ·»åŠ )&lt;updateid=&quot;updateStudentByById&quot;parameterType=&quot;student&quot;&gt;updatestudent&lt;set&gt;&lt;iftest=&quot;name!=null&quot;&gt;name=#{name},&lt;/if&gt;&lt;iftest=&quot;gradeId!=null&quot;&gt;grade_id=#{gradeId}&lt;/if&gt;&lt;/set&gt;whereid=#{id}&lt;/update&gt;foreach&lt;selectid=&quot;findStudentsById&quot;parameterType=&quot;int&quot;resultType=&quot;student&quot;&gt;select*fromstudentwhereidin&lt;foreachcollection=&quot;list&quot;open=&quot;(&quot;separator=&quot;,&quot;close=&quot;)&quot;item=&quot;item&quot;&gt;#{item}&lt;/foreach&gt;&lt;/select&gt;SQLç‰‡æ®µ&lt;sqlid=&quot;sql&quot;&gt;select*fromstudent&lt;/sql&gt;è°ƒç”¨&lt;includerefid=&quot;sql&quot;&gt;&lt;/include&gt;å¤šè¡¨è”åˆæŸ¥è¯¢VOè§£å†³æ€è·¯ï¼šè¦æ±‚è¿”å›çš„æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå¦‚æœpojoä¸èƒ½æ»¡è¶³(è¦è¿”å›çš„åˆ—ä¸å­˜åœ¨pojoä¸­)ï¼Œé‚£ä¹ˆåˆ›å»ºä¸€ä¸ªVOå¯¹è±¡ï¼Œè¿™ä¸ªVOå¯¹è±¡ä¸­åŒ…å«äº†æ‰€æœ‰è¦è¿”å›çš„å­—æ®µåˆ›å»ºä¸€ä¸ªVOpackagecn.kgc.vo;importcn.kgc.pojo.Student;//ç»§æ‰¿çš„åŸåˆ™ï¼šè¦è¿”å›çš„å­—æ®µå“ªä¸ªpojoä¸­å¤šï¼Œé‚£ä¹ˆå°±ç»§æ‰¿å“ªä¸ªpojopublicclassStudentVOextendsStudent{privateStringgradeName;publicStringgetGradeName(){returngradeName;}publicvoidsetGradeName(StringgradeName){this.gradeName=gradeName;}}ç¼–å†™mapperæ¥å£publicinterfaceStudentMapper{/***æŸ¥è¯¢å­¦ç”Ÿä¿¡æ¯ï¼Œè¦æ±‚å±•ç¤ºå­¦ç”Ÿä¿¡æ¯ä¸­å¹´çº§åç§°(è”åˆæŸ¥è¯¢)*/List&lt;StudentVO&gt;getStudentVO();}ç¼–å†™mapper.xml&lt;selectid=&quot;getStudentVO&quot;resultType=&quot;cn.kgc.vo.StudentVO&quot;&gt;SELECTs.*,g.namegradeNameFROMstudents,gradegWHEREs.grade_id=g.id&lt;/select&gt;ä¸€å¯¹ä¸€æŒ‰ç…§æŸ¥è¯¢åµŒå¥—å¤„ç†&lt;resultMapid=&quot;IcpInfoType&quot;type=&quot;icpInfo&quot;&gt;&lt;!--propertyï¼šå®ä½“ç±»çš„å¯¹è±¡å±æ€§åï¼Œcolumnï¼šæ•°æ®åº“ä¸­å…³è”çš„åˆ—ï¼ŒjavaTypeï¼šå®ä½“ç±»å¯¹è±¡ï¼Œselectï¼šä¸€ä¸ªsqlè¯­å¥æŸ¥è¯¢çš„æ˜¯å®ä½“å¯¹è±¡çš„sql--&gt;&lt;associationproperty=&quot;type&quot;column=&quot;type&quot;javaType=&quot;type&quot;select=&quot;getTypeList&quot;/&gt;&lt;/resultMap&gt;&lt;selectid=&quot;getList&quot;resultMap=&quot;IcpInfoType&quot;&gt;select*fromicpinfo&lt;/select&gt;&lt;!--è¿™ä¸ªtypeIDè·å–çš„æ˜¯column=&quot;type&quot;è¿™ä¸ªåˆ—çš„å€¼--&gt;&lt;selectid=&quot;getTypeList&quot;resultType=&quot;type&quot;&gt;select*fromtypewheretid=#{id}&lt;/select&gt;æŒ‰ç…§ç»“æœåµŒå¥—å¤„ç†&lt;selectid=&quot;getList2&quot;resultMap=&quot;getList2&quot;&gt;selecticp,name,address,home,introduce,author,email,`date`,type,tid,tnamefromicpinfoi,typetwherei.type=t.tid&lt;/select&gt;&lt;!--type=è¦æŸ¥è¯¢çš„å¯¹è±¡--&gt;&lt;resultMapid=&quot;getList2&quot;type=&quot;icpInfo&quot;&gt;&lt;!--property=å®ä½“ç±»çš„å±æ€§åcolumn=åˆ—åoråˆ«å--&gt;&lt;resultproperty=&quot;icp&quot;column=&quot;icp&quot;/&gt;&lt;resultproperty=&quot;name&quot;column=&quot;name&quot;/&gt;&lt;resultproperty=&quot;address&quot;column=&quot;address&quot;/&gt;&lt;resultproperty=&quot;home&quot;column=&quot;home&quot;/&gt;&lt;resultproperty=&quot;introduce&quot;column=&quot;introduce&quot;/&gt;&lt;resultproperty=&quot;author&quot;column=&quot;author&quot;/&gt;&lt;resultproperty=&quot;email&quot;column=&quot;email&quot;/&gt;&lt;resultproperty=&quot;date&quot;column=&quot;date&quot;/&gt;&lt;!--å¤æ‚ç±»å‹property=åœ¨icpInfoé‡Œçš„å±æ€§æ˜¯typejavaType=typeçš„å¯¹è±¡--&gt;&lt;associationproperty=&quot;type&quot;javaType=&quot;type&quot;&gt;&lt;resultproperty=&quot;tid&quot;column=&quot;tid&quot;/&gt;&lt;resultproperty=&quot;tname&quot;column=&quot;tname&quot;/&gt;&lt;/association&gt;&lt;/resultMap&gt;ä¸€å¯¹å¤šä¸€å¯¹å¤šåªéœ€è¦æŠŠassociationæ¢æˆ&lt;!--ofType=&quot;&quot;é›†åˆä¸­çš„æ³›å‹ä¿¡æ¯--&gt;&lt;collectionproperty=&quot;&quot;ofType=&quot;&quot;&gt;&lt;/collection&gt;&lt;?xmlversion=&quot;1.0&quot;encoding=&quot;UTF-8&quot;?&gt;&lt;!DOCTYPEmapperPUBLIC&quot;-//mybatis.org//DTDMapper3.0//EN&quot;&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;&gt;&lt;mappernamespace=&quot;cn.kgc.mapper.GradeMapper&quot;&gt;&lt;!--æŸ¥è¯¢å¹´çº§ï¼ŒæŠŠå±äºè¿™ä¸ªå¹´çº§çš„æ‰€æœ‰å­¦ç”ŸæŸ¥è¯¢å‡ºæ¥--&gt;&lt;resultMaptype=&quot;cn.kgc.pojo.Grade&quot;id=&quot;gradeStudentMap&quot;&gt;&lt;idcolumn=&quot;id&quot;property=&quot;id&quot;javaType=&quot;int&quot;/&gt;&lt;resultcolumn=&quot;name&quot;property=&quot;name&quot;javaType=&quot;string&quot;/&gt;&lt;!--collection:ä¸€å¯¹å¤šçš„æ˜ å°„å…³ç³»property:è¡¨ç¤ºä¸€å¯¹å¤šæ˜ å°„å…³ç³»åœ¨pojoä¸­çš„å±æ€§åofType:è¡¨ç¤ºè¯¥é›†åˆçš„æ³›å‹çš„å…¨é™å®šå--&gt;&lt;collectionproperty=&quot;studentList&quot;ofType=&quot;cn.kgc.pojo.Student&quot;&gt;&lt;idcolumn=&quot;sid&quot;property=&quot;id&quot;javaType=&quot;int&quot;/&gt;&lt;resultcolumn=&quot;sname&quot;property=&quot;name&quot;javaType=&quot;string&quot;/&gt;&lt;!--gradeidå› ä¸ºåœ¨gradeä¸­å·²ç»æœ‰äº†ï¼Œæ‰€ä»¥ä¸éœ€è¦å†é…ç½®--&gt;&lt;/collection&gt;&lt;/resultMap&gt;&lt;selectid=&quot;getGradeById&quot;parameterType=&quot;int&quot;resultMap=&quot;gradeStudentMap&quot;&gt;SELECTg.*,s.idsid,s.namesnameFROMgradeg,studentsWHEREg.id=s.grade_idANDg.id=#{id}&lt;/select&gt;&lt;/mapper&gt;å¤šå¯¹å¤š&lt;?xmlversion=&quot;1.0&quot;encoding=&quot;UTF-8&quot;?&gt;&lt;!DOCTYPEmapperPUBLIC&quot;-//mybatis.org//DTDMapper3.0//EN&quot;&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;&gt;&lt;mappernamespace=&quot;cn.kgc.mapper.StudentMapper&quot;&gt;&lt;resultMaptype=&quot;cn.kgc.pojo.Student&quot;id=&quot;studentMap&quot;&gt;&lt;idcolumn=&quot;id&quot;property=&quot;id&quot;javaType=&quot;int&quot;/&gt;&lt;resultcolumn=&quot;name&quot;property=&quot;name&quot;javaType=&quot;string&quot;/&gt;&lt;resultcolumn=&quot;grade_id&quot;property=&quot;gradeId&quot;javaType=&quot;int&quot;/&gt;&lt;!--ä¸€å¯¹å¤šçš„æ˜ å°„å…³ç³»--&gt;&lt;collectionproperty=&quot;studentCourseList&quot;ofType=&quot;cn.kgc.pojo.StudentCourse&quot;&gt;&lt;idcolumn=&quot;scid&quot;property=&quot;id&quot;javaType=&quot;int&quot;/&gt;&lt;!--studentCourseå’Œcourseæ˜¯ä¸€å¯¹ä¸€çš„æ˜ å°„ä¿„å…³ç³»--&gt;&lt;associationproperty=&quot;course&quot;javaType=&quot;cn.kgc.pojo.Course&quot;&gt;&lt;idcolumn=&quot;cid&quot;property=&quot;id&quot;javaType=&quot;int&quot;/&gt;&lt;resultcolumn=&quot;cname&quot;property=&quot;name&quot;javaType=&quot;string&quot;/&gt;&lt;/association&gt;&lt;/collection&gt;&lt;/resultMap&gt;&lt;selectid=&quot;getStudentById&quot;parameterType=&quot;int&quot;resultMap=&quot;studentMap&quot;&gt;SELECTs.*,sc.idscid,c.idcid,c.namecnameFROMstudents,student_coursesc,coursecWHEREs.id=sc.sidANDc.id=sc.cidANDs.id=#{id}&lt;/select&gt;&lt;/mapper&gt;å»¶è¿ŸåŠ è½½ä»€ä¹ˆæ˜¯æ‡’åŠ è½½æ‡’åŠ è½½ï¼šå°±æ˜¯åœ¨éœ€è¦æ•°æ®çš„æ—¶å€™æ‰åŠ è½½ï¼Œä¸éœ€è¦æ•°æ®çš„æ—¶å€™ä¸åŠ è½½ï¼Œè¿™æ ·æœ‰åˆ©äºç³»ç»Ÿæ€§èƒ½çš„æå‡ï¼Œè¿™å°±æ˜¯æ‡’åŠ è½½ï¼ˆä¹Ÿå«åšå»¶è¿ŸåŠ è½½ï¼‰å¥½å¤„ï¼šåœ¨å…³è”æŸ¥è¯¢çš„æ—¶å€™ï¼Œæ ¹æ®éœ€æ±‚è¿›è¡Œå…³è”æŸ¥è¯¢ï¼Œå¤§å¤§æé«˜äº†æ•°æ®åº“çš„æŸ¥è¯¢æ€§èƒ½ã€‚ï¼ˆå•è¡¨çš„æŸ¥è¯¢æ•ˆç‡æ°¸è¿œè¦æ¯”å¤šè¡¨è”åˆæŸ¥è¯¢çš„æ•ˆç‡é«˜ï¼‰åå¤„ï¼šå› ä¸ºéœ€è¦ç”¨åˆ°æ•°æ®çš„æ—¶å€™æ‰å»åšæŸ¥è¯¢ï¼Œè¿™æ ·å¤§æ‰¹é‡çš„æ•°æ®æŸ¥è¯¢çš„æ—¶å€™ç­‰å¾…æ—¶é—´ä¼šå˜å¾—æ›´é•¿ï¼Œé€ æˆç”¨æˆ·çš„ä½“éªŒä¸‹é™(select*fromstudent)ä¼šæŠŠæ‰€æœ‰çš„å­¦ç”Ÿçš„å¹´çº§ç¼–å·ä¹Ÿåœ¨é‡Œé¢çªç„¶è¦æŸ¥è¯¢å¹´çº§ä¿¡æ¯ï¼Œå®ƒåº•å±‚æ“ä½œæ˜¯ï¼šæ ¹æ®å¹´çº§idä¸€ä¸ªä¸€ä¸ªå»æ‰§è¡ŒæŸ¥è¯¢ä½¿ç”¨associationå®ç°æ‡’åŠ è½½æ ¸å¿ƒé…ç½®å¼€å¯æ‡’åŠ è½½&lt;settings&gt;&lt;!--å¼€å¯æ‡’åŠ è½½--&gt;&lt;settingname=&quot;lazyLoadingEnabled&quot;value=&quot;true&quot;/&gt;&lt;!--mybatis3.4.1ä¹‹å‰é»˜è®¤å€¼æ˜¯trueï¼Œéœ€è¦è®¾ç½®ä¸ºfalseï¼ˆå°†ç§¯æåŠ è½½æ”¹ä¸ºæ¶ˆæ¯åŠ è½½ä¹Ÿå°±æ˜¯æŒ‰éœ€åŠ è½½ï¼‰--&gt;&lt;settingname=&quot;aggressiveLazyLoading&quot;value=&quot;false&quot;/&gt;&lt;!--å› ä¸ºæˆ‘è¿™é‡Œä¸ºäº†æ‰“å°å¯¹è±¡é‡Œä¿¡æ¯çš„æ–¹ä¾¿ï¼Œæ‰€ä»¥éƒ½é‡å†™äº†toStringæ–¹æ³•ï¼Œmybatisä¸­é»˜è®¤æ˜¯å¦‚æœä½¿ç”¨(equals,clone,hashCode,toStringä»»æ„ä¸€ä¸ªæ–¹æ³•)é‚£ä¹ˆå°±ä¸å†å»¶è¿ŸåŠ è½½--&gt;&lt;settingname=&quot;lazyLoadTriggerMethods&quot;value=&quot;&quot;/&gt;&lt;/settings&gt;GradeMapper.xml&lt;?xmlversion=&quot;1.0&quot;encoding=&quot;UTF-8&quot;?&gt;&lt;!DOCTYPEmapperPUBLIC&quot;-//mybatis.org//DTDMapper3.0//EN&quot;&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;&gt;&lt;mappernamespace=&quot;cn.kgc.mapper.GradeMapper&quot;&gt;&lt;!--æ ¹æ®idæŸ¥è¯¢å¹´çº§å¯¹è±¡--&gt;&lt;selectid=&quot;getGradeById&quot;parameterType=&quot;int&quot;resultType=&quot;cn.kgc.pojo.Grade&quot;&gt;select*fromgradewhereid=#{id}&lt;/select&gt;&lt;/mapper&gt;StudentMapper.xml&lt;?xmlversion=&quot;1.0&quot;encoding=&quot;UTF-8&quot;?&gt;&lt;!DOCTYPEmapperPUBLIC&quot;-//mybatis.org//DTDMapper3.0//EN&quot;&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;&gt;&lt;mappernamespace=&quot;cn.kgc.mapper.StudentMapper&quot;&gt;&lt;resultMaptype=&quot;cn.kgc.pojo.Student&quot;id=&quot;studentMap&quot;&gt;&lt;idcolumn=&quot;id&quot;property=&quot;id&quot;javaType=&quot;int&quot;/&gt;&lt;resultcolumn=&quot;name&quot;property=&quot;name&quot;javaType=&quot;string&quot;/&gt;&lt;!--ä¸€ä¸ªå­¦ç”Ÿå¯¹åº”ä¸€ä¸ªå¹´çº§ï¼šä¸€å¯¹ä¸€çš„å…³ç³»æ˜ å°„å¯¹äºassociationæ–¹å¼çš„æ‡’åŠ è½½ï¼šselect:æ­¤å¤„è¦æ±‚æ˜¯æ ¹æ®å¹´çº§çš„idæŸ¥è¯¢å¹´çº§å¯¹è±¡çš„mapperæ¥å£ä¸­æ–¹æ³•çš„å…¨é™å®šåcolumn:åœ¨æ•°æ®åº“ä¸­è¡¨ä¸è¡¨ä¹‹é—´å…³ç³»çš„å¤–é”®--&gt;&lt;associationproperty=&quot;grade&quot;javaType=&quot;cn.kgc.pojo.Grade&quot;select=&quot;cn.kgc.mapper.GradeMapper.getGradeById&quot;column=&quot;grade_id&quot;&gt;&lt;/association&gt;&lt;/resultMap&gt;&lt;selectid=&quot;getAllStudents&quot;resultMap=&quot;studentMap&quot;&gt;select*fromstudent&lt;/select&gt;&lt;/mapper&gt;ä½¿ç”¨collectionå®ç°æ‡’åŠ è½½æ ¸å¿ƒé…ç½®å¼€å¯æ‡’åŠ è½½&lt;settings&gt;&lt;!--å¼€å¯æ‡’åŠ è½½--&gt;&lt;settingname=&quot;lazyLoadingEnabled&quot;value=&quot;true&quot;/&gt;&lt;!--mybatis3.4.1ä¹‹å‰é»˜è®¤å€¼æ˜¯trueï¼Œéœ€è¦è®¾ç½®ä¸ºfalseï¼ˆå°†ç§¯æåŠ è½½æ”¹ä¸ºæ¶ˆæ¯åŠ è½½ä¹Ÿå°±æ˜¯æŒ‰éœ€åŠ è½½ï¼‰--&gt;&lt;settingname=&quot;aggressiveLazyLoading&quot;value=&quot;false&quot;/&gt;&lt;!--å› ä¸ºæˆ‘è¿™é‡Œä¸ºäº†æ‰“å°å¯¹è±¡é‡Œä¿¡æ¯çš„æ–¹ä¾¿ï¼Œæ‰€ä»¥éƒ½é‡å†™äº†toStringæ–¹æ³•ï¼Œmybatisä¸­é»˜è®¤æ˜¯å¦‚æœä½¿ç”¨(equals,clone,hashCode,toStringä»»æ„ä¸€ä¸ªæ–¹æ³•)é‚£ä¹ˆå°±ä¸å†å»¶è¿ŸåŠ è½½--&gt;&lt;settingname=&quot;lazyLoadTriggerMethods&quot;value=&quot;&quot;/&gt;&lt;/settings&gt;StudentMapper.xml&lt;selectid=&quot;getStudentsByGradeId&quot;parameterType=&quot;int&quot;resultType=&quot;cn.kgc.pojo.Student&quot;&gt;select*fromstudentwheregrade_id=#{gradeId}&lt;/select&gt;GradeMapper.xml&lt;!--æŸ¥è¯¢å¹´çº§ä¿¡æ¯ï¼Œæœ‰å¯èƒ½æŸ¥è¯¢å¹´çº§ä¸­æ‰€æœ‰çš„å­¦ç”Ÿä¿¡æ¯--&gt;&lt;resultMaptype=&quot;cn.kgc.pojo.Grade&quot;id=&quot;gradeMap&quot;&gt;&lt;idcolumn=&quot;id&quot;property=&quot;id&quot;javaType=&quot;int&quot;/&gt;&lt;resultcolumn=&quot;name&quot;property=&quot;name&quot;javaType=&quot;string&quot;/&gt;&lt;!--ä¸€å¯¹å¤šçš„æ˜ å°„å…³ç³»select:æ ¹æ®å¹´çº§ç¼–å·æŸ¥è¯¢å­¦ç”Ÿåˆ—è¡¨çš„æ–¹æ³•column:å°±æ˜¯gradeçš„idï¼ˆå®ƒå°±æ˜¯gradeè¡¨çš„ä¸»é”®ï¼‰--&gt;&lt;collectionproperty=&quot;studentList&quot;ofType=&quot;cn.kgc.pojo.Student&quot;select=&quot;cn.kgc.mapper.StudentMapper.getStudentsByGradeId&quot;column=&quot;id&quot;&gt;&lt;/collection&gt;&lt;/resultMap&gt;&lt;selectid=&quot;getAllGrades&quot;resultMap=&quot;gradeMap&quot;&gt;select*fromgrade&lt;/select&gt;mybatisç¼“å­˜ä¸€çº§ç¼“å­˜å®ƒæ˜¯SqlSessionçº§åˆ«çš„ï¼ŒåŒä¸€ä¸ªSqlSessionæ‰æ¶‰åŠåˆ°ä¸€çº§ç¼“å­˜ä¸€çº§ç¼“å­˜æ˜¯é»˜è®¤å­˜åœ¨ï¼Œå®ƒä¸éœ€è¦å»åšä»»ä½•çš„è®¾ç½®äºŒçº§ç¼“å­˜å®ƒæ˜¯mapperçº§åˆ«çš„ï¼Œéœ€è¦å¼€å¯æ‰èƒ½ä½¿ç”¨ç¼“å­˜åœ¨å®é™…å¼€å‘ä¸­æ˜¯å¾ˆæœ‰ç”¨çš„ï¼Œå®ƒèƒ½å¤§å¤§çš„æå‡æŸ¥è¯¢çš„æ•ˆç‡ï¼Œæé«˜ç¨‹åºçš„æ€§èƒ½åœ¨æ ¸å¿ƒé…ç½®æ–‡ä»¶ä¸­å¼€å¯äºŒçº§ç¼“å­˜&lt;!--å¼€å¯äºŒçº§ç¼“å­˜(é»˜è®¤å€¼å°±æ˜¯trueï¼Œå‡†å¤‡æˆ‘ä»¬ä½¿ç”¨äºŒçº§ç¼“å­˜ï¼Œå¯ä»¥ä¸ç”¨è®¾ç½®)--&gt;&lt;settingname=&quot;cacheEnabled&quot;value=&quot;true&quot;/&gt;åœ¨mappe.xmlä¸­å¼€å¯äºŒçº§ç¼“å­˜&lt;mappernamespace=&quot;cn.kgc.mapper.StudentMapper&quot;&gt;&lt;!--åœ¨StudentMapper.xmlä¸­å¼€å¯äºŒçº§ç¼“å­˜,å› ä¸ºmybatisä¸­äºŒçº§ç¼“å­˜çš„å®ç°ç±»åªæœ‰ä¸€ä¸ªï¼Œé»˜è®¤å°±æ˜¯è¿™ä¸ªï¼Œtypeå¯ä»¥çœç•¥ä¸å†™--&gt;&lt;cachetype=&quot;org.apache.ibatis.cache.impl.PerpetualCache&quot;&gt;&lt;/cache&gt;&lt;/mapper&gt;pojoéœ€è¦å®ç°åºåˆ—åŒ–æ¥å£å› ä¸ºç¼“å­˜çš„æ—¶å€™è¦å°†pojoæµåŒ–ç„¶åå­˜å‚¨åœ¨å†…å­˜ä¸­ï¼ŒæŸ¥è¯¢å†å–å‡ºpublicclassStudentimplementsSerializable{}è¡¥å……ï¼šåœ¨mapperåº”ç”¨äºŒçº§ç¼“å­˜åï¼Œé»˜è®¤æ˜¯æ‰€æœ‰çš„æŸ¥è¯¢æ–¹æ³•éƒ½å¼€å¯äºŒçº§ç¼“å­˜ï¼Œå¦‚æœè¦æŸä¸ªæŸ¥è¯¢ä¸ä½¿ç”¨äºŒçº§ç¼“å­˜å¯ä»¥æ·»åŠ useCache=&quot;false&quot;æ³¨è§£å¼€å‘å…¥é—¨åœ¨spring4.xå¼€å§‹å°±æ¨èæˆ‘ä»¬ä½¿ç”¨æ³¨è§£ï¼Œå®Œå…¨å»å–ä»£xmlçš„é…ç½®æ–‡ä»¶ç›®å‰æœ€ä¸»æµçš„å¼€å‘æ–¹å¼å°±æ˜¯ï¼šåªä½¿ç”¨æ³¨è§£ï¼Œä¸å†ä½¿ç”¨xmlé…ç½®mybatisæ³¨è§£æ–¹å¼çš„å¼€å‘æ˜¯ä¸€ç§æœªæ¥çš„è¶‹åŠ¿,è¿™ç§æ–¹å¼æ¯”ä¼ ç»Ÿçš„xmlçš„å¼€å‘è¦ç®€å•å¹¶ä¸”é«˜æ•ˆå¯¼å…¥jaråŒ…&lt;dependencies&gt;&lt;!--mysqlé©±åŠ¨--&gt;&lt;dependency&gt;&lt;groupId&gt;mysql&lt;/groupId&gt;&lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;&lt;version&gt;5.1.38&lt;/version&gt;&lt;/dependency&gt;&lt;!--mybatisçš„æ ¸å¿ƒåŒ…--&gt;&lt;dependency&gt;&lt;groupId&gt;org.mybatis&lt;/groupId&gt;&lt;artifactId&gt;mybatis&lt;/artifactId&gt;&lt;version&gt;3.4.6&lt;/version&gt;&lt;/dependency&gt;&lt;!--junitå•å…ƒæµ‹è¯•--&gt;&lt;dependency&gt;&lt;groupId&gt;junit&lt;/groupId&gt;&lt;artifactId&gt;junit&lt;/artifactId&gt;&lt;version&gt;4.12&lt;/version&gt;&lt;/dependency&gt;&lt;!--slf4j-log4j12(slf4j:é…¸è¾£ç²‰)--&gt;&lt;dependency&gt;&lt;groupId&gt;org.slf4j&lt;/groupId&gt;&lt;artifactId&gt;slf4j-log4j12&lt;/artifactId&gt;&lt;version&gt;1.7.25&lt;/version&gt;&lt;/dependency&gt;&lt;/dependencies&gt;é…ç½®æ–‡ä»¶log4j.propertieslog4j.rootLogger=DEBUG,A1log4j.logger.org.mybatis=DEBUGlog4j.appender.A1=org.apache.log4j.ConsoleAppenderlog4j.appender.A1.layout=org.apache.log4j.PatternLayoutlog4j.appender.A1.layout.ConversionPattern=%-d{yyyy-MM-ddHH:mm:ss,SSS}[%t][%c]-[%p]%m%njdbc.propertiesjdbc.dirver=com.mysql.jdbc.Driverjdbc.url=jdbc:mysql://localhost:3306/mybatis?useUnicode=true&amp;amp;characterEncoding=utf-8jdbc.username=rootjdbc.password=rootmybatis-config.xml&lt;?xmlversion=&quot;1.0&quot;encoding=&quot;UTF-8&quot;?&gt;&lt;!DOCTYPEconfigurationPUBLIC&quot;-//mybatis.org//DTDConfig3.0//EN&quot;&quot;http://mybatis.org/dtd/mybatis-3-config.dtd&quot;&gt;&lt;configuration&gt;&lt;!--å¼•å…¥å¤–éƒ¨çš„å±æ€§æ–‡ä»¶--&gt;&lt;propertiesresource=&quot;jdbc.properties&quot;&gt;&lt;/properties&gt;&lt;settings&gt;&lt;!--å¼€å¯é©¼å³°å‘½å--&gt;&lt;settingname=&quot;mapUnderscoreToCamelCase&quot;value=&quot;true&quot;/&gt;&lt;/settings&gt;&lt;!--é…ç½®æ•°æ®æº--&gt;&lt;environmentsdefault=&quot;development&quot;&gt;&lt;environmentid=&quot;development&quot;&gt;&lt;transactionManagertype=&quot;JDBC&quot;/&gt;&lt;dataSourcetype=&quot;POOLED&quot;&gt;&lt;propertyname=&quot;driver&quot;value=&quot;${jdbc.dirver}&quot;/&gt;&lt;propertyname=&quot;url&quot;value=&quot;${jdbc.url}&quot;/&gt;&lt;propertyname=&quot;username&quot;value=&quot;${jdbc.username}&quot;/&gt;&lt;propertyname=&quot;password&quot;value=&quot;${jdbc.password}&quot;/&gt;&lt;/dataSource&gt;&lt;/environment&gt;&lt;/environments&gt;&lt;mappers&gt;&lt;packagename=&quot;cn.kgc.mapper&quot;/&gt;&lt;/mappers&gt;&lt;/configuration&gt;@Select(&quot;SQL&quot;)@Insert(&quot;SQL&quot;)@Delete(&quot;SQL&quot;)@Update(&quot;SQL&quot;)è§£å†³æ•°æ®åº“è¡¨ä¸­çš„åˆ—åå’Œpojoä¸­å±æ€§åä¸ä¸€è‡´ç¬¬ä¸€ç§ç»™sqlè¯­å¥èµ·åˆ«åç¬¬äºŒç§@Resultsç›¸å½“äºæ˜¯resultMap@Select(&quot;select*frombook&quot;)@Results(id=&quot;bookMap&quot;,value={@Result(id=true,column=&quot;id&quot;,property=&quot;id&quot;),@Result(column=&quot;book_name&quot;,property=&quot;name&quot;),@Result(column=&quot;price&quot;,property=&quot;price&quot;)})List&lt;Book&gt;getAllBooks();æ³¨è§£å¼€å‘ä¸­çš„åŠ¨æ€sqlè¾“å…¥æ˜ å°„ç±»å‹ä¸ºç®€å•ç±»å‹/***æœ‰å¯èƒ½æŸ¥è¯¢å…¨éƒ¨ï¼Œæœ‰å¯èƒ½æ ¹æ®idæŸ¥è¯¢*åŠ¨æ€sqlä¸­è¾“å…¥æ˜ å°„ä¸ºç®€å•ç±»å‹ï¼Œè¾“å…¥æ˜ å°„ä¸ºç®€å•ç±»å‹testä¸­å˜é‡åå¿…é¡»å«_parameter*/@Select(&quot;&lt;script&gt;SELECT*FROMbook&lt;iftest='_parameter!=null'&gt;WHEREid=#{id}&lt;/if&gt;&lt;/script&gt;&quot;)List&lt;Book&gt;getBooksOrById(Integerid);è¾“å…¥æ˜ å°„ç±»å‹ä¸ºpojoå¼€å‘äº§ç”ŸSQLè¯­å¥çš„ç±»å’Œæ–¹æ³•packagecn.kgc.sql.provider;importcn.kgc.pojo.Book;publicclassBookMapperProvider{/***ä¸“é—¨ç”¨æ¥ç»™BookMapperæ¥å£æ¥æä¾›åŠ¨æ€sqlè¯­å¥çš„*@parambook*@return*/publicStringgetBooks(Bookbook){Stringsql=&quot;select*frombook&quot;;if(book!=null){if(book.getId()!=null){//idæœ‰å€¼sql=&quot;select*frombookwhereid=#{id}&quot;;}if(book.getName()!=null&amp;&amp;!book.getName().equals(&quot;&quot;)){sql=&quot;select*frombookwherenamelike#{name}&quot;;}if(book.getId()!=null&amp;&amp;(book.getName()!=null&amp;&amp;!book.getName().equals(&quot;&quot;))){sql=&quot;select*frombookwhereid=#{id}andnamelike#{name}&quot;;}}returnsql;}}æ¥å£/***æŸ¥è¯¢ï¼šæœ‰å¯èƒ½æŸ¥è¯¢å…¨éƒ¨ï¼Œæœ‰å¯èƒ½æ ¹æ®idæŸ¥è¯¢ï¼Œæœ‰å¯èƒ½æ ¹æ®nameåšæ¨¡ç³ŠæŸ¥è¯¢*@parambook*@return*/@SelectProvider(type=BookMapperProvider.class,method=&quot;getBooks&quot;)List&lt;Book&gt;getBooks(Bookbook);æ³¨è§£å¼€å‘å®ç°å¤æ‚çš„æ˜ å°„å…³ç³»å¤æ‚çš„æ˜ å°„å¼€å‘æœ¬è´¨æ˜¯ä¸¤ç§ä¸€å¯¹ä¸€ã€ä¸€å¯¹å¤šæ³¨è§£å°±å¯¹åº”çš„æ˜¯ï¼š@One(ä¸€å¯¹ä¸€)@Many(ä¸€å¯¹å¤š)è¦æ±‚æˆ‘ä»¬ä½¿ç”¨æ‡’åŠ è½½ä¸€å¯¹ä¸€å…³ç³»åœ¨æ ¸å¿ƒé…ç½®æ–‡ä»¶ä¸­å¼€å¯æ‡’åŠ è½½&lt;settings&gt;&lt;!--å¼€å¯é©¼å³°å‘½å--&gt;&lt;settingname=&quot;mapUnderscoreToCamelCase&quot;value=&quot;true&quot;/&gt;&lt;!--å¼€å¯æ‡’åŠ è½½--&gt;&lt;settingname=&quot;lazyLoadingEnabled&quot;value=&quot;true&quot;/&gt;&lt;!--mybatis3.4.1ä¹‹å‰é»˜è®¤å€¼æ˜¯trueï¼Œéœ€è¦è®¾ç½®ä¸ºfalseï¼ˆå°†ç§¯æåŠ è½½æ”¹ä¸ºæ¶ˆæ¯åŠ è½½ä¹Ÿå°±æ˜¯æŒ‰éœ€åŠ è½½ï¼‰--&gt;&lt;settingname=&quot;aggressiveLazyLoading&quot;value=&quot;false&quot;/&gt;&lt;!--å› ä¸ºæˆ‘è¿™é‡Œä¸ºäº†æ‰“å°å¯¹è±¡é‡Œä¿¡æ¯çš„æ–¹ä¾¿ï¼Œæ‰€ä»¥éƒ½é‡å†™äº†toStringæ–¹æ³•ï¼Œmybatisä¸­é»˜è®¤æ˜¯å¦‚æœä½¿ç”¨(equals,clone,hashCode,toStringä»»æ„ä¸€ä¸ªæ–¹æ³•)é‚£ä¹ˆå°±ä¸å†å»¶è¿ŸåŠ è½½--&gt;&lt;settingname=&quot;lazyLoadTriggerMethods&quot;value=&quot;&quot;/&gt;&lt;/settings&gt;publicinterfaceGradeMapper{/***æ ¹æ®idæŸ¥è¯¢å¯¹è±¡*@paramid*@return*/@Select(&quot;select*fromgradewhereid=#{id}&quot;)GradegetGradeById(Integerid);}publicinterfaceStudentMapper{/***æŸ¥è¯¢å­¦ç”Ÿé¡ºä¾¿å°†å­¦ç”Ÿæ‰€åœ¨çš„å¹´çº§åç§°æŸ¥è¯¢å‡ºæ¥*/@Select(&quot;select*fromstudent&quot;)@Results(id=&quot;studentMap&quot;,value={@Result(id=true,column=&quot;id&quot;,property=&quot;id&quot;),@Result(column=&quot;name&quot;,property=&quot;name&quot;),@Result(column=&quot;grade_id&quot;,property=&quot;grade&quot;,one=@One(select=&quot;cn.kgc.mapper.GradeMapper.getGradeById&quot;,fetchType=FetchType.LAZY))})List&lt;Student&gt;getAllStudents();}FetchType.LAZYè¡¨ç¤ºåŠ è½½çš„æ–¹å¼æ˜¯æ‡’åŠ è½½,FetchType.EAGERè¡¨ç¤ºä¸€å®šè”åˆæŸ¥è¯¢å¦‚æœä¸æ·»åŠ fetchTypeï¼Œé»˜è®¤å°±æ˜¯æ‡’åŠ è½½ä¸€å¯¹å¤šçš„å…³ç³»publicinterfaceStudentMapper{/***æ ¹æ®å¹´çº§ç¼–å·æŸ¥è¯¢å­¦ç”Ÿåˆ—è¡¨*@paramid*@return*/@Select(&quot;select*fromstudentwheregrade_id=#{gid}&quot;)List&lt;Student&gt;findStudentsListByGradeId(Integerid);}packagecn.kgc.mapper;importjava.util.List;importorg.apache.ibatis.annotations.Many;importorg.apache.ibatis.annotations.Result;importorg.apache.ibatis.annotations.Results;importorg.apache.ibatis.annotations.Select;importorg.apache.ibatis.mapping.FetchType;importcn.kgc.pojo.Grade;publicinterfaceGradeMapper{@Select(&quot;select*fromgrade&quot;)@Results(id=&quot;gradeMap&quot;,value={@Result(id=true,column=&quot;id&quot;,property=&quot;id&quot;),@Result(column=&quot;name&quot;,property=&quot;name&quot;),@Result(column=&quot;id&quot;,property=&quot;studentList&quot;,many=@Many(select=&quot;cn.kgc.mapper.StudentMapper.findStudentsListByGradeId&quot;,fetchType=FetchType.LAZY))})List&lt;Grade&gt;getGrades();}mybatisåŸºäºäºŒçº§ç¼“å­˜çš„å¼€å‘ä¸€çº§ç¼“å­˜åŸºäºsqlSessionçš„ï¼Œé»˜è®¤å°±å­˜åœ¨çš„ï¼Œå’±ä»¬å¯ä»¥ä¸ç”¨ç®¡ï¼Œå®ƒä¸€å®šä¼šå­˜åœ¨4-1åœ¨æ ¸å¿ƒé…ç½®æ–‡ä»¶ä¸­å¼€å¯äºŒçº§ç¼“å­˜&lt;!--å¼€å¯äºŒçº§ç¼“å­˜(æ–°ç‰ˆæœ¬çš„mybatisé»˜è®¤å°±å·²ç»å¼€å¯äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸ç”¨ä¸“é—¨å¼€)--&gt;&lt;settingname=&quot;cacheEnabled&quot;value=&quot;true&quot;/&gt;4-2åœ¨mapperæ¥å£ä¸­ä½¿ç”¨æ³¨è§£é…ç½®å¼€å¯äºŒçº§ç¼“å­˜&lt;!--å¼€å¯äºŒçº§ç¼“å­˜(æ–°ç‰ˆæœ¬çš„mybatisé»˜è®¤å°±å·²ç»å¼€å¯äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸ç”¨ä¸“é—¨å¼€)--&gt;&lt;settingname=&quot;cacheEnabled&quot;value=&quot;true&quot;/&gt;4-2pojoéœ€è¦å®ç°åºåˆ—åŒ–æ¥å£publicclassBookimplementsSerializable{}4-3mapperå¼€å¯äºŒçº§ç¼“å­˜@CacheNamespace(blocking=true)//åœ¨mapperæ¥å£ä¸­å¼€å¯äºŒçº§ç¼“å­˜ï¼Œé»˜è®¤æ˜¯æ‰€æœ‰çš„æŸ¥è¯¢éƒ½ä½¿ç”¨äºŒçº§ç¼“å­˜publicinterfaceBookMapper{/***æŸ¥è¯¢:æ ¹æ®ä¸»é”®æŸ¥è¯¢*åŒæ ·å‡†å®ˆï¼šè¾“å…¥æ˜ å°„ç±»å‹ä¸ºç®€å•ç±»å‹#{éšä¾¿å†™}*å¦‚æœåˆ—åä¸ä¸€æ ·,å¯ä»¥ç›´æ¥å¼•ç”¨ä¸Šé¢å·²ç»å†™å¥½çš„@Resultså®šä¹‰çš„åˆ—å’Œpojoå±æ€§æ˜ å°„çš„å…³ç³»ï¼Œæ–¹å¼ï¼š@ResultMap(&quot;@Resultsçš„id&quot;)*/@Select(&quot;SELECT*FROMbookWHEREid=#{id}&quot;)@ResultMap(&quot;bookMap&quot;)//@Options(useCache=true)//é»˜è®¤å°±æ˜¯å¼€å¯äºŒçº§ç¼“å­˜ï¼Œå¯ä»¥ä¸ç”¨æ·»åŠ è¯¥æ³¨è§£BookgetBookById(Integerid);}åˆ†é¡µæŸ¥è¯¢æ·»åŠ åˆ†é¡µæ’ä»¶çš„jaråŒ…ä¾èµ–&lt;!--pageHelper--&gt;&lt;dependency&gt;&lt;groupId&gt;com.github.pagehelper&lt;/groupId&gt;&lt;artifactId&gt;pagehelper&lt;/artifactId&gt;&lt;version&gt;5.1.6&lt;/version&gt;&lt;/dependency&gt;åœ¨æ ¸å¿ƒé…ç½®æ–‡ä»¶ä¸­é…ç½®åˆ†é¡µæ‹¦æˆªå™¨&lt;!--æ·»åŠ åˆ†é¡µæ’ä»¶--&gt;&lt;plugins&gt;&lt;plugininterceptor=&quot;com.github.pagehelper.PageInterceptor&quot;&gt;&lt;/plugin&gt;&lt;/plugins&gt;å®ç°åˆ†é¡µæ“ä½œ/***åˆ†é¡µæŸ¥è¯¢:åœ¨å®é™…å¼€å‘ä¸­æˆ‘ä»¬éƒ½ä¼šå»ä½¿ç”¨åˆ†é¡µæ’ä»¶æ¥å®Œæˆ*pageHelperæ˜¯å›½äººåšçš„åˆ†é¡µæ’ä»¶ï¼Œéå¸¸çš„ä¼˜ç§€*/@TestpublicvoidtestPage(){//1.å¼€å§‹åˆ†é¡µ(å‚æ•°ä¸€ï¼šå½“å‰è¦å±•ç¤ºçš„é¡µç (1,2..)ï¼Œå‚æ•°äºŒï¼šæ¯é¡µæ˜¾ç¤ºçš„ä¿¡æ¯æ¡æ•°)PageHelper.startPage(1,3);//2.æ‰§è¡ŒæŸ¥è¯¢(æ­£å¸¸çš„æ‰§è¡Œ)BookExampleexample=newBookExample();/*å¦‚æœåˆ†é¡µä¸­æœ‰æ¡ä»¶Criteriacriteria=example.createCriteria();criteria.andNameLike(&quot;%é¾™%&quot;);*/List&lt;Book&gt;list=bookMapper.selectByExample(example);//3.åˆ†é¡µå°±é€šè¿‡pageHelperæ‹¦æˆªå™¨æ¥å®ç°åˆ†é¡µPageInfo&lt;Book&gt;pageInfo=newPageInfo&lt;Book&gt;(list);//ä¸€é¡µä¿¡æ¯List&lt;Book&gt;bookList=pageInfo.getList();for(Bookbook:bookList){System.out.println(book);}System.out.println(&quot;æ€»çš„é¡µæ•°ï¼š&quot;+pageInfo.getPages());}","link":"https://haohanya.github.io/post/mybatis/"},{"title":"Javaåå°„","content":"è·å–Classå¯¹è±¡çš„æ–¹å¼Class.forName(&quot;å…¨ç±»å&quot;);//å°†å­—èŠ‚ç æ–‡ä»¶åŠ è½½è¿›å†…å­˜ï¼Œè¿”å›Classå¯¹è±¡å¤šç”¨äºé…ç½®æ–‡ä»¶ï¼Œå°†ç±»åå®šä¹‰åœ¨é…ç½®æ–‡ä»¶ä¸­ã€‚è¯»å–æ–‡ä»¶ï¼ŒåŠ è½½ç±»ç±»å.classï¼šé€šè¿‡ç±»åçš„å±æ€§classè·å–å¤šç”¨äºå‚æ•°çš„ä¼ é€’å¯¹è±¡.getClass()ï¼šgetClass()æ–¹æ³•åœ¨Objectç±»ä¸­å®šä¹‰ç€ã€‚//å¤šç”¨äºå¯¹è±¡çš„è·å–å­—èŠ‚ç çš„æ–¹å¼Classclazz=News.class;Objectobj=clazz.newInstance();//å®ä¾‹åŒ–ä¸€ä¸ªå¯¹è±¡ï¼šç­‰åŒäºnewä¸€ä¸ªå¯¹è±¡System.out.println(clazz.getSimpleName());//è·å–ç±»åSystem.out.println(clazz.getName());//è·å–å®Œæ•´çš„åŒ…å+ç±»åClasså¯¹è±¡åŠŸèƒ½è·å–æˆå‘˜å˜é‡â€‹Field[]getFields()ï¼šè·å–æ‰€æœ‰publicä¿®é¥°çš„æˆå‘˜å˜é‡â€‹FieldgetField(Stringname)è·å–æŒ‡å®šåç§°çš„publicä¿®é¥°çš„æˆå‘˜å˜é‡â€‹Field[]getDeclaredFields();//è·å–æ‰€æœ‰çš„æˆå‘˜å˜é‡ï¼Œä¸è€ƒè™‘ä¿®é¥°ç¬¦â€‹FieldgetDeclaredField(Stringname);//è·å–æŒ‡å®šåç§°çš„æˆå‘˜å˜é‡ï¼Œä¸è€ƒè™‘ä¿®é¥°ç¬¦Classclazz=News.class;System.out.println(clazz.getSimpleName());//è·å–ç±»åSystem.out.println(clazz.getName());//è·å–åŒ…å+ç±»åObjectobj=clazz.newInstance();//å®ä¾‹åŒ–Newsçš„è¿™ä¸ªå¯¹è±¡Tabletable=obj.getClass().getAnnotation(Table.class);//è·å–objå¯¹è±¡çš„Tableæ³¨è§£ï¼Œæ²¡æœ‰è¿”å›nullSystem.out.println(table.value());Field[]fields=clazz.getDeclaredFields();for(Fieldfield:fields){field.setAccessible(true);//æš´åŠ›åå°„,å¦‚æœä¸å†™è¿™ä¸ªå°†ä¼šæŠ¥é”™//è·å–å±æ€§çš„æ³¨è§£//Fieldfield1=obj.getClass().getDeclaredField(field.getName());//è·å–objå¯¹è±¡çš„æŒ‡å®šå±æ€§PKpk=field.getAnnotation(PK.class);//è·å–å±æ€§çš„æ³¨è§£if(pk!=null){System.out.println(field.getName()+&quot;&gt;&gt;&gt;&quot;+pk);//è·å–å±æ€§åç§°}field.set(obj,null);//ç»™å½“å‰clazzå¯¹è±¡çš„fieldå±æ€§èµ‹å€¼ä¸ºiSystem.out.println(field.get(obj));//è¾“å‡ºclazzå¯¹è±¡çš„fieldçš„å±æ€§å€¼}è·å–æ„é€ æ–¹æ³•â€‹Constructor&lt;?&gt;[]getConstructors()â€‹ConstructorgetConstructor(ç±»&lt;?&gt;...parameterTypes)â€‹ConstructorgetDeclaredConstructor(ç±»&lt;?&gt;...parameterTypes)â€‹Constructor&lt;?&gt;[]getDeclaredConstructors()è·å–æˆå‘˜æ–¹æ³•â€‹Method[]getMethods()â€‹MethodgetMethod(Stringname,ç±»&lt;?&gt;...parameterTypes)â€‹Method[]getDeclaredMethods()â€‹MethodgetDeclaredMethod(Stringname,ç±»&lt;?&gt;...parameterTypes)Fieldï¼šæˆå‘˜å˜é‡è®¾ç½®å€¼voidset(Objectobj,Objectvalue)è·å–å€¼ï¼Œä¼ çš„æ˜¯å¯¹è±¡get(Objectobj)å¿½ç•¥è®¿é—®æƒé™ä¿®é¥°ç¬¦çš„å®‰å…¨æ£€æŸ¥setAccessible(true)Constructor:æ„é€ æ–¹æ³•åˆ›å»ºå¯¹è±¡ï¼Œå¦‚æœä½¿ç”¨ç©ºå‚æ•°æ„é€ æ–¹æ³•åˆ›å»ºå¯¹è±¡ï¼Œæ“ä½œå¯ä»¥ç®€åŒ–ï¼šClasså¯¹è±¡çš„newInstanceæ–¹æ³•TnewInstance(Object...initargs)Methodï¼šæ–¹æ³•å¯¹è±¡æ‰§è¡Œæ–¹æ³•Objectinvoke(Objectobj,Object...args)è·å–æ–¹æ³•åç§°StringgetNameåå°„è·å–æ³¨è§£è·å–objå¯¹è±¡çš„Tableæ³¨è§£ï¼Œæ²¡æœ‰è¿”å›nullï¼Œobjæ˜¯è¦è·å–çš„å¯¹è±¡Tabletable=obj.getClass().getAnnotation(Table.class);è·å–å±æ€§çš„æ³¨è§£ï¼Œè·å–objå¯¹è±¡çš„field.getName()çš„å±æ€§æ³¨è§£Fieldfield1=obj.getClass().getDeclaredField(field.getName());//è·å–objå¯¹è±¡çš„æŒ‡å®šå±æ€§PKpk=field1.getAnnotation(PK.class);//è·å–å±æ€§çš„æ³¨è§£è·å–å½“å‰è°ƒç”¨çš„æ–¹æ³•ä¸Šçš„æ³¨è§£StackTraceElement[]stack=newThrowable().getStackTrace();Methodmethod=this.getClass().getMethod(stack[1].getMethodName());//è¿™é‡Œ0æ˜¯å½“å‰æ–¹æ³•çš„æ³¨è§£ï¼Œ1æ˜¯è°ƒç”¨è€…æ–¹æ³•çš„æ³¨è§£for(Annotationan:method.getAnnotations()){System.out.println(an);}","link":"https://haohanya.github.io/post/java-fan-she/"},{"title":"FastDFS","content":"ä»€ä¹ˆæ˜¯FastDFSFastDFSæ˜¯ç”¨cè¯­è¨€ç¼–å†™çš„ä¸€æ¬¾å¼€æºçš„åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿã€‚FastDFSä¸ºäº’è”ç½‘é‡èº«å®šåˆ¶ï¼Œå……åˆ†è€ƒè™‘äº†å†—ä½™å¤‡ä»½ã€è´Ÿè½½å‡è¡¡ã€çº¿æ€§æ‰©å®¹ç­‰æœºåˆ¶ï¼Œå¹¶æ³¨é‡é«˜å¯ç”¨ã€é«˜æ€§èƒ½ç­‰æŒ‡æ ‡ï¼Œä½¿ç”¨FastDFSå¾ˆå®¹æ˜“æ­å»ºä¸€å¥—é«˜æ€§èƒ½çš„æ–‡ä»¶æœåŠ¡å™¨é›†ç¾¤æä¾›æ–‡ä»¶ä¸Šä¼ ã€ä¸‹è½½ç­‰æœåŠ¡ã€‚FastDFSæ¶æ„åŒ…æ‹¬Trackerserverå’ŒStorageserverã€‚å®¢æˆ·ç«¯è¯·æ±‚Trackerserverè¿›è¡Œæ–‡ä»¶ä¸Šä¼ ã€ä¸‹è½½ï¼Œé€šè¿‡Trackerserverè°ƒåº¦æœ€ç»ˆç”±Storageserverå®Œæˆæ–‡ä»¶ä¸Šä¼ å’Œä¸‹è½½ã€‚Trackerserverä½œç”¨æ˜¯è´Ÿè½½å‡è¡¡å’Œè°ƒåº¦ï¼Œé€šè¿‡Trackerserveråœ¨æ–‡ä»¶ä¸Šä¼ æ—¶å¯ä»¥æ ¹æ®ä¸€äº›ç­–ç•¥æ‰¾åˆ°Storageserveræä¾›æ–‡ä»¶ä¸Šä¼ æœåŠ¡ã€‚å¯ä»¥å°†trackerç§°ä¸ºè¿½è¸ªæœåŠ¡å™¨æˆ–è°ƒåº¦æœåŠ¡å™¨ã€‚Storageserverä½œç”¨æ˜¯æ–‡ä»¶å­˜å‚¨ï¼Œå®¢æˆ·ç«¯ä¸Šä¼ çš„æ–‡ä»¶æœ€ç»ˆå­˜å‚¨åœ¨StorageæœåŠ¡å™¨ä¸Šï¼ŒStorageserveræ²¡æœ‰å®ç°è‡ªå·±çš„æ–‡ä»¶ç³»ç»Ÿè€Œæ˜¯åˆ©ç”¨æ“ä½œç³»ç»Ÿçš„æ–‡ä»¶ç³»ç»Ÿæ¥ç®¡ç†æ–‡ä»¶ã€‚å¯ä»¥å°†storageç§°ä¸ºå­˜å‚¨æœåŠ¡å™¨ã€‚æœåŠ¡ç«¯ä¸¤ä¸ªè§’è‰²ï¼šTrackerï¼šç®¡ç†é›†ç¾¤ï¼Œtrackerä¹Ÿå¯ä»¥å®ç°é›†ç¾¤ã€‚æ¯ä¸ªtrackerèŠ‚ç‚¹åœ°ä½å¹³ç­‰ã€‚æ”¶é›†Storageé›†ç¾¤çš„çŠ¶æ€ã€‚Storageï¼šå®é™…ä¿å­˜æ–‡ä»¶Storageåˆ†ä¸ºå¤šä¸ªç»„ï¼Œæ¯ä¸ªç»„ä¹‹é—´ä¿å­˜çš„æ–‡ä»¶æ˜¯ä¸åŒçš„ã€‚æ¯ä¸ªç»„å†…éƒ¨å¯ä»¥æœ‰å¤šä¸ªæˆå‘˜ï¼Œç»„æˆå‘˜å†…éƒ¨ä¿å­˜çš„å†…å®¹æ˜¯ä¸€æ ·çš„ï¼Œç»„æˆå‘˜çš„åœ°ä½æ˜¯ä¸€è‡´çš„ï¼Œæ²¡æœ‰ä¸»ä»çš„æ¦‚å¿µã€‚æ–‡ä»¶ä¸Šä¼ æµç¨‹å®¢æˆ·ç«¯ä¸Šä¼ æ–‡ä»¶åå­˜å‚¨æœåŠ¡å™¨å°†æ–‡ä»¶IDè¿”å›ç»™å®¢æˆ·ç«¯ï¼Œæ­¤æ–‡ä»¶IDç”¨äºä»¥åè®¿é—®è¯¥æ–‡ä»¶çš„ç´¢å¼•ä¿¡æ¯ã€‚æ–‡ä»¶ç´¢å¼•ä¿¡æ¯åŒ…æ‹¬ï¼šç»„åï¼Œè™šæ‹Ÿç£ç›˜è·¯å¾„ï¼Œæ•°æ®ä¸¤çº§ç›®å½•ï¼Œæ–‡ä»¶åã€‚ç»„åï¼šæ–‡ä»¶ä¸Šä¼ åæ‰€åœ¨çš„storageç»„åç§°ï¼Œåœ¨æ–‡ä»¶ä¸Šä¼ æˆåŠŸåæœ‰storageæœåŠ¡å™¨è¿”å›ï¼Œéœ€è¦å®¢æˆ·ç«¯è‡ªè¡Œä¿å­˜ã€‚è™šæ‹Ÿç£ç›˜è·¯å¾„ï¼šstorageé…ç½®çš„è™šæ‹Ÿè·¯å¾„ï¼Œä¸ç£ç›˜é€‰é¡¹store_path*å¯¹åº”ã€‚å¦‚æœé…ç½®äº†store_path0åˆ™æ˜¯M00ï¼Œå¦‚æœé…ç½®äº†store_path1åˆ™æ˜¯M01ï¼Œä»¥æ­¤ç±»æ¨ã€‚æ•°æ®ä¸¤çº§ç›®å½•ï¼šstorageæœåŠ¡å™¨åœ¨æ¯ä¸ªè™šæ‹Ÿç£ç›˜è·¯å¾„ä¸‹åˆ›å»ºçš„ä¸¤çº§ç›®å½•ï¼Œç”¨äºå­˜å‚¨æ•°æ®æ–‡ä»¶ã€‚æ–‡ä»¶åï¼šä¸æ–‡ä»¶ä¸Šä¼ æ—¶ä¸åŒã€‚æ˜¯ç”±å­˜å‚¨æœåŠ¡å™¨æ ¹æ®ç‰¹å®šä¿¡æ¯ç”Ÿæˆï¼Œæ–‡ä»¶ååŒ…å«ï¼šæºå­˜å‚¨æœåŠ¡å™¨IPåœ°å€ã€æ–‡ä»¶åˆ›å»ºæ—¶é—´æˆ³ã€æ–‡ä»¶å¤§å°ã€éšæœºæ•°å’Œæ–‡ä»¶æ‹“å±•åç­‰ä¿¡æ¯ã€‚æ–‡ä»¶ä¸‹è½½æµç¨‹0.å‡†å¤‡å®‰è£…åŒ…ä¸Šä¼ åˆ°/usr/local/FastDFS_v5.05.tar.gzï¼ˆFastDFSå®‰è£…åŒ…ï¼‰libfastcommonV1.0.7.tar.gzï¼ˆFastDFSä¾èµ–ç¨‹åºï¼‰nginx-1.8.0.tar.gzï¼ˆnginxå®‰è£…åŒ…ï¼Œç”¨äºåšæ–‡ä»¶è¯·æ±‚httpä»£ç†æœåŠ¡å™¨ï¼‰fastdfs-nginx-module_v1.16.tar.gzï¼ˆnginxå’Œfastdfsçš„æ¡¥æ¢æ’ä»¶æ¨¡å—ï¼‰1.å®‰è£…c/c++ç¼–è¯‘ç¯å¢ƒyuminstallgcc-c++2.å®‰è£…libeventyum-yinstalllibevent3.å®‰è£…libfastcommonå°†libfastcommonV1.0.7.tar.gzæ‹·è´è‡³/usr/local/ä¸‹cd/usr/localtar-zxvflibfastcommonV1.0.7.tar.gzcdlibfastcommon-1.0.7./make.sh./make.shinstallcp/usr/lib64/libfastcommon.so/usr/lib4.åˆ›å»ºæ•°æ®å­˜å‚¨ç›®å½•mkdir-p/home/FastDFS/tracker/home/FastDFS/storage/home/FastDFS/client5.trackerç¼–è¯‘å®‰è£…å°†FastDFS_v5.05.tar.gzæ‹·è´è‡³/usr/local/ä¸‹tar-zxvfFastDFS_v5.05.tar.gzcdFastDFS./make.sh./make.shinstallcdconfcp*/etc/fdfs6.ç¼–è¾‘/etc/fdfs/tracker.confvi/etc/fdfs/tracker.confbase_path=/home/FastDFS/tracker7.å¯åŠ¨tracker/usr/bin/fdfs_trackerd/etc/fdfs/tracker.conf[restart](é‡å¯)8.é…ç½®storageèŠ‚ç‚¹vi/etc/fdfs/storage.confbase_path=/home/FastDFS/storagestore_path0=/home/FastDFS/storagetracker_server=192.168.100.151:221229.å¯åŠ¨storageèŠ‚ç‚¹/usr/bin/fdfs_storage{fdfs_storaged}/etc/fdfs/storage.conffdfs_storageä¸å­˜åœ¨å°±ä½¿ç”¨fdfs_storaged10.å®‰è£…nginxyuminstall-ygcc-c++(å·²å®‰è£…)yuminstall-ypcrepcre-develyuminstall-yzlibzlib-develyuminstall-yopensslopenssl-devel11.è§£å‹fastdfs-nginx-module_v1.16.tar.gzcd/usr/local/tar-zxffastdfs-nginx-module_v1.16.tar.gz12.ä¿®æ”¹fastdfs-nginx-module/src/configé…ç½®æ–‡ä»¶vifastdfs-nginx-module/src/configæŠŠCORE_INCS=&quot;$CORE_INCS/usr/local/include/fastdfs/usr/include/fastcommon/&quot;ä¿®æ”¹ä¸ºï¼šCORE_INCS=&quot;$CORE_INCS/usr/include/fastdfs/usr/include/fastcommon/&quot;æŠŠCORE_LIBS=&quot;$CORE_LIBS-L/usr/local/lib-lfastcommon-lfdfsclient&quot;ä¿®æ”¹ä¸ºï¼šCORE_LIBS=&quot;$CORE_LIBS-L/usr/lib-lfastcommon-lfdfsclient&quot;å®é™…å°±æ˜¯æŠŠè·¯å¾„ä¸­çš„localè¿™ä¸€å±‚åˆ é™¤æ‰13.å¤åˆ¶fastdfs-nginx-module/src/mod_fastdfs.confåˆ°/etc/fdfsç›®å½•ä¸‹å¹¶ç¼–è¾‘cpfastdfs-nginx-module/src/mod_fastdfs.conf/etc/fdfs/vi/etc/fdfs/mod_fastdfs.conftracker_server=192.168.100.151:22122url_have_group_name=truestorage_server_port=23000group_name=group1store_path0=/home/FastDFS/storage14.å®‰è£…nginxcd/usr/local/tar-zxfnginx-1.8.1.tar.gzcdnginx-1.8.1./configure--add-module=/usr/local/fastdfs-nginx-module/src/makemakeinstall15.é…ç½®nginxcd/usr/local/nginx/confvinginx.confserver{listen80;server_namelocalhost;location/group1/M00/{ngx_fastdfs_module;}}é‡å¯nginx/usr/local/nginx/sbin/nginxæµ‹è¯•å¼•å…¥ä¾èµ–&lt;!--æ–‡ä»¶ä¸Šä¼ ç»„ä»¶--&gt;&lt;dependency&gt;&lt;groupId&gt;commons-fileupload&lt;/groupId&gt;&lt;artifactId&gt;commons-fileupload&lt;/artifactId&gt;&lt;version&gt;1.3.1&lt;/version&gt;&lt;/dependency&gt;&lt;!--fastdfs--&gt;&lt;dependency&gt;&lt;groupId&gt;org.csource.fastdfs&lt;/groupId&gt;&lt;artifactId&gt;fastdfs&lt;/artifactId&gt;&lt;version&gt;1.2&lt;/version&gt;&lt;/dependency&gt;ç¼–å†™é…ç½®æ–‡ä»¶&lt;!--é…ç½®å¤šåª’ä½“è§£æå™¨--&gt;&lt;beanid=&quot;multipartResolver&quot;class=&quot;org.springframework.web.multipart.commons.CommonsMultipartResolver&quot;&gt;&lt;propertyname=&quot;defaultEncoding&quot;value=&quot;UTF-8&quot;/&gt;&lt;!--è®¾å®šæ–‡ä»¶ä¸Šä¼ çš„æœ€å¤§å€¼5MBï¼Œ5*1024*1024--&gt;&lt;propertyname=&quot;maxUploadSize&quot;value=&quot;5242880&quot;/&gt;&lt;/bean&gt;UploadController/***æ–‡ä»¶æœåŠ¡å™¨åœ°å€*/@Value(&quot;${FILE_SERVER_URL}&quot;)privateStringFILE_SERVER_URL;@RequestMapping(&quot;/upload&quot;)publicJdResultupload(MultipartFilefile){//1ã€å–æ–‡ä»¶çš„æ‰©å±•åStringoriginalFilename=file.getOriginalFilename();StringextName=originalFilename.substring(originalFilename.lastIndexOf(&quot;.&quot;)+1);try{//2ã€åˆ›å»ºä¸€ä¸ªFastDFSçš„å®¢æˆ·ç«¯FastDFSClientdfsClient=newFastDFSClient(&quot;classpath:conf/fdfs_client.conf&quot;);//3ã€æ‰§è¡Œä¸Šä¼ å¤„ç†Stringpath=dfsClient.uploadFile(file.getBytes(),extName);//4ã€æ‹¼æ¥è¿”å›çš„urlå’Œipåœ°å€ï¼Œæ‹¼è£…æˆå®Œæ•´çš„urlStringurl=FILE_SERVER_URL+path;returnJdResult.ok(url);}catch(Exceptione){e.printStackTrace();returnJdResult.error(&quot;æ–‡ä»¶ä¸Šä¼ å¤±è´¥&quot;);}}","link":"https://haohanya.github.io/post/FastDFS/"},{"title":"freemarker","content":"1ã€freemarkerå…¥é—¨1.ä¾èµ–æ ¸å¿ƒåŒ…&lt;!--ä¾èµ–freemarker--&gt;&lt;dependency&gt;&lt;groupId&gt;org.freemarker&lt;/groupId&gt;&lt;artifactId&gt;freemarker&lt;/artifactId&gt;&lt;version&gt;2.3.23&lt;/version&gt;&lt;/dependency&gt;2.åˆ›å»ºæ¨¡æ¿æ–‡ä»¶&lt;!DOCTYPEhtml&gt;&lt;html&gt;&lt;head&gt;&lt;metacharset=&quot;UTF-8&quot;&gt;&lt;title&gt;è¿™ä¸ªæ˜¯æ¨¡æ¿&lt;/title&gt;&lt;/head&gt;&lt;body&gt;&lt;#--è¿™æ˜¯æˆ‘çš„æ³¨é‡Šï¼Œä¸ä¼šè¢«è¾“å‡º--&gt;hello${name}&lt;/body&gt;&lt;/html&gt;3.ç”Ÿæˆæ–‡ä»¶ç¬¬ä¸€æ­¥ï¼šåˆ›å»ºConfigurationå¯¹è±¡ï¼ˆç›´æ¥newï¼Œåœ¨æ„é€ æ–¹æ³•ä¸­æ·»åŠ freemarkerçš„ç‰ˆæœ¬å·ï¼‰ç¬¬äºŒæ­¥ï¼šè®¾ç½®æ¨¡æ¿æ‰€åœ¨çš„è·¯å¾„ç¬¬ä¸‰æ­¥ï¼šè®¾ç½®æ¨¡æ¿æ–‡ä»¶çš„ç¼–ç å­—ç¬¦é›†ï¼ˆä¸€èˆ¬ä½¿ç”¨utf-8ï¼‰ç¬¬å››æ­¥ï¼šåŠ è½½ä¸€ä¸ªæ¨¡æ¿ï¼Œåˆ›å»ºä¸€ä¸ªæ¨¡æ¿å¯¹è±¡ç¬¬äº”æ­¥ï¼šåˆ›å»ºæ•°æ®æ¨¡å‹ï¼ˆä½¿ç”¨çš„æ˜¯Map&lt;String,Object&gt;è¿˜å¯ä»¥ä½¿ç”¨è‡ªå®šä¹‰çš„pojoå®é™…å¼€å‘ä¸­éƒ½ç”¨mapï¼‰ç¬¬å…­æ­¥ï¼šåˆ›å»ºwriterå¯¹è±¡ï¼Œä¸€èˆ¬ç”¨FileWriterå¯¹è±¡è¿›è¡Œå®ä¾‹åŒ–ï¼Œæ‰§è¡Œç”Ÿæˆçš„æ–‡ä»¶ç¬¬ä¸ƒæ­¥ï¼šè°ƒç”¨æ¨¡æ¿å¯¹è±¡çš„processæ–¹æ³•è¾“å‡ºæ–‡ä»¶ç¬¬å…«æ­¥ï¼šå…³é—­æµpublicstaticvoidmain(String[]args)throwsException{//1.åˆ›å»ºé…ç½®ç±»Configurationconfiguration=newConfiguration(Configuration.getVersion());//2.è®¾ç½®æ¨¡æ¿æ‰€åœ¨ç›®å½•configuration.setDirectoryForTemplateLoading(newFile(&quot;F:\\\\workspace002\\\\freemarker-demo01\\\\src\\\\main\\\\resources&quot;));//3.è®¾ç½®ç¼–ç é›†configuration.setDefaultEncoding(&quot;UTF-8&quot;);//4.åŠ è½½æ¨¡æ¿Templatetemplate=configuration.getTemplate(&quot;hello.html&quot;);//5.åˆ›å»ºæ•°æ®æ¨¡å‹Map&lt;String,Object&gt;data=newHashMap&lt;String,Object&gt;();data.put(&quot;name&quot;,&quot;å¼ ä¸‰&quot;);//6.åˆ›å»ºwriterå¯¹è±¡ï¼Œå‡†å¤‡ç”¨æ¥è¾“å‡ºæ–‡ä»¶Writerout=newFileWriter(newFile(&quot;E:\\\\freemarker\\\\hello.html&quot;));//7,è¾“å‡ºæ–‡ä»¶template.process(data,out);//8.å…³é—­æµout.close();}FTLæŒ‡ä»¤1.assignä½œç”¨ï¼šç”¨äºåœ¨é¡µé¢ä¸Šå®šä¹‰ä¸€ä¸ªå˜é‡&lt;#--assignï¼šç”¨æ¥åœ¨é¡µé¢ä¸Šå®šä¹‰ä¸€ä¸ªå˜é‡--&gt;&lt;#assignname=&quot;å¼ ä¸‰&quot;&gt;è·å–å˜é‡ï¼š${name}&lt;hr/&gt;&lt;#--assign:è¿˜å¯ä»¥ç”¨æ¥å®šä¹‰ä¸€ä¸ªå¯¹è±¡--&gt;&lt;#assigninfo={&quot;name&quot;:&quot;æå››&quot;,&quot;age&quot;:18,&quot;hobs&quot;:&quot;java&quot;}&gt;è·å–åˆ°å¯¹è±¡çš„å±æ€§:å§“å-${info.name},å¹´é¾„-${info.age},çˆ±å¥½-${info.hobs}2.includeä½œç”¨ï¼šæ­¤æŒ‡ä»¤ç”¨äºæ¨¡æ¿æ–‡ä»¶ä¹‹é—´çš„ç›¸äº’åµŒå¥—&lt;#include&quot;head.ftl&quot;&gt;3.ifä½œç”¨ï¼šç”¨äºæ¡ä»¶åˆ¤æ–­data.put(&quot;success&quot;,true);&lt;#ifsuccess=true&gt;successçš„å€¼æ˜¯true&lt;#else&gt;successçš„å€¼æ˜¯false&lt;/#if&gt;4.listä½œç”¨ï¼šåœ¨é¡µé¢ä¸­éå†é›†åˆ&lt;ul&gt;&lt;#listmylistasuser&gt;&lt;li&gt;${user.name}&lt;/li&gt;&lt;/#list&gt;&lt;/ul&gt;5.å†…å»ºå‡½æ•°è¯­æ³•ï¼šå˜é‡+?+å‡½æ•°å5-1è·å–é›†åˆçš„å¤§å°(size)${mylist?size}5-2è½¬æ¢jsonå­—ç¬¦ä¸²ä¸ºjsonå¯¹è±¡&lt;#--å®šä¹‰ä¸€ä¸ªjsonå­—ç¬¦ä¸²--&gt;&lt;#assigntext=&quot;{'name':'å¼ ä¸‰','sex':'ç”·'}&quot;&gt;&lt;#--å°†jsonå­—ç¬¦ä¸²è½¬æ¢æˆjsonå¯¹è±¡--&gt;&lt;#assignperson=text?eval&gt;å§“åï¼š${person.name}ï¼Œæ€§åˆ«:${person.sex}5-3æ—¥æœŸå¹´æœˆæ—¥ï¼š${mydate?date}&lt;br/&gt;æ—¶åˆ†ç§’ï¼š${mydate?time}&lt;br/&gt;å¹´æœˆæ—¥æ—¶åˆ†ç§’ï¼š${mydate?datetime}&lt;br/&gt;è‡ªå®šä¹‰æ—¥æœŸï¼š${mydate?string('yyyyå¹´MMæœˆddæ—¥hhæ—¶mmåˆ†ssç§’')}5-4æ•°å­—è½¬æ¢æˆå­—ç¬¦ä¸²${mynum?c}6.ç©ºå€¼å¤„ç†6-1å¤„ç†æ–¹æ¡ˆä¸€(ç¼ºå€¼è¡¨è¾¾å¼)${mytest!&quot;å€¼ä¸ºnull&quot;}&lt;/br&gt;${mytest!}6-2å¤„ç†æ–¹æ¡ˆäºŒ&lt;#ifmytest??&gt;mytestå€¼æ˜¯å­˜åœ¨çš„:${mytest}&lt;#else&gt;mytestçš„å€¼ä¸ºnull&lt;/#if&gt;7.è¿ç®—ç¬¦7-1ç®—æœ¯è¿ç®—ç¬¦+-*/%7-2é€»è¾‘è¿ç®—ç¬¦&amp;&amp;ã€||ã€!7-3æ¯”è¾ƒè¿ç®—ç¬¦=æˆ–è€…==!=&gt;æˆ–è€…æ˜¯gt&lt;æˆ–è€…æ˜¯lt&gt;=æˆ–è€…æ˜¯gte&lt;=æˆ–è€…æ˜¯lte","link":"https://haohanya.github.io/post/freemarker/"}]}