<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8" />

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<meta name="keywords" content="浩瀚,浩瀚博客,java">
<meta name="description" content="浩瀚-每天向往着外面的世界">
<meta name="theme-color" content="#000">
<title>浩瀚</title>
<link rel="shortcut icon" href="/favicon.ico?v=1591806266046">
<link rel="stylesheet" href="/styles/main.css">
<link rel="stylesheet" href="/media/css/gemini.css">

<link rel="stylesheet" href="/media/fonts/font-awesome.css">
<link
  href="//fonts.googleapis.com/css?family=Monda:300,300italic,400,400italic,700,700italic|Roboto Slab:300,300italic,400,400italic,700,700italic|Rosario:300,300italic,400,400italic,700,700italic|PT Mono:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext"
  rel="stylesheet" type="text/css">

<link href="/media/hljs/styles/androidstudio.css"
  rel="stylesheet">

<script src="/media/hljs/highlight.js"></script>
<script src="https://cdn.jsdelivr.net/npm/velocity-animate@1.5.0/velocity.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/velocity-animate@1.5.0/velocity.ui.min.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.css"
  integrity="sha384-zB1R0rpPzHqg7Kpt0Aljp8JPLqbXI3bhnPWROx27a9N0Ll6ZP/+DiW/UqRcLbRjq" crossorigin="anonymous">


<script defer src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.js"
  integrity="sha384-y23I5Q6l+B6vatafAwxRu/0oK/79VlbSz7Q9aiSZUvyWYIYsd+qj+o24G5ZU2zJz" crossorigin="anonymous"></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/contrib/auto-render.min.js"
  integrity="sha384-kWPLUVMOks5AQFrykwIup5lo0m3iMkkHrD0uJ4H5cjeGihAutqP0yW0J6dpFiVkI" crossorigin="anonymous"
  onload="renderMathInElement(document.body);"></script>




</head>

<body>
  <div class="head-top-line"></div>
  <div class="header-box">
    
<div class="gemini">
  <header class="header  ">
    <div class="blog-header box-shadow-wrapper bg-color " id="header">
      <div class="nav-toggle" id="nav_toggle">
        <div class="toggle-box">
          <div class="line line-top"></div>
          <div class="line line-center"></div>
          <div class="line line-bottom"></div>
        </div>
      </div>
      <div class="site-meta">       
        <div class="site-title">
          
            <a href="/" class="brand">
              <span>浩瀚</span>
            </a>  
          
        </div>
        
          <p class="subtitle">热爱生活</p>
        
      </div>
      <nav class="site-nav" id="site_nav">
        <ul id="nav_ul">
          
            
            
              
            
            <li class="nav-item ">
              
              
                <a href="/" target="_self">
                  <i class="fa fa-home"></i> 首页
                </a>
              
            </li>
          
            
            
              
            
            <li class="nav-item ">
              
              
                <a href="/archives/" target="_self">
                  <i class="fa fa-archive"></i> 归档
                </a>
              
            </li>
          
            
            
              
            
            <li class="nav-item ">
              
              
                <a href="/tags/" target="_self">
                  <i class="fa fa-tags"></i> 标签
                </a>
              
            </li>
          
            
            
              
            
            <li class="nav-item ">
              
              
                <a href="/post/about/" target="_self">
                  <i class="fa fa-user"></i> 关于
                </a>
              
            </li>
          
          
            
              <li class="nav-item ">
                <a href="/friends/" target="_self">
                  
                    <i class="fa fa-address-book"></i> 友情链接
                  
                </a>
              </li>
            
          
        </ul>
      </nav>
    </div>
  </header>
</div>

<script type="text/javascript"> 
 
  let showNav = true;

  let navToggle = document.querySelector('#nav_toggle'),
  siteNav = document.querySelector('#site_nav');
  
  function navClick() {
    let sideBar = document.querySelector('.sidebar');
    let navUl = document.querySelector('#nav_ul');
    navToggle.classList.toggle('nav-toggle-active');
    siteNav.classList.toggle('nav-menu-active');
    if (siteNav.classList.contains('nav-menu-active')) {
      siteNav.style = "height: " + (navUl.children.length * 42) +"px !important";
    } else {
      siteNav.style = "";
    }
  }

  navToggle.addEventListener('click',navClick);  
</script>
  </div>
  <div class="main-continer">
    
    <div
      class="section-layout  gemini">
      <div class="section-layout-wrapper">
        <div id="sidebarMeta" class="sidebar">
    
<div class="sidebar-wrapper box-shadow-wrapper bg-color">
  <div class="sidebar-item">
    <img class="site-author-image right-motion" src="/images/avatar.png"/>
    <p class="site-author-name">浩瀚</p>
    
    <div class="site-description right-motion">
      
        <p id="binft">一位正在努力成长的码农</p>
      
    </div>
    
  </div>
  <div class="sidebar-item side-item-stat right-motion">
    <div class="sidebar-item-box">
      <a href="/archives/">
        
        <span class="site-item-stat-count">17</span>
        <span class="site-item-stat-name">文章</span>
      </a>
    </div>
    <div class="sidebar-item-box">
      <a href="">
        <span class="site-item-stat-count">20</span>
        <span class="site-item-stat-name">分类</span>
      </a>
    </div>
    <div class="sidebar-item-box">
      <a href="/tags/">
        <span class="site-item-stat-count">20</span>
        <span class="site-item-stat-name">标签</span>
      </a>
    </div>
  </div>
  
    
      <div class="sidebar-item">
        <span class="site-item-rss">
            <i class="fa fa-rss"></i>
            <a href="https://haohanya.github.io/atom.xml" target="_blank">RSS</a>
        </span>
      </div>
    
  
  


</div>
</div>
<script>
  let sidebarMeta = document.querySelector('#sidebarMeta');
  let scheme = 'gemini';
  let sidebarWrapper = document.querySelector('.sidebar-wrapper');
  if (sidebarMeta && (scheme === 'pisces' || scheme === 'gemini')) {
    document.addEventListener('scroll', function(e) {
      if (document.scrollingElement.scrollTop > parseInt(sidebarMeta.style.marginTop) + 10) {
        sidebarWrapper.classList.add('home-sidebar-fixed')
      } else {
        sidebarWrapper.classList.remove('home-sidebar-fixed')
      }
    });
  }
  </script>
        <div class="section-box tag-line box-shadow-wrapper">
          <section class="section tags-section posts-expand bg-color">
            <div class="padding-wrapper">
  <div class="tag-timeline-box">
    <div class="tag-timeline-wrapper">
      <div class="tag-timeline-title">
        <h2>
          jpa
          <small>标签</small>
        </h2>
      </div>
      
      
      
      
      
      
      
      
      
      
      
      
      
      <a href="https://haohanya.github.io/post/spring-data-jpa/">
        <div class="motion-warpper">
          <div class="tag-post-node">
            <h1>
              06-10
              <small>Spring-Data-Jpa</small>
            </h1>
          </div>
        </div>
      </a>
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
    </div>
  </div>
</div>
          </section>
        </div>
      </div>
    </div>
    <div class="footer-box">
  <footer class="footer">
    <div class="copyright">
      Powered by <a href="https://github.com/getgridea/gridea" target="_blank">Gridea</a> | © 2019-2020 Theme By <a href="https://github.com/hsxyhao/gridea-theme-next" target="_blank">HsxyHao</a>
    </div>
    <div class="poweredby">
      Powered by <a href="https://github.com/getgridea/gridea" target="_blank">Gridea</a>
    </div>
  </footer>
  
  
  <div class="gemini back-to-top" id="back_to_top">
    <i class="fa fa-arrow-up"></i>
    
    <span class="scrollpercent">
      <span id="back_to_top_text">0</span>%
    </span>
    
  </div>
  
    
    <div class="bg-img">
      <img src="\media\images\custom-bgImg.jpg" />
    </div>
  
  
  
</div>
<script>

  let sideBarOpen = 'sidebar-open';
  let body = document.body;
  let back2Top = document.querySelector('#back_to_top'),
  back2TopText = document.querySelector('#back_to_top_text'),
  drawerBox = document.querySelector('#drawer_box'),
  rightSideBar = document.querySelector('.sidebar'),
  viewport = document.querySelector('body');

  function scrollAnimation(currentY, targetY) {
   
    let needScrollTop = targetY - currentY
    let _currentY = currentY
    setTimeout(() => {
      const dist = Math.ceil(needScrollTop / 10)
      _currentY += dist
      window.scrollTo(_currentY, currentY)
      if (needScrollTop > 10 || needScrollTop < -10) {
        scrollAnimation(_currentY, targetY)
      } else {
        window.scrollTo(_currentY, targetY)
      }
    }, 1)
  }

  back2Top.addEventListener("click", function(e) {
    scrollAnimation(document.scrollingElement.scrollTop, 0);
    e.stopPropagation();
    return false;
  });
  
  window.addEventListener('scroll', function(e) {
    let percent = document.scrollingElement.scrollTop / (document.scrollingElement.scrollHeight - document.scrollingElement.clientHeight) * 100;
    if (percent > 1 && !back2Top.classList.contains('back-top-active')) {
      back2Top.classList.add('back-top-active');
    }
    if (percent == 0) {
      back2Top.classList.remove('back-top-active');
    }
    if (back2TopText) {
      back2TopText.textContent = Math.floor(percent);
    }
  });

  
  let hasCacu = false;
  window.onresize = function() {
    if (window.width > 991) {
      calcuHeight();
    } else {
      hasCacu = false;
    }
  }

  function calcuHeight() {
    // 动态调整站点概览高度
    if (!hasCacu && back2Top.classList.contains('pisces') || back2Top.classList.contains('gemini')) {
      let sideBar = document.querySelector('.sidebar');
      let navUl = document.querySelector('#site_nav');
      sideBar.style = 'margin-top:' + (navUl.offsetHeight + navUl.offsetTop + 15) + 'px;';
      hasCacu = true;
    }
  }
  calcuHeight();
  
  let open = false, MOTION_TIME = 300, RIGHT_MOVE_DIS = '320px';

  if (drawerBox) {
    let rightMotions = document.querySelectorAll('.right-motion');
    let right = drawerBox.classList.contains('right');

    let transitionDir = right ? "transition.slideRightIn" : "transition.slideLeftIn";

    let openProp, closeProp;
    if (right) {
      openProp = {
        paddingRight: RIGHT_MOVE_DIS 
      };
      closeProp = {
        paddingRight: '0px'
      };
    } else {
      openProp = {
        paddingLeft: RIGHT_MOVE_DIS 
      };
      closeProp = {
        paddingLeft: '0px'
      };
    }

    drawerBox.onclick = function() {
      open = !open;
      window.Velocity(rightSideBar, 'stop');
      window.Velocity(viewport, 'stop');
      window.Velocity(rightMotions, 'stop');
      if (open) {
        window.Velocity(rightSideBar, {
          width: RIGHT_MOVE_DIS
        }, {
          duration: MOTION_TIME,
          begin: function() {
            window.Velocity(rightMotions, transitionDir,{ });
          }
        })
        window.Velocity(viewport, openProp,{
          duration: MOTION_TIME
        });
      } else {
        window.Velocity(rightSideBar, {
          width: '0px'
        }, {
          duration: MOTION_TIME,
          begin: function() {
            window.Velocity(rightMotions, {
              opacity: 0
            });
          }
        })
        window.Velocity(viewport, closeProp ,{
          duration: MOTION_TIME
        });
      }
      for (let i = 0; i < drawerBox.children.length; i++) {
        drawerBox.children[i].classList.toggle('muse-line');
      }
      drawerBox.classList.toggle(sideBarOpen);
    }
  }

  // 链接跳转
  let newWindow = 'false'
  if (newWindow === 'true') {
    let links = document.querySelectorAll('.post-body a')
    links.forEach(item => {
      if (!item.classList.contains('btn')) {
        item.setAttribute("target","_blank");
      }
    })
  }
  // 代码高亮
  hljs.initHighlightingOnLoad();

</script>
  </div>
</body>
<input hidden id="copy" />
<script>
  //拿来主义(真香)^_^，Clipboard 实现摘自掘金 https://juejin.im/post/5aefeb6e6fb9a07aa43c20af
  window.Clipboard = (function (window, document, navigator) {
    var textArea,
      copy;

    // 判断是不是ios端
    function isOS() {
      return navigator.userAgent.match(/ipad|iphone/i);
    }
    //创建文本元素
    function createTextArea(text) {
      textArea = document.createElement('textArea');
      textArea.value = text;
      textArea.style.width = 0;
      textArea.style.height = 0;
      textArea.clientHeight = 0;
      textArea.clientWidth = 0;
      document.body.appendChild(textArea);
    }
    //选择内容
    function selectText() {
      var range,
        selection;

      if (isOS()) {
        range = document.createRange();
        range.selectNodeContents(textArea);
        selection = window.getSelection();
        selection.removeAllRanges();
        selection.addRange(range);
        textArea.setSelectionRange(0, 999999);
      } else {
        textArea.select();
      }
    }

    //复制到剪贴板
    function copyToClipboard() {
      try {
        document.execCommand("Copy")
      } catch (err) {
        alert("复制错误！请手动复制！")
      }
      document.body.removeChild(textArea);
    }

    copy = function (text) {
      createTextArea(text);
      selectText();
      copyToClipboard();
    };

    return {
      copy: copy
    };
  })(window, document, navigator);

  function copyCode(e) {
    if (e.srcElement.tagName === 'SPAN' && e.srcElement.classList.contains('copy-code')) {
      let code = e.currentTarget.querySelector('code');
      var text = code.innerText;
      if (e.srcElement.textContent === '复制成功') {
        console.log('复制操作频率过高');
        return;
      }
      e.srcElement.textContent = '复制成功';
      (function (elem) {
        setTimeout(() => {
          if (elem.textContent === '复制成功') {
            elem.textContent = '复制代码'
          }
        }, 1000);
      })(e.srcElement)
      Clipboard.copy(text);
    }
  }

  let pres = document.querySelectorAll('pre');
  pres.forEach(pre => {
    let code = pre.querySelector('code');
    let copyElem = document.createElement('span');
    copyElem.classList.add('copy-code');
    copyElem.textContent = '复制代码';
    pre.appendChild(copyElem);
    pre.onclick = copyCode
  })
</script>
<script src="/media/js/motion.js"></script>

<script src="https://cdn.jsdelivr.net/gh/cferdinandi/smooth-scroll/dist/smooth-scroll.polyfills.min.js"></script>
<script>
  var scroll = new SmoothScroll('a[href*="#"]', {
    speed: 500
  });
</script>

<!-- <div class="search-mask" id="search_mask">
  <div class="search-box">
    <div class="search-title">
      <i class="fa fa-search"></i>
      <div class="input-box">
        <input type="text" placeholder="搜索">
      </div>
      <i class="fa fa-times-circle"></i>
    </div>
    <div class="result">
      
      <div class="item">
        <a class="result-title" href="https://haohanya.github.io/post/eureka/"" data-c="
          &lt;h2 id=&#34;什么是eureka&#34;&gt;什么是Eureka&lt;/h2&gt;
&lt;blockquote&gt;
&lt;p&gt;百度百科：&lt;a href=&#34;https://baike.baidu.com/item/Eureka/22402835?fr=aladdin&#34;&gt;什么是Eureka&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&#34;问题分析&#34;&gt;问题分析&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;刚才的案例，user-service对外提供服务，需要对外暴漏自己的地址。user-web需要记录服务提供者的地址。将来地址出现变更，还需要及时的去更新。这在服务较少的时候不会觉得有什么，但是在大型的互联网项目中，一个项目可能差分处几十个微服务，此时如果还是人为的管理，不仅开发困难，奖励啊测试、发布上线都会有大麻烦&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;code&gt;与DevOps思想违背：就是系统可以通过一组过程、方法或者是系统，提高应用发布和运维的效率，降低管理成本&lt;/code&gt;&lt;/p&gt;
&lt;h3 id=&#34;eureka做什么&#34;&gt;Eureka做什么&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;好比是房产中介，负责管理、记录服务提供者的信息。服务调用者就无需自己去找服务，而是把自己的需求告诉Eureka，然后Eureka把符合你要求的服务告诉你&lt;/p&gt;
&lt;p&gt;同时，服务的提供方与Eureka之间通过“心跳”机制进行监控，当某个服务提供方出现问题，Eureka自然会把它从服务列表中剔除&lt;/p&gt;
&lt;p&gt;&lt;code&gt;这就实现了服务的自动注册、发现和状态监控&lt;/code&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&#34;eureka注册中心说明&#34;&gt;Eureka注册中心说明&lt;/h2&gt;
&lt;blockquote&gt;
&lt;p&gt;Eureka的主要功能是进行服务管理，定期检查服务状态，返回服务地址列表。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;figure data-type=&#34;image&#34; tabindex=&#34;1&#34;&gt;&lt;img src=&#34;https://haohanya.github.io/post-images/1591806137091.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
&lt;h2 id=&#34;入门案例&#34;&gt;入门案例&lt;/h2&gt;
&lt;p&gt;1、创建springboot项目并添加依赖&lt;/p&gt;
&lt;figure data-type=&#34;image&#34; tabindex=&#34;2&#34;&gt;&lt;img src=&#34;https://haohanya.github.io/post-images/1591806146598.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
&lt;p&gt;2、在启动类中添加注解&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;@SpringBootApplication
@EnableEurekaServer     //声明当前应用是eureka服务
public class EurekaServiceApplication {
    public static void main(String[] args) {
        SpringApplication.run(EurekaServiceApplication.class, args);
    }
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;3、配置eureka&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-yml&#34;&gt;#端口号
server:
  port: 10086
spring:
  application:
    name: eureka-server   #应用名称，会在eureka中作为服务的id标识

#配置eurkea
eureka:
  client:
    service-url:
      defaultZone: http://127.0.0.1:10086/eureka
    register-with-eureka: false       #不注册自己，默认值是true（如果搭建eureka集群，需要相互之间注册）
    fetch-registry: false   #不拉取自己的服务列表

&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;4、启动服务&lt;/p&gt;
&lt;p&gt;访问：http://localhost:10086/&lt;/p&gt;
&lt;figure data-type=&#34;image&#34; tabindex=&#34;3&#34;&gt;&lt;img src=&#34;Eureka%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83.assets/15.png&#34; alt=&#34;15&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
&lt;h2 id=&#34;服务注册&#34;&gt;服务注册&lt;/h2&gt;
&lt;blockquote&gt;
&lt;p&gt;注册服务，就是在服务上添加Eureka的客户端依赖，客户端代码会自动把服务注册到EurekaService中&lt;/p&gt;
&lt;/blockquote&gt;
&lt;figure data-type=&#34;image&#34; tabindex=&#34;4&#34;&gt;&lt;img src=&#34;https://haohanya.github.io/post-images/1591806162495.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
&lt;p&gt;添加依赖&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-xml&#34;&gt;&amp;lt;!-- 添加mapper的启动器 --&amp;gt;
&amp;lt;dependency&amp;gt;
    &amp;lt;groupId&amp;gt;tk.mybatis&amp;lt;/groupId&amp;gt;
    &amp;lt;artifactId&amp;gt;mapper-spring-boot-starter&amp;lt;/artifactId&amp;gt;
    &amp;lt;version&amp;gt;2.0.3&amp;lt;/version&amp;gt;
&amp;lt;/dependency&amp;gt;
&amp;lt;!-- lombok --&amp;gt;
&amp;lt;dependency&amp;gt;
    &amp;lt;groupId&amp;gt;org.projectlombok&amp;lt;/groupId&amp;gt;
    &amp;lt;artifactId&amp;gt;lombok&amp;lt;/artifactId&amp;gt;
&amp;lt;/dependency&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;1、修改启动类&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;@SpringBootApplication
@MapperScan(basePackages = &amp;quot;com.kgc.mapper&amp;quot;)  //扫描mapper包，如果使用的是tb.mybatis
@EnableEurekaClient     //开启Eureka客户端发现功能
public class UserServiceApplication {

    public static void main(String[] args) {
        SpringApplication.run(UserServiceApplication.class, args);
    }

}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;2、修改配置文件&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-yml&#34;&gt;#端口号
server:
  port: 9091
#数据源
spring:
  datasource:
    driver-class-name: com.mysql.jdbc.Driver
    url: jdbc:mysql://localhost:3306/springcloud?useUnicode=true&amp;amp;characterEncoding=utf-8&amp;amp;serverTimezone=Asia/Shanghai
    username: root
    password: root
  application:
    name: user-service   #应用名
#添加Eureka注册的配置
eureka:
  client:
    service-url:
      defaultZone: http://127.0.0.1:10086/eureka
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;3、测试&lt;/p&gt;
&lt;p&gt;启动user-service工程&lt;/p&gt;
&lt;figure data-type=&#34;image&#34; tabindex=&#34;5&#34;&gt;&lt;img src=&#34;Eureka%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83.assets/17.png&#34; alt=&#34;17&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
&lt;h2 id=&#34;服务发现&#34;&gt;服务发现&lt;/h2&gt;
&lt;figure data-type=&#34;image&#34; tabindex=&#34;6&#34;&gt;&lt;img src=&#34;https://haohanya.github.io/post-images/1591806178141.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
&lt;p&gt;1、修改启动类&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;@SpringBootApplication
@EnableDiscoveryClient     //开启Eureak客户端
public class UserWebApplication {
    @Bean
    public RestTemplate restTemplate(){
        return new RestTemplate();
    }

    public static void main(String[] args) {
        SpringApplication.run(UserWebApplication.class, args);
    }

}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;2、修改配置文件&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-yml&#34;&gt;server:
  port: 8080
spring:
  application:
    name: user-web     #应用名称
eureka:
  client:
    service-url:
      defaultZone: http://127.0.0.1:10086/eureka    #eurekaSerer地址
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;3、修改处理器&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;package com.cn.controller;

import com.cn.pojo.User;
import com.netflix.appinfo.InstanceInfo;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.cloud.client.ServiceInstance;
import org.springframework.cloud.client.discovery.DiscoveryClient;
import org.springframework.web.bind.annotation.PathVariable;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;
import org.springframework.web.client.RestTemplate;

import java.util.List;

@RestController
@RequestMapping(&amp;quot;/consumer&amp;quot;)
public class ConsumerController {
    @Autowired
    private RestTemplate restTemplate;
    //DiscoveryClient的用springCloud包中的
    @Autowired(required = false)
    private DiscoveryClient discoveryClient;

    @RequestMapping(&amp;quot;/{id}&amp;quot;)
    public User getByid(@PathVariable(&amp;quot;id&amp;quot;) Long id){
        /*
        //通过http的方式实现系统之间的通讯
        String url = &amp;quot;http://localhost:9091/user/&amp;quot; + id;//这个是user-service提供的rest api风格的接口
        User user = restTemplate.getForObject(url, User.class);
        return user;
         */
        //从eurekaServer注册中心去获取user-service的实例列表
        List&amp;lt;ServiceInstance&amp;gt; instancesList = discoveryClient.getInstances(&amp;quot;user-service&amp;quot;);
        //因为我就一个服务，所以我就拿集合中的第一个就成
        ServiceInstance serviceInstance = instancesList.get(0);
        //服务的resutApi接口
        String url = &amp;quot;http://&amp;quot; + serviceInstance.getHost() + &amp;quot;:&amp;quot; + serviceInstance.getPort() + &amp;quot;/user/&amp;quot; + id;
        return restTemplate.getForObject(url,User.class);
    }
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;4、测试&lt;/p&gt;
&lt;figure data-type=&#34;image&#34; tabindex=&#34;7&#34;&gt;&lt;img src=&#34;https://haohanya.github.io/post-images/1591806191931.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
&lt;h2 id=&#34;eureak总结&#34;&gt;Eureak总结&lt;/h2&gt;
&lt;p&gt;三个角色&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;服务注册中心
&lt;ul&gt;
&lt;li&gt;Eureka的服务端应用，提供服务注册和发现功能，就是我们建立的eureka-server&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;服务提供者
&lt;ul&gt;
&lt;li&gt;提供服务的应用，可以是springBoot应用，也可以是其他任意技术实现，只要对外提供的是Rest风格服务就可。就是我们建立的user-service&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;服务消费者
&lt;ul&gt;
&lt;li&gt;消费者应用就是从注册中心获取服务列表，从而得知每个服务放的信息，知道去哪里调用服务，就是我们建立的user-web&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;高可用的eureka-server&#34;&gt;高可用的Eureka Server&lt;/h2&gt;
&lt;p&gt;我们只有一个Eureak，事实上可以搭建一个集群，形成一个高可用的Eureka注册中心&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;服务同步&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;多个EurekaServer之间会相互注册为服务，当服务提供者注册到EurekaServer结群中的某个节点的时候，该节点会把服务的信息同步到集群中的每个节点，从而实现数据的同步，一旦有一个节点挂掉了，那么其他的节点依然能提供服务注册和发现的功能&lt;/p&gt;
&lt;h3 id=&#34;1-修改eurekaserver配置&#34;&gt;1、修改EurekaServer配置&lt;/h3&gt;
&lt;pre&gt;&lt;code class=&#34;language-yml&#34;&gt;#端口号
server:
  port: ${port:10086}
spring:
  application:
    name: eureka-server   #应用名称，会在eureka中作为服务的id标识

#配置eurkea
eureka:
  client:
    service-url:
      defaultZone: ${defualtZone:http://127.0.0.1:10086/eureka}
    #register-with-eureka: false       #不注册自己，默认值是true（如果搭建eureka集群，需要相互之间注册）
    #fetch-registry: false   #不拉取自己的服务列表
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;2、修改启动配置文件&lt;/p&gt;
&lt;figure data-type=&#34;image&#34; tabindex=&#34;8&#34;&gt;&lt;img src=&#34;https://haohanya.github.io/post-images/1591806205847.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
&lt;p&gt;3、复制一份并修改VM options&lt;/p&gt;
&lt;figure data-type=&#34;image&#34; tabindex=&#34;9&#34;&gt;&lt;img src=&#34;https://haohanya.github.io/post-images/1591806216118.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
&lt;p&gt;4、启动eureka集群&lt;/p&gt;
&lt;figure data-type=&#34;image&#34; tabindex=&#34;10&#34;&gt;&lt;img src=&#34;https://haohanya.github.io/post-images/1591806227522.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
&lt;h2 id=&#34;服务注册eureka集群&#34;&gt;服务注册Eureka集群&lt;/h2&gt;
&lt;p&gt;因为Eureka不止一个，修改user-service关于注册中心的配置&lt;/p&gt;
&lt;p&gt;服务提供者在启动的时候，会检测配置属性中&lt;code&gt;eureka.client.register-with-eureka=true&lt;/code&gt;参数是否正确，事实上默认是true，所以我们没有配置，如果值确实是true，则会向EurekaServer发起一个Rest请求，并且携带自己的元数据信息，EurekaServer会把这些信息保存到一个双层的Map结构中&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;第一层Map的key就是服务的id，一般就是配置&lt;code&gt;spring.applicaton.name&lt;/code&gt;属性&lt;/li&gt;
&lt;li&gt;第二层Map的key就是服务的实例id，一般host + serviceId + port，例如：localhost:user-service:9091&lt;/li&gt;
&lt;li&gt;值则是服务的实例对象，也就是说一个服务，可以同时启动多个不同的实例，形成集群&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;默认注册的时候是主机名或者是localhost，如果想用ip进行注册，可以在&lt;code&gt;user-server&lt;/code&gt; 中添加配置&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-yml&#34;&gt;#端口号
server:
  port: 9091
#数据源
spring:
  datasource:
    driver-class-name: com.mysql.jdbc.Driver
    url: jdbc:mysql://localhost:3306/springcloud?useUnicode=true&amp;amp;characterEncoding=utf-8&amp;amp;serverTimezone=Asia/Shanghai
    username: root
    password: root
  application:
    name: user-service   #应用名
#添加Eureka注册的配置
eureka:
  client:
    service-url:  #EurekaServer地址，多个地址之间用逗号分隔
      defaultZone: http://127.0.0.1:10086/eureka,http://127.0.0.1:10087/eureka
  instance:
    ip-address: 127.0.0.1    #ip地址
    prefer-ip-address: true  #更倾向于使用ip，而不是host名    
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;修改完成后重启&lt;code&gt;user-server&lt;/code&gt;工程和&lt;code&gt;user-web&lt;/code&gt;工程&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;可以测试一下，先关掉10086，然后在测试是否能正常通讯&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&#34;失效的剔除和自我保护&#34;&gt;失效的剔除和自我保护&lt;/h2&gt;
&lt;p&gt;服务续约&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;在注册服务完成以后，服务提供者会持续一个心跳（定时向EurekaServer发起Rest请求），告诉EurekaServer：“我还活着”，这个我们就称之为服务的续约(renew)；&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;向user-server工程配置文件中添加如下配置&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-yml&#34;&gt;#添加Eureka注册的配置
eureka:
  client:
    service-url:  #EurekaServer地址，多个地址之间用逗号分隔
      defaultZone: http://127.0.0.1:10086/eureka,http://127.0.0.1:10087/eureka
  instance:
    ip-address: 127.0.0.1    #ip地址
    prefer-ip-address: true  #更倾向于使用ip，而不是host名
    lease-expiration-duration-in-seconds: 5 #服务续约的时间间隔，默认是30秒，现在我这里设置为5秒
    lease-renewal-interval-in-seconds: 5  #服务失效时间，默认是90秒，我这里设置为5秒
&lt;/code&gt;&lt;/pre&gt;
&lt;blockquote&gt;
&lt;p&gt;也就是说，默认情况下每个30秒服务会向注册中心发送一次心跳，证明自己还活着，如果超过90秒还没有发送心跳，EurekaServer就会认为该服务已经宕机，会定时从服务列表中移除，这两个值在生产环境中不要修改（我这里修改是为了方便测试）&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;服务下线&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;当服务进行正常关闭操作的时候，它会触发一个服务下线的REST请求给EurekaSever，告诉服务注册中心：“我要下线了”。服务中心接收到请求之后，会讲该服务置为下线状态&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;失效剔除&lt;/p&gt;
&lt;p&gt;自我保护&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;我们关停一个服务，很可能会在eureka面板出现一条警告：&lt;/p&gt;
&lt;/blockquote&gt;
&lt;figure data-type=&#34;image&#34; tabindex=&#34;11&#34;&gt;&lt;img src=&#34;https://haohanya.github.io/post-images/1591806244663.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
&lt;blockquote&gt;
&lt;p&gt;这个就是eureka的自我保护机制。当服务未按时进行心跳续约，Eureka会统计服务实例最近15分钟心跳续约的比例是否低于85%，在生产环境下，因为网络延迟等原因，心跳失败实例的比例很有可能会超标，但是此时就把服务剔除列表并不妥当，因为服务并没有宕机。Erueka在这段时间内不会剔除任何服务实例，直到网络恢复正常。生产环境下这很有效,因此服务调用者必须做好服务的失败容错&lt;/p&gt;
&lt;p&gt;可以关闭自我保护（生产环境下，千万别干这事！）&lt;/p&gt;
&lt;/blockquote&gt;
&lt;pre&gt;&lt;code class=&#34;language-yml&#34;&gt;#配置eurkea
eureka:
  client:
    service-url:
      defaultZone: ${defualtZone:http://127.0.0.1:10086/eureka}
    #register-with-eureka: false       #不注册自己，默认值是true（如果搭建eureka集群，需要相互之间注册）
    #fetch-registry: false   #不拉取自己的服务列表
  server:
    enable-self-preservation: false  #关闭自我保护模式(缺省为打开)
&lt;/code&gt;&lt;/pre&gt;
">Eureka</a>
      </div>
      
      <div class="item">
        <a class="result-title" href="https://haohanya.github.io/post/chu-shi-springcloud/"" data-c="
          &lt;h2 id=&#34;系统架构的演变&#34;&gt;系统架构的演变&lt;/h2&gt;
&lt;blockquote&gt;
&lt;p&gt;随着互联网的发展，网站的应用规模不断扩大，需求的激增，带来的是技术上的压力。系统架构也因此在不断的演变、升级、迭代。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;figure data-type=&#34;image&#34; tabindex=&#34;1&#34;&gt;&lt;img src=&#34;https://haohanya.github.io/post-images/1591797493895.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
&lt;h3 id=&#34;集中式架构&#34;&gt;集中式架构&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;当网站流量很小的时候，只需要一个应用，将所有的功能都部署到一起，以减少部署节点和成本。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;figure data-type=&#34;image&#34; tabindex=&#34;2&#34;&gt;&lt;img src=&#34;https://haohanya.github.io/post-images/1591797514846.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
&lt;p&gt;优点：系统开发速度快，维护成本低，适合开发并发要求较低的系统&lt;/p&gt;
&lt;p&gt;缺点：单点容错率低，并发能力差&lt;/p&gt;
&lt;h3 id=&#34;垂直应用架构&#34;&gt;垂直应用架构&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;当访问量逐渐增大，单一应用无法满足需求，此时为了应对更高的并发和业务需求，我们根据业务功能对系统进行拆分：&lt;/p&gt;
&lt;/blockquote&gt;
&lt;figure data-type=&#34;image&#34; tabindex=&#34;3&#34;&gt;&lt;img src=&#34;https://haohanya.github.io/post-images/1591797530176.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
&lt;p&gt;优点：&lt;/p&gt;
&lt;p&gt;系统拆分实现了流量分担，解决了并发问题&lt;/p&gt;
&lt;p&gt;可以针对不同的模块进行优化&lt;/p&gt;
&lt;p&gt;方便水平扩展，负载均衡，容错率高&lt;/p&gt;
&lt;p&gt;缺点：系统之间相互独立，开发中会有很多重复代码，影响开发效率&lt;/p&gt;
&lt;h3 id=&#34;分布式服务&#34;&gt;分布式服务&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;当垂直应用越来越多的时候，应用之间交互不可避免，作为独立的服务，逐渐形成稳定的服务中心，是前段应用能更快速的影响多变的市场需求&lt;/p&gt;
&lt;/blockquote&gt;
&lt;figure data-type=&#34;image&#34; tabindex=&#34;4&#34;&gt;&lt;img src=&#34;https://haohanya.github.io/post-images/1591797545349.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
&lt;p&gt;优点：将基础服务进行了抽取，系统之间互相通用，提高了代码的重用性和开发效率&lt;/p&gt;
&lt;p&gt;缺点：系统之间耦合较高，调用关系复杂，难以维护&lt;/p&gt;
&lt;h3 id=&#34;面向服务架构&#34;&gt;面向服务架构&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;SOA(Service Oriented Architecure)面向服务的架构：它是一种设计方法，其中包含了多个服务，服务与服务之间通过互相依赖最终提供一系列的功能。一个服务通常以独立的形式存在与操作系统进行中，各个服务之间通过网络调用。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;figure data-type=&#34;image&#34; tabindex=&#34;5&#34;&gt;&lt;img src=&#34;https://haohanya.github.io/post-images/1591797558773.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
&lt;blockquote&gt;
&lt;p&gt;ESB(企业服务总线)：简单的说ESB就是一根管道，用来连接各个服务节点，为了继承不同系统，不同协议的服务，ESB做了消息的转换解释和路由工作，让不同的服务互联互通&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;SOA缺点&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;每个供应商的ESB产品有偏差，自身实现较为复杂；应用服务粒度较大，ESB继承整合所有的服务和协议，数据转换使得运维、测试和部署比较困难，所有的服务都通过一个通路通讯，直接降低了通信速度&lt;/p&gt;
&lt;p&gt;(dubbo要比这个优化，系统之间通讯采用RPC这种方式，这种方式是直接使用二进制，效率比较高)&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&#34;微服务架构&#34;&gt;微服务架构&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;微服务架构是使用&lt;code&gt;一套小服务开发单个应用的方式或途径&lt;/code&gt;，每个服务基于单一业务能力构建（职能单一），运行在自己的进程中，并使用轻量级机制通信，通常是Http API，并能够通过自动化部署机制来独立部署，这些服务可以使用不同的编程语言，以及不同的数据存储技术，并保持最低的集中式管理&lt;/p&gt;
&lt;p&gt;(dubbo：使用RPC协议通讯，采用的就是二进制通讯，如果要使用dubbo实现系统之间的通讯，必须保证项目是java语言开发的。dubbo是不能实现跨语言平台通讯&lt;/p&gt;
&lt;p&gt;dubbox：后来是当当网对它进行升级，让dubbo在支持RPC的同时，也支持Http API（RestAPI）通讯 )&lt;/p&gt;
&lt;/blockquote&gt;
&lt;figure data-type=&#34;image&#34; tabindex=&#34;6&#34;&gt;&lt;img src=&#34;https://haohanya.github.io/post-images/1591797585782.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
&lt;blockquote&gt;
&lt;p&gt;API Gateway: 网关是一个服务器，是系统的唯一入口，为每个客户端提供了一个定制的API。API网关核心是，所有的客户端和消费端都通过统一的网关介入微服务，在网管层处理所有的非业务功能。如它还可以具有其他职责：身份验证、监控、负载均衡、缓存、请求分片与管理。通常网关提供RESTFUL/http的方式访问服务，而服务端通过服务注册中心进行服务注册和管理&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h4 id=&#34;微服务特点&#34;&gt;微服务特点&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;单一职责：微服务中每个服务都对应唯一的业务能力,做到单一职责&lt;/li&gt;
&lt;li&gt;微：微服务的服务拆分粒度很小，例如一个用户管理就可以作为一个服务，每个服务虽然小，但是“五脏俱全”&lt;/li&gt;
&lt;li&gt;面向服务：每个服务都要对外暴漏Rest风格服务接口API。并不关心服务的技术实现，做到与平台和语言无关，也不限定用什么技术实现，只要提供Rest的接口即可&lt;/li&gt;
&lt;li&gt;自治：服务之间相互独立，互不干扰
&lt;ul&gt;
&lt;li&gt;团队独立：每个服务都可以一个独立的团队开发，人数不能过多&lt;/li&gt;
&lt;li&gt;技术独立：面向的是服务，提供Rest接口，使用什么技术没有人干涉&lt;/li&gt;
&lt;li&gt;前后端分离：采用前后端分离开发，提供统一Rest接口，后端不用再为PC、移动端开发不同的接口&lt;/li&gt;
&lt;li&gt;部署独立：服务之间虽然有调用，但是要做到服务器重启不影响其他的服务器。有利于持续集成和持续交付。每个服务都是独立的组件，可以复用、可以替换、降低了耦合度，易于维护&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;互联网精神：先上线，后迭代&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;微服务架构与SOA都是对系统进行了拆分；微服务架构师基于SOA思想，可以把微服务当作去除了ESB总线的SOA。ESB是SOA架构中的中心总线&lt;/p&gt;
&lt;h2 id=&#34;服务调用方式&#34;&gt;服务调用方式&lt;/h2&gt;
&lt;h3 id=&#34;常见的远程调用方式&#34;&gt;常见的远程调用方式&lt;/h3&gt;
&lt;h4 id=&#34;1-rpc&#34;&gt;1、RPC&lt;/h4&gt;
&lt;blockquote&gt;
&lt;p&gt;Remote Produce Call。基于Socket的通讯（是用最底层的方式来实现通讯，采用二进制的形式，通讯的效率最高的）。工作在会话层。自定义数据格式，速度快，效率高。早期的webservice，现在热门的dubbox，都是RPC的典型代表（只能是java语言编写的服务之间通讯）&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h4 id=&#34;2-http&#34;&gt;2、Http&lt;/h4&gt;
&lt;blockquote&gt;
&lt;p&gt;http其实是一种网络传输协议，基于TCP，工作在应用层，规定了数据传输的格式。现在客户端浏览器与服务器通讯基本上都是采用的http协议，也可以用来进行远程服务调用。缺点是消息封装臃肿，优势是对服务的提供和调用方没有任何技术限定（可以跨语言），自由灵活，更符合微服务的理念&lt;/p&gt;
&lt;/blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;如果你们的公司全部采用的java技术栈，那么使用dubbo作为微服务架构师一个不错的选择。&lt;/p&gt;
&lt;p&gt;相反如果公司的技术栈多样化，而且你更加青睐于Spring家族，那么SpringCloud搭建微服务就是不二选择，在我们的项目中，会所选择SpringCloud套件，因此会使用http方式来实现微服务之间的调用&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&#34;http客户端工具&#34;&gt;Http客户端工具&lt;/h3&gt;
&lt;p&gt;既然微服务选择了http，那么我们就需要考虑自己来实现对请求和响应的处理，不过开源世界已经有很多的http客户端工具，能够帮助我们做这些事情，例如：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;HttpClient&lt;/li&gt;
&lt;li&gt;OkHttp&lt;/li&gt;
&lt;li&gt;URLConnection&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;他们之间的API各不相同，而spring也有对http的客户端工具进行了封装（这三种都有），提供了工具类：RestTemplate&lt;/p&gt;
&lt;h3 id=&#34;spring的resttemplate&#34;&gt;Spring的RestTemplate&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;使用spring提供的一个RestTemplate来实现http的交互&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;创建springboot项目&lt;/p&gt;
&lt;h4 id=&#34;1-创建业务逻辑层user-service&#34;&gt;1、创建业务逻辑层(user-service)&lt;/h4&gt;
&lt;p&gt;依赖&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-xml&#34;&gt;&amp;lt;!-- mapper启动器(准备使用mybatis作为持久层) --&amp;gt;
&amp;lt;dependency&amp;gt;
    &amp;lt;groupId&amp;gt;tk.mybatis&amp;lt;/groupId&amp;gt;
    &amp;lt;artifactId&amp;gt;mapper-spring-boot-starter&amp;lt;/artifactId&amp;gt;
    &amp;lt;version&amp;gt;2.0.3&amp;lt;/version&amp;gt;
&amp;lt;/dependency&amp;gt;
&amp;lt;!-- mysql驱动 --&amp;gt;
&amp;lt;dependency&amp;gt;
    &amp;lt;groupId&amp;gt;mysql&amp;lt;/groupId&amp;gt;
    &amp;lt;artifactId&amp;gt;mysql-connector-java&amp;lt;/artifactId&amp;gt;
&amp;lt;/dependency&amp;gt;
&amp;lt;!-- 为了开发方便，我这里引入lombok --&amp;gt;
&amp;lt;dependency&amp;gt;
    &amp;lt;groupId&amp;gt;org.projectlombok&amp;lt;/groupId&amp;gt;
    &amp;lt;artifactId&amp;gt;lombok&amp;lt;/artifactId&amp;gt;
&amp;lt;/dependency&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;pojo&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;@Data
@Table(name = &amp;quot;tb_user&amp;quot;)
public class User {
    @Id
    @KeySql(useGeneratedKeys = true)
    private Long id;
    private String userName;        /*用户名*/
    private String password;        /*密码*/
    private String name;            /*姓名*/
    private Integer age;            /*年龄*/
    private Integer sex;            /*性别，1男性，2女性*/
    private Date birthday;          /*生日*/
    private String note;            /*备注*/
    private Date created;           /*创建时间*/
    private Date updated;           /*修改时间*/
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;mapper接口&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;import tk.mybatis.mapper.common.Mapper;
public interface UserMapper extends Mapper&amp;lt;User&amp;gt; {
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;在启动类中扫描mapper&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;@SpringBootApplication
@MapperScan(basePackages = &amp;quot;com.cn.mapper&amp;quot;)
public class UserServiceApplication {
   
    public static void main(String[] args) {
        SpringApplication.run(UserServiceApplication.class, args);
    }

}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;service&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;public interface UserService {
    /**
     * 根据主键查询对象
     * @param id     主键
     * @return       对象
     */
    User getUserById(Long id);
}
-------------
@Service
public class UserServiceImpl implements UserService {
    @Autowired(required = false)
    private UserMapper userMapper;

    @Override
    public User getUserById(Long id) {
        return userMapper.selectByPrimaryKey(id);
    }
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;编写控制层提供Rstful接口&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;@RestController
@RequestMapping(&amp;quot;/user&amp;quot;)
public class UserContorller {
    @Autowired
    private UserService userService;

    @RequestMapping(&amp;quot;/{id}&amp;quot;)
    public User getById(@PathVariable(&amp;quot;id&amp;quot;) Long id){
        return userService.getUserById(id);
    }
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;2、创建表现层（user-web）&lt;/p&gt;
&lt;p&gt;pojo：同上&lt;/p&gt;
&lt;p&gt;启动类配置RestTemplate&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;@SpringBootApplication
public class UserWebApplication {
    @Bean
    public RestTemplate restTemplate(){
        return new RestTemplate();
    }
    public static void main(String[] args) {
        SpringApplication.run(UserWebApplication.class, args);
    }
}
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;import com.cn.pojo.User;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.web.bind.annotation.PathVariable;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;
import org.springframework.web.client.RestTemplate;

@RestController
@RequestMapping(&amp;quot;/consumer&amp;quot;)
public class ConsumerController {
    @Autowired
    private RestTemplate restTemplate;
    @RequestMapping(&amp;quot;/{id}&amp;quot;)
    public User getByid(@PathVariable(&amp;quot;id&amp;quot;) Long id){
        //通过http的方式实现系统之间的通讯
        String url = &amp;quot;http://localhost:9091/user/&amp;quot; + id;//这个是user-service提供的rest api风格的接口
        User user = restTemplate.getForObject(url, User.class);
        return user;
    }
}
&lt;/code&gt;&lt;/pre&gt;
&lt;blockquote&gt;
&lt;p&gt;上面的操作我们是使用user-service对外提供了根据主键查询用户的接口，然后在user-web通过RestTemplate调用service的接口&lt;/p&gt;
&lt;p&gt;这样写会存在硬编码的问题，不方便后期维护，并且我们需要记住url的地址，如果发生改变，收不到通知，地址将会失效&lt;/p&gt;
&lt;p&gt;web层并不知道service层的状态，例如服务器宕机&lt;/p&gt;
&lt;p&gt;service层也只有一台，不具备高可用&lt;/p&gt;
&lt;p&gt;即便是service搭建成了集群，web还需要去实现负载均衡&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;其实上面说的问题，概括一下就是分布式服务必然要面临的问题：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;服务管理
&lt;ul&gt;
&lt;li&gt;如何自动注册和发现&lt;/li&gt;
&lt;li&gt;如何实现状态监控&lt;/li&gt;
&lt;li&gt;如何实现动态路由&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;服务如何实现负载均衡&lt;/li&gt;
&lt;li&gt;服务如何解决容灾问题&lt;/li&gt;
&lt;li&gt;服务如何实现统一配置&lt;/li&gt;
&lt;/ul&gt;
">初识SpringCloud</a>
      </div>
      
      <div class="item">
        <a class="result-title" href="https://haohanya.github.io/post/spring-data-jpa/"" data-c="
          &lt;h2 id=&#34;什么是jap&#34;&gt;什么是JAP&lt;/h2&gt;
&lt;blockquote&gt;
&lt;p&gt;JPA是Java Persistence API的简称，中文名Java持久层API，是JDK 5.0注解或XML描述对象－关系表的映射关系，并将运行期的实体对象持久化到数据库中&lt;br&gt;
Sun引入新的JPA ORM规范出于两个原因：其一，简化现有Java EE和Java SE应用开发工作；其二，Sun希望整合ORM技术，实现天下归一。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&#34;mybatis和hibernate的区别&#34;&gt;mybatis和hibernate的区别&lt;/h2&gt;
&lt;blockquote&gt;
&lt;p&gt;mybatis和hibernate一样是个orm数据库框架&lt;br&gt;
1). hibernate是全自动，而mybatis是半自动。&lt;br&gt;
mybatis开发是需要去写sql语句，而使用hibernate不需要写任何的sql语句就能实现各种操作&lt;br&gt;
2).hibernate数据库移植性远大于mybatis。&lt;br&gt;
如果使用mybatis，一旦数据库发生变化，需要重写编码（比如mysql数据库的sql语句和oracle以及sqlServer数据库他们用的sql语句会有一些差别）。但是使用hibernate一旦数据库发生变化，我们不需要重写编码，只需要改少许的配置就能实现&lt;br&gt;
3).hibernate拥有完整的日志系统，mybatis则欠缺一些。&lt;br&gt;
4).mybatis相比hibernate需要关心很多细节&lt;br&gt;
hibernate配置要比mybatis复杂的多，学习成本也比mybatis高。但也正因为 mybatis使用简单，才导致它要比hibernate关心很多技术细节。mybatis由于不用考虑很多细节，开发模式上与传统jdbc区别很小，因 此很容易上手并开发项目，但忽略细节会导致项目前期bug较多，因而开发出相对稳定的软件很慢，而开发出软件却很快。hibernate则正好与之相反。 但是如果使用hibernate很熟练的话，实际上开发效率丝毫不差于甚至超越mybatis。&lt;/p&gt;
&lt;p&gt;5).sql直接优化上，mybatis要比hibernate方便很多&lt;br&gt;
这也是hibernate没落的原因之一。因为sql语句自动生成的，效率上不好控制&lt;/p&gt;
&lt;p&gt;为什么现在mybatis要比hiernate流行？&lt;br&gt;
很重要的原因：hibernate的学习难度是目前大家接触的框架中最大的，学习成本远远高于mybatis，所以mybatis更流行&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&#34;入门&#34;&gt;入门&lt;/h2&gt;
&lt;p&gt;1、引入依赖.....&lt;/p&gt;
&lt;p&gt;2、配置数据源&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-properties&#34;&gt;spring.datasource.url=jdbc:mysql://localhost:3306/springboot?serverTimezone=UTC&amp;amp;useUnicode=true&amp;amp;characterEncoding=utf8&amp;amp;useSSL=true
spring.datasource.username=root
spring.datasource.password=root
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;3、编写实体类&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;在mybatis的开发中，实体类所在包名都用的是pojo，但是在spring-data-jpa中，因为spring中实体类的包名一般都是叫做domain，所以我们开发的时候实体类的包名也叫domain&lt;/p&gt;
&lt;/blockquote&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;import javax.persistence.*;
/**
	@Entity ：该注解表示这个类是一个实体类，（准备用来建立数据库表的映射关系）
	@Table ：用来建立实体类和数据库表的真实映射关系，属性name为表名，表名和类名一致可以省略
	
		@id ：表示主键
		@GeneratedValue(strategy = GenerationType.IDENTITY) ：该字段是自增的
		@Column ：建立数据库列名的映射
*/
@Entity
@Table(name = &amp;quot;grade&amp;quot;)
public class Grade {

    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    @Column(name = &amp;quot;id&amp;quot;,nullable = false)
    private Integer id;

    @Column(name = &amp;quot;name&amp;quot;,nullable = false,length = 50)
    private String name;
	
    ....
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;4、编写接口&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;在spring-data-jpa中，接口所在的包名，官方用的是repository，所以我们也这么用，它等同于我们之前的dao或者是mapper&lt;/p&gt;
&lt;/blockquote&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;/**
 * 编写spring-data-jpa接口要点：
 *      1.继承JpaRepository&amp;lt;参数一要操作的类,参数二改类的主键类型&amp;gt;
 *      2.在接口上添加注解@Repository，如果该接口在启动类的同一个包或者是在启动类的子包中，那么该类将交给spring管理
 *   spring-data-jpa接口编写的规则（因为增删改是就用封装好的就可以，该接口主要是用于查询）
 *   精确查询的规则：find + 表名 + By + domain中的属性名
 *   模糊查询的规则：find + 表名 + By + domain中的属性名 + Like	
 */
@Repository
public interface GradeAreaRepository extends JpaRepository&amp;lt;Grade,Integer&amp;gt; {
	/**
     * 根据年级名称查询年级
     * @param name
     * @return
     */
    Grade findGradeByName(String name);

    /**
     * 根据年级名称做模糊查询
     * @param name
     * @return
     */
    List&amp;lt;Grade&amp;gt; findGradeByNameLike(String name);

    /**
     * 根据主键查询
     */
    Grade findGradeById(Integer id);
    
    /**
     * 根据id和年级名称做联合查询
     */
    Grade findGradeByIdAndNameLike(Integer id,String name);
    
    /**
     * 单独的分页操作
     * 如果希望做分页操作，返回的数据类型必须是spring-data-jpa跟我们封装好的Page，参数放Pageable接口
     */
    Page&amp;lt;Grade&amp;gt; findAll(Pageable page);
}

&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;5、测试&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-xml&#34;&gt;&amp;lt;!-- spring-data-jpa测试需要添加的依赖,如果直接在tomcat中运行不需要该包 --&amp;gt;
&amp;lt;dependency&amp;gt;
    &amp;lt;groupId&amp;gt;net.minidev&amp;lt;/groupId&amp;gt;
    &amp;lt;artifactId&amp;gt;asm&amp;lt;/artifactId&amp;gt;
    &amp;lt;version&amp;gt;1.0.2&amp;lt;/version&amp;gt;
    &amp;lt;scope&amp;gt;test&amp;lt;/scope&amp;gt;
&amp;lt;/dependency&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;//测试增加
@Test
public void testSave(){
    Grade grade = new Grade();
    grade.setName(&amp;quot;五年级&amp;quot;);
    Grade g = gradeRepository.save(grade);
    //增加后很容易拿到主键
    System.out.println(g);
}

//测试修改(如果不给主键是增加，给主键就是修改)
@Test
public void testUpdate(){
    Grade grade = new Grade();
    grade.setId(4);
    grade.setName(&amp;quot;原子弹设置与制造&amp;quot;);
    Grade g = gradeRepository.save(grade);
    System.out.println(g);
}
//测试删除--根据主键删除
@Test
public void testDeleteById(){
    //执行删除
    gradeRepository.deleteById(5);
}
//测试删除--根据对象删除
@Test
public void testDeleteByObject(){
    //执行删除
    Grade grade = new Grade();
    grade.setId(4);
    gradeRepository.delete(grade);
}
//测试删除--删除全部
@Test
public void testDeleteAll(){
    gradeRepository.deleteAll();
}

@Test
public void testSave100(){
    for (int i = 1; i &amp;lt;= 100; i++) {
        Grade grade = new Grade();
        grade.setName(i+ &amp;quot;年级&amp;quot;);
        gradeRepository.save(grade);
    }

}

//测试查询--查询全部
@Test
public void testGetAll(){
    List&amp;lt;Grade&amp;gt; list = gradeRepository.findAll();
    for (Grade grade : list) {
        System.out.println(grade);
    }
}
//测试查询--根据id查询
@Test
public void testGetById(){
    //根据主键查询
    Grade grade = gradeRepository.findById(1).get();
    System.out.println(grade);
}

//测试查询--根据id查询(在tomcat容器中不会有问题，但是在测试的时候会出现懒加载导致session关闭的问题)
@Test
public void testGetById2(){
    //根据主键查询
    //使用getOne方法需要在配置文件中添加   spring.jpa.properties.hibernate.enable_lazy_load_no_trans=true
    Grade grade = gradeRepository.getOne(1);
    System.out.println(grade);
}


//测试查询--非主键的精确查询--根据年级名称做精确查询
@Test
public void testGetGradeByName(){
    Grade grade = gradeRepository.findGradeByName(&amp;quot;1年级&amp;quot;);
    System.out.println(grade);
}

//测试查询--模糊查询--根据年级名称做模糊查询
@Test
public void testGetGradeByNameLike(){
    String name = &amp;quot;火&amp;quot;;
    List&amp;lt;Grade&amp;gt; list = gradeRepository.findGradeByNameLike(&amp;quot;%&amp;quot; + name + &amp;quot;%&amp;quot;);
    for (Grade grade : list) {
        System.out.println(grade);
    }
}

@Test
public void testGetById3(){
    Grade grade = gradeRepository.findGradeById(2);
    System.out.println(grade);
}

//测试查询--多条件联合查询
@Test
public void testGetGradeByIdAndNameLike(){
    Grade grade = gradeRepository.findGradeByIdAndNameLike(1, &amp;quot;%1年级%&amp;quot;);
    System.out.println(grade);
}

//测试查询--分页查询
@Test
public void testFindAllPages(){
    //构造Pageable使用PageRequest.of(参数一当前要展示的页码，参数二每页显示的信息条数)
    //注意：在mybatis的pagehelper中，当前源码是从1开始的，但是在spring-data-jpa中分页页码是从0开始
    
    //PageRequest中的其他参数
    //Pageable pageable = PageRequest.of(0,10, Sort.by(Sort.Direction.DESC,&amp;quot;id&amp;quot;));
	//Pageable pageable = PageRequest.of(0,10,Sort.Direction.DESC,&amp;quot;id&amp;quot;);
    Pageable pageable = PageRequest.of(1,10);
    Page&amp;lt;Grade&amp;gt; all = gradeRepository.findAll(pageable);
    System.out.println(&amp;quot;总条数&amp;quot;+all.getTotalElements());
    System.out.println(&amp;quot;总页数&amp;quot; + all.getTotalPages());
    System.out.println(&amp;quot;是否有下一页&amp;quot;+all.hasNext());
    System.out.println(&amp;quot;是否有上一页&amp;quot;+all.hasPrevious());
    System.out.println(&amp;quot;是否有内容&amp;quot;+all.hasContent());
    System.out.println(&amp;quot;是否首页&amp;quot;+all.isFirst());
    System.out.println(&amp;quot;是否最后一页&amp;quot;+all.isLast());
    System.out.println(&amp;quot;元素数量&amp;quot;+all.getNumberOfElements());
    //获取到一页数据
    List&amp;lt;Grade&amp;gt; list = all.getContent();
    for (Grade grade : list) {
        System.out.println(grade);
    }
        
}
&lt;/code&gt;&lt;/pre&gt;
">Spring-Data-Jpa</a>
      </div>
      
      <div class="item">
        <a class="result-title" href="https://haohanya.github.io/post/mongodb/"" data-c="
          &lt;h2 id=&#34;mongo&#34;&gt;Mongo&lt;/h2&gt;
&lt;h3 id=&#34;什么是mongodb&#34;&gt;什么是MongoDB&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;MongoDB是一个基于分布式文件存储的数据库。由C++语言编写。旨在为WEB应用提供可扩展的高性能数据存储解决方案。&lt;br&gt;
MongoDB是一个介于关系数据库和非关系数据库之间的产品，是非关系数据库当中功能最丰富，最像关系数据库的。它支持的数据结构非常松散，是类似json的bson格式，因此可以存储比较复杂的数据类型。Mongo最大的特点是它支持的查询语言非常强大，其语法有点类似于面向对象的查询语言，几乎可以实现类似关系数据库单表查询的绝大部分功能，而且还支持对数据建立索引。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&#34;mongodb特点&#34;&gt;MongoDB特点&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;它的特点是高性能、易部署、易使用，存储数据非常方便。主要功能特性有：&lt;/p&gt;
&lt;p&gt;*面向集合存储的，易于存储对象类型的数据&lt;/p&gt;
&lt;p&gt;*模式自由。&lt;/p&gt;
&lt;p&gt;*支持动态[查询]&lt;/p&gt;
&lt;p&gt;*支持完全索引，包含内部对象。&lt;/p&gt;
&lt;p&gt;*支持查询。&lt;/p&gt;
&lt;p&gt;*支持复制和故障恢复。&lt;/p&gt;
&lt;p&gt;*使用高效的二进制数据存储，包括大型对象（如视频等）。&lt;/p&gt;
&lt;p&gt;*自动处理碎片，以支持云计算层次的扩展性。&lt;/p&gt;
&lt;p&gt;*支持 Golang，RUBY，PYTHON，JAVA，C++，PHP，C#等多种语言。&lt;/p&gt;
&lt;p&gt;*文件存储格式为BSON（一种JSON的扩展）。&lt;/p&gt;
&lt;p&gt;*可通过网络访问。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&#34;mongodb体系结构&#34;&gt;MongoDB体系结构&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;mongo的逻辑结果是一种层次结构&lt;/p&gt;
&lt;p&gt;主要由如下几个东西组成：&lt;/p&gt;
&lt;p&gt;文档(document)、集合(collection)、数据库(database)这三部分组成，逻辑结构是面向用户的。&lt;/p&gt;
&lt;p&gt;用户就可以通过MongoDB开发应用程序使用的就是逻辑结构&lt;/p&gt;
&lt;p&gt;(1)MongoDB的document，相当于是MySQL（关系型数据库）中的一行记录&lt;/p&gt;
&lt;p&gt;(2)多个文档组成一个集合，在MySQL中多条记录组成的是表&lt;/p&gt;
&lt;p&gt;(3)多个集合，逻辑上组织在一起，就是一个数据库&lt;/p&gt;
&lt;p&gt;(4)一个MongoDB实例支持多个数据库&lt;/p&gt;
&lt;/blockquote&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style=&#34;text-align:center&#34;&gt;MongoDB&lt;/th&gt;
&lt;th style=&#34;text-align:center&#34;&gt;Mysql&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;数据库(database)&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;数据库(database)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;集合(collection)&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;表(table)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;文档(document)&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;行(row)&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h2 id=&#34;安装mongo&#34;&gt;安装Mongo&lt;/h2&gt;
&lt;h3 id=&#34;1-拉取镜像&#34;&gt;1、拉取镜像&lt;/h3&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;docker pull mongo:latest
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;2-创建容器&#34;&gt;2、创建容器&lt;/h3&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;docker run -di --name=mymongo -p 27017:27017 mongo --auth
&lt;/code&gt;&lt;/pre&gt;
&lt;blockquote&gt;
&lt;p&gt;27017 ：mongo默认的端口&lt;/p&gt;
&lt;p&gt;--auth：启用验证，默认关闭&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&#34;3-创建用户&#34;&gt;3、创建用户&lt;/h3&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;# 进入容器
docker exec -it mymongo /bin/bash
# 进入Mongo
mongo
# 选择数据库
use admin
# 创建用户
db.createUser({user:&amp;quot;root&amp;quot;,pwd:&amp;quot;root&amp;quot;,roles:[{role:&amp;quot;root&amp;quot;,db:&amp;quot;admin&amp;quot;}]})
&lt;/code&gt;&lt;/pre&gt;
&lt;figure data-type=&#34;image&#34; tabindex=&#34;1&#34;&gt;&lt;img src=&#34;https://haohanya.github.io/post-images/1590650660588.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
&lt;h2 id=&#34;crud&#34;&gt;CRUD&lt;/h2&gt;
&lt;blockquote&gt;
&lt;p&gt;如果涉及到认证问题，必须在操作之前登陆&lt;/p&gt;
&lt;p&gt;&lt;code&gt;db.auth(&amp;quot;账号&amp;quot;,&amp;quot;密码&amp;quot;)&lt;/code&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&#34;添加&#34;&gt;添加&lt;/h3&gt;
&lt;p&gt;语法：&lt;code&gt;db.collection.save(json)&lt;/code&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-sql&#34;&gt;db.student.save({name:&amp;quot;张三&amp;quot;,sex:&amp;quot;男&amp;quot;,address:&amp;quot;湖北&amp;quot;})
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;查询&#34;&gt;查询&lt;/h3&gt;
&lt;h4 id=&#34;查询全部&#34;&gt;查询全部&lt;/h4&gt;
&lt;p&gt;语法：&lt;code&gt;db.collection.find()&lt;/code&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-sql&#34;&gt;db.student.find()
# 结果
# { &amp;quot;_id&amp;quot; : ObjectId(&amp;quot;5ece87413b6767c1aa235b37&amp;quot;), &amp;quot;name&amp;quot; : &amp;quot;张三&amp;quot;, &amp;quot;sex&amp;quot; : &amp;quot;女&amp;quot;, &amp;quot;address&amp;quot; : &amp;quot;湖北&amp;quot; }
&lt;/code&gt;&lt;/pre&gt;
&lt;blockquote&gt;
&lt;p&gt;这里大家会发现每条文档都有一个叫 &amp;quot;_id&amp;quot;字段，这个相当于mysql数据库中表的主键，当你在插入记录的时候，没有指定该字段，mongo会自动创建，类型是ObjectId类型&lt;/p&gt;
&lt;p&gt;如果我们在插入文档记录的时候指定了该字段，其类型可以是ObjectId，也可以是mongo支持的任意数据类型&lt;/p&gt;
&lt;p&gt;如：&lt;code&gt;db.student.save({_id:1,name:&amp;quot;张三&amp;quot;,sex:15,address:&amp;quot;湖北&amp;quot;})&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;如果_id 的值是一样的会覆盖原有的数据&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h4 id=&#34;条件查询&#34;&gt;条件查询&lt;/h4&gt;
&lt;p&gt;语法：&lt;code&gt;db.collection.find({key:&amp;quot;value&amp;quot;})&lt;/code&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-sql&#34;&gt;db.student.find({name:&amp;quot;李四&amp;quot;})
&lt;/code&gt;&lt;/pre&gt;
&lt;h4 id=&#34;查询单个&#34;&gt;查询单个&lt;/h4&gt;
&lt;p&gt;语法：&lt;code&gt;db.collection.findOne({key:value})&lt;/code&gt;&lt;/p&gt;
&lt;h3 id=&#34;修改&#34;&gt;修改&lt;/h3&gt;
&lt;h4 id=&#34;完全修改&#34;&gt;完全修改&lt;/h4&gt;
&lt;p&gt;语法：&lt;code&gt;db.collection.update(条件json,修改后的json)&lt;/code&gt;&lt;/p&gt;
&lt;h4 id=&#34;部分修改&#34;&gt;部分修改&lt;/h4&gt;
&lt;p&gt;语法：&lt;code&gt;db.collection.update(条件json,{$set:{key:value,key:value}})&lt;/code&gt;&lt;/p&gt;
&lt;h3 id=&#34;删除&#34;&gt;删除&lt;/h3&gt;
&lt;p&gt;语法：&lt;code&gt;db.collection.remove(json条件)&lt;/code&gt;&lt;/p&gt;
&lt;h2 id=&#34;高级查询&#34;&gt;高级查询&lt;/h2&gt;
&lt;h3 id=&#34;模糊查询&#34;&gt;模糊查询&lt;/h3&gt;
&lt;p&gt;语法：&lt;code&gt;db.collection.find({key:/value/})&lt;/code&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;查询key中带有value的文档&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&#34;查询null&#34;&gt;查询NULL&lt;/h3&gt;
&lt;p&gt;语法：&lt;code&gt;db.collection.find({key:null})&lt;/code&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;查询没有key的文档&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&#34;比较查询&#34;&gt;比较查询&lt;/h3&gt;
&lt;pre&gt;&lt;code class=&#34;language-sql&#34;&gt;# 大于
db.collection.find({key:{$gt:value}})
# 小于
db.collection.find({key:{$lt:value}})
# 大于或等于
db.collection.find({key:{$gte:value}})
# 小于等于
db.collection.find({key:{$lte:value}})
# 不等于
db.collection.find({key:{$ne:value}})
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;判断域字段是否存在&#34;&gt;判断域/字段是否存在&lt;/h3&gt;
&lt;pre&gt;&lt;code class=&#34;language-sql&#34;&gt;# 语法
db.collection.find({key:{$exists:true}})
# 例子：查询带有address的文档
db.student.find({address:{$exists:true}})
# 例子：查询没有address的文档
db.student.find({address:{$exists:false}})
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;包含&#34;&gt;包含&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;类似于mysql的in&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;语法：&lt;code&gt;db.collection.find({key:{$in:[v1,v2,v3,.....]}})&lt;/code&gt;&lt;/p&gt;
&lt;h3 id=&#34;统计数量&#34;&gt;统计数量&lt;/h3&gt;
&lt;p&gt;语法：&lt;code&gt;db.collection.count()&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;添加条件语法：&lt;code&gt;db.collection.count(json条件)&lt;/code&gt;&lt;/p&gt;
&lt;h3 id=&#34;逻辑运算符&#34;&gt;逻辑运算符&lt;/h3&gt;
&lt;h4 id=&#34;并且&#34;&gt;并且&lt;/h4&gt;
&lt;pre&gt;&lt;code class=&#34;language-sql&#34;&gt;# 语法
db.collection.find($and:[{k1:v1},{k2:{表达式:v2}}])
# 例子：查询年龄大于10并且小于20
db.student.find($and:[{age:{$gt:10}},{age:{$lt:20}}])
&lt;/code&gt;&lt;/pre&gt;
&lt;h4 id=&#34;或者&#34;&gt;或者&lt;/h4&gt;
&lt;pre&gt;&lt;code class=&#34;language-sql&#34;&gt;# 语法
db.collection.find($or:[{k1:v1},{v2:{表达式:v2}}])
# 例子：查询年龄大于18或者性别为女
db.student.find($or:[{age:{$gt:18}},{sex:&amp;quot;女&amp;quot;}])
&lt;/code&gt;&lt;/pre&gt;
&lt;h4 id=&#34;非&#34;&gt;非&lt;/h4&gt;
&lt;pre&gt;&lt;code class=&#34;language-sql&#34;&gt;db.collection.find({key:{$ne:value}})
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;java操作mongo&#34;&gt;JAVA操作Mongo&lt;/h2&gt;
&lt;h3 id=&#34;1-添加依赖&#34;&gt;1、添加依赖&lt;/h3&gt;
&lt;pre&gt;&lt;code class=&#34;language-xml&#34;&gt;&amp;lt;!-- mongodb客户端 --&amp;gt;
&amp;lt;dependency&amp;gt;
    &amp;lt;groupId&amp;gt;org.mongodb&amp;lt;/groupId&amp;gt;
    &amp;lt;artifactId&amp;gt;mongo-java-driver&amp;lt;/artifactId&amp;gt;
    &amp;lt;version&amp;gt;3.9.1&amp;lt;/version&amp;gt;
&amp;lt;/dependency&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;2-连接测试&#34;&gt;2、连接测试&lt;/h3&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;@Test
public void testConnection(){
    //创建认证对象，参数1：用户名、参数2：数据库、参数3：密码
    MongoCredential credential = MongoCredential.createCredential(&amp;quot;root&amp;quot;,&amp;quot;admin&amp;quot;,&amp;quot;root&amp;quot;.toCharArray());
    //创建mongo客户端对象，参数1：服务器地址，参数2：mongodb的端口号
    ServerAddress serverAddress = new ServerAddress(&amp;quot;192.168.25.146&amp;quot;,27017);
    MongoClient client = new MongoClient(serverAddress, Arrays.asList(credential));
    //获取到集合（数据库）
    MongoDatabase database = client.getDatabase(&amp;quot;admin&amp;quot;);
    //获取collection
    MongoCollection&amp;lt;Document&amp;gt; student = database.getCollection(&amp;quot;student&amp;quot;);
    //获取到document集合（一行记录）
    FindIterable&amp;lt;Document&amp;gt; documents = student.find();
    for (Document document : documents) {
        System.out.println(document.getString(&amp;quot;name&amp;quot;));
        System.out.println(document.getDouble(&amp;quot;age&amp;quot;));
        System.out.println(document.getString(&amp;quot;sex&amp;quot;));
    }
}
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;3-条件查询-匹配&#34;&gt;3、条件查询-匹配&lt;/h3&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;@Test
public void testFindBasi(){
    //创建认证对象，参数1：用户名、参数2：数据库、参数3：密码
    MongoCredential credential = MongoCredential.createCredential(&amp;quot;root&amp;quot;,&amp;quot;admin&amp;quot;,&amp;quot;root&amp;quot;.toCharArray());
    //创建mongo客户端对象，参数1：服务器地址，参数2：mongodb的端口号
    ServerAddress serverAddress = new ServerAddress(&amp;quot;192.168.25.146&amp;quot;,27017);
    MongoClient client = new MongoClient(serverAddress, Arrays.asList(credential));
    //获取到集合（数据库）
    MongoDatabase database = client.getDatabase(&amp;quot;admin&amp;quot;);
    //获取collection
    MongoCollection&amp;lt;Document&amp;gt; student = database.getCollection(&amp;quot;student&amp;quot;);

    /*------------------------------------创建查询条件----------------------------------------------*/

    Map&amp;lt;String,Object&amp;gt; map = new HashMap&amp;lt;&amp;gt;();
    map.put(&amp;quot;name&amp;quot;,&amp;quot;张三&amp;quot;);
    BasicDBObject basicDBObject = new BasicDBObject(map);

    /*------------------------------------创建查询条件----------------------------------------------*/

    //获取到document集合（一行记录）
    FindIterable&amp;lt;Document&amp;gt; documents = student.find(basicDBObject);
    for (Document document : documents) {
        System.out.println(document.getString(&amp;quot;name&amp;quot;));
        System.out.println(document.getDouble(&amp;quot;age&amp;quot;));
        System.out.println(document.getString(&amp;quot;sex&amp;quot;));
    }
}
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;4-条件查询-模糊&#34;&gt;4、条件查询-模糊&lt;/h3&gt;
&lt;h4 id=&#34;完全匹配&#34;&gt;完全匹配&lt;/h4&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;/*------------------------------------创建查询条件----------------------------------------------*/
Pattern pattern = Pattern.compile(&amp;quot;^张三$&amp;quot;);

Map&amp;lt;String,Object&amp;gt; map = new HashMap&amp;lt;&amp;gt;();
map.put(&amp;quot;name&amp;quot;,pattern);
BasicDBObject basicDBObject = new BasicDBObject(map);
/*------------------------------------创建查询条件----------------------------------------------*/
&lt;/code&gt;&lt;/pre&gt;
&lt;h4 id=&#34;右匹配&#34;&gt;右匹配&lt;/h4&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;Pattern pattern = Pattern.compile(&amp;quot;^张.*$&amp;quot;);
&lt;/code&gt;&lt;/pre&gt;
&lt;h4 id=&#34;左匹配&#34;&gt;左匹配&lt;/h4&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;Pattern pattern = Pattern.compile(&amp;quot;^.*张$&amp;quot;);
&lt;/code&gt;&lt;/pre&gt;
&lt;h4 id=&#34;模糊匹配&#34;&gt;模糊匹配&lt;/h4&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;Pattern pattern = Pattern.compile(&amp;quot;^.*张.*$&amp;quot;);
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;5-数字比较&#34;&gt;5、数字比较&lt;/h3&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;//查询年龄大于10
/*------------------------------------创建查询条件----------------------------------------------*/
BasicDBObject basicDBObject = new BasicDBObject(&amp;quot;age&amp;quot;,new BasicDBObject(&amp;quot;$gt&amp;quot;,10));
/*------------------------------------创建查询条件----------------------------------------------*/
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;6-条件连接-并且&#34;&gt;6、条件连接-并且&lt;/h3&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;//查询性别为男并且年龄大于10岁
/*------------------------------------创建查询条件----------------------------------------------*/
BasicDBObject basicDBObject1 = new BasicDBObject(&amp;quot;sex&amp;quot;,&amp;quot;男&amp;quot;);
BasicDBObject basicDBObject2 = new BasicDBObject(&amp;quot;age&amp;quot;,new BasicDBObject(&amp;quot;$gt&amp;quot;,10));
BasicDBObject basicDBObject = new BasicDBObject(&amp;quot;$and&amp;quot;,Arrays.asList(basicDBObject1,basicDBObject2));
/*------------------------------------创建查询条件----------------------------------------------*/
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;7-条件连接-或者&#34;&gt;7、条件连接-或者&lt;/h3&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;//查询性别为男或者年龄大于20
/*------------------------------------创建查询条件----------------------------------------------*/
BasicDBObject basicDBObject1 = new BasicDBObject(&amp;quot;sex&amp;quot;,&amp;quot;男&amp;quot;);
BasicDBObject basicDBObject2 = new BasicDBObject(&amp;quot;age&amp;quot;,new BasicDBObject(&amp;quot;$gt&amp;quot;,20));
BasicDBObject basicDBObject = new BasicDBObject(&amp;quot;$or&amp;quot;,Arrays.asList(basicDBObject1,basicDBObject2));
/*------------------------------------创建查询条件----------------------------------------------*/
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;8-添加&#34;&gt;8、添加&lt;/h3&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;//创建认证对象，参数1：用户名、参数2：数据库、参数3：密码
MongoCredential credential = MongoCredential.createCredential(&amp;quot;root&amp;quot;,&amp;quot;admin&amp;quot;,&amp;quot;root&amp;quot;.toCharArray());
//创建mongo客户端对象，参数1：服务器地址，参数2：mongodb的端口号
ServerAddress serverAddress = new ServerAddress(&amp;quot;192.168.25.146&amp;quot;,27017);
MongoClient client = new MongoClient(serverAddress, Arrays.asList(credential));
//获取到集合（数据库）
MongoDatabase database = client.getDatabase(&amp;quot;admin&amp;quot;);
//获取collection
MongoCollection&amp;lt;Document&amp;gt; student = database.getCollection(&amp;quot;student&amp;quot;);

Map&amp;lt;String,Object&amp;gt; map = new HashMap&amp;lt;&amp;gt;();
map.put(&amp;quot;name&amp;quot;,&amp;quot;王五&amp;quot;);
map.put(&amp;quot;sex&amp;quot;,&amp;quot;男&amp;quot;);
map.put(&amp;quot;age&amp;quot;,15);
map.put(&amp;quot;address&amp;quot;,&amp;quot;湖南&amp;quot;);

Document document = new Document(map);
student.insertOne(document);
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;9-修改&#34;&gt;9、修改&lt;/h3&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;//把_id为1的文档中age修改为55
public void update(){
    //创建认证对象，参数1：用户名、参数2：数据库、参数3：密码
    MongoCredential credential = MongoCredential.createCredential(&amp;quot;root&amp;quot;,&amp;quot;admin&amp;quot;,&amp;quot;root&amp;quot;.toCharArray());
    //创建mongo客户端对象，参数1：服务器地址，参数2：mongodb的端口号
    ServerAddress serverAddress = new ServerAddress(&amp;quot;192.168.25.146&amp;quot;,27017);
    MongoClient client = new MongoClient(serverAddress, Arrays.asList(credential));
    //获取到集合（数据库）
    MongoDatabase database = client.getDatabase(&amp;quot;admin&amp;quot;);
    //获取collection
    MongoCollection&amp;lt;Document&amp;gt; student = database.getCollection(&amp;quot;student&amp;quot;);
	//修改的条件
    BasicDBObject filter = new BasicDBObject(&amp;quot;_id&amp;quot;,1);
    //修改后的域和值
    BasicDBObject update = new BasicDBObject(&amp;quot;$set&amp;quot;,new BasicDBObject(&amp;quot;age&amp;quot;,55));

    student.updateOne(filter,update);
}
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;10-删除文档&#34;&gt;10、删除文档&lt;/h3&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;public void delete(){
    //创建认证对象，参数1：用户名、参数2：数据库、参数3：密码
    MongoCredential credential = MongoCredential.createCredential(&amp;quot;root&amp;quot;,&amp;quot;admin&amp;quot;,&amp;quot;root&amp;quot;.toCharArray());
    //创建mongo客户端对象，参数1：服务器地址，参数2：mongodb的端口号
    ServerAddress serverAddress = new ServerAddress(&amp;quot;192.168.25.146&amp;quot;,27017);
    MongoClient client = new MongoClient(serverAddress, Arrays.asList(credential));
    //获取到集合（数据库）
    MongoDatabase database = client.getDatabase(&amp;quot;admin&amp;quot;);
    //获取collection
    MongoCollection&amp;lt;Document&amp;gt; student = database.getCollection(&amp;quot;student&amp;quot;);

    //删除条件
    BasicDBObject basicDBObject = new BasicDBObject(&amp;quot;_id&amp;quot;,1);
    student.deleteOne(basicDBObject);//删除一个
    student.deleteMany(basicDBObject);//删除所有满足条件的
}
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;mongodb工具类&#34;&gt;MongoDB工具类&lt;/h2&gt;
&lt;blockquote&gt;
&lt;p&gt;MongoClient被设计成线程安全的类（单线程），也就是我们在使用该类的时候不用考虑并发的情况，这样我们就可以考虑将mongoClient做成一个静态变量，为所有的线程共用，不必每次都销毁，这样就可以极大的提高执行的效率，实际上mongodb提供了内置的连接池来实现&lt;/p&gt;
&lt;/blockquote&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;package com.mongo.util;

import com.mongodb.*;
import com.mongodb.client.MongoDatabase;

import java.util.Arrays;

/**
 * @program: mongodb
 * @author: 潘
 * @create: 2020-05-28 12:57
 **/
public class MongoManager {

    private static MongoClient client = null;

    private static void init(){
        MongoCredential credential = MongoCredential.createCredential(&amp;quot;root&amp;quot;, &amp;quot;admin&amp;quot;, &amp;quot;root&amp;quot;.toCharArray());
        ServerAddress serverAddress = new ServerAddress(&amp;quot;192.168.25.146&amp;quot;, 27017);
        //选项构造者
        MongoClientOptions.Builder builder = new MongoClientOptions.Builder();
        //读取数据的超时时间
        builder.socketTimeout(5000);
        //每个地址最大请求数
        builder.connectionsPerHost(30);
        //写入的策略,仅仅抛出网络异常
        builder.writeConcern(WriteConcern.NORMAL);
        MongoClientOptions options = builder.build();
        client = new MongoClient(serverAddress, Arrays.asList(credential), options);
    }
    public static MongoDatabase getDatabase(String db){

        if(client == null){
            init();
        }

        return client.getDatabase(db);
    }

}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;dao&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;public class StudentDao {
	public void save(String name,String sex,double age,String address){
		// 2.获取数据库(数据库)
		MongoDatabase database = MongoManager.getDatabase(&amp;quot;admin&amp;quot;);
		// 3.获取到collection(表)
		MongoCollection&amp;lt;Document&amp;gt; collection = database.getCollection(&amp;quot;student&amp;quot;);
		//4.准备要添加的数据
		Map&amp;lt;String, Object&amp;gt; map = new HashMap&amp;lt;String, Object&amp;gt;();
		map.put(&amp;quot;name&amp;quot;, name);
		map.put(&amp;quot;sex&amp;quot;, sex);
		map.put(&amp;quot;age&amp;quot;, age);
		map.put(&amp;quot;address&amp;quot;, address);
		Document document = new Document(map);
		//5.添加数据
		collection.insertOne(document);
	}
}
&lt;/code&gt;&lt;/pre&gt;
">MongoDB</a>
      </div>
      
      <div class="item">
        <a class="result-title" href="https://haohanya.github.io/post/docker/"" data-c="
          &lt;h1 id=&#34;docker&#34;&gt;Docker&lt;/h1&gt;
&lt;h2 id=&#34;安装docker&#34;&gt;安装Docker&lt;/h2&gt;
&lt;h3 id=&#34;1-使用yum命令在线安装&#34;&gt;1、使用yum命令在线安装&lt;/h3&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;yum install docker
# 遇事不决就选y
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;2-查看docker版本&#34;&gt;2、查看docker版本&lt;/h3&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;docker -v
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;3-启动与停止&#34;&gt;3、启动与停止&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;systemctl 命令是系统服务管理器指令，它是 service 和 chkconfig 两个命令组合&lt;/p&gt;
&lt;/blockquote&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;# 启动 docker
systemctl start docker
# 停止 docker
systemctl stop docker
# 重启 docker
systemctl restart docker
# 查看 docker 状态
systemctl status docker
# 开机自启
systemctl enable docker
# 查看 docker 概要信息
docker info
# 查看 docker 帮助文档
docker --info
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;docker-镜像操作&#34;&gt;Docker 镜像操作&lt;/h2&gt;
&lt;h3 id=&#34;1-列出镜像&#34;&gt;1、列出镜像&lt;/h3&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;docker images
# REPOSITORY   镜像所在的仓库名称 
# TAG          镜像标签（版本号）
# IMAGE ID     镜像ID
# CREATE       镜像创建的时间（仓库中创建的时间）
# SIZE         镜像大小
&lt;/code&gt;&lt;/pre&gt;
&lt;figure data-type=&#34;image&#34; tabindex=&#34;1&#34;&gt;&lt;img src=&#34;https://haohanya.github.io/post-images/1590650520863.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
&lt;h3 id=&#34;2-搜索镜像&#34;&gt;2、搜索镜像&lt;/h3&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;docker search 镜像名称
# INDEX 
# NAME         仓库名称
# DESCRIPTION  镜像描述
# STARS        用户评价，反应一个镜像的受欢迎程度
# OFFICIAL     是否是官方
# AUTOMATED    自动构建，表示该镜像由Docker Hub自动构建流程创建的
&lt;/code&gt;&lt;/pre&gt;
&lt;figure data-type=&#34;image&#34; tabindex=&#34;2&#34;&gt;&lt;img src=&#34;https://haohanya.github.io/post-images/1590650561249.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
&lt;h3 id=&#34;3-拉取镜像&#34;&gt;3、拉取镜像&lt;/h3&gt;
&lt;h4 id=&#34;从docker-hub上拉取&#34;&gt;从Docker Hub上拉取&lt;/h4&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;docker pull centos:7
&lt;/code&gt;&lt;/pre&gt;
&lt;h4 id=&#34;ustc的镜像&#34;&gt;ustc的镜像&lt;/h4&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;https://lug.ustc.edu.cn/wiki/mirrors/help/docker
&lt;/code&gt;&lt;/pre&gt;
&lt;h4 id=&#34;阿里云镜像&#34;&gt;阿里云镜像&lt;/h4&gt;
&lt;p&gt;1、进入阿里云&lt;/p&gt;
&lt;p&gt;https://cr.console.aliyun.com/cn-hangzhou/instances/mirrors&lt;/p&gt;
&lt;p&gt;2、得到镜像URL并修改daemon.json&lt;/p&gt;
&lt;p&gt;3、重启daemon&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;systemctl daemon-reload
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;4、重启docker服务&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;systemctl restart docker
&lt;/code&gt;&lt;/pre&gt;
&lt;h4 id=&#34;修改daemonjson&#34;&gt;修改daemon.json&lt;/h4&gt;
&lt;p&gt;1、编辑文件&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;vi /etc/docker/daemon.json
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;2、修改文件内容&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;{
&amp;quot;registry-mirrors&amp;quot;: [&amp;quot;https://docker.mirrors.ustc.edu.cn&amp;quot;]
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;3、重启&lt;/p&gt;
&lt;h3 id=&#34;4-删除镜像&#34;&gt;4、删除镜像&lt;/h3&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;# 删除指定镜像
docker rmi $IMAGE_ID
# 删除所有镜像
docker rmi `docker images -q`
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;docker容器操作&#34;&gt;Docker容器操作&lt;/h2&gt;
&lt;h3 id=&#34;1-查看容器&#34;&gt;1、查看容器&lt;/h3&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;# 查看正在运行的容器
docker ps
# 查看运行过的容器
docker ps -a
# 查看最后一次运行的容器
docker ps -i
# 查看停止的容器
docker ps -f status=exited
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;2-创建与启动容器&#34;&gt;2、创建与启动容器&lt;/h3&gt;
&lt;p&gt;创建容器常用的参数说明&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;docker run  创建容器命令
-i          运行该容器
-t          表示容器启动后会进入其命令行。加入这两个参数后，容器创建就能登录进去。即分配一个伪终端。
--name      为创建的容器命名
-v          表示目录映射关系（前者是宿主机目录，后者是映射到宿主机上的目录），可以使用多个－v做多个目录或文件映射。注意：最好做目录映射，在宿主机上做修改，然后共享到容器上。
-d          在run后面加上-d参数则会创建一个守护式容器在后台运行（这样创建容器后不会自动登陆容器，如果只加-i-t两个参数，创建后就会自动进入容器）
-p          端口映射，前者是宿主机端口，后者是容器内的映射端口，可以使用多个-p做多个端口映射
&lt;/code&gt;&lt;/pre&gt;
&lt;h4 id=&#34;交互式容器&#34;&gt;交互式容器&lt;/h4&gt;
&lt;p&gt;创建一个交互式容器并命名为：mycentos&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;docker run -it --name=mycentos centos:7 /bin/bash
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;使用exit命令 退出当前容器&lt;/p&gt;
&lt;h4 id=&#34;创建守护式容器&#34;&gt;创建守护式容器&lt;/h4&gt;
&lt;p&gt;创建一个守护式容器：如果对于一个需要长期运行的容器来说，我们可以创建一个守护式容器。命令如下（容器名称不能重复）&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;docker run -id --name=mycentos2  centos:7
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;登陆守护式容器&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;docker exec -it container_name(或者container_id) /bin/bash (exit退出时容器不会停止)
&lt;/code&gt;&lt;/pre&gt;
&lt;figure data-type=&#34;image&#34; tabindex=&#34;3&#34;&gt;&lt;img src=&#34;https://haohanya.github.io/post-images/1590650581316.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
&lt;h3 id=&#34;3-停止与启动容器&#34;&gt;3、停止与启动容器&lt;/h3&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;# 停止正在运行的容器
docker stop $CONTAINER_NAME/ID
# 运行已停止的容器
docker start $CONTAINER_NAME/ID
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;4-文件拷贝&#34;&gt;4、文件拷贝&lt;/h3&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;# 将文件拷贝到容器内
docker cp 宿主机内要拷贝的文件或目录 容器名称:拷贝到容器目录
# 将容器内的文件拷贝出来
docker cp 容器名称:容器要拷贝出开的文件或目录 拷贝到宿主机那个目录
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;5-目录挂载&#34;&gt;5、目录挂载&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;我们可以在创建容器的时候，将宿主机的目录与容器内的目录进行映射，这样我们就可以通过修改宿主机某个目录的文件从而去影响容器。&lt;/p&gt;
&lt;p&gt;创建容器 添加-v参数 后边为  宿主机目录:容器目录&lt;/p&gt;
&lt;p&gt;如果共享多级目录可能会出现权限不足的情况&lt;/p&gt;
&lt;p&gt;这是因为CentOS7中的安全模块selinux把权限禁掉了，我们需要添加参数 --privileged=true 来解决挂载的目录没有权限的问题&lt;/p&gt;
&lt;/blockquote&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;docker run -di -v /usr/test:/usr/test --name=mycentos centos:7
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;6-查看容器ip地址&#34;&gt;6、查看容器IP地址&lt;/h3&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;# 可以通过以下命令查看容器运行的各种数据
docker inspect container_name
# 也可以直接执行下面的命令直接输出IP地址
docker inspect --format=&#39;{{.NetworkSettings.IPAddress}}&#39; container_name
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;7-删除容器&#34;&gt;7、删除容器&lt;/h3&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;# 删除指定容器
docker rm container_id/name
# 删除所有容器（以停止运行的）
docker rm `docker ps -a -q`
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;部署应用&#34;&gt;部署应用&lt;/h2&gt;
&lt;h3 id=&#34;mysql部署&#34;&gt;MySQL部署&lt;/h3&gt;
&lt;p&gt;1、拉取MySQL镜像&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;docker pull mysql
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;2、创建MySQL容器&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;# -p 宿主机映射端口:容器运行端口
# -e 表示添加环境变量，MYSQL_ROOT_PASSWORD 为root用户的登陆密码
docker run -di --name=jd_mysql -p 33306:3306 -e MYSQL_ROOT_PASSWORD=root mysql
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;3、进入MySQL容器&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;docker exec -it jd_mysql /bin/bash
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;4、登陆MySQL&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;# -u 用户名，-u后面需要打空格
# -p密码，-p后面没有空格,加了空格会再输入一遍密码
mysql -u root -proot
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;5、退出MySQL&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;# 退出mysql
quit
# 退出容器
exit
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;tomcat部署&#34;&gt;Tomcat部署&lt;/h3&gt;
&lt;p&gt;1、拉取Tomcat镜像&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;docker pull tomcat:7-jre7
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;2、创建tomcat容器&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;创建容器用于部署单点登录系统（CAS） -p表示地址映射&lt;/p&gt;
&lt;/blockquote&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;docker run -di --name=jd_tomcat -p 9100:8080 -v /usr/local/webapps:/usr/local/tomcat/webapps --privileged=true tomcat:7-jre7
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;3、访问ip:9100/cas&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;登陆测试，如果出现Invalid credentials重启.&lt;/p&gt;
&lt;p&gt;docker restart jd_tomcat&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&#34;nginx部署&#34;&gt;nginx部署&lt;/h3&gt;
&lt;p&gt;1、拉取镜像&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;docker pull nginx
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;2、创建容器&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;docker run -di --name=mynginx -p 80:80 nginx /bin/bash
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;3、测试&lt;/p&gt;
&lt;p&gt;无法访问需要手动启动nginx&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;docker exec -it jd_nginx /bin/bash
/etc/init.d/nginx start
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;4、编辑配置文件&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;# 将nginx配置文件复制出来
docker cp jd_nginx:/etc/nginx/nginx.conf  nginx.conf
# 修改nginx.conf
.......
# 将文件拷贝到容器
docker cp nginx.conf jd_nginx:/etc/nginx/nginx.conf
#重启容器
docker restart jd_nginx
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;redis部署&#34;&gt;Redis部署&lt;/h3&gt;
&lt;p&gt;1、拉取镜像&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;docker pull redis
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;2、创建容器&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;docker run -di --name=jd_redis -p 6379:6379 redis
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;3、测试连接&lt;/p&gt;
&lt;p&gt;&lt;code&gt;redis Desktop&lt;/code&gt;&lt;/p&gt;
&lt;h2 id=&#34;备份与迁移&#34;&gt;备份与迁移&lt;/h2&gt;
&lt;h3 id=&#34;1-将容器保存为镜像&#34;&gt;1、将容器保存为镜像&lt;/h3&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;docker commit jd_nginx mynginx
&lt;/code&gt;&lt;/pre&gt;
&lt;blockquote&gt;
&lt;p&gt;jd_nginx：容器名称&lt;/p&gt;
&lt;p&gt;mynginx：新镜像名称&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&#34;2-镜像备份&#34;&gt;2、镜像备份&lt;/h3&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;docker save -o mynginx.tar mynginx
&lt;/code&gt;&lt;/pre&gt;
&lt;blockquote&gt;
&lt;p&gt;-o ：输出到的文件&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&#34;3-镜像恢复与迁移&#34;&gt;3、镜像恢复与迁移&lt;/h3&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;docker load -i mynginx.tar
&lt;/code&gt;&lt;/pre&gt;
&lt;blockquote&gt;
&lt;p&gt;-i ：输入的文件&lt;/p&gt;
&lt;/blockquote&gt;
">Docker</a>
      </div>
      
      <div class="item">
        <a class="result-title" href="https://haohanya.github.io/post/redis-cluster/"" data-c="
          &lt;h2 id=&#34;搭建redis-cluster&#34;&gt;搭建Redis-Cluster&lt;/h2&gt;
&lt;h3 id=&#34;搭建要求&#34;&gt;搭建要求&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;需要 6 台 redis 服务器。搭建伪集群。&lt;/p&gt;
&lt;p&gt;需要 6 个 redis 实例。&lt;/p&gt;
&lt;p&gt;需要运行在不同的端口 7001-7006&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&#34;准备工作&#34;&gt;准备工作&lt;/h3&gt;
&lt;h4 id=&#34;1-安装gcc&#34;&gt;1、安装gcc&lt;/h4&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;yum install gcc-c++
&lt;/code&gt;&lt;/pre&gt;
&lt;h4 id=&#34;2-使用yum命令安装-ruby-我们需要使用ruby脚本来实现集群搭建&#34;&gt;2、使用yum命令安装 ruby （我们需要使用ruby脚本来实现集群搭建）&lt;/h4&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;yum install ruby
yum install rubygems
&lt;/code&gt;&lt;/pre&gt;
&lt;blockquote&gt;
&lt;p&gt;以上两步遇到选择y/N直接填y即可&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h4 id=&#34;3-将redis源码包上传到-linux-系统-解压redis源码包&#34;&gt;3、将redis源码包上传到 linux 系统 ，解压redis源码包&lt;/h4&gt;
&lt;blockquote&gt;
&lt;p&gt;tar -zxvf redis-3.0.0.tar.gz&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h4 id=&#34;4-编译redis源码-进入redis源码文件夹&#34;&gt;4、编译redis源码 ，进入redis源码文件夹&lt;/h4&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;cd redis-3.0.0
make
&lt;/code&gt;&lt;/pre&gt;
&lt;h4 id=&#34;5-创建目录usrlocalredis-cluster目录-安装6个redis实例分别安装在以下目录&#34;&gt;5、创建目录/usr/local/redis-cluster目录， 安装6个redis实例，分别安装在以下目录&lt;/h4&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;mkdir /usr/local/redis-cluster
cd redis-3.0.0
make install PREFIX=/usr/local/redis-cluster/redis-1
......
make install PREFIX=/usr/local/redis-cluster/redis-6
&lt;/code&gt;&lt;/pre&gt;
&lt;h4 id=&#34;6-复制配置文件-将-redis-300redisconf-复制到redis下的bin目录下&#34;&gt;6、复制配置文件 将 /redis-3.0.0/redis.conf 复制到redis下的bin目录下&lt;/h4&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;cp redis.conf /usr/local/redis-cluster/redis-1/bin
......
cp redis.conf /usr/local/redis-cluster/redis-6/bin
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;配置集群&#34;&gt;配置集群&lt;/h3&gt;
&lt;p&gt;1、修改每个redis节点的配置文件redis.conf&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;修改运行端口为7001 （7002 7003 .....）(45行)&lt;/p&gt;
&lt;p&gt;将cluster-enabled yes 前的注释去掉(632行)&lt;/p&gt;
&lt;p&gt;daemonize no 改为yes （43行）&lt;/p&gt;
&lt;/blockquote&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;cd /usr/local/redis-cluster/
vi redis-1/bin/redis.conf
......
vi redis-6/bin/redis.conf
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;2、启动每个redis实例&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;cd redis-1/bin/
./redis-server redis.conf
.......
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;3、上传redis-3.0.0.gem ，安装 ruby用于搭建redis集群的脚本。&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;cd ~
cp redis-3.0.0.gem /usr/local/redis-cluster/
cd redis-3.0.0/src/
cp redis-trib.rb /usr/local/redis-cluster/
cd /usr/local/redis-cluster/
gem install redis-3.0.0.gem
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;4、使用 ruby 脚本搭建集群。&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;进入redis源码目录中的src目录 执行下面的命令&lt;/p&gt;
&lt;/blockquote&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;./redis-trib.rb create --replicas 1 192.168.25.144:7001 192.168.25.144:7002 192.168.25.144:7003 192.168.25.144:7004 192.168.25.144:7005 192.168.25.144:7006
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;5、查看是否启动成功&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;ps -ef | grep redis
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;springdataredis连接redis集群&#34;&gt;SpringDataRedis连接Redis集群&lt;/h3&gt;
&lt;pre&gt;&lt;code class=&#34;language-xml&#34;&gt;&amp;lt;?xml version=&amp;quot;1.0&amp;quot; encoding=&amp;quot;UTF-8&amp;quot;?&amp;gt; 
&amp;lt;beans xmlns=&amp;quot;http://www.springframework.org/schema/beans&amp;quot; 
  xmlns:xsi=&amp;quot;http://www.w3.org/2001/XMLSchema-instance&amp;quot; xmlns:p=&amp;quot;http://www.springframework.org/schema/p&amp;quot; 
  xmlns:context=&amp;quot;http://www.springframework.org/schema/context&amp;quot; 
  xsi:schemaLocation=&amp;quot;http://www.springframework.org/schema/beans   
            http://www.springframework.org/schema/beans/spring-beans.xsd   
            http://www.springframework.org/schema/context   
            http://www.springframework.org/schema/context/spring-context.xsd&amp;quot;&amp;gt;  
	&amp;lt;!-- 加载配置属性文件 --&amp;gt;  
&amp;lt;context:property-placeholder ignore-unresolvable=&amp;quot;true&amp;quot; location=&amp;quot;classpath:properties/redis-cluster-config.properties&amp;quot; /&amp;gt;  
&amp;lt;bean id=&amp;quot;redis-clusterConfiguration&amp;quot; class=&amp;quot;org.springframework.data.redis.connection.redis-clusterConfiguration&amp;quot;&amp;gt;  
	&amp;lt;property name=&amp;quot;maxRedirects&amp;quot; value=&amp;quot;${redis.maxRedirects}&amp;quot;&amp;gt;&amp;lt;/property&amp;gt;  
	&amp;lt;property name=&amp;quot;clusterNodes&amp;quot;&amp;gt;  
	&amp;lt;set&amp;gt;  
		&amp;lt;bean class=&amp;quot;org.springframework.data.redis.connection.redis-clusterNode&amp;quot;&amp;gt;  
			&amp;lt;constructor-arg name=&amp;quot;host&amp;quot; value=&amp;quot;${redis.host1}&amp;quot;&amp;gt;&amp;lt;/constructor-arg&amp;gt;  
			&amp;lt;constructor-arg name=&amp;quot;port&amp;quot; value=&amp;quot;${redis.port1}&amp;quot;&amp;gt;&amp;lt;/constructor-arg&amp;gt;  
		&amp;lt;/bean&amp;gt;  
		&amp;lt;bean class=&amp;quot;org.springframework.data.redis.connection.redis-clusterNode&amp;quot;&amp;gt;  
			&amp;lt;constructor-arg name=&amp;quot;host&amp;quot; value=&amp;quot;${redis.host2}&amp;quot;&amp;gt;&amp;lt;/constructor-arg&amp;gt;  
			&amp;lt;constructor-arg name=&amp;quot;port&amp;quot; value=&amp;quot;${redis.port2}&amp;quot;&amp;gt;&amp;lt;/constructor-arg&amp;gt;  
		&amp;lt;/bean&amp;gt;  
		&amp;lt;bean class=&amp;quot;org.springframework.data.redis.connection.redis-clusterNode&amp;quot;&amp;gt;  
			&amp;lt;constructor-arg name=&amp;quot;host&amp;quot; value=&amp;quot;${redis.host3}&amp;quot;&amp;gt;&amp;lt;/constructor-arg&amp;gt;  
			&amp;lt;constructor-arg name=&amp;quot;port&amp;quot; value=&amp;quot;${redis.port3}&amp;quot;&amp;gt;&amp;lt;/constructor-arg&amp;gt;  
		&amp;lt;/bean&amp;gt;  
	     &amp;lt;bean class=&amp;quot;org.springframework.data.redis.connection.redis-clusterNode&amp;quot;&amp;gt;  
	         &amp;lt;constructor-arg name=&amp;quot;host&amp;quot; value=&amp;quot;${redis.host4}&amp;quot;&amp;gt;&amp;lt;/constructor-arg&amp;gt;  
	         &amp;lt;constructor-arg name=&amp;quot;port&amp;quot; value=&amp;quot;${redis.port4}&amp;quot;&amp;gt;&amp;lt;/constructor-arg&amp;gt;  
	      &amp;lt;/bean&amp;gt;  
	      &amp;lt;bean class=&amp;quot;org.springframework.data.redis.connection.redis-clusterNode&amp;quot;&amp;gt;  
	         &amp;lt;constructor-arg name=&amp;quot;host&amp;quot; value=&amp;quot;${redis.host5}&amp;quot;&amp;gt;&amp;lt;/constructor-arg&amp;gt;  
	         &amp;lt;constructor-arg name=&amp;quot;port&amp;quot; value=&amp;quot;${redis.port5}&amp;quot;&amp;gt;&amp;lt;/constructor-arg&amp;gt;  
	      &amp;lt;/bean&amp;gt;  
		 &amp;lt;bean class=&amp;quot;org.springframework.data.redis.connection.redis-clusterNode&amp;quot;&amp;gt;  
			&amp;lt;constructor-arg name=&amp;quot;host&amp;quot; value=&amp;quot;${redis.host6}&amp;quot;&amp;gt;&amp;lt;/constructor-arg&amp;gt;  
			&amp;lt;constructor-arg name=&amp;quot;port&amp;quot; value=&amp;quot;${redis.port6}&amp;quot;&amp;gt;&amp;lt;/constructor-arg&amp;gt;  
		 &amp;lt;/bean&amp;gt;  
	   &amp;lt;/set&amp;gt;  
	 &amp;lt;/property&amp;gt;  
&amp;lt;/bean&amp;gt;  
&amp;lt;bean id=&amp;quot;jedisPoolConfig&amp;quot;   class=&amp;quot;redis.clients.jedis.JedisPoolConfig&amp;quot;&amp;gt;  
	   &amp;lt;property name=&amp;quot;maxIdle&amp;quot; value=&amp;quot;${redis.maxIdle}&amp;quot; /&amp;gt;   
	   &amp;lt;property name=&amp;quot;maxTotal&amp;quot; value=&amp;quot;${redis.maxTotal}&amp;quot; /&amp;gt;   
&amp;lt;/bean&amp;gt;  
&amp;lt;bean id=&amp;quot;jeidsConnectionFactory&amp;quot; class=&amp;quot;org.springframework.data.redis.connection.jedis.JedisConnectionFactory&amp;quot;  &amp;gt;  
		&amp;lt;constructor-arg ref=&amp;quot;redis-clusterConfiguration&amp;quot; /&amp;gt;  
		&amp;lt;constructor-arg ref=&amp;quot;jedisPoolConfig&amp;quot; /&amp;gt;  
&amp;lt;/bean&amp;gt;    
&amp;lt;bean id=&amp;quot;redisTemplate&amp;quot; class=&amp;quot;org.springframework.data.redis.core.RedisTemplate&amp;quot;&amp;gt;  
		&amp;lt;property name=&amp;quot;connectionFactory&amp;quot; ref=&amp;quot;jeidsConnectionFactory&amp;quot; /&amp;gt;  
&amp;lt;/bean&amp;gt;  
&amp;lt;/beans&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;redis-cluster-config.properties&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-properties&#34;&gt;redis.host1=192.168.25.140
redis.port1=7001

redis.host2=192.168.25.140
redis.port2=7002

redis.host3=192.168.25.140
redis.port3=7003

redis.host4=192.168.25.140
redis.port4=7004

redis.host5=192.168.25.140
redis.port5=7005

redis.host6=192.168.25.140
redis.port6=7006

redis.maxRedirects=3
redis.maxIdle=100
redis.maxTotal=600
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;模拟集群异常测试&#34;&gt;模拟集群异常测试&lt;/h2&gt;
&lt;p&gt;关闭节点命令&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;./redis-cli -p 端口 shutdown 
&lt;/code&gt;&lt;/pre&gt;
&lt;blockquote&gt;
&lt;p&gt;测试关闭7001 和7004, 看看会发生什么。&lt;/p&gt;
&lt;p&gt;测试关闭7001、7002、7003 会发生什么。&lt;/p&gt;
&lt;/blockquote&gt;
">Redis-Cluster</a>
      </div>
      
      <div class="item">
        <a class="result-title" href="https://haohanya.github.io/post/zookeeper-cluster/"" data-c="
          &lt;p&gt;查看tomcat运行日志：tail -f logs/catalina.out&lt;/p&gt;
&lt;h2 id=&#34;zookeeper安装&#34;&gt;ZooKeeper安装&lt;/h2&gt;
&lt;p&gt;官网下载：http://zookeeper.apache.org/releases.html&lt;/p&gt;
&lt;p&gt;第一次启动会出现错误&lt;/p&gt;
&lt;p&gt;解决方案：把conf目录下的zoo_sample.cfg复制一份，并改名为zoo.cfg&lt;/p&gt;
&lt;p&gt;在zookeeper根目录新建一个data目录&lt;/p&gt;
&lt;p&gt;修改zoo.cfg里面的dataDir=/tmp/zookeeper&lt;/p&gt;
&lt;p&gt;修改为：../data&lt;/p&gt;
&lt;h2 id=&#34;服务提供者&#34;&gt;服务提供者&lt;/h2&gt;
&lt;pre&gt;&lt;code class=&#34;language-xml&#34;&gt;&amp;lt;!--使用dubbo暴漏服务--&amp;gt;
&amp;lt;dubbo:protocol name=&amp;quot;dubbo&amp;quot; port=&amp;quot;20881&amp;quot;/&amp;gt;
&amp;lt;!--将工程注册到dubbo中--&amp;gt;
&amp;lt;dubbo:application name=&amp;quot;jd-sellergoods-service&amp;quot;/&amp;gt;
&amp;lt;!--注册中心地址--&amp;gt;
&amp;lt;dubbo:registry address=&amp;quot;zookeeper://192.168.25.128:2181&amp;quot;/&amp;gt;
&amp;lt;!--开启注解开发--&amp;gt;
&amp;lt;dubbo:annotation package=&amp;quot;com.jd.service.impl&amp;quot; /&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;服务消费者&#34;&gt;服务消费者&lt;/h2&gt;
&lt;pre&gt;&lt;code class=&#34;language-xml&#34;&gt;&amp;lt;!-- 引用dubbo 服务 --&amp;gt;
&amp;lt;dubbo:application name=&amp;quot;jd-sellergoods-web&amp;quot; /&amp;gt;
&amp;lt;dubbo:registry address=&amp;quot;zookeeper://192.168.25.128:2181&amp;quot; timeout=&amp;quot;30000&amp;quot;/&amp;gt;
&amp;lt;dubbo:annotation package=&amp;quot;com.jd.controller&amp;quot; /&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;zookeeper集群简介&#34;&gt;Zookeeper集群简介&lt;/h2&gt;
&lt;h3 id=&#34;为什么搭建zookeeper集群&#34;&gt;为什么搭建Zookeeper集群&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;大部分分布式应用需要一个主控、协调器或者控制器来管理物理分布的子进程。目前，大多数都要开发私有的协调程序，缺乏一个通用机制，协调程序的反复编写浪费，且难以形成通用、伸缩性好的协调器，zookeeper提供通用的分布式锁服务，用以协调分布式应用。所以说zookeeper是分布式应用的协作服务。&lt;/p&gt;
&lt;p&gt;zookeeper作为注册中心，服务器和客户端都要访问，如果有大量的并发，肯定会有等待。所以可以通过zookeeper集群解决。&lt;/p&gt;
&lt;p&gt;下面是zookeeper集群部署结构图：&lt;/p&gt;
&lt;/blockquote&gt;
&lt;figure data-type=&#34;image&#34; tabindex=&#34;1&#34;&gt;&lt;img src=&#34;https://haohanya.github.io/post-images/1590380537479.jpg&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
&lt;h3 id=&#34;了解leader选举&#34;&gt;了解Leader选举&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;Zookeeper的启动过程中leader选举是非常重要而且最复杂的一个环节。那么什么是leader选举呢？zookeeper为什么需要leader选举呢？zookeeper的leader选举的过程又是什么样子的？&lt;/p&gt;
&lt;p&gt;首先我们来看看什么是leader选举。其实这个很好理解，leader选举就像总统选举一样，每人一票，获得多数票的人就当选为总统了。在zookeeper集群中也是一样，每个节点都会投票，如果某个节点获得超过半数以上的节点的投票，则该节点就是leader节点了。&lt;/p&gt;
&lt;p&gt;以一个简单的例子来说明整个选举的过程.&lt;br&gt;
假设有五台服务器组成的zookeeper集群,它们的id从1-5,同时它们都是最新启动的,也就是没有历史数据,在存放数据量这一点上,都是一样的.假设这些服务器依序启动,来看看会发生什么 。&lt;br&gt;
1) 服务器1启动,此时只有它一台服务器启动了,它发出去的报没有任何响应,所以它的选举状态一直是LOOKING状态&lt;br&gt;
2) 服务器2启动,它与最开始启动的服务器1进行通信,互相交换自己的选举结果,由于两者都没有历史数据,所以id值较大的服务器2胜出,但是由于没有达到超过半数以上的服务器都同意选举它(这个例子中的半数以上是3),所以服务器1,2还是继续保持LOOKING状态.&lt;br&gt;
3) 服务器3启动,根据前面的理论分析,服务器3成为服务器1,2,3中的老大,而与上面不同的是,此时有三台服务器选举了它,所以它成为了这次选举的leader.&lt;br&gt;
4) 服务器4启动,根据前面的分析,理论上服务器4应该是服务器1,2,3,4中最大的,但是由于前面已经有半数以上的服务器选举了服务器3,所以它只能接收当小弟的命了.&lt;br&gt;
5) 服务器5启动,同4一样,当小弟&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&#34;zookeeper集群搭建&#34;&gt;ZooKeeper集群搭建&lt;/h2&gt;
&lt;blockquote&gt;
&lt;p&gt;真实的集群是需要部署在不同的服务器上的，但是在我们测试时同时启动十几个虚拟机内存会吃不消，所以我们通常会搭建&lt;strong&gt;伪集群&lt;/strong&gt;，也就是把所有的服务都搭建在一台虚拟机上，用端口进行区分。&lt;/p&gt;
&lt;p&gt;我们这里要求搭建一个三个节点的Zookeeper集群（伪集群）。&lt;/p&gt;
&lt;p&gt;测试环境&lt;/p&gt;
&lt;p&gt;​	jdk：1.7&lt;/p&gt;
&lt;p&gt;​	zookeeper：3.4.6&lt;/p&gt;
&lt;p&gt;​	centos ：6.x&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&#34;1-创建一个目录&#34;&gt;1、创建一个目录&lt;/h3&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt; mkdir /usr/local/zookeeper-cluster
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;2-上传zookeeper文件并解压&#34;&gt;2、上传zookeeper文件并解压&lt;/h3&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;tar -zxvf zookeeper-3.4.6.tar.gz
# 新建文件夹
mkdir zookeeper-3.4.6/data
#修改coo.cfg名
cd zookeeper-3.4.6/conf/
mv zoo_sample.cfg zoo.cfg
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;3-复制zookeeper&#34;&gt;3、复制zookeeper&lt;/h3&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;cp -r  zookeeper-3.4.6 /usr/local/zookeeper-cluster/zookeeper-1
cp -r  zookeeper-3.4.6 /usr/local/zookeeper-cluster/zookeeper-2
cp -r  zookeeper-3.4.6 /usr/local/zookeeper-cluster/zookeeper-3
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;4-配置每一个zookeeper&#34;&gt;4、配置每一个Zookeeper&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;配置每一个Zookeeper 的dataDir（zoo.cfg） clientPort 分别为2181 2182 2183&lt;/p&gt;
&lt;p&gt;vi /usr/local/zookeeper-cluster/zookeeper-1/conf/zoo.cfg&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;clientPort=2181&lt;/p&gt;
&lt;p&gt;dataDir=/usr/local/zookeeper-cluster/zookeeper-1/data&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;vi /usr/local/zookeeper-cluster/zookeeper-2/conf/zoo.cfg&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;clientPort=2182&lt;/p&gt;
&lt;p&gt;dataDir=/usr/local/zookeeper-cluster/zookeeper-2/data&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;vi /usr/local/zookeeper-cluster/zookeeper-3/conf/zoo.cfg&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;clientPort=2183&lt;/p&gt;
&lt;p&gt;dataDir=/usr/local/zookeeper-cluster/zookeeper-3/data&lt;/p&gt;
&lt;/blockquote&gt;
&lt;/blockquote&gt;
&lt;h3 id=&#34;5-配置集群&#34;&gt;5、配置集群&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;在每个zookeeper的 data 目录下创建一个 myid 文件，内容分别是1、2、3 。这个文件就是记录每个服务器的ID（内容为自定义，后面会用到，只要不重复即可）&lt;/p&gt;
&lt;/blockquote&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;cd /usr/local/zookeeper-cluster/
echo 1 &amp;gt;zookeeper-1/data/myid
echo 2 &amp;gt;zookeeper-2/data/myid
echo 3 &amp;gt;zookeeper-3/data/myid
&lt;/code&gt;&lt;/pre&gt;
&lt;blockquote&gt;
&lt;p&gt;在每一个zookeeper 的 zoo.cfg配置客户端访问端口（clientPort）和集群服务器IP列表。&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;解释：server.服务器ID=服务器IP地址:服务器之间通信端口:服务器之间投票选举端口&lt;/p&gt;
&lt;p&gt;服务器ID为上面自定义的内容&lt;/p&gt;
&lt;/blockquote&gt;
&lt;/blockquote&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;server.1=192.168.25.143:2881:3881
server.2=192.168.25.143:2882:3882
server.3=192.168.25.143:2883:3883
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;vi zookeeper-1/conf/zoo.cfg
vi zookeeper-2/conf/zoo.cfg
vi zookeeper-3/conf/zoo.cfg
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;6-启动集群&#34;&gt;6、启动集群&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;启动集群就是分别启动每个实例。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;./zookeeper-1/bin/zkServer.sh start
./zookeeper-2/bin/zkServer.sh start
./zookeeper-3/bin/zkServer.sh start
# 查看启动状态
./zookeeper-1/bin/zkServer.sh status
./zookeeper-2/bin/zkServer.sh status
./zookeeper-3/bin/zkServer.sh status
# 如果出现错误，则需要查看日志
vi zookeeper.out
&lt;/code&gt;&lt;/pre&gt;
&lt;figure data-type=&#34;image&#34; tabindex=&#34;2&#34;&gt;&lt;img src=&#34;https://haohanya.github.io/post-images/1590380587607.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
&lt;blockquote&gt;
&lt;p&gt;Mode为follower表示是&lt;strong&gt;跟随者&lt;/strong&gt;（从）&lt;/p&gt;
&lt;p&gt;Mod 为leader表示是&lt;strong&gt;领导者&lt;/strong&gt;（主）&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&#34;7-模拟集群异常&#34;&gt;7、模拟集群异常&lt;/h2&gt;
&lt;blockquote&gt;
&lt;p&gt;首先我们先测试如果是从服务器挂掉，会怎么样&lt;/p&gt;
&lt;p&gt;把3号服务器停掉，观察1号和2号，发现状态并没有变化&lt;/p&gt;
&lt;p&gt;由此得出结论，3个节点的集群，从服务器挂掉，集群正常&lt;/p&gt;
&lt;/blockquote&gt;
&lt;figure data-type=&#34;image&#34; tabindex=&#34;3&#34;&gt;&lt;img src=&#34;https://haohanya.github.io/post-images/1590380605531.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
&lt;blockquote&gt;
&lt;p&gt;我们再把1号服务器（从服务器）也停掉，查看2号（主服务器）的状态，发现已经停止运行了。&lt;/p&gt;
&lt;p&gt;由此得出结论，3个节点的集群，2个从服务器都挂掉，主服务器也无法运行。因为可运行的机器没有超过集群总数量的半数。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;figure data-type=&#34;image&#34; tabindex=&#34;4&#34;&gt;&lt;img src=&#34;https://haohanya.github.io/post-images/1590380619018.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
&lt;blockquote&gt;
&lt;p&gt;我们再次把1号服务器启动起来，发现2号服务器又开始正常工作了。而且依然是领导者。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;figure data-type=&#34;image&#34; tabindex=&#34;5&#34;&gt;&lt;img src=&#34;https://haohanya.github.io/post-images/1590380630247.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
&lt;blockquote&gt;
&lt;p&gt;我们把3号服务器也启动起来，把2号服务器停掉（汗~~干嘛？领导挂了？）停掉后观察1号和3号的状态。&lt;/p&gt;
&lt;p&gt;发现新的leader产生了~&lt;/p&gt;
&lt;p&gt;由此我们得出结论，当集群中的主服务器挂了，集群中的其他服务器会自动进行选举状态，然后产生新得leader&lt;/p&gt;
&lt;/blockquote&gt;
&lt;figure data-type=&#34;image&#34; tabindex=&#34;6&#34;&gt;&lt;img src=&#34;https://haohanya.github.io/post-images/1590380642196.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
&lt;blockquote&gt;
&lt;p&gt;我们再次测试，当我们把2号服务器重新启动起来（汗~~这是诈尸啊!）启动后，会发生什么？2号服务器会再次成为新的领导吗？我们看结果&lt;/p&gt;
&lt;p&gt;我们会发现，2号服务器启动后依然是跟随者（从服务器），3号服务器依然是领导者（主服务器），没有撼动3号服务器的领导地位。哎~退休了就是退休了，说了不算了，哈哈。&lt;/p&gt;
&lt;p&gt;由此我们得出结论，当领导者产生后，再次有新服务器加入集群，不会影响到现任领导者。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;figure data-type=&#34;image&#34; tabindex=&#34;7&#34;&gt;&lt;img src=&#34;https://haohanya.github.io/post-images/1590380653854.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
&lt;h2 id=&#34;dubbox连接zookeeper集群&#34;&gt;Dubbox连接zookeeper集群&lt;/h2&gt;
&lt;p&gt;修改服务提供者和服务调用者的spring 配置文件,多个节点使用“,”分割&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-xml&#34;&gt;&amp;lt;!-- 指定注册中心地址 --&amp;gt;
&amp;lt;dubbo:registry protocol=&amp;quot;zookeeper&amp;quot; address=&amp;quot;192.168.25.129:2181,192.168.25.129:2182,192.168.25.129:2183&amp;quot; /&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
"> Zookeeper-Cluster</a>
      </div>
      
      <div class="item">
        <a class="result-title" href="https://haohanya.github.io/post/dan-dian-deng-lu-cas/"" data-c="
          &lt;h2 id=&#34;什么是单点登录&#34;&gt;什么是单点登录&lt;/h2&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;a href=&#34;http://baike.baidu.com/item/%E5%8D%95%E7%82%B9%E7%99%BB%E5%BD%95&#34;&gt;单点登录&lt;/a&gt;（Single Sign On），简称为 SSO，是目前比较流行的企业业务整合的解决方案之一。SSO的定义是在多个应用系统中，用户只需要登录一次就可以访问所有相互信任的应用系统。&lt;/p&gt;
&lt;p&gt;我们目前的系统存在诸多子系统，而这些子系统是分别部署在不同的服务器中，那么使用传统方式的session是无法解决的，我们需要使用相关的单点登录技术来解决。&lt;br&gt;
&lt;img src=&#34;https://haohanya.github.io/post-images/1589897963520.jpg&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&#34;什么是cas&#34;&gt;什么是CAS&lt;/h2&gt;
&lt;blockquote&gt;
&lt;p&gt;CAS 是 Yale 大学发起的一个开源项目，旨在为 Web 应用系统提供一种可靠的单点登录方法，CAS 在 2004 年 12 月正式成为 JA-SIG 的一个项目。CAS 具有以下特点：&lt;/p&gt;
&lt;p&gt;【1】开源的企业级单点登录解决方案。&lt;/p&gt;
&lt;p&gt;【2】CAS Server 为需要独立部署的 Web 应用。&lt;/p&gt;
&lt;p&gt;【3】CAS Client 支持非常多的客户端(这里指单点登录系统中的各个 Web 应用)，包括 Java, .Net, PHP, Perl, Apache, uPortal, Ruby 等。&lt;/p&gt;
&lt;p&gt;从结构上看，CAS 包含两个部分： CAS Server 和 CAS Client。CAS Server 需要独立部署，主要负责对用户的认证工作；CAS Client 负责处理对客户端受保护资源的访问请求，需要登录时，重定向到 CAS Server。下图是 CAS 最基本的协议过程：&lt;/p&gt;
&lt;/blockquote&gt;
&lt;figure data-type=&#34;image&#34; tabindex=&#34;1&#34;&gt;&lt;img src=&#34;https://haohanya.github.io/post-images/1589897985205.jpg&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
&lt;blockquote&gt;
&lt;p&gt;SSO单点登录访问流程主要有以下步骤：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;访问服务：SSO客户端发送请求访问应用系统提供的服务资源。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;定向认证：SSO客户端会重定向用户请求到SSO服务器。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;用户认证：用户身份认证。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;发放票据：SSO服务器会产生一个随机的Service Ticket。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;验证票据：SSO服务器验证票据Service Ticket的合法性，验证通过后，允许客户端访问服务。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;传输用户信息：SSO服务器验证票据通过后，传输用户认证结果信息给客户端。&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/blockquote&gt;
&lt;h2 id=&#34;cas服务端部署&#34;&gt;CAS服务端部署&lt;/h2&gt;
&lt;h3 id=&#34;1-cas安装&#34;&gt;1、cas安装&lt;/h3&gt;
&lt;p&gt;在资源\cas\source\cas-server-4.0.0-release\cas-server-4.0.0\modules目录下&lt;/p&gt;
&lt;p&gt;cas-server-webapp-4.0.0.war 将其改名为cas.war放入tomcat目录下的webapps下。启动tomcat自动解压war包。浏览器输入http://localhost:8080/cas/login ，可看到登录页面&lt;/p&gt;
&lt;figure data-type=&#34;image&#34; tabindex=&#34;2&#34;&gt;&lt;img src=&#34;https://haohanya.github.io/post-images/1589897998952.jpg&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
&lt;p&gt;这里有个固定的用户名和密码  casuser/Mellon&lt;/p&gt;
&lt;p&gt;登录成功后会跳到登录成功的提示页面&lt;/p&gt;
&lt;figure data-type=&#34;image&#34; tabindex=&#34;3&#34;&gt;&lt;img src=&#34;https://haohanya.github.io/post-images/1589898004970.jpg&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
&lt;h3 id=&#34;2-修改端口&#34;&gt;2、修改端口&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;修改tomcat端口&lt;/p&gt;
&lt;p&gt;打开tomcat 目录 conf\server.xml 找到下面的配置&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-xml&#34;&gt;&amp;lt;Connector port=&amp;quot;8080&amp;quot; protocol=&amp;quot;HTTP/1.1&amp;quot;
               connectionTimeout=&amp;quot;20000&amp;quot;
               redirectPort=&amp;quot;8443&amp;quot; /&amp;gt;
&amp;lt;!--修改port为9100--&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;修改CAS配置文件&lt;/p&gt;
&lt;p&gt;WEB-INF/cas.properties&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-properties&#34;&gt;server.name=http://localhost:9100
&lt;/code&gt;&lt;/pre&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&#34;3-去除https认证&#34;&gt;3、去除https认证&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;CAS默认使用的是HTTPS协议，如果使用HTTPS协议需要SSL安全证书（需向特定的机构申请和购买） 。如果对安全要求不高或是在开发测试阶段，可使用HTTP协议。我们这里讲解通过修改配置，让CAS使用HTTP协议。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;修改cas的WEB-INF/deployerConfigContext.xml&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-xml&#34;&gt;&amp;lt;bean class=&amp;quot;org.jasig.cas.authentication.handler.support.HttpBasedServiceCredentialsAuthenticationHandler&amp;quot;
p:httpClient-ref=&amp;quot;httpClient&amp;quot;/&amp;gt;
&amp;lt;!-- 
	这里需要增加参数p:requireSecure=&amp;quot;false&amp;quot;
	requireSecure属性意思为是否需要安全验证
	即HTTPS，false为不采用
 --&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;修改cas的/WEB-INF/&lt;a href=&#34;http://lib.csdn.net/base/javaee&#34;&gt;&lt;strong&gt;spring&lt;/strong&gt;&lt;/a&gt;-configuration/ticketGrantingTicketCookieGenerator.xml&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-xml&#34;&gt;&amp;lt;bean id=&amp;quot;ticketGrantingTicketCookieGenerator&amp;quot; class=&amp;quot;org.jasig.cas.web.support.CookieRetrievingCookieGenerator&amp;quot;
      p:cookieSecure=&amp;quot;true&amp;quot;
      p:cookieMaxAge=&amp;quot;-1&amp;quot;
      p:cookieName=&amp;quot;CASTGC&amp;quot;
      p:cookiePath=&amp;quot;/cas&amp;quot; /&amp;gt;
&amp;lt;!--
	参数p:cookieSecure=&amp;quot;true&amp;quot;，同理为HTTPS验证相关，TRUE为采用HTTPS验证，FALSE为不采用https验证。
    参数p:cookieMaxAge=&amp;quot;-1&amp;quot;，是COOKIE的最大生命周期，-1为无生命周期，即只在当前打开的窗口有效，关闭或重新打开其它窗口，仍会要求验证。可以根据需要修改为大于0的数字，比如3600等，意思是在3600秒内，打开任意窗口，都不需要验证。
    我们这里将cookieSecure改为false ,  cookieMaxAge 改为3600
--&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;修改cas的WEB-INF/spring-configuration/warnCookieGenerator.xml&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-xml&#34;&gt;&amp;lt;bean id=&amp;quot;warnCookieGenerator&amp;quot; class=&amp;quot;org.jasig.cas.web.support.CookieRetrievingCookieGenerator&amp;quot;
    p:cookieSecure=&amp;quot;true&amp;quot;
    p:cookieMaxAge=&amp;quot;-1&amp;quot;
    p:cookieName=&amp;quot;CASPRIVACY&amp;quot;
    p:cookiePath=&amp;quot;/cas&amp;quot; /&amp;gt;
&amp;lt;!-- 将cookieSecure改为false ,  cookieMaxAge 改为3600 --&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;cas客户端入门小demo&#34;&gt;CAS客户端入门小Demo&lt;/h2&gt;
&lt;h3 id=&#34;客户端工程1搭建&#34;&gt;客户端工程1搭建&lt;/h3&gt;
&lt;h4 id=&#34;1-搭建工程引入依赖&#34;&gt;1、搭建工程引入依赖&lt;/h4&gt;
&lt;p&gt;创建Maven工程 （war）casclient_demo1 引入cas客户端依赖并制定tomcat运行端口为9001&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-xml&#34;&gt;&amp;lt;dependencies&amp;gt;
    &amp;lt;!-- cas --&amp;gt;
    &amp;lt;dependency&amp;gt;
        &amp;lt;groupId&amp;gt;org.jasig.cas.client&amp;lt;/groupId&amp;gt;
        &amp;lt;artifactId&amp;gt;cas-client-core&amp;lt;/artifactId&amp;gt;
        &amp;lt;version&amp;gt;3.3.3&amp;lt;/version&amp;gt;
    &amp;lt;/dependency&amp;gt;
    &amp;lt;dependency&amp;gt;
        &amp;lt;groupId&amp;gt;javax.servlet&amp;lt;/groupId&amp;gt;
        &amp;lt;artifactId&amp;gt;servlet-api&amp;lt;/artifactId&amp;gt;
        &amp;lt;version&amp;gt;2.5&amp;lt;/version&amp;gt;
        &amp;lt;scope&amp;gt;provided&amp;lt;/scope&amp;gt;
    &amp;lt;/dependency&amp;gt;
&amp;lt;/dependencies&amp;gt;

&amp;lt;build&amp;gt;
    &amp;lt;plugins&amp;gt;
        &amp;lt;!-- 配置Tomcat插件 --&amp;gt;
        &amp;lt;plugin&amp;gt;
            &amp;lt;groupId&amp;gt;org.apache.tomcat.maven&amp;lt;/groupId&amp;gt;
            &amp;lt;artifactId&amp;gt;tomcat7-maven-plugin&amp;lt;/artifactId&amp;gt;
            &amp;lt;configuration&amp;gt;
                &amp;lt;port&amp;gt;9001&amp;lt;/port&amp;gt;
                &amp;lt;path&amp;gt;/&amp;lt;/path&amp;gt;
                &amp;lt;uriEncoding&amp;gt;utf-8&amp;lt;/uriEncoding&amp;gt;
            &amp;lt;/configuration&amp;gt;
        &amp;lt;/plugin&amp;gt;
    &amp;lt;/plugins&amp;gt;
&amp;lt;/build&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;h4 id=&#34;2-修改webxml&#34;&gt;2、修改web.xml&lt;/h4&gt;
&lt;pre&gt;&lt;code class=&#34;language-xml&#34;&gt;&amp;lt;?xml version=&amp;quot;1.0&amp;quot; encoding=&amp;quot;UTF-8&amp;quot;?&amp;gt;
&amp;lt;web-app xmlns=&amp;quot;http://xmlns.jcp.org/xml/ns/javaee&amp;quot;
         xmlns:xsi=&amp;quot;http://www.w3.org/2001/XMLSchema-instance&amp;quot;
         xsi:schemaLocation=&amp;quot;http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_4_0.xsd&amp;quot;
         version=&amp;quot;4.0&amp;quot;&amp;gt;

    &amp;lt;!-- 用于单点退出，该过滤器用于实现单点登出功能，可选配置 --&amp;gt;
    &amp;lt;listener&amp;gt;
        &amp;lt;listener-class&amp;gt;org.jasig.cas.client.session.SingleSignOutHttpSessionListener&amp;lt;/listener-class&amp;gt;
    &amp;lt;/listener&amp;gt;

    &amp;lt;!-- 该过滤器用于实现单点登出功能，可选配置。 --&amp;gt;
    &amp;lt;filter&amp;gt;
        &amp;lt;filter-name&amp;gt;CAS Single Sign Out Filter&amp;lt;/filter-name&amp;gt;
        &amp;lt;filter-class&amp;gt;org.jasig.cas.client.session.SingleSignOutFilter&amp;lt;/filter-class&amp;gt;
    &amp;lt;/filter&amp;gt;
    &amp;lt;filter-mapping&amp;gt;
        &amp;lt;filter-name&amp;gt;CAS Single Sign Out Filter&amp;lt;/filter-name&amp;gt;
        &amp;lt;url-pattern&amp;gt;/*&amp;lt;/url-pattern&amp;gt;
    &amp;lt;/filter-mapping&amp;gt;

    &amp;lt;!-- 该过滤器负责用户的认证工作，必须启用它 --&amp;gt;
    &amp;lt;filter&amp;gt;
        &amp;lt;filter-name&amp;gt;CASFilter&amp;lt;/filter-name&amp;gt;
        &amp;lt;filter-class&amp;gt;org.jasig.cas.client.authentication.AuthenticationFilter&amp;lt;/filter-class&amp;gt;
        &amp;lt;init-param&amp;gt;
            &amp;lt;param-name&amp;gt;casServerLoginUrl&amp;lt;/param-name&amp;gt;
            &amp;lt;param-value&amp;gt;http://localhost:9100/cas/login&amp;lt;/param-value&amp;gt;
            &amp;lt;!--这里的server是服务端的IP --&amp;gt;
        &amp;lt;/init-param&amp;gt;
        &amp;lt;init-param&amp;gt;
            &amp;lt;param-name&amp;gt;serverName&amp;lt;/param-name&amp;gt;
            &amp;lt;param-value&amp;gt;http://localhost:9001&amp;lt;/param-value&amp;gt;
        &amp;lt;/init-param&amp;gt;
    &amp;lt;/filter&amp;gt;
    &amp;lt;filter-mapping&amp;gt;
        &amp;lt;filter-name&amp;gt;CASFilter&amp;lt;/filter-name&amp;gt;
        &amp;lt;url-pattern&amp;gt;/*&amp;lt;/url-pattern&amp;gt;
    &amp;lt;/filter-mapping&amp;gt;

    &amp;lt;!-- 该过滤器负责对Ticket的校验工作，必须启用它 --&amp;gt;
    &amp;lt;filter&amp;gt;
        &amp;lt;filter-name&amp;gt;CAS Validation Filter&amp;lt;/filter-name&amp;gt;
        &amp;lt;filter-class&amp;gt;org.jasig.cas.client.validation.Cas20ProxyReceivingTicketValidationFilter&amp;lt;/filter-class&amp;gt;
        &amp;lt;init-param&amp;gt;
            &amp;lt;param-name&amp;gt;casServerUrlPrefix&amp;lt;/param-name&amp;gt;
            &amp;lt;param-value&amp;gt;http://localhost:9100/cas&amp;lt;/param-value&amp;gt;
        &amp;lt;/init-param&amp;gt;
        &amp;lt;init-param&amp;gt;
            &amp;lt;param-name&amp;gt;serverName&amp;lt;/param-name&amp;gt;
            &amp;lt;param-value&amp;gt;http://localhost:9001&amp;lt;/param-value&amp;gt;
        &amp;lt;/init-param&amp;gt;
    &amp;lt;/filter&amp;gt;
    &amp;lt;filter-mapping&amp;gt;
        &amp;lt;filter-name&amp;gt;CAS Validation Filter&amp;lt;/filter-name&amp;gt;
        &amp;lt;url-pattern&amp;gt;/*&amp;lt;/url-pattern&amp;gt;
    &amp;lt;/filter-mapping&amp;gt;

    &amp;lt;!-- 该过滤器负责实现HttpServletRequest请求的包裹， 比如允许开发者通过HttpServletRequest的getRemoteUser()方法获得SSO登录用户的登录名，可选配置。 --&amp;gt;
    &amp;lt;filter&amp;gt;
        &amp;lt;filter-name&amp;gt;CAS HttpServletRequest Wrapper Filter&amp;lt;/filter-name&amp;gt;
        &amp;lt;filter-class&amp;gt;
            org.jasig.cas.client.util.HttpServletRequestWrapperFilter&amp;lt;/filter-class&amp;gt;
    &amp;lt;/filter&amp;gt;
    &amp;lt;filter-mapping&amp;gt;
        &amp;lt;filter-name&amp;gt;CAS HttpServletRequest Wrapper Filter&amp;lt;/filter-name&amp;gt;
        &amp;lt;url-pattern&amp;gt;/*&amp;lt;/url-pattern&amp;gt;
    &amp;lt;/filter-mapping&amp;gt;

    &amp;lt;!-- 该过滤器使得开发者可以通过org.jasig.cas.client.util.AssertionHolder来获取用户的登录名。 比如AssertionHolder.getAssertion().getPrincipal().getName()。 --&amp;gt;
    &amp;lt;filter&amp;gt;
        &amp;lt;filter-name&amp;gt;CAS Assertion Thread Local Filter&amp;lt;/filter-name&amp;gt;
        &amp;lt;filter-class&amp;gt;org.jasig.cas.client.util.AssertionThreadLocalFilter&amp;lt;/filter-class&amp;gt;
    &amp;lt;/filter&amp;gt;
    &amp;lt;filter-mapping&amp;gt;
        &amp;lt;filter-name&amp;gt;CAS Assertion Thread Local Filter&amp;lt;/filter-name&amp;gt;
        &amp;lt;url-pattern&amp;gt;/*&amp;lt;/url-pattern&amp;gt;
    &amp;lt;/filter-mapping&amp;gt;

&amp;lt;/web-app&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;h4 id=&#34;3-编写indexjsp&#34;&gt;3、编写index.jsp&lt;/h4&gt;
&lt;pre&gt;&lt;code class=&#34;language-jsp&#34;&gt;&amp;lt;%@ page language=&amp;quot;java&amp;quot; contentType=&amp;quot;text/html; charset=utf-8&amp;quot; pageEncoding=&amp;quot;utf-8&amp;quot;%&amp;gt;
&amp;lt;!DOCTYPE html PUBLIC &amp;quot;-//W3C//DTD HTML 4.01 Transitional//EN&amp;quot; &amp;quot;http://www.w3.org/TR/html4/loose.dtd&amp;quot;&amp;gt;
&amp;lt;html&amp;gt;
&amp;lt;head&amp;gt;
    &amp;lt;meta http-equiv=&amp;quot;Content-Type&amp;quot; content=&amp;quot;text/html; charset=utf-8&amp;quot;&amp;gt;
    &amp;lt;title&amp;gt;Hello&amp;lt;/title&amp;gt;
&amp;lt;/head&amp;gt;
&amp;lt;body&amp;gt;
欢迎登陆一：
&amp;lt;%--为获取远程登录名--%&amp;gt;
&amp;lt;%=request.getRemoteUser()%&amp;gt;
&amp;lt;/body&amp;gt;
&amp;lt;/html&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;客户端工程2搭建&#34;&gt;客户端工程2搭建&lt;/h3&gt;
&lt;h4 id=&#34;1-搭建工程&#34;&gt;1、搭建工程&lt;/h4&gt;
&lt;blockquote&gt;
&lt;p&gt;创建Maven工程 （war）casclient_demo2 引入cas客户端依赖并制定tomcat运行端口为9002&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h4 id=&#34;2-修改webxml-2&#34;&gt;2、修改web.xml&lt;/h4&gt;
&lt;blockquote&gt;
&lt;p&gt;创建web.xml，参照casclient_demo1 ,将serverName的值改为http://localhost:9002，一共两处&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h4 id=&#34;3-编写indexjsp-2&#34;&gt;3、编写index.jsp&lt;/h4&gt;
&lt;pre&gt;&lt;code class=&#34;language-jsp&#34;&gt;创建index.jsp  ,内容显示“欢迎登陆二：”
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;单点退出登录&#34;&gt;单点退出登录&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;地址栏输入 &lt;a href=&#34;http://localhost:9000/cas/logout&#34;&gt;http://localhost:9100/cas/logout&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;即可看到退出后的提示页面&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h4 id=&#34;指定退出后跳转地址&#34;&gt;指定退出后跳转地址&lt;/h4&gt;
&lt;p&gt;1、修改cas系统的配置文件cas-servlet.xml（217行）&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-xml&#34;&gt; &amp;lt;bean id=&amp;quot;logoutAction&amp;quot; class=&amp;quot;org.jasig.cas.web.flow.LogoutAction&amp;quot;
        p:servicesManager-ref=&amp;quot;servicesManager&amp;quot;
        p:followServiceRedirects=&amp;quot;${cas.logout.followServiceRedirects:false}&amp;quot;/&amp;gt;
&amp;lt;!-- 把p:followServiceRedirects的false修改为true --&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;2、填入跳转地址&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-html&#34;&gt;&amp;lt;!-- service参数为退出后跳转的地址 --&amp;gt;
&amp;lt;a href=&amp;quot;http://localhost:9100/cas/logout?service=http://www.baidu.com&amp;quot;&amp;gt;退出登录&amp;lt;/a&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;cas服务端数据源设置&#34;&gt;CAS服务端数据源设置&lt;/h2&gt;
&lt;h3 id=&#34;1-配置数据源&#34;&gt;1、配置数据源&lt;/h3&gt;
&lt;p&gt;修改cas服务端中web-inf下deployerConfigContext.xml ，添加如下配置&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-xml&#34;&gt;&amp;lt;!-- 配置数据源c3p0连接池 --&amp;gt;
&amp;lt;bean id=&amp;quot;dataSource&amp;quot; class=&amp;quot;com.mchange.v2.c3p0.ComboPooledDataSource&amp;quot;  
			  p:driverClass=&amp;quot;com.mysql.jdbc.Driver&amp;quot;  
			  p:jdbcUrl=&amp;quot;jdbc:mysql://127.0.0.1:3306/jd?characterEncoding=utf8&amp;quot;  
			  p:user=&amp;quot;root&amp;quot;  
			  p:password=&amp;quot;root&amp;quot; /&amp;gt; 
&amp;lt;!-- 密码加密的方式为 md5,在登陆时先加密密码然后再去数据库比对 --&amp;gt;
&amp;lt;bean id=&amp;quot;passwordEncoder&amp;quot; class=&amp;quot;org.jasig.cas.authentication.handler.DefaultPasswordEncoder&amp;quot;  
		c:encodingAlgorithm=&amp;quot;MD5&amp;quot;  
		p:characterEncoding=&amp;quot;UTF-8&amp;quot; /&amp;gt; 
&amp;lt;!-- 数据校验 --&amp;gt;
&amp;lt;bean id=&amp;quot;dbAuthHandler&amp;quot;  
		  class=&amp;quot;org.jasig.cas.adaptors.jdbc.QueryDatabaseAuthenticationHandler&amp;quot;  
		  p:dataSource-ref=&amp;quot;dataSource&amp;quot;  
		  p:sql=&amp;quot;select password from tb_user where username = ?&amp;quot;  
		  p:passwordEncoder-ref=&amp;quot;passwordEncoder&amp;quot;/&amp;gt;  
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;然后在配置文件开始部分找到如下配置&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-xml&#34;&gt;&amp;lt;bean id=&amp;quot;authenticationManager&amp;quot; class=&amp;quot;org.jasig.cas.authentication.PolicyBasedAuthenticationManager&amp;quot;&amp;gt;
    &amp;lt;constructor-arg&amp;gt;
        &amp;lt;map&amp;gt;               
            &amp;lt;entry key-ref=&amp;quot;proxyAuthenticationHandler&amp;quot; value-ref=&amp;quot;proxyPrincipalResolver&amp;quot; /&amp;gt;
            &amp;lt;entry key-ref=&amp;quot;primaryAuthenticationHandler&amp;quot; value-ref=&amp;quot;primaryPrincipalResolver&amp;quot; /&amp;gt;
        &amp;lt;/map&amp;gt;
    &amp;lt;/constructor-arg&amp;gt;      
    &amp;lt;property name=&amp;quot;authenticationPolicy&amp;quot;&amp;gt;
        &amp;lt;bean class=&amp;quot;org.jasig.cas.authentication.AnyAuthenticationPolicy&amp;quot; /&amp;gt;
    &amp;lt;/property&amp;gt;
&amp;lt;/bean&amp;gt;
&amp;lt;!--
	其中&amp;lt;entry key-ref=&amp;quot;primaryAuthenticationHandler&amp;quot; value-ref=&amp;quot;primaryPrincipalResolver&amp;quot; /&amp;gt;
	一句是使用固定的用户名和密码，我们在下面可以看到这两个bean ,如果我们使用数据库认证用户名和密码，需要将这句注释掉。
	添加下面这一句配置(54行)
	&amp;lt;entry key-ref=&amp;quot;dbAuthHandler&amp;quot; value-ref=&amp;quot;primaryPrincipalResolver&amp;quot;/&amp;gt;
--&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;2-添加jar包&#34;&gt;2、添加jar包&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;将以下三个jar包放入webapps\cas\WEB-INF\lib下&lt;/p&gt;
&lt;p&gt;c3p0-0.9.1.2.jar&lt;/p&gt;
&lt;p&gt;cas-server-support-jdbc-4.0.0.jar&lt;/p&gt;
&lt;p&gt;mysql-connector-java-5.1.32.jar&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&#34;3-测试&#34;&gt;3、测试&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;用数据库中的用户名和密码进行测试&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&#34;修改默认登陆页面&#34;&gt;修改默认登陆页面&lt;/h2&gt;
&lt;h3 id=&#34;1-上传文件&#34;&gt;1、上传文件&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;上传自己的登陆页面到WEB-INF\view\jsp\default\ui\casLoginView.jsp&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&#34;2-编辑casloginviewjsp-内容&#34;&gt;2、&lt;strong&gt;编辑casLoginView.jsp&lt;/strong&gt; 内容&lt;/h3&gt;
&lt;h4 id=&#34;1-添加指令&#34;&gt;1、添加指令&lt;/h4&gt;
&lt;pre&gt;&lt;code class=&#34;language-jsp&#34;&gt;&amp;lt;%@ page pageEncoding=&amp;quot;UTF-8&amp;quot; %&amp;gt;
&amp;lt;%@ page contentType=&amp;quot;text/html; charset=UTF-8&amp;quot; %&amp;gt;
&amp;lt;%@ taglib prefix=&amp;quot;c&amp;quot; uri=&amp;quot;http://java.sun.com/jsp/jstl/core&amp;quot; %&amp;gt;
&amp;lt;%@ taglib prefix=&amp;quot;spring&amp;quot; uri=&amp;quot;http://www.springframework.org/tags&amp;quot; %&amp;gt;
&amp;lt;%@ taglib prefix=&amp;quot;form&amp;quot; uri=&amp;quot;http://www.springframework.org/tags/form&amp;quot; %&amp;gt;
&amp;lt;%@ taglib prefix=&amp;quot;fn&amp;quot; uri=&amp;quot;http://java.sun.com/jsp/jstl/functions&amp;quot; %&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;h4 id=&#34;2-修改form标签&#34;&gt;2、修改form标签&lt;/h4&gt;
&lt;pre&gt;&lt;code class=&#34;language-jsp&#34;&gt;&amp;lt;form:form method=&amp;quot;post&amp;quot; id=&amp;quot;fm1&amp;quot; commandName=&amp;quot;${commandName}&amp;quot; htmlEscape=&amp;quot;true&amp;quot; class=&amp;quot;sui-form&amp;quot;&amp;gt;
......
&amp;lt;/form:form&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;h4 id=&#34;3-修改用户名框&#34;&gt;3、修改用户名框&lt;/h4&gt;
&lt;pre&gt;&lt;code class=&#34;language-jsp&#34;&gt;&amp;lt;form:input id=&amp;quot;username&amp;quot; tabindex=&amp;quot;1&amp;quot; 
	accesskey=&amp;quot;${userNameAccessKey}&amp;quot; path=&amp;quot;username&amp;quot; autocomplete=&amp;quot;off&amp;quot; htmlEscape=&amp;quot;true&amp;quot; 
	placeholder=&amp;quot;邮箱/用户名/手机号&amp;quot; class=&amp;quot;span2 input-xfat&amp;quot; /&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;h4 id=&#34;4-修改密码框&#34;&gt;4、修改密码框&lt;/h4&gt;
&lt;pre&gt;&lt;code class=&#34;language-jsp&#34;&gt;&amp;lt;form:password  id=&amp;quot;password&amp;quot; tabindex=&amp;quot;2&amp;quot; path=&amp;quot;password&amp;quot; 
      accesskey=&amp;quot;${passwordAccessKey}&amp;quot; htmlEscape=&amp;quot;true&amp;quot; autocomplete=&amp;quot;off&amp;quot; 
	  placeholder=&amp;quot;请输入密码&amp;quot; class=&amp;quot;span2 input-xfat&amp;quot;   /&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;h4 id=&#34;5-修改登陆按钮&#34;&gt;5、修改登陆按钮&lt;/h4&gt;
&lt;pre&gt;&lt;code class=&#34;language-jsp&#34;&gt;&amp;lt;input type=&amp;quot;hidden&amp;quot; name=&amp;quot;lt&amp;quot; value=&amp;quot;${loginTicket}&amp;quot; /&amp;gt;
&amp;lt;input type=&amp;quot;hidden&amp;quot; name=&amp;quot;execution&amp;quot; value=&amp;quot;${flowExecutionKey}&amp;quot; /&amp;gt;
&amp;lt;input type=&amp;quot;hidden&amp;quot; name=&amp;quot;_eventId&amp;quot; value=&amp;quot;submit&amp;quot; /&amp;gt;
&amp;lt;input class=&amp;quot;sui-btn btn-block btn-xlarge btn-danger&amp;quot; accesskey=&amp;quot;l&amp;quot; value=&amp;quot;登陆&amp;quot; type=&amp;quot;submit&amp;quot; /&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;3-错误提示&#34;&gt;3、错误提示&lt;/h3&gt;
&lt;p&gt;在表单内加入错误提示框&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-jsp&#34;&gt;&amp;lt;form:errors path=&amp;quot;*&amp;quot; id=&amp;quot;msg&amp;quot; cssClass=&amp;quot;errors&amp;quot; element=&amp;quot;div&amp;quot; htmlEscape=&amp;quot;false&amp;quot; /&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;设置登陆失败中文提示&lt;/p&gt;
&lt;p&gt;修改cas-servlet.xml中的en（61行）&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-xml&#34;&gt;&amp;lt;bean id=&amp;quot;localeResolver&amp;quot; class=&amp;quot;org.springframework.web.servlet.i18n.CookieLocaleResolver&amp;quot; p:defaultLocale=&amp;quot;zh_CN&amp;quot; /&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;将此信息拷贝到WEB-INF\classes\messages_zh_CN.properties下，并改为中文提示（转码）&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-properties&#34;&gt;authenticationFailure.AccountNotFoundException=\u7528\u6237\u4E0D\u5B58\u5728.
authenticationFailure.FailedLoginException=\u5BC6\u7801\u9519\u8BEF.
&lt;/code&gt;&lt;/pre&gt;
&lt;blockquote&gt;
&lt;p&gt;第一个是用户名不存在时的错误提示&lt;/p&gt;
&lt;p&gt;第二个是密码错误的提示&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&#34;cas客户端与springsecurity集成&#34;&gt;CAS客户端与SpringSecurity集成&lt;/h2&gt;
&lt;h3 id=&#34;1-创建工程&#34;&gt;1、创建工程&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;建立Maven项目casclient_demo3 ，引入spring依赖和spring secrity 相关依赖 ，tomcat端口设置为9003&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&#34;2-引入依赖&#34;&gt;2、引入依赖&lt;/h3&gt;
&lt;pre&gt;&lt;code class=&#34;language-xml&#34;&gt;&amp;lt;dependencies&amp;gt;
    &amp;lt;dependency&amp;gt;
        &amp;lt;groupId&amp;gt;org.springframework&amp;lt;/groupId&amp;gt;
        &amp;lt;artifactId&amp;gt;spring-webmvc&amp;lt;/artifactId&amp;gt;
        &amp;lt;version&amp;gt;4.2.4.RELEASE&amp;lt;/version&amp;gt;
    &amp;lt;/dependency&amp;gt;
    &amp;lt;dependency&amp;gt;
        &amp;lt;groupId&amp;gt;com.fasterxml.jackson.core&amp;lt;/groupId&amp;gt;
        &amp;lt;artifactId&amp;gt;jackson-databind&amp;lt;/artifactId&amp;gt;
        &amp;lt;version&amp;gt;2.4.2&amp;lt;/version&amp;gt;
    &amp;lt;/dependency&amp;gt;
    &amp;lt;dependency&amp;gt;
        &amp;lt;groupId&amp;gt;javax.servlet&amp;lt;/groupId&amp;gt;
        &amp;lt;artifactId&amp;gt;servlet-api&amp;lt;/artifactId&amp;gt;
        &amp;lt;version&amp;gt;2.5&amp;lt;/version&amp;gt;
        &amp;lt;scope&amp;gt;provided&amp;lt;/scope&amp;gt;
    &amp;lt;/dependency&amp;gt;
    &amp;lt;!-- 身份验证 --&amp;gt;
    &amp;lt;dependency&amp;gt;
        &amp;lt;groupId&amp;gt;org.springframework.security&amp;lt;/groupId&amp;gt;
        &amp;lt;artifactId&amp;gt;spring-security-web&amp;lt;/artifactId&amp;gt;
        &amp;lt;version&amp;gt;4.1.0.RELEASE&amp;lt;/version&amp;gt;
    &amp;lt;/dependency&amp;gt;
    &amp;lt;dependency&amp;gt;
        &amp;lt;groupId&amp;gt;org.springframework.security&amp;lt;/groupId&amp;gt;
        &amp;lt;artifactId&amp;gt;spring-security-config&amp;lt;/artifactId&amp;gt;
        &amp;lt;version&amp;gt;4.1.0.RELEASE&amp;lt;/version&amp;gt;
    &amp;lt;/dependency&amp;gt;
    &amp;lt;dependency&amp;gt;
        &amp;lt;groupId&amp;gt;com.github.penggle&amp;lt;/groupId&amp;gt;
        &amp;lt;artifactId&amp;gt;kaptcha&amp;lt;/artifactId&amp;gt;
        &amp;lt;version&amp;gt;2.3.2&amp;lt;/version&amp;gt;
        &amp;lt;exclusions&amp;gt;
            &amp;lt;exclusion&amp;gt;
                &amp;lt;groupId&amp;gt;javax.servlet&amp;lt;/groupId&amp;gt;
                &amp;lt;artifactId&amp;gt;javax.servlet-api&amp;lt;/artifactId&amp;gt;
            &amp;lt;/exclusion&amp;gt;
        &amp;lt;/exclusions&amp;gt;
    &amp;lt;/dependency&amp;gt;
    &amp;lt;dependency&amp;gt;
        &amp;lt;groupId&amp;gt;org.springframework.security&amp;lt;/groupId&amp;gt;
        &amp;lt;artifactId&amp;gt;spring-security-cas&amp;lt;/artifactId&amp;gt;
        &amp;lt;version&amp;gt;4.1.0.RELEASE&amp;lt;/version&amp;gt;
    &amp;lt;/dependency&amp;gt;
    &amp;lt;dependency&amp;gt;
        &amp;lt;groupId&amp;gt;org.jasig.cas.client&amp;lt;/groupId&amp;gt;
        &amp;lt;artifactId&amp;gt;cas-client-core&amp;lt;/artifactId&amp;gt;
        &amp;lt;version&amp;gt;3.3.3&amp;lt;/version&amp;gt;
        &amp;lt;!-- 排除log4j包冲突 --&amp;gt;
        &amp;lt;exclusions&amp;gt;
            &amp;lt;exclusion&amp;gt;
                &amp;lt;groupId&amp;gt;org.slf4j&amp;lt;/groupId&amp;gt;
                &amp;lt;artifactId&amp;gt;log4j-over-slf4j&amp;lt;/artifactId&amp;gt;
            &amp;lt;/exclusion&amp;gt;
        &amp;lt;/exclusions&amp;gt;
    &amp;lt;/dependency&amp;gt;
&amp;lt;/dependencies&amp;gt;

&amp;lt;build&amp;gt;
    &amp;lt;plugins&amp;gt;
        &amp;lt;!-- 配置Tomcat插件 --&amp;gt;
        &amp;lt;plugin&amp;gt;
            &amp;lt;groupId&amp;gt;org.apache.tomcat.maven&amp;lt;/groupId&amp;gt;
            &amp;lt;artifactId&amp;gt;tomcat7-maven-plugin&amp;lt;/artifactId&amp;gt;
            &amp;lt;configuration&amp;gt;
                &amp;lt;port&amp;gt;9003&amp;lt;/port&amp;gt;
                &amp;lt;path&amp;gt;/&amp;lt;/path&amp;gt;
                &amp;lt;uriEncoding&amp;gt;utf-8&amp;lt;/uriEncoding&amp;gt;
            &amp;lt;/configuration&amp;gt;
        &amp;lt;/plugin&amp;gt;
    &amp;lt;/plugins&amp;gt;
    &amp;lt;resources&amp;gt;
        &amp;lt;resource&amp;gt;
            &amp;lt;directory&amp;gt;src/main/java&amp;lt;/directory&amp;gt;
            &amp;lt;includes&amp;gt;
                &amp;lt;include&amp;gt;**/*.*&amp;lt;/include&amp;gt;
            &amp;lt;/includes&amp;gt;
        &amp;lt;/resource&amp;gt;
        &amp;lt;resource&amp;gt;
            &amp;lt;directory&amp;gt;src/main/resources&amp;lt;/directory&amp;gt;
            &amp;lt;includes&amp;gt;
                &amp;lt;include&amp;gt;**/*.*&amp;lt;/include&amp;gt;
            &amp;lt;/includes&amp;gt;
        &amp;lt;/resource&amp;gt;
    &amp;lt;/resources&amp;gt;
&amp;lt;/build&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;3-创建spring-mvcxml&#34;&gt;3、创建spring-mvc.xml&lt;/h3&gt;
&lt;pre&gt;&lt;code class=&#34;language-xml&#34;&gt;&amp;lt;?xml version=&amp;quot;1.0&amp;quot; encoding=&amp;quot;UTF-8&amp;quot;?&amp;gt;
&amp;lt;beans xmlns=&amp;quot;http://www.springframework.org/schema/beans&amp;quot;
       xmlns:xsi=&amp;quot;http://www.w3.org/2001/XMLSchema-instance&amp;quot;
       xmlns:context=&amp;quot;http://www.springframework.org/schema/context&amp;quot;
       xmlns:mvc=&amp;quot;http://www.springframework.org/schema/mvc&amp;quot;
       xsi:schemaLocation=&amp;quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
        http://www.springframework.org/schema/mvc http://www.springframework.org/schema/mvc/spring-mvc.xsd
        http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd&amp;quot;&amp;gt;

    &amp;lt;!-- 扫描用@Controller注解的类，并且加载到spring中进行管理 --&amp;gt;
    &amp;lt;context:component-scan base-package=&amp;quot;com.cn.controller&amp;quot;/&amp;gt;
    &amp;lt;!-- 配置注解驱动 --&amp;gt;
    &amp;lt;mvc:annotation-driven&amp;gt;
        &amp;lt;!-- 添加转换器，添加对于对象的支持 --&amp;gt;
        &amp;lt;mvc:message-converters&amp;gt;
            &amp;lt;ref bean=&amp;quot;stringHttpMessageConverter&amp;quot;/&amp;gt;
            &amp;lt;ref bean=&amp;quot;mappingJackson2HttpMessageConverter&amp;quot;/&amp;gt;
        &amp;lt;/mvc:message-converters&amp;gt;
    &amp;lt;/mvc:annotation-driven&amp;gt;

    &amp;lt;bean id=&amp;quot;stringHttpMessageConverter&amp;quot; class=&amp;quot;org.springframework.http.converter.StringHttpMessageConverter&amp;quot;/&amp;gt;
    &amp;lt;!--解决IE浏览器json文件下载和json数据中午乱码的问题--&amp;gt;
    &amp;lt;bean id=&amp;quot;mappingJackson2HttpMessageConverter&amp;quot;
          class=&amp;quot;org.springframework.http.converter.json.MappingJackson2HttpMessageConverter&amp;quot;&amp;gt;
        &amp;lt;property name=&amp;quot;supportedMediaTypes&amp;quot;&amp;gt;
            &amp;lt;list&amp;gt;
                &amp;lt;value&amp;gt;text/html;charset=UTF-8&amp;lt;/value&amp;gt;
            &amp;lt;/list&amp;gt;
        &amp;lt;/property&amp;gt;
    &amp;lt;/bean&amp;gt;
    &amp;lt;mvc:default-servlet-handler/&amp;gt;
    &amp;lt;!-- jackson --&amp;gt;
    &amp;lt;mvc:annotation-driven&amp;gt;
        &amp;lt;mvc:message-converters&amp;gt;
            &amp;lt;bean class=&amp;quot;org.springframework.http.converter.StringHttpMessageConverter&amp;quot;/&amp;gt;
            &amp;lt;bean class=&amp;quot;org.springframework.http.converter.json.MappingJackson2HttpMessageConverter&amp;quot;/&amp;gt;
        &amp;lt;/mvc:message-converters&amp;gt;
    &amp;lt;/mvc:annotation-driven&amp;gt;

&amp;lt;/beans&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;4-创建spring-securityxml&#34;&gt;4、创建spring-security.xml&lt;/h3&gt;
&lt;pre&gt;&lt;code class=&#34;language-xml&#34;&gt;&amp;lt;?xml version=&amp;quot;1.0&amp;quot; encoding=&amp;quot;UTF-8&amp;quot;?&amp;gt;
&amp;lt;beans:beans xmlns=&amp;quot;http://www.springframework.org/schema/security&amp;quot;
             xmlns:beans=&amp;quot;http://www.springframework.org/schema/beans&amp;quot;
             xmlns:xsi=&amp;quot;http://www.w3.org/2001/XMLSchema-instance&amp;quot;
             xsi:schemaLocation=&amp;quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
						http://www.springframework.org/schema/security http://www.springframework.org/schema/security/spring-security.xsd&amp;quot;&amp;gt;

    &amp;lt;!--   entry-point-ref  入口点引用 --&amp;gt;
    &amp;lt;http use-expressions=&amp;quot;false&amp;quot; entry-point-ref=&amp;quot;casProcessingFilterEntryPoint&amp;quot;&amp;gt;
        &amp;lt;intercept-url pattern=&amp;quot;/**&amp;quot; access=&amp;quot;ROLE_USER&amp;quot;/&amp;gt;
        &amp;lt;csrf disabled=&amp;quot;true&amp;quot;/&amp;gt;
        &amp;lt;!-- custom-filter为过滤器， position 表示将过滤器放在指定的位置上(参照位置表)，before表示放在指定位置之前  ，after表示放在指定的位置之后  --&amp;gt;
        &amp;lt;custom-filter ref=&amp;quot;casAuthenticationFilter&amp;quot; position=&amp;quot;CAS_FILTER&amp;quot;/&amp;gt;
        &amp;lt;custom-filter ref=&amp;quot;requestSingleLogoutFilter&amp;quot; before=&amp;quot;LOGOUT_FILTER&amp;quot;/&amp;gt;
        &amp;lt;custom-filter ref=&amp;quot;singleLogoutFilter&amp;quot; before=&amp;quot;CAS_FILTER&amp;quot;/&amp;gt;
    &amp;lt;/http&amp;gt;

    &amp;lt;!-- CAS入口点 开始 --&amp;gt;
    &amp;lt;beans:bean id=&amp;quot;casProcessingFilterEntryPoint&amp;quot;
                class=&amp;quot;org.springframework.security.cas.web.CasAuthenticationEntryPoint&amp;quot;&amp;gt;
        &amp;lt;!-- 单点登录服务器登录URL --&amp;gt;
        &amp;lt;beans:property name=&amp;quot;loginUrl&amp;quot; value=&amp;quot;http://localhost:9100/cas/login&amp;quot;/&amp;gt;
        &amp;lt;beans:property name=&amp;quot;serviceProperties&amp;quot; ref=&amp;quot;serviceProperties&amp;quot;/&amp;gt;
    &amp;lt;/beans:bean&amp;gt;
    &amp;lt;beans:bean id=&amp;quot;serviceProperties&amp;quot; class=&amp;quot;org.springframework.security.cas.ServiceProperties&amp;quot;&amp;gt;
        &amp;lt;!--service 配置自身工程的根地址+/login/cas   --&amp;gt;
        &amp;lt;beans:property name=&amp;quot;service&amp;quot; value=&amp;quot;http://localhost:9003/login/cas&amp;quot;/&amp;gt;
    &amp;lt;/beans:bean&amp;gt;
    &amp;lt;!-- CAS入口点 结束 --&amp;gt;

    &amp;lt;!-- 认证过滤器 开始 --&amp;gt;
    &amp;lt;beans:bean id=&amp;quot;casAuthenticationFilter&amp;quot; class=&amp;quot;org.springframework.security.cas.web.CasAuthenticationFilter&amp;quot;&amp;gt;
        &amp;lt;beans:property name=&amp;quot;authenticationManager&amp;quot; ref=&amp;quot;authenticationManager&amp;quot;/&amp;gt;
    &amp;lt;/beans:bean&amp;gt;
    &amp;lt;!-- 认证管理器 --&amp;gt;
    &amp;lt;authentication-manager alias=&amp;quot;authenticationManager&amp;quot;&amp;gt;
        &amp;lt;authentication-provider ref=&amp;quot;casAuthenticationProvider&amp;quot;&amp;gt;
        &amp;lt;/authentication-provider&amp;gt;
    &amp;lt;/authentication-manager&amp;gt;
    &amp;lt;!-- 认证提供者 --&amp;gt;
    &amp;lt;beans:bean id=&amp;quot;casAuthenticationProvider&amp;quot;
                class=&amp;quot;org.springframework.security.cas.authentication.CasAuthenticationProvider&amp;quot;&amp;gt;
        &amp;lt;beans:property name=&amp;quot;authenticationUserDetailsService&amp;quot;&amp;gt;
            &amp;lt;beans:bean class=&amp;quot;org.springframework.security.core.userdetails.UserDetailsByNameServiceWrapper&amp;quot;&amp;gt;
                &amp;lt;beans:constructor-arg ref=&amp;quot;userDetailsService&amp;quot;/&amp;gt;
            &amp;lt;/beans:bean&amp;gt;
        &amp;lt;/beans:property&amp;gt;
        &amp;lt;beans:property name=&amp;quot;serviceProperties&amp;quot; ref=&amp;quot;serviceProperties&amp;quot;/&amp;gt;
        &amp;lt;!-- ticketValidator 为票据验证器 --&amp;gt;
        &amp;lt;beans:property name=&amp;quot;ticketValidator&amp;quot;&amp;gt;
            &amp;lt;beans:bean class=&amp;quot;org.jasig.cas.client.validation.Cas20ServiceTicketValidator&amp;quot;&amp;gt;
                &amp;lt;beans:constructor-arg index=&amp;quot;0&amp;quot; value=&amp;quot;http://localhost:9100/cas&amp;quot;/&amp;gt;
            &amp;lt;/beans:bean&amp;gt;
        &amp;lt;/beans:property&amp;gt;
        &amp;lt;beans:property name=&amp;quot;key&amp;quot; value=&amp;quot;an_id_for_this_auth_provider_only&amp;quot;/&amp;gt;
    &amp;lt;/beans:bean&amp;gt;
    &amp;lt;!-- 认证类 --&amp;gt;
    &amp;lt;beans:bean id=&amp;quot;userDetailsService&amp;quot; class=&amp;quot;com.cn.service.impl.UserDetailServiceImpl&amp;quot;/&amp;gt;

    &amp;lt;!-- 认证过滤器 结束 --&amp;gt;
    &amp;lt;!-- 单点登出  开始  --&amp;gt;
    &amp;lt;beans:bean id=&amp;quot;singleLogoutFilter&amp;quot; class=&amp;quot;org.jasig.cas.client.session.SingleSignOutFilter&amp;quot;/&amp;gt;
    &amp;lt;beans:bean id=&amp;quot;requestSingleLogoutFilter&amp;quot;
                class=&amp;quot;org.springframework.security.web.authentication.logout.LogoutFilter&amp;quot;&amp;gt;
        &amp;lt;beans:constructor-arg value=&amp;quot;http://localhost:9100/cas/logout?service=http://www.baidu.com&amp;quot;/&amp;gt;
        &amp;lt;beans:constructor-arg&amp;gt;
            &amp;lt;beans:bean class=&amp;quot;org.springframework.security.web.authentication.logout.SecurityContextLogoutHandler&amp;quot;/&amp;gt;
        &amp;lt;/beans:constructor-arg&amp;gt;
        &amp;lt;beans:property name=&amp;quot;filterProcessesUrl&amp;quot; value=&amp;quot;/logout/cas&amp;quot;/&amp;gt;
    &amp;lt;/beans:bean&amp;gt;
    &amp;lt;!-- 单点登出  结束 --&amp;gt;

&amp;lt;/beans:beans&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;5-创建认证类&#34;&gt;5、创建认证类&lt;/h3&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;public class UserDetailServiceImpl implements UserDetailsService {

    @Override
    public UserDetails loadUserByUsername(String username) throws UsernameNotFoundException {
        //构建角色集合
        List&amp;lt;GrantedAuthority&amp;gt; authorities=new ArrayList();
        authorities.add(new SimpleGrantedAuthority(&amp;quot;ROLE_USER&amp;quot;));
        return new User(username, &amp;quot;&amp;quot;  , authorities);
    }

}
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;6-修改webxml-添加过滤器等配置&#34;&gt;6、修改web.xml ,添加过滤器等配置&lt;/h3&gt;
&lt;pre&gt;&lt;code class=&#34;language-xml&#34;&gt;&amp;lt;?xml version=&amp;quot;1.0&amp;quot; encoding=&amp;quot;UTF-8&amp;quot;?&amp;gt;
&amp;lt;web-app xmlns=&amp;quot;http://xmlns.jcp.org/xml/ns/javaee&amp;quot;
         xmlns:xsi=&amp;quot;http://www.w3.org/2001/XMLSchema-instance&amp;quot;
         xsi:schemaLocation=&amp;quot;http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_4_0.xsd&amp;quot;
         version=&amp;quot;4.0&amp;quot;&amp;gt;
    &amp;lt;context-param&amp;gt;
        &amp;lt;param-name&amp;gt;contextConfigLocation&amp;lt;/param-name&amp;gt;
        &amp;lt;param-value&amp;gt;classpath:spring-security.xml&amp;lt;/param-value&amp;gt;
    &amp;lt;/context-param&amp;gt;
    &amp;lt;listener&amp;gt;
        &amp;lt;listener-class&amp;gt;
            org.springframework.web.context.ContextLoaderListener
        &amp;lt;/listener-class&amp;gt;
    &amp;lt;/listener&amp;gt;
    &amp;lt;filter&amp;gt;
        &amp;lt;filter-name&amp;gt;springSecurityFilterChain&amp;lt;/filter-name&amp;gt;
        &amp;lt;filter-class&amp;gt;org.springframework.web.filter.DelegatingFilterProxy&amp;lt;/filter-class&amp;gt;
    &amp;lt;/filter&amp;gt;
    &amp;lt;filter-mapping&amp;gt;
        &amp;lt;filter-name&amp;gt;springSecurityFilterChain&amp;lt;/filter-name&amp;gt;
        &amp;lt;url-pattern&amp;gt;/*&amp;lt;/url-pattern&amp;gt;
    &amp;lt;/filter-mapping&amp;gt;
&amp;lt;!--------------------------------------------------------------------------------&amp;gt;
    &amp;lt;!-- 解决post乱码 --&amp;gt;
    &amp;lt;filter&amp;gt;
        &amp;lt;filter-name&amp;gt;CharacterEncodingFilter&amp;lt;/filter-name&amp;gt;
        &amp;lt;filter-class&amp;gt;org.springframework.web.filter.CharacterEncodingFilter&amp;lt;/filter-class&amp;gt;
        &amp;lt;init-param&amp;gt;
            &amp;lt;param-name&amp;gt;encoding&amp;lt;/param-name&amp;gt;
            &amp;lt;param-value&amp;gt;utf-8&amp;lt;/param-value&amp;gt;
        &amp;lt;/init-param&amp;gt;
        &amp;lt;init-param&amp;gt;
            &amp;lt;param-name&amp;gt;forceEncoding&amp;lt;/param-name&amp;gt;
            &amp;lt;param-value&amp;gt;true&amp;lt;/param-value&amp;gt;
        &amp;lt;/init-param&amp;gt;
    &amp;lt;/filter&amp;gt;
    &amp;lt;filter-mapping&amp;gt;
        &amp;lt;filter-name&amp;gt;CharacterEncodingFilter&amp;lt;/filter-name&amp;gt;
        &amp;lt;url-pattern&amp;gt;/*&amp;lt;/url-pattern&amp;gt;
    &amp;lt;/filter-mapping&amp;gt;

    &amp;lt;servlet&amp;gt;
        &amp;lt;servlet-name&amp;gt;springmvc&amp;lt;/servlet-name&amp;gt;
        &amp;lt;servlet-class&amp;gt;org.springframework.web.servlet.DispatcherServlet&amp;lt;/servlet-class&amp;gt;
        &amp;lt;!-- 指定加载的配置文件 ，通过参数contextConfigLocation加载--&amp;gt;
        &amp;lt;init-param&amp;gt;
            &amp;lt;param-name&amp;gt;contextConfigLocation&amp;lt;/param-name&amp;gt;
            &amp;lt;param-value&amp;gt;classpath:spring-mvc.xml&amp;lt;/param-value&amp;gt;
        &amp;lt;/init-param&amp;gt;
        &amp;lt;load-on-startup&amp;gt;1&amp;lt;/load-on-startup&amp;gt;
    &amp;lt;/servlet&amp;gt;

    &amp;lt;servlet-mapping&amp;gt;
        &amp;lt;servlet-name&amp;gt;springmvc&amp;lt;/servlet-name&amp;gt;
        &amp;lt;url-pattern&amp;gt;/&amp;lt;/url-pattern&amp;gt;
    &amp;lt;/servlet-mapping&amp;gt;
&amp;lt;/web-app&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;7-创建usercontroller&#34;&gt;7、创建UserController&lt;/h3&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;@RestController
public class UserController {

    @RequestMapping(&amp;quot;/findLoginUser&amp;quot;)
    public void  findLoginUser(){
        String name = SecurityContextHolder.getContext().getAuthentication().getName();
        System.out.println(name);
    }
}
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;8-退出登陆&#34;&gt;8、退出登陆&lt;/h3&gt;
&lt;p&gt;修改spring-security.xml&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;http://localhost:9100/cas/logout?service=http://www.baidu.com&lt;/p&gt;
&lt;p&gt;service 等于登出后跳转的地址&lt;/p&gt;
&lt;/blockquote&gt;
&lt;pre&gt;&lt;code class=&#34;language-xml&#34;&gt;&amp;lt;!-- 单点登出  开始  --&amp;gt;
&amp;lt;beans:bean id=&amp;quot;singleLogoutFilter&amp;quot; class=&amp;quot;org.jasig.cas.client.session.SingleSignOutFilter&amp;quot;/&amp;gt;
&amp;lt;beans:bean id=&amp;quot;requestSingleLogoutFilter&amp;quot;
            class=&amp;quot;org.springframework.security.web.authentication.logout.LogoutFilter&amp;quot;&amp;gt;
    &amp;lt;beans:constructor-arg value=&amp;quot;http://localhost:9100/cas/logout?service=http://www.baidu.com&amp;quot;/&amp;gt;
    &amp;lt;beans:constructor-arg&amp;gt;
        &amp;lt;beans:bean class=&amp;quot;org.springframework.security.web.authentication.logout.SecurityContextLogoutHandler&amp;quot;/&amp;gt;
    &amp;lt;/beans:constructor-arg&amp;gt;
    &amp;lt;beans:property name=&amp;quot;filterProcessesUrl&amp;quot; value=&amp;quot;/logout/cas&amp;quot;/&amp;gt;
&amp;lt;/beans:bean&amp;gt;
&amp;lt;!-- 单点登出  结束 --&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;在页面上添加&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-html&#34;&gt;&amp;lt;a href=&amp;quot;/logout/cas&amp;quot;&amp;gt;退出登录&amp;lt;/a&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
">单点登陆-CAS</a>
      </div>
      
      <div class="item">
        <a class="result-title" href="https://haohanya.github.io/post/redis/"" data-c="
          &lt;h2 id=&#34;redis安装&#34;&gt;redis安装&lt;/h2&gt;
&lt;p&gt;安装gcc&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;yum install gcc-c++
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;解压源码&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;tar -zxvf redis-3.0.0.tar.gz
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;进入解压后的目录进行编译&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;cd /usr/local/redis-3.0.0
make PREFIX=/usr/local/redis install
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;拷贝配置文件到安装目录下&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;cd /usr/local/redis
mkdir conf
cp /usr/local/redis-3.0.0/redis.conf  /usr/local/redis/bin
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;运行&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;bin/redis-server
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;后端模式运行&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;修改redis.conf文件 : daemonize yes
./bin/redis-server redis.conf
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;springdataredis简介&#34;&gt;SpringDataRedis简介&lt;/h2&gt;
&lt;h3 id=&#34;redis&#34;&gt;Redis&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;redis&lt;/strong&gt;是一款开源的Key-Value&lt;strong&gt;数据库&lt;/strong&gt;，运行在内存中，由ANSI C编写。企业开发通常采用Redis来实现缓存。同类的产品还有memcache 、MongoDB等。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&#34;jedis&#34;&gt;Jedis&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;Jedis是Redis官方推出的一款面向&lt;strong&gt;Java&lt;/strong&gt;的客户端，提供了很多接口供Java语言调用。可以在Redis官网下载，当然还有一些开源爱好者提供的客户端，如Jredis、SRP等等，推荐使用Jedis。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&#34;spring-data-redis&#34;&gt;Spring Data Redis&lt;/h2&gt;
&lt;blockquote&gt;
&lt;p&gt;Spring-data-redis是spring大家族的一部分，提供了在srping应用中通过简单的配置访问redis服务，对reids底层开发包(Jedis,  JRedis, and RJC)进行了高度封装，RedisTemplate提供了redis各种操作、异常处理及序列化，支持发布订阅，并对spring 3.1 cache进行了实现。&lt;/p&gt;
&lt;p&gt;spring-data-redis针对jedis提供了如下功能：&lt;br&gt;
1、连接池自动管理，提供了一个高度封装的“RedisTemplate”类&lt;/p&gt;
&lt;p&gt;​	2、针对jedis客户端中大量api进行了归类封装,将同一类型操作封装为operation接口&lt;/p&gt;
&lt;p&gt;​     ValueOperations：简单K-V操作&lt;/p&gt;
&lt;p&gt;​     SetOperations：set类型数据操作&lt;/p&gt;
&lt;p&gt;​     ZSetOperations：zset类型数据操作&lt;/p&gt;
&lt;p&gt;​     HashOperations：针对map类型的数据操作&lt;/p&gt;
&lt;p&gt;​     ListOperations：针对list类型的数据操作&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&#34;spring-data-redis入门小demo&#34;&gt;Spring Data Redis入门小Demo&lt;/h2&gt;
&lt;p&gt;1、引入依赖&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-xml&#34;&gt;&amp;lt;!-- 缓存 --&amp;gt;
&amp;lt;dependency&amp;gt; 
    &amp;lt;groupId&amp;gt;redis.clients&amp;lt;/groupId&amp;gt; 
    &amp;lt;artifactId&amp;gt;jedis&amp;lt;/artifactId&amp;gt; 
    &amp;lt;version&amp;gt;2.8.1&amp;lt;/version&amp;gt; 
&amp;lt;/dependency&amp;gt; 
&amp;lt;dependency&amp;gt; 
    &amp;lt;groupId&amp;gt;org.springframework.data&amp;lt;/groupId&amp;gt; 
    &amp;lt;artifactId&amp;gt;spring-data-redis&amp;lt;/artifactId&amp;gt; 
    &amp;lt;version&amp;gt;1.7.2.RELEASE&amp;lt;/version&amp;gt; 
&amp;lt;/dependency&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;2、创建redis-config.properties&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-properties&#34;&gt;redis.host=127.0.0.1 
redis.port=6379 
redis.pass= 
redis.database=0 
redis.maxIdle=300 
redis.maxWait=3000 
redis.testOnBorrow=true 
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;3、编写redis配置文件&lt;/p&gt;
&lt;p&gt;applicationContext-redis.xml&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-xml&#34;&gt;&amp;lt;context:property-placeholder location=&amp;quot;classpath*:properties/*.properties&amp;quot; /&amp;gt;   
&amp;lt;!-- redis 相关配置 --&amp;gt; 
&amp;lt;bean id=&amp;quot;poolConfig&amp;quot; class=&amp;quot;redis.clients.jedis.JedisPoolConfig&amp;quot;&amp;gt;  
 &amp;lt;property name=&amp;quot;maxIdle&amp;quot; value=&amp;quot;${redis.maxIdle}&amp;quot; /&amp;gt;   
 &amp;lt;property name=&amp;quot;maxWaitMillis&amp;quot; value=&amp;quot;${redis.maxWait}&amp;quot; /&amp;gt;  
 &amp;lt;property name=&amp;quot;testOnBorrow&amp;quot; value=&amp;quot;${redis.testOnBorrow}&amp;quot; /&amp;gt;  
&amp;lt;/bean&amp;gt;  
&amp;lt;bean id=&amp;quot;JedisConnectionFactory&amp;quot; class=&amp;quot;org.springframework.data.redis.connection.jedis.JedisConnectionFactory&amp;quot; 
   p:host-name=&amp;quot;${redis.host}&amp;quot; p:port=&amp;quot;${redis.port}&amp;quot; p:password=&amp;quot;${redis.pass}&amp;quot; p:pool-config-ref=&amp;quot;poolConfig&amp;quot;/&amp;gt;  

&amp;lt;bean id=&amp;quot;redisTemplate&amp;quot; class=&amp;quot;org.springframework.data.redis.core.RedisTemplate&amp;quot;&amp;gt;  
 &amp;lt;property name=&amp;quot;connectionFactory&amp;quot; ref=&amp;quot;JedisConnectionFactory&amp;quot; /&amp;gt;  
&amp;lt;/bean&amp;gt;  
&lt;/code&gt;&lt;/pre&gt;
&lt;blockquote&gt;
&lt;p&gt;maxIdle ：最大空闲数&lt;/p&gt;
&lt;p&gt;maxWaitMillis:连接时的最大等待毫秒数&lt;/p&gt;
&lt;p&gt;testOnBorrow：在提取一个jedis实例时，是否提前进行验证操作；如果为true，则得到的jedis实例均是可用的；&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;4、值类型操作&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;@RunWith(SpringJUnit4ClassRunner.class)
@ContextConfiguration(locations=&amp;quot;classpath:spring/applicationContext-redis.xml&amp;quot;)
public class TestValue {
	@Autowired
	private RedisTemplate redisTemplate;	
	@Test
	public void setValue(){
		redisTemplate.boundValueOps(&amp;quot;name&amp;quot;).set(&amp;quot;zhangsan&amp;quot;);		
	}	
	@Test
	public void getValue(){
		String str = (String) redisTemplate.boundValueOps(&amp;quot;name&amp;quot;).get();
		System.out.println(str);
	}	
	@Test
	public void deleteValue(){
		redisTemplate.delete(&amp;quot;name&amp;quot;);;
	}	
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;5、Set类型操作&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;@RunWith(SpringJUnit4ClassRunner.class)
@ContextConfiguration(locations=&amp;quot;classpath:spring/applicationContext-redis.xml&amp;quot;)
public class TestSet {
	@Autowired
	private RedisTemplate redisTemplate;
	/**
	 * 存入值
	 */
	@Test
	public void setValue(){
		redisTemplate.boundSetOps(&amp;quot;nameset&amp;quot;).add(&amp;quot;罗志祥&amp;quot;);		
		redisTemplate.boundSetOps(&amp;quot;nameset&amp;quot;).add(&amp;quot;周扬青&amp;quot;);	
		redisTemplate.boundSetOps(&amp;quot;nameset&amp;quot;).add(&amp;quot;蝴蝶姐&amp;quot;);
	}
	/**
	 * 提取值
	 */
	@Test
	public void getValue(){
		Set members = redisTemplate.boundSetOps(&amp;quot;nameset&amp;quot;).members();
		System.out.println(members);
	}
    /**
	 * 删除集合中的某一个值
	 */
	@Test
	public void deleteValue(){
		redisTemplate.boundSetOps(&amp;quot;nameset&amp;quot;).remove(&amp;quot;蝴蝶姐&amp;quot;);
	}
	
	/**
	 * 删除整个集合
	 */
	@Test
	public void deleteAllValue(){
		redisTemplate.delete(&amp;quot;nameset&amp;quot;);
	}
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;6、List类型操作&lt;/p&gt;
&lt;p&gt;6.1、右压栈&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;/**
 * 右压栈：后添加的对象排在后边
 */
@Test
public void testSetValue1(){		
    redisTemplate.boundListOps(&amp;quot;namelist1&amp;quot;).rightPush(&amp;quot;刘备&amp;quot;);
    redisTemplate.boundListOps(&amp;quot;namelist1&amp;quot;).rightPush(&amp;quot;关羽&amp;quot;);
    redisTemplate.boundListOps(&amp;quot;namelist1&amp;quot;).rightPush(&amp;quot;张飞&amp;quot;);		
}
/**
 * 显示右压栈集合
 */
@Test
public void testGetValue1(){
    List list = redisTemplate.boundListOps(&amp;quot;namelist1&amp;quot;).range(0, 10);
    System.out.println(list);
}
//运行结果：[刘备, 关羽, 张飞]
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;6.2、左压栈&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;/**
 * 左压栈：后添加的对象排在前边
 */
@Test
public void testSetValue2(){		
    redisTemplate.boundListOps(&amp;quot;namelist2&amp;quot;).leftPush(&amp;quot;刘备&amp;quot;);
    redisTemplate.boundListOps(&amp;quot;namelist2&amp;quot;).leftPush(&amp;quot;关羽&amp;quot;);
    redisTemplate.boundListOps(&amp;quot;namelist2&amp;quot;).leftPush(&amp;quot;张飞&amp;quot;);		
}
/**
 * 显示左压栈集合
 */
@Test
public void testGetValue2(){
    List list = redisTemplate.boundListOps(&amp;quot;namelist2&amp;quot;).range(0, 10);
    System.out.println(list);
}
//运行结果：[张飞, 关羽, 刘备]
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;6.3、根据索引查询元素&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;/**
 * 查询集合某个元素
 */
@Test
public void testSearchByIndex(){
    String s = (String) redisTemplate.boundListOps(&amp;quot;namelist1&amp;quot;).index(1);
    System.out.println(s);
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;6.4、移除某个元素的值&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;/**
 * 移除集合某个元素
 */
@Test
public void testRemoveByIndex(){
    redisTemplate.boundListOps(&amp;quot;namelist1&amp;quot;).remove(1, &amp;quot;关羽&amp;quot;);
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;7、Hash类型操作&lt;/p&gt;
&lt;p&gt;7.1、存入值&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;@Test
public void testSetValue(){
    redisTemplate.boundHashOps(&amp;quot;namehash&amp;quot;).put(&amp;quot;a&amp;quot;, &amp;quot;唐僧&amp;quot;);
    redisTemplate.boundHashOps(&amp;quot;namehash&amp;quot;).put(&amp;quot;b&amp;quot;, &amp;quot;悟空&amp;quot;);
    redisTemplate.boundHashOps(&amp;quot;namehash&amp;quot;).put(&amp;quot;c&amp;quot;, &amp;quot;八戒&amp;quot;);
    redisTemplate.boundHashOps(&amp;quot;namehash&amp;quot;).put(&amp;quot;d&amp;quot;, &amp;quot;沙僧&amp;quot;);
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;7.2、提取所有的KEY&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;@Test
public void testGetKeys(){
    Set s = redisTemplate.boundHashOps(&amp;quot;namehash&amp;quot;).keys();		
    System.out.println(s);		
}
//运行结果：[a, b, c, d]
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;7.3、提取所有的值&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;@Test
public void testGetValues(){
    List values = redisTemplate.boundHashOps(&amp;quot;namehash&amp;quot;).values();
    System.out.println(values);		
}
//运行结果：[唐僧, 悟空, 八戒, 沙僧]
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;7.4、根据KEY提取值&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;@Test
public void testGetValueByKey(){
    Object object = redisTemplate.boundHashOps(&amp;quot;namehash&amp;quot;).get(&amp;quot;b&amp;quot;);
    System.out.println(object);
}
//运行结果：悟空
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;7.5、根据KEY移除值&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;@Test
public void testRemoveValueByKey(){
    redisTemplate.boundHashOps(&amp;quot;namehash&amp;quot;).delete(&amp;quot;c&amp;quot;);
}
//运行结果：[唐僧, 悟空, 沙僧]
&lt;/code&gt;&lt;/pre&gt;
">Redis</a>
      </div>
      
      <div class="item">
        <a class="result-title" href="https://haohanya.github.io/post/activemq/"" data-c="
          &lt;h2 id=&#34;什么是jms&#34;&gt;什么是jms&lt;/h2&gt;
&lt;blockquote&gt;
&lt;p&gt;JMS（java Messaging Service）是Java平台上有关面向消息中间件的技术规范，它便于消息系统中的Java应用程序进行消息交换,并且通过提供标准的产生、发送、接收消息的接口简化企业应用的开发。&lt;/p&gt;
&lt;p&gt;​    JMS本身只定义了一系列的接口规范，是一种与厂商无关的 API，用来访问消息收发系统。它类似于 JDBC(java Database Connectivity)：这里，JDBC 是可以用来访问许多不同关系数据库的 API，而 JMS 则提供同样与厂商无关的访问方法，以访问消息收发服务。许多厂商目前都支持 JMS，包括 IBM 的 MQSeries、BEA的 Weblogic JMS service和 Progress 的 SonicMQ，这只是几个例子。 JMS 使您能够通过消息收发服务（有时称为消息中介程序或路由器）从一个 JMS 客户机向另一个 JML 客户机发送消息。消息是 JMS 中的一种类型对象，由两部分组成：报头和消息主体。报头由路由信息以及有关该消息的元数据组成。消息主体则携带着应用程序的数据或有效负载。&lt;/p&gt;
&lt;p&gt;JMS 定义了五种不同的消息正文格式，以及调用的消息类型，允许你发送并接收以一&lt;/p&gt;
&lt;p&gt;些不同形式的数据，提供现有消息格式的一些级别的兼容性。&lt;/p&gt;
&lt;p&gt;TextMessage--一个字符串对象（应用最广泛的一种）&lt;/p&gt;
&lt;p&gt;MapMessage--一套名称-值对&lt;/p&gt;
&lt;p&gt;ObjectMessage--一个序列化的 Java 对象&lt;/p&gt;
&lt;p&gt;BytesMessage--一个字节的数据流&lt;/p&gt;
&lt;p&gt;StreamMessage -- Java 原始值的数据流&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&#34;jms消息传递类型&#34;&gt;JMS消息传递类型&lt;/h2&gt;
&lt;p&gt;对于消息的传递有两种类型：&lt;br&gt;
一种是点对点的，即一个生产者和一个消费者一一对应；&lt;br&gt;
&lt;img src=&#34;https://haohanya.github.io/post-images/1589686388156.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
另一种是发布/ 订阅模式，即一个生产者产生消息并进行发送后，可以由多个消费者进&lt;br&gt;
行接收。&lt;br&gt;
&lt;img src=&#34;https://haohanya.github.io/post-images/1589686418709.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/p&gt;
&lt;h2 id=&#34;安装&#34;&gt;安装&lt;/h2&gt;
&lt;p&gt;1、上传activeMQ到服务器&lt;/p&gt;
&lt;p&gt;2、解压 &lt;code&gt;tar -zxvf apache-activemq-5.12.0-bin.tar.gz&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;3、移动文件 &lt;code&gt;mv apache-activemq-5.12.0 /usr/local/java/activemq-5.12.0&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;4、进入bin &lt;code&gt;cd /usr/local/java/activemq-5.12.0/bin&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;5、启动activeMQ &lt;code&gt;./activemq start&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;6、访问：&lt;code&gt;ip:8161&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;账号：admin&lt;/p&gt;
&lt;p&gt;密码：admin&lt;/p&gt;
&lt;h2 id=&#34;jms测试&#34;&gt;JMS测试&lt;/h2&gt;
&lt;h3 id=&#34;点对点模式&#34;&gt;点对点模式&lt;/h3&gt;
&lt;p&gt;1、引入依赖&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-xml&#34;&gt; &amp;lt;dependencies&amp;gt;
    &amp;lt;dependency&amp;gt;
        &amp;lt;groupId&amp;gt;org.apache.activemq&amp;lt;/groupId&amp;gt;
        &amp;lt;artifactId&amp;gt;activemq-client&amp;lt;/artifactId&amp;gt;
        &amp;lt;version&amp;gt;5.13.4&amp;lt;/version&amp;gt;
    &amp;lt;/dependency&amp;gt;
&amp;lt;/dependencies&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;2、创建消息生产者QueueProducer&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;public static void main(String[] args) throws JMSException {
    //1、创建工厂
    ConnectionFactory connectionFactory  = new ActiveMQConnectionFactory(&amp;quot;tcp://192.168.25.135:61616&amp;quot;);
    //2、获取连接
    Connection connection = connectionFactory.createConnection();
    //3、启动连接
    connection.start();
    /** 4、获取session  
    	参数1：是否启用事务 
    	参数2：消息确认模式
            AUTO_ACKNOWLEDGE = 1    自动确认
            CLIENT_ACKNOWLEDGE = 2    客户端手动确认   
            DUPS_OK_ACKNOWLEDGE = 3    自动批量确认
            SESSION_TRANSACTED = 0    事务提交并确认
	*/
    Session session = connection.createSession(false, Session.AUTO_ACKNOWLEDGE);
    //5、创建队列对象
    Queue queue = session.createQueue(&amp;quot;test-queue&amp;quot;);
    //6、创建消息生产着
    MessageProducer messageProducer = session.createProducer(queue);
    //7、创建消息
    TextMessage textMessage = session.createTextMessage(&amp;quot;测试文本内容&amp;quot;);
    //8、发送消息
    messageProducer.send(textMessage);
    //9、关闭资源
    messageProducer.close();
    session.close();
    connection.close();
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;3、创建消息消费者QueueConsumer&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;public static void main(String[] args) throws JMSException, IOException {
    //1、创建连接工厂
    ConnectionFactory connectionFactory = new ActiveMQConnectionFactory(&amp;quot;tcp://192.168.25.135:61616&amp;quot;);
    //2、获取连接
    Connection connection = connectionFactory.createConnection();
    //3、启动连接
    connection.start();
    //4、获取session
    Session session = connection.createSession(false, Session.AUTO_ACKNOWLEDGE);
    //5、创建队列对象
    Queue queue = session.createQueue(&amp;quot;test-queue&amp;quot;);
    //6、创建消息消费
    MessageConsumer consumer = session.createConsumer(queue);
    //7、监听消息
    consumer.setMessageListener(new MessageListener() {
        @Override
        public void onMessage(Message message) {
            TextMessage textMessage = (TextMessage) message;
            try {
                System.out.println(&amp;quot;接收消息为：&amp;quot;+textMessage.getText());
            } catch (JMSException e) {
                e.printStackTrace();
            }
        }
    });
    //8、等待键盘输入
    System.in.read();
    //9、关闭资源
    consumer.close();
    session.close();
    connection.close();
}
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;发布订阅模式&#34;&gt;发布/订阅模式&lt;/h3&gt;
&lt;p&gt;1、消息生产者TopicProducer&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;public static void main(String[] args) throws JMSException, IOException {
    //1、创建连接工厂
    ConnectionFactory connectionFactory = new ActiveMQConnectionFactory(&amp;quot;tcp://192.168.25.135:61616&amp;quot;);
    //2、获取连接
    Connection connection = connectionFactory.createConnection();
    //3、启动连接
    connection.start();
    //4、获取session
    Session session = connection.createSession(false, Session.AUTO_ACKNOWLEDGE);
    //5、创建主题对象
    Topic topic = session.createTopic(&amp;quot;test-topic&amp;quot;);
    //6、创建消息消费者
    MessageConsumer consumer = session.createConsumer(topic);
    //7、监听消息
    consumer.setMessageListener(new MessageListener() {
        @Override
        public void onMessage(Message message) {
            TextMessage textMessage = (TextMessage) message;
            try {
                System.out.println(&amp;quot;接收消息：&amp;quot;+textMessage.getText());
            } catch (JMSException e) {
                e.printStackTrace();
            }
        }
    });
    //8、等待键盘输入
    System.in.read();
    //9、关闭资源
    consumer.close();
    session.close();
    connection.close();
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;2、消息消费者TopicProducer&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;public static void main(String[] args) throws JMSException {
    //1、创建连接工厂
    ConnectionFactory connectionFactory = new ActiveMQConnectionFactory(&amp;quot;tcp://192.168.25.135:61616&amp;quot;);
    //2、获取连接
    Connection connection = connectionFactory.createConnection();
    //3、启动连接
    connection.start();
    //4、获取session
    Session session = connection.createSession(false, Session.AUTO_ACKNOWLEDGE);
    //5、创建主题对象
    Topic topic = session.createTopic(&amp;quot;test-topic&amp;quot;);
    //6、创建消息生产者
    MessageProducer producer = session.createProducer(topic);
    //7、创建消息
    TextMessage topicTest = session.createTextMessage(&amp;quot;topicTest&amp;quot;);
    //8、发送消息
    producer.send(topicTest);
    //9、关闭资源
    producer.close();
    session.close();
    connection.close();
}
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;spring整合jms&#34;&gt;spring整合jms&lt;/h2&gt;
&lt;h3 id=&#34;点对点模式-2&#34;&gt;点对点模式&lt;/h3&gt;
&lt;p&gt;1、引入依赖&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-xml&#34;&gt;&amp;lt;!--spring-jms--&amp;gt;
&amp;lt;dependency&amp;gt;
    &amp;lt;groupId&amp;gt;org.springframework&amp;lt;/groupId&amp;gt;
    &amp;lt;artifactId&amp;gt;spring-jms&amp;lt;/artifactId&amp;gt;
    &amp;lt;version&amp;gt;4.2.4.RELEASE&amp;lt;/version&amp;gt;
&amp;lt;/dependency&amp;gt;
&amp;lt;!-- activemq --&amp;gt;
&amp;lt;dependency&amp;gt;
    &amp;lt;groupId&amp;gt;org.apache.activemq&amp;lt;/groupId&amp;gt;
    &amp;lt;artifactId&amp;gt;activemq-all&amp;lt;/artifactId&amp;gt;
    &amp;lt;version&amp;gt;5.11.2&amp;lt;/version&amp;gt;
&amp;lt;/dependency&amp;gt;
&amp;lt;!-- 单元测试 --&amp;gt;
&amp;lt;!-- springJunit --&amp;gt;
&amp;lt;dependency&amp;gt;
    &amp;lt;groupId&amp;gt;org.springframework&amp;lt;/groupId&amp;gt;
    &amp;lt;artifactId&amp;gt;spring-test&amp;lt;/artifactId&amp;gt;
    &amp;lt;version&amp;gt;4.2.4.RELEASE&amp;lt;/version&amp;gt;
    &amp;lt;scope&amp;gt;test&amp;lt;/scope&amp;gt;
&amp;lt;/dependency&amp;gt;
&amp;lt;dependency&amp;gt;
    &amp;lt;groupId&amp;gt;junit&amp;lt;/groupId&amp;gt;
    &amp;lt;artifactId&amp;gt;junit&amp;lt;/artifactId&amp;gt;
    &amp;lt;version&amp;gt;4.12&amp;lt;/version&amp;gt;
    &amp;lt;scope&amp;gt;test&amp;lt;/scope&amp;gt;
&amp;lt;/dependency&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;2、创建生产者配置文件&lt;/p&gt;
&lt;p&gt;applicationContext-jms-producer-queue.xml&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-xml&#34;&gt;&amp;lt;?xml version=&amp;quot;1.0&amp;quot; encoding=&amp;quot;UTF-8&amp;quot;?&amp;gt;
&amp;lt;beans xmlns=&amp;quot;http://www.springframework.org/schema/beans&amp;quot;
       xmlns:xsi=&amp;quot;http://www.w3.org/2001/XMLSchema-instance&amp;quot;
       xmlns:context=&amp;quot;http://www.springframework.org/schema/context&amp;quot;
       xsi:schemaLocation=&amp;quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd&amp;quot;&amp;gt;
    &amp;lt;!--消息生产者:点对点--&amp;gt;

    &amp;lt;context:component-scan base-package=&amp;quot;com.springjms&amp;quot;/&amp;gt;

    &amp;lt;!--jms服务厂商提供的连接工厂--&amp;gt;
    &amp;lt;bean id=&amp;quot;targetConnectionFactory&amp;quot; class=&amp;quot;org.apache.activemq.ActiveMQConnectionFactory&amp;quot;&amp;gt;
        &amp;lt;property name=&amp;quot;brokerURL&amp;quot; value=&amp;quot;tcp://192.168.25.137:61616&amp;quot;/&amp;gt;
    &amp;lt;/bean&amp;gt;
    &amp;lt;!--spring用于管理真正的ConnectionFactory--&amp;gt;
    &amp;lt;bean id=&amp;quot;connectionFactory&amp;quot; class=&amp;quot;org.springframework.jms.connection.SingleConnectionFactory&amp;quot;&amp;gt;
        &amp;lt;property name=&amp;quot;targetConnectionFactory&amp;quot; ref=&amp;quot;targetConnectionFactory&amp;quot;/&amp;gt;
    &amp;lt;/bean&amp;gt;
    &amp;lt;!--spring提供的工具类--&amp;gt;
    &amp;lt;bean id=&amp;quot;jmsTemplate&amp;quot; class=&amp;quot;org.springframework.jms.core.JmsTemplate&amp;quot;&amp;gt;
        &amp;lt;constructor-arg name=&amp;quot;connectionFactory&amp;quot; ref=&amp;quot;connectionFactory&amp;quot;/&amp;gt;
    &amp;lt;/bean&amp;gt;

    &amp;lt;!--queue--&amp;gt;
    &amp;lt;bean id=&amp;quot;queueTextDestination&amp;quot; class=&amp;quot;org.apache.activemq.command.ActiveMQQueue&amp;quot;&amp;gt;
        &amp;lt;constructor-arg name=&amp;quot;name&amp;quot; value=&amp;quot;queue_text&amp;quot;/&amp;gt;
    &amp;lt;/bean&amp;gt;
&amp;lt;/beans&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;3、发送消息&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;@Component
public class QueueProducer {

    @Resource
    private JmsTemplate jmsTemplate;

    @Resource
    private Destination queueTextDestination;

    /**
     * 发送文本消息
     * @param text  发送的文本内容
     */
    public void sendTextMessage(final String text){
        jmsTemplate.send(queueTextDestination, new MessageCreator() {
            @Override
            public Message createMessage(Session session) throws JMSException {
                return session.createTextMessage(text);
            }
        });
    }

}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;4、测试发送消息&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;@RunWith(SpringJUnit4ClassRunner.class)
@ContextConfiguration(locations = &amp;quot;classpath:applicationContext-jms-producer-queue.xml&amp;quot;)
public class MyTest {

    @Resource
    private QueueProducer queueProducer;

    @Test
    public void test(){
        queueProducer.sendTextMessage(&amp;quot;Hello! queue&amp;quot;);
    }

}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;5、创建消费者配置文件&lt;/p&gt;
&lt;p&gt;applicationContext-jms-consumer-queue.xml&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-xml&#34;&gt;&amp;lt;?xml version=&amp;quot;1.0&amp;quot; encoding=&amp;quot;UTF-8&amp;quot;?&amp;gt;
&amp;lt;beans xmlns=&amp;quot;http://www.springframework.org/schema/beans&amp;quot;
       xmlns:xsi=&amp;quot;http://www.w3.org/2001/XMLSchema-instance&amp;quot;
       xsi:schemaLocation=&amp;quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd&amp;quot;&amp;gt;
    &amp;lt;!--服务消费者:点对点--&amp;gt;

    &amp;lt;!--jsm服务厂商提供的连接工厂--&amp;gt;
    &amp;lt;bean id=&amp;quot;targetConnectionFactory&amp;quot; class=&amp;quot;org.apache.activemq.ActiveMQConnectionFactory&amp;quot;&amp;gt;
        &amp;lt;property name=&amp;quot;brokerURL&amp;quot; value=&amp;quot;tcp://192.168.25.137:61616&amp;quot;/&amp;gt;
    &amp;lt;/bean&amp;gt;
    &amp;lt;!--spring用于管理真正的ConnectionFactory--&amp;gt;
    &amp;lt;bean id=&amp;quot;connectionFactory&amp;quot; class=&amp;quot;org.springframework.jms.connection.SingleConnectionFactory&amp;quot;&amp;gt;
        &amp;lt;property name=&amp;quot;targetConnectionFactory&amp;quot; ref=&amp;quot;targetConnectionFactory&amp;quot;/&amp;gt;
    &amp;lt;/bean&amp;gt;
    &amp;lt;!--spring提供的工具类--&amp;gt;
    &amp;lt;bean id=&amp;quot;jmsTemplate&amp;quot; class=&amp;quot;org.springframework.jms.core.JmsTemplate&amp;quot;&amp;gt;
        &amp;lt;constructor-arg name=&amp;quot;connectionFactory&amp;quot; ref=&amp;quot;connectionFactory&amp;quot;/&amp;gt;
    &amp;lt;/bean&amp;gt;

    &amp;lt;!--queue--&amp;gt;
    &amp;lt;bean id=&amp;quot;queueTextDestination&amp;quot; class=&amp;quot;org.apache.activemq.command.ActiveMQQueue&amp;quot;&amp;gt;
        &amp;lt;constructor-arg name=&amp;quot;name&amp;quot; value=&amp;quot;queue_text&amp;quot;/&amp;gt;
    &amp;lt;/bean&amp;gt;
    &amp;lt;!--监听类,用来监听mq中是否有消息--&amp;gt;
    &amp;lt;bean id=&amp;quot;myMessageListener&amp;quot; class=&amp;quot;com.springjms.MyMessageListener&amp;quot;/&amp;gt;
    &amp;lt;!--消息的监听器--&amp;gt;
    &amp;lt;bean class=&amp;quot;org.springframework.jms.listener.DefaultMessageListenerContainer&amp;quot;&amp;gt;
        &amp;lt;property name=&amp;quot;connectionFactory&amp;quot; ref=&amp;quot;connectionFactory&amp;quot;/&amp;gt;
        &amp;lt;property name=&amp;quot;destination&amp;quot; ref=&amp;quot;queueTextDestination&amp;quot;/&amp;gt;
        &amp;lt;property name=&amp;quot;messageListener&amp;quot; ref=&amp;quot;myMessageListener&amp;quot;/&amp;gt;
    &amp;lt;/bean&amp;gt;
&amp;lt;/beans&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;6、编写监听类&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;public class MyMessageListener implements MessageListener {
    @Override
    public void onMessage(Message message) {
        TextMessage textMessage = (TextMessage) message;
        try {
            System.out.println(&amp;quot;接收到消息：&amp;quot;+textMessage.getText());
        } catch (JMSException e) {
            e.printStackTrace();
        }
    }
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;7、测试&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;@RunWith(SpringJUnit4ClassRunner.class)
@ContextConfiguration(locations=&amp;quot;classpath:applicationContext-jms-consumer-queue.xml&amp;quot;)
public class MyTest1 {
    @Test
    public void testQueue(){
        try {
            System.in.read();
        } catch (IOException e) {
            e.printStackTrace();
        }
    }
}
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;发布订阅模式-2&#34;&gt;发布/订阅模式&lt;/h2&gt;
&lt;p&gt;1、创建生产者，在applicationContext-jms-producer-queue.xml新增内容&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-xml&#34;&gt;&amp;lt;!--这个是订阅模式  文本信息--&amp;gt;  
&amp;lt;bean id=&amp;quot;topicTextDestination&amp;quot; class=&amp;quot;org.apache.activemq.command.ActiveMQTopic&amp;quot;&amp;gt;  
    &amp;lt;constructor-arg value=&amp;quot;topic_text&amp;quot;/&amp;gt;  
&amp;lt;/bean&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;2、发送消息&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;@Component
public class TopicProducer {

    @Resource
    private JmsTemplate jmsTemplate;
    @Resource
    private Destination topicTextDestination;

    /**
     * 发送消息
     * @param text
     */
    public void sendMessage(final String text){
        jmsTemplate.send(topicTextDestination, new MessageCreator() {
            @Override
            public Message createMessage(Session session) throws JMSException {
                return session.createTextMessage(text);
            }
        });
    }

}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;3、测试&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;@RunWith(SpringJUnit4ClassRunner.class)
@ContextConfiguration(locations = &amp;quot;classpath:applicationContext-jms-producer-topic.xml&amp;quot;)
public class MyTest2 {

    @Resource
    private TopicProducer topicProducer;

    @Test
    public void test(){
        topicProducer.sendMessage(&amp;quot;Hello! topic&amp;quot;);
    }

}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;4、创建消费者，在applicationContext-jms-consumer-queue.xml新增内容&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-xml&#34;&gt;&amp;lt;!--topic--&amp;gt;
&amp;lt;bean id=&amp;quot;topicTextDestination&amp;quot; class=&amp;quot;org.apache.activemq.command.ActiveMQTopic&amp;quot;&amp;gt;
    &amp;lt;constructor-arg name=&amp;quot;name&amp;quot; value=&amp;quot;topic_text&amp;quot;/&amp;gt;
&amp;lt;/bean&amp;gt;
&amp;lt;!--监听类,用来监听mq中是否有消息--&amp;gt;
&amp;lt;bean id=&amp;quot;topicMessageListener&amp;quot; class=&amp;quot;com.springjms.TopicMessageListener&amp;quot;/&amp;gt;
&amp;lt;!--消息的监听器--&amp;gt;
&amp;lt;bean class=&amp;quot;org.springframework.jms.listener.DefaultMessageListenerContainer&amp;quot;&amp;gt;
    &amp;lt;property name=&amp;quot;connectionFactory&amp;quot; ref=&amp;quot;connectionFactory&amp;quot;/&amp;gt;
    &amp;lt;property name=&amp;quot;destination&amp;quot; ref=&amp;quot;topicTextDestination&amp;quot;/&amp;gt;
    &amp;lt;property name=&amp;quot;messageListener&amp;quot; ref=&amp;quot;topicMessageListener&amp;quot;/&amp;gt;
&amp;lt;/bean&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;5、编写监听类&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;public class TopicMessageListener implements MessageListener {
    @Override
    public void onMessage(Message message) {
        TextMessage textMessage = (TextMessage) message;
        try {
            System.out.println(&amp;quot;接收到消息：&amp;quot;+textMessage.getText());
        } catch (JMSException e) {
            e.printStackTrace();
        }
    }
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;6、编写测试类&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;@RunWith(SpringJUnit4ClassRunner.class)
@ContextConfiguration(locations=&amp;quot;classpath:applicationContext-jms-consumer-topic.xml&amp;quot;)
public class MyTest3 {
    @Test
    public void testQueue(){
        try {
            System.in.read();
        } catch (IOException e) {
            e.printStackTrace();
        }
    }
}
&lt;/code&gt;&lt;/pre&gt;
">ActiveMQ</a>
      </div>
      
      <div class="item">
        <a class="result-title" href="https://haohanya.github.io/post/solr-an-zhuang-shi-yong/"" data-c="
          &lt;h2 id=&#34;什么是solr&#34;&gt;什么是Solr&lt;/h2&gt;
&lt;blockquote&gt;
&lt;p&gt;大多数搜索引擎应用都必须具有某种搜索功能，问题是搜索功能往往是巨大的资源消耗并且它们由于沉重的数据库加载而拖垮你的应用的性能。&lt;/p&gt;
&lt;p&gt;这就是为什么转移负载到一个外部的搜索服务器是一个不错的主意，Apache Solr是一个流行的开源搜索服务器，它通过使用类似REST的HTTP API，这就确保你能从几乎任何编程语言来使用solr。&lt;/p&gt;
&lt;p&gt;Solr是一个开源搜索平台，用于构建搜索应用程序。 它建立在Lucene(全文搜索引擎)之上。 Solr是企业级的，快速的和高度可扩展的。 使用Solr构建的应用程序非常复杂，可提供高性能。&lt;/p&gt;
&lt;p&gt;为了在CNET网络的公司网站上添加搜索功能，Yonik Seely于2004年创建了Solr。并在2006年1月，它成为Apache软件基金会下的一个开源项目。并于2016年发布最新版本Solr 6.0，支持并行SQL查询的执行。&lt;/p&gt;
&lt;p&gt;Solr可以和Hadoop一起使用。由于Hadoop处理大量数据，Solr帮助我们从这么大的源中找到所需的信息。不仅限于搜索，Solr也可以用于存储目的。像其他NoSQL数据库一样，它是一种非关系数据存储和处理技术。&lt;/p&gt;
&lt;p&gt;总之，Solr是一个可扩展的，可部署，搜索/存储引擎，优化搜索大量以文本为中心的数据。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&#34;solr安装&#34;&gt;solr安装&lt;/h2&gt;
&lt;h3 id=&#34;1-上传文件&#34;&gt;1 上传文件&lt;/h3&gt;
&lt;p&gt;apache-tomcat-7.0.82.tar.gz&lt;/p&gt;
&lt;p&gt;solr-4.10.3.tgz.tgz&lt;/p&gt;
&lt;p&gt;IK Analyzer 2012FF_hf1&lt;/p&gt;
&lt;h3 id=&#34;2-创建目录&#34;&gt;2 创建目录&lt;/h3&gt;
&lt;p&gt;mkdir /usr/soft/solr&lt;/p&gt;
&lt;h3 id=&#34;3-解压tomcat并移动到solr目录&#34;&gt;3 解压tomcat并移动到solr目录&lt;/h3&gt;
&lt;p&gt;tar -zxvf apache-tomcat-7.0.82.tar.gz&lt;/p&gt;
&lt;p&gt;mv apache-tomcat-7.0.82 /usr/soft/solr/tomcat7&lt;/p&gt;
&lt;p&gt;tar -zxvf solr-4.10.3.tgz.tgz&lt;/p&gt;
&lt;p&gt;在solr-4.10.3/dist目录下有一个war包 需要把war包移动到tomcat里运行&lt;/p&gt;
&lt;p&gt;cp ~/solr-4.10.3/dist/solr-4.10.3.war /usr/soft/solr/tomcat7/webapps/solr.war&lt;/p&gt;
&lt;h3 id=&#34;4-启动tomcat&#34;&gt;4 启动tomcat&lt;/h3&gt;
&lt;p&gt;cd /usr/soft/solr/tomcat7&lt;/p&gt;
&lt;p&gt;./bin/startup.sh&lt;/p&gt;
&lt;p&gt;查看tomcat日志(可选)&lt;/p&gt;
&lt;p&gt;tail -f logs/catalina.out&lt;/p&gt;
&lt;h3 id=&#34;5-引入依赖jar包&#34;&gt;5 引入依赖jar包&lt;/h3&gt;
&lt;p&gt;cd ~/solr-4.10.3/example/lib/ext&lt;/p&gt;
&lt;p&gt;cp * /usr/soft/solr/tomcat7/webapps/solr/WEB-INF/lib&lt;/p&gt;
&lt;h3 id=&#34;6-复制配置文件&#34;&gt;6 复制配置文件&lt;/h3&gt;
&lt;p&gt;cd ~/solr-4.10.3/example&lt;/p&gt;
&lt;p&gt;cp -r solr /usr/soft/solr/solrhome&lt;/p&gt;
&lt;h3 id=&#34;7-solr和solrhome建立联系&#34;&gt;7 solr和solrhome建立联系&lt;/h3&gt;
&lt;p&gt;cd /usr/soft/solr/tomcat7/webapps/solr/WEB-INF&lt;/p&gt;
&lt;p&gt;vi web.xml&lt;/p&gt;
&lt;p&gt;/usr/soft/solr/solrhome&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-xml&#34;&gt;&amp;lt;env-entry&amp;gt;
	&amp;lt;env-entry-name&amp;gt;solr/home&amp;lt;/env-entry-name&amp;gt;
    &amp;lt;!-- 这里设置为自己的solrhome路径 --&amp;gt;
    &amp;lt;env-entry-value&amp;gt;/usr/soft/solr/solrhome&amp;lt;/env-entry-value&amp;gt;
    &amp;lt;env-entry-type&amp;gt;java.lang.String&amp;lt;/env-entry-type&amp;gt;
&amp;lt;/env-entry&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;:wq&lt;/p&gt;
&lt;h3 id=&#34;8-重启-tomcat&#34;&gt;8 重启 tomcat&lt;/h3&gt;
&lt;p&gt;cd /usr/soft/solr/tomcat7/bin&lt;/p&gt;
&lt;p&gt;./shutdown.sh&lt;/p&gt;
&lt;p&gt;./startup.sh&lt;/p&gt;
&lt;h3 id=&#34;9-访问solr&#34;&gt;9 访问solr&lt;/h3&gt;
&lt;p&gt;http://192.168.25.132:8080/solr/&lt;/p&gt;
&lt;h2 id=&#34;配置ik分词器&#34;&gt;配置IK分词器&lt;/h2&gt;
&lt;h3 id=&#34;ik-analyzer简介&#34;&gt;IK Analyzer简介&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;IK Analyzer 是一个开源的，基亍 java 语言开发的轻量级的中文分词工具包。从 2006年 12 月推出 1.0 版开始， IKAnalyzer 已经推出了 4 个大版本。最初，它是以开源项目Luence 为应用主体的，结合词典分词和文法分析算法的中文分词组件。从 3.0 版本开始，IK 发展为面向 Java 的公用分词组件，独立亍 Lucene 项目，同时提供了对 Lucene 的默认优化实现。在 2012 版本中，IK 实现了简单的分词歧义排除算法，标志着 IK 分词器从单纯的词典分词向模拟语义分词衍化。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&#34;1-将ik分词器jar包移动到solr中&#34;&gt;1 将ik分词器jar包移动到solr中&lt;/h3&gt;
&lt;p&gt;cp ~/IK\ Analyzer\ 2012FF_hf1/IKAnalyzer2012FF_u1.jar /usr/soft/solr/tomcat7/webapps/solr/WEB-INF/lib&lt;/p&gt;
&lt;h3 id=&#34;2-在solr项目的web-inf-目录创建一个classes目录&#34;&gt;2 在solr项目的WEB-INF 目录创建一个classes目录&lt;/h3&gt;
&lt;p&gt;mkdir /usr/soft/solr/tomcat7/webapps/solr/WEB-INF/classes&lt;/p&gt;
&lt;h3 id=&#34;3-移动配置文件到classes目录&#34;&gt;3 移动配置文件到classes目录&lt;/h3&gt;
&lt;p&gt;cp IKAnalyzer.cfg.xml ext_stopword.dic mydict.dic /usr/soft/solr/tomcat7/webapps/solr/WEB-INF/classes&lt;/p&gt;
&lt;h3 id=&#34;4-启用-编辑配置文件&#34;&gt;4 启用---编辑配置文件&lt;/h3&gt;
&lt;p&gt;使用npp编辑服务器上的文件&lt;/p&gt;
&lt;p&gt;1 安装npp (略)&lt;/p&gt;
&lt;p&gt;2  安装NppFTP(略)&lt;/p&gt;
&lt;p&gt;3 连接服务器 (虐)&lt;/p&gt;
&lt;p&gt;4 编辑xml文件 : /usr/soft/solr/solrhome/collection1/conf/schema.xml&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-xml&#34;&gt;&amp;lt;!-- 配置IK分词器 --&amp;gt;
&amp;lt;fieldType name=&amp;quot;text_ik&amp;quot; class=&amp;quot;solr.TextField&amp;quot;&amp;gt;
    &amp;lt;analyzer class=&amp;quot;org.wltea.analyzer.lucene.IKAnalyzer&amp;quot;&amp;gt;&amp;lt;/analyzer&amp;gt;
&amp;lt;/fieldType&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;5 重启tomcat&lt;/p&gt;
&lt;p&gt;cd /usr/soft/solr/tomcat7/bin&lt;/p&gt;
&lt;p&gt;./shutdown.sh&lt;/p&gt;
&lt;p&gt;./startup.sh&lt;/p&gt;
&lt;p&gt;6 访问url&lt;/p&gt;
&lt;p&gt;http://192.168.25.132:8080/solr/&lt;/p&gt;
&lt;h2 id=&#34;域&#34;&gt;域&lt;/h2&gt;
&lt;p&gt;域 : 相当于数据库表的字段&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-xml&#34;&gt;&amp;lt;!--
	name : 指定域的名称
	type : 指定域的类型
	indexed : 是否索引
	stored : 是否存储
	required : 是否必须
	multiValued : 是否多值
--&amp;gt;
&amp;lt;field name=&amp;quot;id&amp;quot; type=&amp;quot;string&amp;quot; indexed=&amp;quot;true&amp;quot; stored=&amp;quot;true&amp;quot; required=&amp;quot;true&amp;quot; multiValued=&amp;quot;false&amp;quot; /&amp;gt; 
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;spring-data-solr-demo&#34;&gt;Spring Data Solr Demo&lt;/h2&gt;
&lt;p&gt;1、引入依赖&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-xml&#34;&gt;&amp;lt;dependency&amp;gt;
    &amp;lt;groupId&amp;gt;org.springframework.data&amp;lt;/groupId&amp;gt;
    &amp;lt;artifactId&amp;gt;spring-data-solr&amp;lt;/artifactId&amp;gt;
    &amp;lt;version&amp;gt;1.5.5.RELEASE&amp;lt;/version&amp;gt;
&amp;lt;/dependency&amp;gt; 
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;2、applicationContext-solr.xml&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-xml&#34;&gt;&amp;lt;?xml version=&amp;quot;1.0&amp;quot; encoding=&amp;quot;UTF-8&amp;quot;?&amp;gt;
&amp;lt;beans xmlns=&amp;quot;http://www.springframework.org/schema/beans&amp;quot;
	xmlns:xsi=&amp;quot;http://www.w3.org/2001/XMLSchema-instance&amp;quot; xmlns:p=&amp;quot;http://www.springframework.org/schema/p&amp;quot;
	xmlns:context=&amp;quot;http://www.springframework.org/schema/context&amp;quot;
	xmlns:solr=&amp;quot;http://www.springframework.org/schema/data/solr&amp;quot;
	xsi:schemaLocation=&amp;quot;http://www.springframework.org/schema/data/solr 
  		http://www.springframework.org/schema/data/solr/spring-solr-1.0.xsd
		http://www.springframework.org/schema/beans 
		http://www.springframework.org/schema/beans/spring-beans.xsd
		http://www.springframework.org/schema/context 
		http://www.springframework.org/schema/context/spring-context.xsd&amp;quot;&amp;gt;
	&amp;lt;!-- solr服务器地址 --&amp;gt;
	&amp;lt;solr:solr-server id=&amp;quot;solrServer&amp;quot; url=&amp;quot;http://127.0.0.1:8080/solr&amp;quot; /&amp;gt;
	&amp;lt;!-- solr模板，使用solr模板可对索引库进行CRUD的操作 --&amp;gt;
	&amp;lt;bean id=&amp;quot;solrTemplate&amp;quot; class=&amp;quot;org.springframework.data.solr.core.SolrTemplate&amp;quot;&amp;gt;
		&amp;lt;constructor-arg ref=&amp;quot;solrServer&amp;quot; /&amp;gt;
	&amp;lt;/bean&amp;gt;
&amp;lt;/beans&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;3、@Field 注解&lt;/p&gt;
&lt;p&gt;作用：如果在pojo上添加了这个注解，那么这个属性会被引用到solr，value为指定solr中field定义的name，如果一样可以省略&lt;/p&gt;
&lt;p&gt;@Dynamic注解，在属性上定义就表示是一个动态域&lt;/p&gt;
&lt;p&gt;4、添加&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;@Autowired
private SolrTemplate solrTemplate;

solrTemplate.saveBean(item);
//添加多条数据可以使用saveBeans
solrTemplate.commit();//提交事务
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;5、按主键查询&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;//参数1 ：要查询的主键ID
//参数2 ：返回的数据类型
solrTemplate.getById(1,TbItem.class)
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;6、按主键删除&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;solrTemplate.deleteById(&amp;quot;1&amp;quot;);
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;7、分页查询&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;//条件
Query query = newSimpleQuery(&amp;quot;*:*&amp;quot;);
//查询条件
Criteria criteria = new Criteria();
//and ：查询的域
//contains ：查询的关键字
criteria.and(&amp;quot;item_title&amp;quot;).contains(&amp;quot;手机&amp;quot;);
//将查询条件添加到queyr中
query.addCriteria(criteria);
query.setOffset(0);//开始索引，默认为0，翻页规则 (pageNow - 1) * pageSize
query.setRows(20);//每页记录条数
//ScoredPage ：solr的分页查询
//参数1：查询条件
//参数2：返回类型
ScoredPage&amp;lt;TbItem&amp;gt; page = solrTemplate.queryForPage(query,TbItem.class)
System.out.pringln(&amp;quot;总记录数:&amp;quot;+page.getTotalElements());
List&amp;lt;TbItem&amp;gt; list = page.getContent();
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;8、高亮查询&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;@Resource
private SolrTemplate solrTemplate;

@Override
public Map&amp;lt;String, Object&amp;gt; search(Map&amp;lt;String, Object&amp;gt; searchMap) {

    Map&amp;lt;String,Object&amp;gt; map = new HashMap&amp;lt;String, Object&amp;gt;();

    //设置搜索高亮
    HighlightQuery query = new SimpleHighlightQuery();

    //设置高亮的域
    HighlightOptions highlightOptions = new HighlightOptions().addField(&amp;quot;item_title&amp;quot;);

    //设置高亮前缀
    highlightOptions.setSimplePrefix(&amp;quot;&amp;lt;em style=&#39;color:red&#39;&amp;gt;&amp;quot;);
    //设置高亮后缀
    highlightOptions.setSimplePostfix(&amp;quot;&amp;lt;/em&amp;gt;&amp;quot;);

    //设置高亮选项
    query.setHighlightOptions(highlightOptions);

    //按照关键字查询
    Criteria criteria = new Criteria(&amp;quot;item_keywords&amp;quot;).is(searchMap.get(&amp;quot;keywords&amp;quot;));

    //添加条件
    query.addCriteria(criteria);

    //到solr中查询
    HighlightPage&amp;lt;TbItem&amp;gt; page = solrTemplate.queryForHighlightPage(query,TbItem.class);

    //循环高亮入口集合
    for (HighlightEntry&amp;lt;TbItem&amp;gt; entry : page.getHighlighted()) {
        //获取原实体类
        TbItem tbItem = entry.getEntity();

        //判断是否有高亮内容
        if(entry.getHighlights().size() &amp;gt; 0 &amp;amp;&amp;amp; entry.getHighlights().get(0).getSnipplets().size() &amp;gt; 0 ){
            //设置高亮的结果
            tbItem.setTitle(entry.getHighlights().get(0).getSnipplets().get(0));
        }
    }
    map.put(&amp;quot;rows&amp;quot;,page.getContent());

    return map;
}
&lt;/code&gt;&lt;/pre&gt;
">solr安装使用</a>
      </div>
      
      <div class="item">
        <a class="result-title" href="https://haohanya.github.io/post/spring-security/"" data-c="
          &lt;h2 id=&#34;spring-security简介&#34;&gt;Spring Security简介&lt;/h2&gt;
&lt;blockquote&gt;
&lt;p&gt;Spring Security是一个能够为基于Spring的企业应用系统提供声明式的安全访问控制解决方案的安全框架。它提供了一组可以在Spring应用上下文中配置的Bean，充分利用了Spring IoC，DI（控制反转Inversion of Control ,DI:Dependency Injection 依赖注入）和AOP（面向切面编程）功能，为应用系统提供声明式的安全访问控制功能，减少了为企业系统安全控制编写大量重复代码的工作。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&#34;单机版&#34;&gt;单机版&lt;/h2&gt;
&lt;p&gt;1.引入依赖&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-xml&#34;&gt; &amp;lt;!-- 身份验证 --&amp;gt;
&amp;lt;dependency&amp;gt;
    &amp;lt;groupId&amp;gt;org.springframework.security&amp;lt;/groupId&amp;gt;
    &amp;lt;artifactId&amp;gt;spring-security-web&amp;lt;/artifactId&amp;gt;
&amp;lt;/dependency&amp;gt;
&amp;lt;dependency&amp;gt;
    &amp;lt;groupId&amp;gt;org.springframework.security&amp;lt;/groupId&amp;gt;
    &amp;lt;artifactId&amp;gt;spring-security-config&amp;lt;/artifactId&amp;gt;
&amp;lt;/dependency&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;!-- more --&gt;
&lt;p&gt;2.配置核心配置文件&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-xml&#34;&gt;&amp;lt;?xml version=&amp;quot;1.0&amp;quot; encoding=&amp;quot;UTF-8&amp;quot;?&amp;gt;
&amp;lt;beans:beans xmlns=&amp;quot;http://www.springframework.org/schema/security&amp;quot;
             xmlns:beans=&amp;quot;http://www.springframework.org/schema/beans&amp;quot;
             xmlns:xsi=&amp;quot;http://www.w3.org/2001/XMLSchema-instance&amp;quot;
             xsi:schemaLocation=&amp;quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
						http://www.springframework.org/schema/security http://www.springframework.org/schema/security/spring-security.xsd&amp;quot;&amp;gt;
    &amp;lt;!-- 以下页面不被拦截 --&amp;gt;
    &amp;lt;http pattern=&amp;quot;/login.html&amp;quot; security=&amp;quot;none&amp;quot;/&amp;gt;
    &amp;lt;http pattern=&amp;quot;/css/**&amp;quot; security=&amp;quot;none&amp;quot;/&amp;gt;
    &amp;lt;http pattern=&amp;quot;/img/**&amp;quot; security=&amp;quot;none&amp;quot;/&amp;gt;
    &amp;lt;http pattern=&amp;quot;/js/**&amp;quot; security=&amp;quot;none&amp;quot;/&amp;gt;
    &amp;lt;http pattern=&amp;quot;/plugins/**&amp;quot; security=&amp;quot;none&amp;quot;/&amp;gt;

    &amp;lt;!--
            页面拦截规则
                use-expressions:是否启用spel表达式, 如果为true那么access=&amp;quot;hasRole(&#39;ROLE_USER&#39;)&amp;quot;
        --&amp;gt;
    &amp;lt;!-- 页面拦截规则 --&amp;gt;
    &amp;lt;http use-expressions=&amp;quot;false&amp;quot;&amp;gt;
        &amp;lt;!--
            pattern : 拦截的url
            access : 拥有如下权限允许访问
        --&amp;gt;
        &amp;lt;intercept-url pattern=&amp;quot;/**&amp;quot; access=&amp;quot;ROLE_ADMIN&amp;quot; /&amp;gt;
        &amp;lt;!--
            login-page : 自定义登陆页面
            default-target-url : 登陆成功后跳转的页面,不设定默认跳转上一次访问的页面
            authentication-failure-url : 登陆失败时跳转的url
            always-use-default-target : 登陆成功后 总是跳转到 default-target-url 设定的url
        --&amp;gt;
        &amp;lt;form-login login-page=&amp;quot;/login.html&amp;quot;  default-target-url=&amp;quot;/admin/index.html&amp;quot; authentication-failure-url=&amp;quot;/login.html&amp;quot; always-use-default-target=&amp;quot;true&amp;quot;/&amp;gt;
        &amp;lt;csrf disabled=&amp;quot;true&amp;quot;/&amp;gt;

        &amp;lt;!--
            logout-url : 退出的地址
            logout-success-url : 退出后跳转的地址
        --&amp;gt;
        &amp;lt;logout logout-url=&amp;quot;/logout&amp;quot; logout-success-url=&amp;quot;/login.html&amp;quot;/&amp;gt;
        &amp;lt;!--
            如果使用了iframe,需要指定框架页的策略为 SAMEORIGIN
        --&amp;gt;
        &amp;lt;headers&amp;gt;
            &amp;lt;frame-options policy=&amp;quot;SAMEORIGIN&amp;quot;/&amp;gt;  &amp;lt;!--允许使用frameset --&amp;gt;
        &amp;lt;/headers&amp;gt;
    &amp;lt;/http&amp;gt;

    &amp;lt;!--认证管理器--&amp;gt;
    &amp;lt;authentication-manager&amp;gt;
        &amp;lt;authentication-provider&amp;gt;
            &amp;lt;user-service&amp;gt;
                &amp;lt;!--用户名和密码,权限--&amp;gt;
                &amp;lt;user name=&amp;quot;root&amp;quot; password=&amp;quot;root&amp;quot; authorities=&amp;quot;ROLE_ADMIN&amp;quot;/&amp;gt;
            &amp;lt;/user-service&amp;gt;
        &amp;lt;/authentication-provider&amp;gt;
    &amp;lt;/authentication-manager&amp;gt;

&amp;lt;/beans:beans&amp;gt;

&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;3.配置web.xml&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-xml&#34;&gt;&amp;lt;context-param&amp;gt;
    &amp;lt;param-name&amp;gt;contextConfigLocation&amp;lt;/param-name&amp;gt;
    &amp;lt;param-value&amp;gt;classpath:spring/spring-security.xml&amp;lt;/param-value&amp;gt;
&amp;lt;/context-param&amp;gt;
&amp;lt;listener&amp;gt;
    &amp;lt;listener-class&amp;gt;
        org.springframework.web.context.ContextLoaderListener
    &amp;lt;/listener-class&amp;gt;
&amp;lt;/listener&amp;gt;
&amp;lt;filter&amp;gt;
    &amp;lt;filter-name&amp;gt;springSecurityFilterChain&amp;lt;/filter-name&amp;gt;
    &amp;lt;filter-class&amp;gt;org.springframework.web.filter.DelegatingFilterProxy&amp;lt;/filter-class&amp;gt;
&amp;lt;/filter&amp;gt;
&amp;lt;filter-mapping&amp;gt;
    &amp;lt;filter-name&amp;gt;springSecurityFilterChain&amp;lt;/filter-name&amp;gt;
    &amp;lt;url-pattern&amp;gt;/*&amp;lt;/url-pattern&amp;gt;
&amp;lt;/filter-mapping&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;连接数据库&#34;&gt;连接数据库&lt;/h2&gt;
&lt;p&gt;1.引入依赖&lt;/p&gt;
&lt;p&gt;2.实现UserDetailsService接口&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;package com.jd.shop.service.impl;

import com.jd.pojo.TbSeller;
import com.jd.sellergoods.service.TbSellerService;
import org.springframework.security.core.GrantedAuthority;
import org.springframework.security.core.authority.SimpleGrantedAuthority;
import org.springframework.security.core.userdetails.User;
import org.springframework.security.core.userdetails.UserDetails;
import org.springframework.security.core.userdetails.UserDetailsService;
import org.springframework.security.core.userdetails.UsernameNotFoundException;

import java.util.ArrayList;
import java.util.List;

/**
 * 认证类
 * @program: jd
 * @author: 潘
 * @create: 2020-04-29 22:43
 **/
public class UserDetailsServiceImpl implements UserDetailsService{

    private TbSellerService tbSellerService;

    public void setTbSellerService(TbSellerService tbSellerService) {
        this.tbSellerService = tbSellerService;
    }

    @Override
    public UserDetails loadUserByUsername(String username) throws UsernameNotFoundException {

        if(username == null){
            return null;
        }

        TbSeller byId = tbSellerService.findById(username);

        if(byId == null){
            return null;
        }

        //构建角色列表
        List&amp;lt;GrantedAuthority&amp;gt; list = new ArrayList&amp;lt;&amp;gt;();

        //用户的权限集合
        list.add(new SimpleGrantedAuthority(&amp;quot;ROLE_USER&amp;quot;));

        return new User(username,byId.getPassword(),list);
    }
}

&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;3.配置核心配置文件&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-xml&#34;&gt;&amp;lt;?xml version=&amp;quot;1.0&amp;quot; encoding=&amp;quot;UTF-8&amp;quot;?&amp;gt;
&amp;lt;beans:beans xmlns=&amp;quot;http://www.springframework.org/schema/security&amp;quot;
             xmlns:beans=&amp;quot;http://www.springframework.org/schema/beans&amp;quot;
             xmlns:xsi=&amp;quot;http://www.w3.org/2001/XMLSchema-instance&amp;quot;
             xmlns:dubbo=&amp;quot;http://code.alibabatech.com/schema/dubbo&amp;quot;
             xsi:schemaLocation=&amp;quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
						http://www.springframework.org/schema/security http://www.springframework.org/schema/security/spring-security.xsd http://code.alibabatech.com/schema/dubbo http://code.alibabatech.com/schema/dubbo/dubbo.xsd&amp;quot;&amp;gt;
    &amp;lt;!-- 以下页面不被拦截 --&amp;gt;
    &amp;lt;http pattern=&amp;quot;/login.html&amp;quot; security=&amp;quot;none&amp;quot;/&amp;gt;
    &amp;lt;http pattern=&amp;quot;/css/**&amp;quot; security=&amp;quot;none&amp;quot;/&amp;gt;
    &amp;lt;http pattern=&amp;quot;/img/**&amp;quot; security=&amp;quot;none&amp;quot;/&amp;gt;
    &amp;lt;http pattern=&amp;quot;/js/**&amp;quot; security=&amp;quot;none&amp;quot;/&amp;gt;
    &amp;lt;http pattern=&amp;quot;/plugins/**&amp;quot; security=&amp;quot;none&amp;quot;/&amp;gt;
    &amp;lt;http pattern=&amp;quot;/*.html&amp;quot; security=&amp;quot;none&amp;quot;/&amp;gt;
&amp;lt;!--    &amp;lt;http pattern=&amp;quot;/login&amp;quot; security=&amp;quot;none&amp;quot;/&amp;gt;--&amp;gt;

    &amp;lt;!--
            页面拦截规则
                use-expressions:是否启用spel表达式, 如果为true那么access=&amp;quot;hasRole(&#39;ROLE_USER&#39;)&amp;quot;
        --&amp;gt;
    &amp;lt;!-- 页面拦截规则 --&amp;gt;
    &amp;lt;http use-expressions=&amp;quot;false&amp;quot;&amp;gt;
        &amp;lt;!--
            pattern : 拦截的url
            access : 拥有如下权限允许访问
        --&amp;gt;
        &amp;lt;intercept-url pattern=&amp;quot;/**&amp;quot; access=&amp;quot;ROLE_USER&amp;quot; /&amp;gt;
        &amp;lt;!--
            login-page : 自定义登陆页面
            default-target-url : 登陆成功后跳转的页面,不设定默认跳转上一次访问的页面
            authentication-failure-url : 登陆失败时跳转的url
            always-use-default-target : 登陆成功后 总是跳转到 default-target-url 设定的url
        --&amp;gt;
        &amp;lt;form-login login-processing-url=&amp;quot;/login&amp;quot; login-page=&amp;quot;/shoplogin.html&amp;quot;  default-target-url=&amp;quot;/admin/index.html&amp;quot; authentication-failure-url=&amp;quot;/shoplogin.html&amp;quot; always-use-default-target=&amp;quot;true&amp;quot;/&amp;gt;
        &amp;lt;csrf disabled=&amp;quot;true&amp;quot;/&amp;gt;

        &amp;lt;!--
            logout-url : 退出的地址
            logout-success-url : 退出后跳转的地址
        --&amp;gt;
        &amp;lt;logout logout-url=&amp;quot;/logout&amp;quot; logout-success-url=&amp;quot;/shoplogin.html&amp;quot;/&amp;gt;
        &amp;lt;!--
            如果使用了iframe,需要指定框架页的策略为 SAMEORIGIN
        --&amp;gt;
        &amp;lt;headers&amp;gt;
            &amp;lt;frame-options policy=&amp;quot;SAMEORIGIN&amp;quot;/&amp;gt;  &amp;lt;!--允许使用frameset --&amp;gt;
        &amp;lt;/headers&amp;gt;
    &amp;lt;/http&amp;gt;

    &amp;lt;!--认证管理器--&amp;gt;
    &amp;lt;authentication-manager&amp;gt;
        &amp;lt;authentication-provider user-service-ref=&amp;quot;userDetailsServiceImpl&amp;quot;/&amp;gt;
    &amp;lt;/authentication-manager&amp;gt;

    &amp;lt;!-- 引用dubbo 服务 --&amp;gt;
    &amp;lt;dubbo:application name=&amp;quot;jd-shop-web&amp;quot; /&amp;gt;
    &amp;lt;dubbo:registry address=&amp;quot;zookeeper://47.98.157.69:2181&amp;quot; timeout=&amp;quot;30000&amp;quot;/&amp;gt;
    &amp;lt;dubbo:annotation package=&amp;quot;com.jd.shop.controller&amp;quot; /&amp;gt;
    
    &amp;lt;dubbo:reference interface=&amp;quot;com.jd.sellergoods.service.TbSellerService&amp;quot; id=&amp;quot;tbSellerService&amp;quot;/&amp;gt;

    &amp;lt;beans:bean id=&amp;quot;userDetailsServiceImpl&amp;quot; class=&amp;quot;com.jd.shop.service.impl.UserDetailsServiceImpl&amp;quot;&amp;gt;
        &amp;lt;beans:property name=&amp;quot;tbSellerService&amp;quot; ref=&amp;quot;tbSellerService&amp;quot;/&amp;gt;
    &amp;lt;/beans:bean&amp;gt;

&amp;lt;/beans:beans&amp;gt;

&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;4.配置web.xml文件&lt;/p&gt;
&lt;h2 id=&#34;brcy加密&#34;&gt;Brcy加密&lt;/h2&gt;
&lt;p&gt;1.编写java&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;BCryptPasswordEncoder passwordEncoder = new BCryptPasswordEncoder();
String encode = passwordEncoder.encode(tbSeller.getPassword());
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;2.编写配置文件&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-xml&#34;&gt;&amp;lt;!--认证管理器--&amp;gt;
&amp;lt;authentication-manager&amp;gt;
    &amp;lt;authentication-provider user-service-ref=&amp;quot;userDetailsServiceImpl&amp;quot;&amp;gt;
        &amp;lt;!-- 这句话表示在登陆时使用bcry加密验证 --&amp;gt;
        &amp;lt;password-encoder ref=&amp;quot;bCryptPasswordEncoder&amp;quot;/&amp;gt;
    &amp;lt;/authentication-provider&amp;gt;
&amp;lt;/authentication-manager&amp;gt;
&amp;lt;!--配置加密,在认证管理器中引用--&amp;gt;
&amp;lt;beans:bean id=&amp;quot;bCryptPasswordEncoder&amp;quot; class=&amp;quot;org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder&amp;quot;/&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;记住我&#34;&gt;记住我&lt;/h2&gt;
&lt;pre&gt;&lt;code class=&#34;language-html&#34;&gt;&amp;lt;input value=&amp;quot;1&amp;quot; name=&amp;quot;remember-me&amp;quot;/&amp;gt;

&lt;/code&gt;&lt;/pre&gt;
">Spring-Security</a>
      </div>
      
      <div class="item">
        <a class="result-title" href="https://haohanya.github.io/post/mybatis/"" data-c="
          &lt;h1 id=&#34;快速开始&#34;&gt;快速开始&lt;/h1&gt;
&lt;h2 id=&#34;1-mybatis核心配置文件&#34;&gt;1、MyBatis核心配置文件&lt;/h2&gt;
&lt;pre&gt;&lt;code class=&#34;language-xml&#34;&gt;&amp;lt;?xml version=&amp;quot;1.0&amp;quot; encoding=&amp;quot;UTF-8&amp;quot; ?&amp;gt;
&amp;lt;!DOCTYPE configuration
  PUBLIC &amp;quot;-//mybatis.org//DTD Config 3.0//EN&amp;quot;
  &amp;quot;http://mybatis.org/dtd/mybatis-3-config.dtd&amp;quot;&amp;gt;
&amp;lt;configuration&amp;gt;
  &amp;lt;!-- 配置数据源 --&amp;gt;
  &amp;lt;environments default=&amp;quot;development&amp;quot;&amp;gt;
    &amp;lt;environment id=&amp;quot;development&amp;quot;&amp;gt;
     &amp;lt;!--事务处理方式--&amp;gt;
      &amp;lt;transactionManager type=&amp;quot;JDBC&amp;quot;/&amp;gt;
      &amp;lt;dataSource type=&amp;quot;POOLED&amp;quot;&amp;gt;
        &amp;lt;property name=&amp;quot;driver&amp;quot; value=&amp;quot;com.mysql.jdbc.Driver&amp;quot;/&amp;gt;
        &amp;lt;property name=&amp;quot;url&amp;quot; value=&amp;quot;jdbc:mysql://localhost:3306/mybatis&amp;quot;/&amp;gt;
        &amp;lt;property name=&amp;quot;username&amp;quot; value=&amp;quot;root&amp;quot;/&amp;gt;
        &amp;lt;property name=&amp;quot;password&amp;quot; value=&amp;quot;root&amp;quot;/&amp;gt;
      &amp;lt;/dataSource&amp;gt;
    &amp;lt;/environment&amp;gt;
  &amp;lt;/environments&amp;gt;
&amp;lt;!--映射器：每一个Mapper接口都应该在核心配置文件&amp;lt;mappers&amp;gt;标签中注册--&amp;gt;
  &amp;lt;mappers&amp;gt;
  	&amp;lt;!--使用XML配置文件注册--&amp;gt;
    &amp;lt;mapper resource=&amp;quot;com/cn/mybatis/dao/IcpInfoMapper.xml&amp;quot;/&amp;gt;
    &amp;lt;!--使用类注册方式--&amp;gt;
    &amp;lt;mapper class=&amp;quot;com.cn.mybatis.dao.IcpInfoMapper&amp;quot; /&amp;gt;
  &amp;lt;/mappers&amp;gt;
&amp;lt;/configuration&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;2-orm映射文件mapperxml&#34;&gt;2、ORM映射文件mapper.xml&lt;/h2&gt;
&lt;pre&gt;&lt;code class=&#34;language-xml&#34;&gt;&amp;lt;?xml version=&amp;quot;1.0&amp;quot; encoding=&amp;quot;UTF-8&amp;quot; ?&amp;gt;
&amp;lt;!DOCTYPE mapper
  PUBLIC &amp;quot;-//mybatis.org//DTD Mapper 3.0//EN&amp;quot;
  &amp;quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&amp;quot;&amp;gt;
&amp;lt;!-- 这个配置文件主要是配置实体类和数据库中的表映射关系 --&amp;gt;
&amp;lt;!-- mapper：映射信息配置 namesapce:如果是在ibatis的开发中，名字可以随便取，但是在mybatis中将有特殊的意义 --&amp;gt;
&amp;lt;mapper namespace=&amp;quot;test&amp;quot;&amp;gt;
	&amp;lt;!-- 查询所有的书籍信息 select:专门用于查询的statement
	     id:是statement的唯一标识符
	     resultType:返回值得类型（跟返回的个数无关），将返回类型的全限定名写到这里
	 --&amp;gt;
	&amp;lt;select id=&amp;quot;selectAllBooks&amp;quot; resultType=&amp;quot;cn.kgc.pojo.Book&amp;quot;&amp;gt;
		select * from book
	&amp;lt;/select&amp;gt;
&amp;lt;/mapper&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;3-日志文件&#34;&gt;3、日志文件&lt;/h2&gt;
&lt;p&gt;&lt;code&gt;log4j.properties&lt;/code&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-properties&#34;&gt;log4j.rootLogger=DEBUG,A1
log4j.logger.org.mybatis=DEBUG
log4j.appender.A1=org.apache.log4j.ConsoleAppender
log4j.appender.A1.layout=org.apache.log4j.PatternLayout
log4j.appender.A1.layout.ConversionPattern=%-d{yyyy-MM-dd HH:mm:ss,SSS} [%t] [%c]-[%p] %m%n
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;4-测试&#34;&gt;4、测试&lt;/h2&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;//查询全部
@Test
public void testFindAll() throws Exception{
    //通过流的方式读取配置文件
    InputStream inputStream = Resources.getResourceAsStream(&amp;quot;mybatis-config.xml&amp;quot;);
    //1.读取配置文件,得到SqlSessionFactory
    SqlSessionFactory sqlSessionFactory = new SqlSessionFactoryBuilder().build(inputStream );
    //2.创建SqlSession
    SqlSession sqlSession = sqlSessionFactory.openSession();
    //3.查询所有(参数：是namespace.statementId)
    List&amp;lt;Book&amp;gt; list = sqlSession.selectList(&amp;quot;test.selectAllBooks&amp;quot;);
    System.out.println(list);
}
&lt;/code&gt;&lt;/pre&gt;
&lt;h1 id=&#34;properties属性&#34;&gt;properties属性&lt;/h1&gt;
&lt;p&gt;创建一个外部的properties文件&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-properties&#34;&gt;jdbc.dirver=com.mysql.jdbc.Driver
jdbc.url=jdbc:mysql://localhost:3306/mybatis?useUnicode=true&amp;amp;amp;characterEncoding=utf-8
jdbc.username=root
jdbc.password=root
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;在核心配置文件中引用properties文件&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-xml&#34;&gt;&amp;lt;properties resource=&amp;quot;jdbc.properties&amp;quot;/&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;使用&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-xml&#34;&gt;${jdbc.dirver}
${jdbc.url}
${jdbc.username}
&lt;/code&gt;&lt;/pre&gt;
&lt;h1 id=&#34;settings&#34;&gt;settings&lt;/h1&gt;
&lt;p&gt;&lt;code&gt;mapUnderscoreToCamelCase&lt;/code&gt;:开启驼峰命名，可以帮助我们完成数据库的经典命名规则，到java的经典命名规则（驼峰命名发）&lt;/p&gt;
&lt;p&gt;如：数据库叫user_name  到java类（&lt;code&gt;pojo&lt;/code&gt;）中是&lt;code&gt;userName&lt;/code&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-xml&#34;&gt;&amp;lt;settings&amp;gt;
    &amp;lt;!-- 开启驼峰命名 --&amp;gt;
    &amp;lt;setting name=&amp;quot;mapUnderscoreToCamelCase&amp;quot; value=&amp;quot;true&amp;quot;/&amp;gt;
    &amp;lt;!--指定 MyBatis 所用日志的具体实现，未指定时将自动查找。
	日志类型：
	STDOUT_LOGGING 不需要导入jar包，因为是mybatis自带
	NO_LOGGING 代表不需要日志输出
	SLF4J | LOG4J | LOG4J2 | JDK_LOGGING | COMMONS_LOGGING | STDOUT_LOGGING | NO_LOGGING
 	--&amp;gt;
    &amp;lt;setting name=&amp;quot;logImpl&amp;quot; value=&amp;quot;STDOUT_LOGGING&amp;quot;/&amp;gt;
&amp;lt;/settings&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;分析日志输出&lt;/p&gt;
&lt;figure data-type=&#34;image&#34; tabindex=&#34;1&#34;&gt;&lt;img src=&#34;MyBatis.assets%5Cimage-20200307124719177.png&#34; alt=&#34;image-20200307124719177&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
&lt;h1 id=&#34;typealiases类型别名&#34;&gt;typeAliases（类型别名）&lt;/h1&gt;
&lt;h2 id=&#34;自定义别名&#34;&gt;自定义别名&lt;/h2&gt;
&lt;pre&gt;&lt;code class=&#34;language-xml&#34;&gt;&amp;lt;!--别名，用于简化--&amp;gt;
&amp;lt;typeAliases&amp;gt;
    &amp;lt;!--type：包+类名，alias：别名--&amp;gt;
    &amp;lt;typeAlias type=&amp;quot;com.cn.mybatis.entity.IcpInfo&amp;quot; alias=&amp;quot;Icp&amp;quot; /&amp;gt;
    &amp;lt;!--使用包的方式
		每一个在包 domain.blog 中的 Java Bean，在没有注解的情况下
		会使用 Bean 的首字母小写的非限定类名来作为它的别名
		(这句话意思是：@Alias(&amp;quot;author&amp;quot;)
		在使用包方式时，javaBean没有添加注解指定别名时自动使用类名{首字母小写})
	--&amp;gt;
    &amp;lt;package name=&amp;quot;com.cn.mybatis.entity&amp;quot;/&amp;gt;
&amp;lt;/typeAliases&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;h1 id=&#34;plugins插件&#34;&gt;plugins（插件）&lt;/h1&gt;
&lt;h1 id=&#34;xml映射&#34;&gt;XML映射&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;cache&lt;/code&gt; – 对给定命名空间的缓存配置。&lt;/li&gt;
&lt;li&gt;&lt;code&gt;cache-ref&lt;/code&gt; – 对其他命名空间缓存配置的引用。&lt;/li&gt;
&lt;li&gt;&lt;code&gt;resultMap&lt;/code&gt; – 是最复杂也是最强大的元素，用来描述如何从数据库结果集中来加载对象。&lt;/li&gt;
&lt;li&gt;&lt;code&gt;parameterMap&lt;/code&gt; – 已被废弃！老式风格的参数映射。更好的办法是使用内联参数，此元素可能在将来被移除。文档中不会介绍此元素。&lt;/li&gt;
&lt;li&gt;&lt;code&gt;sql&lt;/code&gt; – 可被其他语句引用的可重用语句块。&lt;/li&gt;
&lt;li&gt;&lt;code&gt;insert&lt;/code&gt; – 映射插入语句&lt;/li&gt;
&lt;li&gt;&lt;code&gt;update&lt;/code&gt; – 映射更新语句&lt;/li&gt;
&lt;li&gt;&lt;code&gt;delete&lt;/code&gt; – 映射删除语句&lt;/li&gt;
&lt;li&gt;&lt;code&gt;select&lt;/code&gt; – 映射查询语句&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;select-查询语句&#34;&gt;select 查询语句&lt;/h2&gt;
&lt;pre&gt;&lt;code class=&#34;language-xml&#34;&gt;&amp;lt;!--
	id：一般和Mepper接口的方法名称相同，在命名空间中唯一的标识符，可以被用来引用这条语句。
	parameterType：接收一个int类型的参数
		接收参数使用#{ }包裹着，这个参数对应着接口的参数
	resultType：返回一个hashmap 类型的数据

--&amp;gt;
&amp;lt;select id=&amp;quot;selectPerson&amp;quot; parameterType=&amp;quot;int&amp;quot; resultType=&amp;quot;hashmap&amp;quot;&amp;gt;
  SELECT * FROM PERSON WHERE ID = #{id}
&amp;lt;/select&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;insert-updatea-delete&#34;&gt;insert updatea delete&lt;/h2&gt;
&lt;p&gt;在使用这些语句的时候需要提交事务：session.commit();&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-xml&#34;&gt;&amp;lt;insert id=&amp;quot;addIcpInfo&amp;quot; parameterType=&amp;quot;icpInfo&amp;quot; &amp;gt;
    insert into icpinfo (icp, name, address, home, introduce, author, email, date, type) values (#{icp}, #{name}, #{address}, #{home}, #{introduce}, #{author}, #{email}, #{date}, #{type})
&amp;lt;/insert&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;获取插入数据后的主键id：useGeneratedKeys=&amp;quot;true&amp;quot; keyProperty=&amp;quot;cip&amp;quot;&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-xml&#34;&gt;&amp;lt;insert id=&amp;quot;addIcpInfo&amp;quot; useGeneratedKeys=&amp;quot;true&amp;quot; keyProperty=&amp;quot;cip&amp;quot;&amp;gt;
    insert into icpinfo (icp, name, address, home, introduce, author, email, date, type) values (#{icp}, #{name}, #{address}, #{home}, #{introduce}, #{author}, #{email}, #{date}, #{type})
&amp;lt;/insert&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;插入多条数据：传入一个 数组或集合，并返回自动生成的主键。&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-xml&#34;&gt;&amp;lt;insert id=&amp;quot;addIcpInfoList&amp;quot; useGeneratedKeys=&amp;quot;true&amp;quot; keyProperty=&amp;quot;cip&amp;quot;&amp;gt;
    insert into icpinfo (icp, name, address, home, introduce, author, email, date, type) values
    &amp;lt;foreach collection=&amp;quot;list&amp;quot; item=&amp;quot;item&amp;quot; separator=&amp;quot;,&amp;quot;&amp;gt;
        (#{item.icp}, #{item.name}, #{item.address}, #{item.home}, #{item.introduce}, #{item.author}, #{item.email}, #{item.date}, #{item.type})
    &amp;lt;/foreach&amp;gt;
&amp;lt;/insert&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;h1 id=&#34;动态sql&#34;&gt;动态SQL&lt;/h1&gt;
&lt;h2 id=&#34;if&#34;&gt;if&lt;/h2&gt;
&lt;pre&gt;&lt;code class=&#34;language-xml&#34;&gt;对于输入映射类型为pojo类型：
#{pojo中的属性名}   ${pojo中的属性名}
&amp;lt;if test=&amp;quot;gradeId != null&amp;quot;&amp;gt;
    and grade_id = #{gradeId}
&amp;lt;/if&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;sql注入的问题&#34;&gt;sql注入的问题&lt;/h2&gt;
&lt;p&gt;在使用${}会出现&lt;code&gt;sql&lt;/code&gt;注入的问题（拼接字符串，没有使用预编译）&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-xml&#34;&gt;如果为简单数据类型需要把name换成_parameter
&amp;lt;bind name=&amp;quot;n&amp;quot; value=&amp;quot;&#39;%&#39;+name+&#39;%&#39;&amp;quot;/&amp;gt;
and name like #{n}
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;when&#34;&gt;when&lt;/h2&gt;
&lt;p&gt;应用场景：可能查询全部，有可能根据条件查询，并且如果第一个条件前面有and，where子句会自动把这个and删除再作为sql语句运行&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-xml&#34;&gt;&amp;lt;select id=&amp;quot;findStudentByLike&amp;quot; resultType=&amp;quot;student&amp;quot; parameterType=&amp;quot;student&amp;quot;&amp;gt;
    select * from student
    &amp;lt;where&amp;gt;
        &amp;lt;if test=&amp;quot;name != null and name != &#39;&#39;&amp;quot;&amp;gt;
            &amp;lt;bind name=&amp;quot;n&amp;quot; value=&amp;quot;&#39;%&#39;+name+&#39;%&#39;&amp;quot;/&amp;gt;
            and name like #{n}
        &amp;lt;/if&amp;gt;
        &amp;lt;if test=&amp;quot;gradeId != null&amp;quot;&amp;gt;
            and grade_id = #{gradeId}
        &amp;lt;/if&amp;gt;
    &amp;lt;/where&amp;gt;
&amp;lt;/select&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;choose&#34;&gt;choose&lt;/h2&gt;
&lt;p&gt;其实就是java中的switch  或者 if...else if ...else&lt;/p&gt;
&lt;h2 id=&#34;set&#34;&gt;set&lt;/h2&gt;
&lt;p&gt;set标签作用：能自动的判断是否在sql语句的结尾处是否要添加逗号，如果不需要逗号它自动帮我们删除&lt;/p&gt;
&lt;p&gt;(和where一样不会自动添加)&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-xml&#34;&gt;&amp;lt;update id=&amp;quot;updateStudentByById&amp;quot; parameterType=&amp;quot;student&amp;quot;&amp;gt;
    update student
    &amp;lt;set&amp;gt;
        &amp;lt;if test=&amp;quot;name != null&amp;quot;&amp;gt;
            name = #{name},
        &amp;lt;/if&amp;gt;
        &amp;lt;if test=&amp;quot;gradeId != null&amp;quot;&amp;gt;
            grade_id = #{gradeId}
        &amp;lt;/if&amp;gt;
    &amp;lt;/set&amp;gt;
    where id = #{id}
&amp;lt;/update&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;foreach&#34;&gt;foreach&lt;/h2&gt;
&lt;pre&gt;&lt;code class=&#34;language-xml&#34;&gt;&amp;lt;select id=&amp;quot;findStudentsById&amp;quot; parameterType=&amp;quot;int&amp;quot; resultType=&amp;quot;student&amp;quot;&amp;gt;
        select * from student where id in
        &amp;lt;foreach collection=&amp;quot;list&amp;quot; open=&amp;quot;(&amp;quot; separator=&amp;quot;,&amp;quot; close=&amp;quot;)&amp;quot; item=&amp;quot;item&amp;quot;&amp;gt;
            #{item}
        &amp;lt;/foreach&amp;gt;
    &amp;lt;/select&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;h1 id=&#34;sql片段&#34;&gt;SQL片段&lt;/h1&gt;
&lt;pre&gt;&lt;code class=&#34;language-xml&#34;&gt;&amp;lt;sql id=&amp;quot;sql&amp;quot;&amp;gt;
    select * from student
&amp;lt;/sql&amp;gt;
调用
&amp;lt;include refid=&amp;quot;sql&amp;quot;&amp;gt;&amp;lt;/include&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;h1 id=&#34;多表联合查询&#34;&gt;多表联合查询&lt;/h1&gt;
&lt;h2 id=&#34;vo&#34;&gt;VO&lt;/h2&gt;
&lt;p&gt;解决思路：要求返回的是一个对象，如果&lt;code&gt;pojo&lt;/code&gt;不能满足(要返回的列不存在&lt;code&gt;pojo&lt;/code&gt;中)，那么创建一个VO对象，这个VO对象中包含了所有要返回的字段&lt;/p&gt;
&lt;h3 id=&#34;创建一个vo&#34;&gt;创建一个VO&lt;/h3&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;package cn.kgc.vo;

import cn.kgc.pojo.Student;
//继承的原则：要返回的字段哪个pojo中多，那么就继承哪个pojo
public class StudentVO extends Student{
	private String gradeName;

	public String getGradeName() {
		return gradeName;
	}

	public void setGradeName(String gradeName) {
		this.gradeName = gradeName;
	}	
}
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;编写mapper接口&#34;&gt;编写mapper接口&lt;/h3&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;public interface StudentMapper {
	/**
	 * 查询学生信息，要求展示学生信息中年级名称(联合查询)
	 */
	List&amp;lt;StudentVO&amp;gt; getStudentVO();
}
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;编写mapperxml&#34;&gt;编写mapper.xml&lt;/h3&gt;
&lt;pre&gt;&lt;code class=&#34;language-xml&#34;&gt;&amp;lt;select id=&amp;quot;getStudentVO&amp;quot; resultType=&amp;quot;cn.kgc.vo.StudentVO&amp;quot;&amp;gt;
	SELECT s.*,g.name gradeName FROM student s,grade g WHERE s.grade_id=g.id
&amp;lt;/select&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;一对一&#34;&gt;一对一&lt;/h2&gt;
&lt;h3 id=&#34;按照查询嵌套处理&#34;&gt;按照查询嵌套处理&lt;/h3&gt;
&lt;pre&gt;&lt;code class=&#34;language-xml&#34;&gt;&amp;lt;resultMap id=&amp;quot;IcpInfoType&amp;quot; type=&amp;quot;icpInfo&amp;quot;&amp;gt;
&amp;lt;!-- property：实体类的对象属性名，
	column：数据库中关联的列，
	javaType：实体类对象，
	select：一个sql语句查询的是实体对象的sql
--&amp;gt;
    &amp;lt;association property=&amp;quot;type&amp;quot; column=&amp;quot;type&amp;quot; javaType=&amp;quot;type&amp;quot; select=&amp;quot;getTypeList&amp;quot; /&amp;gt;
&amp;lt;/resultMap&amp;gt;
&amp;lt;select id=&amp;quot;getList&amp;quot; resultMap=&amp;quot;IcpInfoType&amp;quot;&amp;gt;
    select * from icpinfo
&amp;lt;/select&amp;gt;
&amp;lt;!--这个typeID 获取的是 column=&amp;quot;type&amp;quot; 这个列的值--&amp;gt;
&amp;lt;select id=&amp;quot;getTypeList&amp;quot; resultType=&amp;quot;type&amp;quot; &amp;gt;
    select * from type where tid = #{id}
&amp;lt;/select&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;按照结果嵌套处理&#34;&gt;按照结果嵌套处理&lt;/h3&gt;
&lt;pre&gt;&lt;code class=&#34;language-xml&#34;&gt;&amp;lt;select id=&amp;quot;getList2&amp;quot; resultMap=&amp;quot;getList2&amp;quot; &amp;gt;
    select icp, name, address, home, introduce, author, email, `date`, type, tid, tname from icpinfo i ,type t
    where i.type = t.tid
&amp;lt;/select&amp;gt;
&amp;lt;!--type = 要查询的对象--&amp;gt;
&amp;lt;resultMap id=&amp;quot;getList2&amp;quot; type=&amp;quot;icpInfo&amp;quot; &amp;gt;
    &amp;lt;!--property=实体类的属性名 column=列名or别名--&amp;gt;
    &amp;lt;result property=&amp;quot;icp&amp;quot; column=&amp;quot;icp&amp;quot; /&amp;gt;
    &amp;lt;result property=&amp;quot;name&amp;quot; column=&amp;quot;name&amp;quot; /&amp;gt;
    &amp;lt;result property=&amp;quot;address&amp;quot; column=&amp;quot;address&amp;quot; /&amp;gt;
    &amp;lt;result property=&amp;quot;home&amp;quot; column=&amp;quot;home&amp;quot; /&amp;gt;
    &amp;lt;result property=&amp;quot;introduce&amp;quot; column=&amp;quot;introduce&amp;quot; /&amp;gt;
    &amp;lt;result property=&amp;quot;author&amp;quot; column=&amp;quot;author&amp;quot; /&amp;gt;
    &amp;lt;result property=&amp;quot;email&amp;quot; column=&amp;quot;email&amp;quot; /&amp;gt;
    &amp;lt;result property=&amp;quot;date&amp;quot; column=&amp;quot;date&amp;quot; /&amp;gt;
    &amp;lt;!--复杂类型
		property=在icpInfo里的属性是type
		javaType=type的对象
	--&amp;gt;
    &amp;lt;association property=&amp;quot;type&amp;quot; javaType=&amp;quot;type&amp;quot; &amp;gt;
        &amp;lt;result property=&amp;quot;tid&amp;quot; column=&amp;quot;tid&amp;quot; /&amp;gt;
        &amp;lt;result property=&amp;quot;tname&amp;quot; column=&amp;quot;tname&amp;quot; /&amp;gt;
    &amp;lt;/association&amp;gt;
&amp;lt;/resultMap&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;一对多&#34;&gt;一对多&lt;/h2&gt;
&lt;p&gt;一对多只需要把association换成&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-xml&#34;&gt;&amp;lt;!--ofType=&amp;quot;&amp;quot;
	集合中的泛型信息
--&amp;gt;
&amp;lt;collection property=&amp;quot;&amp;quot; ofType=&amp;quot;&amp;quot;&amp;gt;&amp;lt;/collection&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&#34;language-xml&#34;&gt;&amp;lt;?xml version=&amp;quot;1.0&amp;quot; encoding=&amp;quot;UTF-8&amp;quot; ?&amp;gt;
&amp;lt;!DOCTYPE mapper
  PUBLIC &amp;quot;-//mybatis.org//DTD Mapper 3.0//EN&amp;quot;
  &amp;quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&amp;quot;&amp;gt;
&amp;lt;mapper namespace=&amp;quot;cn.kgc.mapper.GradeMapper&amp;quot;&amp;gt;
	&amp;lt;!-- 查询年级，把属于这个年级的所有学生查询出来 --&amp;gt;
	&amp;lt;resultMap type=&amp;quot;cn.kgc.pojo.Grade&amp;quot; id=&amp;quot;gradeStudentMap&amp;quot;&amp;gt;
		&amp;lt;id column=&amp;quot;id&amp;quot; property=&amp;quot;id&amp;quot; javaType=&amp;quot;int&amp;quot;/&amp;gt;
		&amp;lt;result column=&amp;quot;name&amp;quot; property=&amp;quot;name&amp;quot; javaType=&amp;quot;string&amp;quot;/&amp;gt;
		&amp;lt;!-- collection:一对多的映射关系
			property:表示一对多映射关系在pojo中的属性名
			ofType:表示该集合的泛型的全限定名
		 --&amp;gt;
		&amp;lt;collection property=&amp;quot;studentList&amp;quot; ofType=&amp;quot;cn.kgc.pojo.Student&amp;quot;&amp;gt;
			&amp;lt;id column=&amp;quot;sid&amp;quot; property=&amp;quot;id&amp;quot; javaType=&amp;quot;int&amp;quot;/&amp;gt;
			&amp;lt;result column=&amp;quot;sname&amp;quot; property=&amp;quot;name&amp;quot; javaType=&amp;quot;string&amp;quot;/&amp;gt;
			&amp;lt;!-- gradeid因为在grade中已经有了，所以不需要再配置 --&amp;gt;
		&amp;lt;/collection&amp;gt;
	&amp;lt;/resultMap&amp;gt;
	
	&amp;lt;select id=&amp;quot;getGradeById&amp;quot; parameterType=&amp;quot;int&amp;quot; resultMap=&amp;quot;gradeStudentMap&amp;quot;&amp;gt;
		SELECT 
		  g.*,
		  s.id sid,
		  s.name sname
		FROM
		  grade g,
		  student s 
		WHERE g.id = s.grade_id 
		  AND g.id = #{id}
	&amp;lt;/select&amp;gt;
&amp;lt;/mapper&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;多对多&#34;&gt;多对多&lt;/h3&gt;
&lt;pre&gt;&lt;code class=&#34;language-xml&#34;&gt;&amp;lt;?xml version=&amp;quot;1.0&amp;quot; encoding=&amp;quot;UTF-8&amp;quot; ?&amp;gt;
&amp;lt;!DOCTYPE mapper
  PUBLIC &amp;quot;-//mybatis.org//DTD Mapper 3.0//EN&amp;quot;
  &amp;quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&amp;quot;&amp;gt;
&amp;lt;mapper namespace=&amp;quot;cn.kgc.mapper.StudentMapper&amp;quot;&amp;gt;
	&amp;lt;resultMap type=&amp;quot;cn.kgc.pojo.Student&amp;quot; id=&amp;quot;studentMap&amp;quot;&amp;gt;
		&amp;lt;id column=&amp;quot;id&amp;quot; property=&amp;quot;id&amp;quot; javaType=&amp;quot;int&amp;quot;/&amp;gt;
		&amp;lt;result column=&amp;quot;name&amp;quot; property=&amp;quot;name&amp;quot; javaType=&amp;quot;string&amp;quot;/&amp;gt;
		&amp;lt;result column=&amp;quot;grade_id&amp;quot; property=&amp;quot;gradeId&amp;quot; javaType=&amp;quot;int&amp;quot;/&amp;gt;
		&amp;lt;!-- 一对多的映射关系 --&amp;gt;
		&amp;lt;collection property=&amp;quot;studentCourseList&amp;quot; ofType=&amp;quot;cn.kgc.pojo.StudentCourse&amp;quot;&amp;gt;
			&amp;lt;id column=&amp;quot;scid&amp;quot; property=&amp;quot;id&amp;quot; javaType=&amp;quot;int&amp;quot;/&amp;gt;
			&amp;lt;!-- studentCourse和course是一对一的映射俄关系 --&amp;gt;
			&amp;lt;association property=&amp;quot;course&amp;quot; javaType=&amp;quot;cn.kgc.pojo.Course&amp;quot;&amp;gt;
				&amp;lt;id column=&amp;quot;cid&amp;quot; property=&amp;quot;id&amp;quot; javaType=&amp;quot;int&amp;quot;/&amp;gt;
				&amp;lt;result column=&amp;quot;cname&amp;quot; property=&amp;quot;name&amp;quot; javaType=&amp;quot;string&amp;quot;/&amp;gt;
			&amp;lt;/association&amp;gt;
		&amp;lt;/collection&amp;gt;
	&amp;lt;/resultMap&amp;gt;

	&amp;lt;select id=&amp;quot;getStudentById&amp;quot; parameterType=&amp;quot;int&amp;quot; resultMap=&amp;quot;studentMap&amp;quot;&amp;gt;
	SELECT 
	  s.*,
	  sc.id scid,
	  c.id cid,
	  c.name cname 
	FROM
	  student s,
	  student_course sc,
	  course c 
	WHERE s.id = sc.sid 
	  AND c.id = sc.cid 
	  AND s.id = #{id}
	&amp;lt;/select&amp;gt;
&amp;lt;/mapper&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;h1 id=&#34;延迟加载&#34;&gt;延迟加载&lt;/h1&gt;
&lt;p&gt;什么是懒加载&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;懒加载：就是在需要数据的时候才加载，不需要数据的时候不加载，这样有利于系统性能的提升，这就是懒加载（也叫做延迟加载）

好处：在关联查询的时候，根据需求进行关联查询，大大提高了数据库的查询性能。（单表的查询效率永远要比多表联合查询的效率高）

坏处：因为需要用到数据的时候才去做查询，这样大批量的数据查询的时候等待时间会变得更长，造成用户的体验下降
(select * from student)会把所有的学生的年级编号也在里面
突然要查询年级信息，它底层操作是：根据年级id一个一个去执行查询
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;使用association实现懒加载&#34;&gt;使用&lt;code&gt;association&lt;/code&gt;实现懒加载&lt;/h2&gt;
&lt;h3 id=&#34;核心配置开启懒加载&#34;&gt;核心配置开启懒加载&lt;/h3&gt;
&lt;pre&gt;&lt;code class=&#34;language-xml&#34;&gt; &amp;lt;settings&amp;gt;
  	&amp;lt;!-- 开启懒加载 --&amp;gt;
  	&amp;lt;setting name=&amp;quot;lazyLoadingEnabled&amp;quot; value=&amp;quot;true&amp;quot;/&amp;gt;
  	&amp;lt;!-- mybatis3.4.1之前默认值是true，需要设置为false（将积极加载改为消息加载也就是按需加载） --&amp;gt;
  	&amp;lt;setting name=&amp;quot;aggressiveLazyLoading&amp;quot; value=&amp;quot;false&amp;quot;/&amp;gt;
  	&amp;lt;!-- 因为我这里为了打印对象里信息的方便，所以都重写了toString方法，mybatis中默认是如果使用(equals,clone,hashCode,toString任意一个方法)那么就不再延迟加载 --&amp;gt;
  	&amp;lt;setting name=&amp;quot;lazyLoadTriggerMethods&amp;quot; value=&amp;quot;&amp;quot;/&amp;gt;
  &amp;lt;/settings&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;GradeMapper.xml&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-xml&#34;&gt;&amp;lt;?xml version=&amp;quot;1.0&amp;quot; encoding=&amp;quot;UTF-8&amp;quot; ?&amp;gt;
&amp;lt;!DOCTYPE mapper
  PUBLIC &amp;quot;-//mybatis.org//DTD Mapper 3.0//EN&amp;quot;
  &amp;quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&amp;quot;&amp;gt;
&amp;lt;mapper namespace=&amp;quot;cn.kgc.mapper.GradeMapper&amp;quot;&amp;gt;
	&amp;lt;!-- 根据id查询年级对象 --&amp;gt;
	&amp;lt;select id=&amp;quot;getGradeById&amp;quot; parameterType=&amp;quot;int&amp;quot; resultType=&amp;quot;cn.kgc.pojo.Grade&amp;quot;&amp;gt;
		select * from grade where id=#{id}
	&amp;lt;/select&amp;gt;
&amp;lt;/mapper&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;StudentMapper.xml&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-xml&#34;&gt;&amp;lt;?xml version=&amp;quot;1.0&amp;quot; encoding=&amp;quot;UTF-8&amp;quot; ?&amp;gt;
&amp;lt;!DOCTYPE mapper
  PUBLIC &amp;quot;-//mybatis.org//DTD Mapper 3.0//EN&amp;quot;
  &amp;quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&amp;quot;&amp;gt;
&amp;lt;mapper namespace=&amp;quot;cn.kgc.mapper.StudentMapper&amp;quot;&amp;gt;
	
	&amp;lt;resultMap type=&amp;quot;cn.kgc.pojo.Student&amp;quot; id=&amp;quot;studentMap&amp;quot;&amp;gt;
		&amp;lt;id column=&amp;quot;id&amp;quot; property=&amp;quot;id&amp;quot; javaType=&amp;quot;int&amp;quot;/&amp;gt;
		&amp;lt;result column=&amp;quot;name&amp;quot; property=&amp;quot;name&amp;quot; javaType=&amp;quot;string&amp;quot;/&amp;gt;
		&amp;lt;!-- 一个学生对应一个年级：一对一的关系映射
			对于association方式的懒加载：
				select:此处要求是根据年级的id查询年级对象的mapper接口中方法的全限定名
				column:在数据库中表与表之间关系的外键
		 --&amp;gt;
		&amp;lt;association property=&amp;quot;grade&amp;quot; javaType=&amp;quot;cn.kgc.pojo.Grade&amp;quot;
			select=&amp;quot;cn.kgc.mapper.GradeMapper.getGradeById&amp;quot; column=&amp;quot;grade_id&amp;quot;&amp;gt;&amp;lt;/association&amp;gt;
	&amp;lt;/resultMap&amp;gt;
	
	&amp;lt;select id=&amp;quot;getAllStudents&amp;quot; resultMap=&amp;quot;studentMap&amp;quot;&amp;gt;
		select * from student
	&amp;lt;/select&amp;gt;
&amp;lt;/mapper&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;使用collection实现懒加载&#34;&gt;使用&lt;code&gt;collection&lt;/code&gt;实现懒加载&lt;/h2&gt;
&lt;h3 id=&#34;核心配置开启懒加载-2&#34;&gt;核心配置开启懒加载&lt;/h3&gt;
&lt;pre&gt;&lt;code class=&#34;language-xml&#34;&gt;&amp;lt;settings&amp;gt;
&amp;lt;!-- 开启懒加载 --&amp;gt;
&amp;lt;setting name=&amp;quot;lazyLoadingEnabled&amp;quot; value=&amp;quot;true&amp;quot;/&amp;gt;
&amp;lt;!-- mybatis3.4.1之前默认值是true，需要设置为false（将积极加载改为消息加载也就是按需加载） --&amp;gt;
&amp;lt;setting name=&amp;quot;aggressiveLazyLoading&amp;quot; value=&amp;quot;false&amp;quot;/&amp;gt;
&amp;lt;!-- 因为我这里为了打印对象里信息的方便，所以都重写了toString方法，mybatis中默认是如果使用(equals,clone,hashCode,toString任意一个方法)那么就不再延迟加载 --&amp;gt;
&amp;lt;setting name=&amp;quot;lazyLoadTriggerMethods&amp;quot; value=&amp;quot;&amp;quot;/&amp;gt;
&amp;lt;/settings&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;StudentMapper.xml&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-xml&#34;&gt;&amp;lt;select id=&amp;quot;getStudentsByGradeId&amp;quot; parameterType=&amp;quot;int&amp;quot; resultType=&amp;quot;cn.kgc.pojo.Student&amp;quot;&amp;gt;
    select * from student where grade_id=#{gradeId}
&amp;lt;/select&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;GradeMapper.xml&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-xml&#34;&gt;&amp;lt;!-- 查询年级信息，有可能查询年级中所有的学生信息 --&amp;gt;
&amp;lt;resultMap type=&amp;quot;cn.kgc.pojo.Grade&amp;quot; id=&amp;quot;gradeMap&amp;quot;&amp;gt;
    &amp;lt;id column=&amp;quot;id&amp;quot; property=&amp;quot;id&amp;quot; javaType=&amp;quot;int&amp;quot;/&amp;gt;
    &amp;lt;result column=&amp;quot;name&amp;quot; property=&amp;quot;name&amp;quot; javaType=&amp;quot;string&amp;quot;/&amp;gt;
    &amp;lt;!-- 一对多的映射关系
        select:根据年级编号查询学生列表的方法
        column:就是grade的id（它就是grade表的主键）
     --&amp;gt;
    &amp;lt;collection property=&amp;quot;studentList&amp;quot; ofType=&amp;quot;cn.kgc.pojo.Student&amp;quot;
        select=&amp;quot;cn.kgc.mapper.StudentMapper.getStudentsByGradeId&amp;quot; column=&amp;quot;id&amp;quot;&amp;gt;&amp;lt;/collection&amp;gt;
&amp;lt;/resultMap&amp;gt;
&amp;lt;select id=&amp;quot;getAllGrades&amp;quot; resultMap=&amp;quot;gradeMap&amp;quot;&amp;gt;
    select * from grade
&amp;lt;/select&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;h1 id=&#34;mybatis缓存&#34;&gt;mybatis缓存&lt;/h1&gt;
&lt;h2 id=&#34;一级缓存&#34;&gt;一级缓存&lt;/h2&gt;
&lt;p&gt;它是&lt;code&gt;SqlSession&lt;/code&gt;级别的，同一个&lt;code&gt;SqlSession&lt;/code&gt;才涉及到一级缓存&lt;/p&gt;
&lt;p&gt;一级缓存是默认存在，它不需要去做任何的设置&lt;/p&gt;
&lt;h2 id=&#34;二级缓存&#34;&gt;二级缓存&lt;/h2&gt;
&lt;p&gt;它是mapper级别的，需要开启才能使用&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;缓存在实际开发中是很有用的，它能大大的提升查询的效率，提高程序的性能&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&#34;在核心配置文件中开启二级缓存&#34;&gt;在核心配置文件中开启二级缓存&lt;/h3&gt;
&lt;pre&gt;&lt;code class=&#34;language-xml&#34;&gt;&amp;lt;!-- 开启二级缓存(默认值就是true，准备我们使用二级缓存，可以不用设置) --&amp;gt;
&amp;lt;setting name=&amp;quot;cacheEnabled&amp;quot; value=&amp;quot;true&amp;quot;/&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;在mappexml中开启二级缓存&#34;&gt;在mappe.xml中开启二级缓存&lt;/h3&gt;
&lt;pre&gt;&lt;code class=&#34;language-xml&#34;&gt;&amp;lt;mapper namespace=&amp;quot;cn.kgc.mapper.StudentMapper&amp;quot;&amp;gt;
	&amp;lt;!-- 在StudentMapper.xml中开启二级缓存 ,因为mybatis中二级缓存的实现类只有一个，默认就是这个，type可以省略不写--&amp;gt;
	&amp;lt;cache type=&amp;quot;org.apache.ibatis.cache.impl.PerpetualCache&amp;quot;&amp;gt;&amp;lt;/cache&amp;gt;
&amp;lt;/mapper&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;pojo需要实现序列化接口&#34;&gt;pojo需要实现序列化接口&lt;/h3&gt;
&lt;p&gt;因为缓存的时候要将pojo流化然后存储在内存中，查询再取出&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;public class Student implements Serializable{
}
&lt;/code&gt;&lt;/pre&gt;
&lt;blockquote&gt;
&lt;p&gt;补充：在mapper应用二级缓存后，默认是所有的查询方法都开启二级缓存，如果要某个查询不使用二级缓存可以添加&lt;code&gt;useCache=&amp;quot;false&amp;quot;&lt;/code&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h1 id=&#34;注解开发入门&#34;&gt;注解开发入门&lt;/h1&gt;
&lt;p&gt;在spring4.x开始就推荐我们使用注解，完全去取代xml的配置文件&lt;/p&gt;
&lt;p&gt;目前最主流的开发方式就是：只使用注解，不再使用xml配置&lt;/p&gt;
&lt;p&gt;mybatis注解方式的开发是一种未来的趋势,这种方式比传统的xml的开发要简单并且高效&lt;/p&gt;
&lt;h2 id=&#34;导入jar包&#34;&gt;导入jar包&lt;/h2&gt;
&lt;pre&gt;&lt;code class=&#34;language-xml&#34;&gt;&amp;lt;dependencies&amp;gt;
    &amp;lt;!-- mysql驱动 --&amp;gt;
    &amp;lt;dependency&amp;gt;
        &amp;lt;groupId&amp;gt;mysql&amp;lt;/groupId&amp;gt;
        &amp;lt;artifactId&amp;gt;mysql-connector-java&amp;lt;/artifactId&amp;gt;
        &amp;lt;version&amp;gt;5.1.38&amp;lt;/version&amp;gt;
    &amp;lt;/dependency&amp;gt;
    &amp;lt;!-- mybatis的核心包 --&amp;gt;
    &amp;lt;dependency&amp;gt;
        &amp;lt;groupId&amp;gt;org.mybatis&amp;lt;/groupId&amp;gt;
        &amp;lt;artifactId&amp;gt;mybatis&amp;lt;/artifactId&amp;gt;
        &amp;lt;version&amp;gt;3.4.6&amp;lt;/version&amp;gt;
    &amp;lt;/dependency&amp;gt;
    &amp;lt;!-- junit单元测试 --&amp;gt;
    &amp;lt;dependency&amp;gt;
        &amp;lt;groupId&amp;gt;junit&amp;lt;/groupId&amp;gt;
        &amp;lt;artifactId&amp;gt;junit&amp;lt;/artifactId&amp;gt;
        &amp;lt;version&amp;gt;4.12&amp;lt;/version&amp;gt;
    &amp;lt;/dependency&amp;gt;
    &amp;lt;!-- slf4j-log4j12  (slf4j:酸辣粉) --&amp;gt;
    &amp;lt;dependency&amp;gt;
        &amp;lt;groupId&amp;gt;org.slf4j&amp;lt;/groupId&amp;gt;
        &amp;lt;artifactId&amp;gt;slf4j-log4j12&amp;lt;/artifactId&amp;gt;
        &amp;lt;version&amp;gt;1.7.25&amp;lt;/version&amp;gt;
    &amp;lt;/dependency&amp;gt;
&amp;lt;/dependencies&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;配置文件&#34;&gt;配置文件&lt;/h2&gt;
&lt;p&gt;log4j.properties&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-properties&#34;&gt;log4j.rootLogger=DEBUG,A1
log4j.logger.org.mybatis=DEBUG
log4j.appender.A1=org.apache.log4j.ConsoleAppender
log4j.appender.A1.layout=org.apache.log4j.PatternLayout
log4j.appender.A1.layout.ConversionPattern=%-d{yyyy-MM-dd HH:mm:ss,SSS} [%t] [%c]-[%p] %m%n
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;jdbc.properties&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-properties&#34;&gt;jdbc.dirver=com.mysql.jdbc.Driver
jdbc.url=jdbc:mysql://localhost:3306/mybatis?useUnicode=true&amp;amp;amp;characterEncoding=utf-8
jdbc.username=root
jdbc.password=root
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;mybatis-config.xml&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-xml&#34;&gt;&amp;lt;?xml version=&amp;quot;1.0&amp;quot; encoding=&amp;quot;UTF-8&amp;quot; ?&amp;gt;
&amp;lt;!DOCTYPE configuration
  PUBLIC &amp;quot;-//mybatis.org//DTD Config 3.0//EN&amp;quot;
  &amp;quot;http://mybatis.org/dtd/mybatis-3-config.dtd&amp;quot;&amp;gt;
&amp;lt;configuration&amp;gt;
  &amp;lt;!-- 引入外部的属性文件 --&amp;gt;
  &amp;lt;properties resource=&amp;quot;jdbc.properties&amp;quot;&amp;gt;&amp;lt;/properties&amp;gt;
  &amp;lt;settings&amp;gt;
  	&amp;lt;!-- 开启驼峰命名 --&amp;gt;
  	&amp;lt;setting name=&amp;quot;mapUnderscoreToCamelCase&amp;quot; value=&amp;quot;true&amp;quot;/&amp;gt;
  &amp;lt;/settings&amp;gt;
  &amp;lt;!-- 配置数据源 --&amp;gt;
  &amp;lt;environments default=&amp;quot;development&amp;quot;&amp;gt;
    &amp;lt;environment id=&amp;quot;development&amp;quot;&amp;gt;
      &amp;lt;transactionManager type=&amp;quot;JDBC&amp;quot;/&amp;gt;
      &amp;lt;dataSource type=&amp;quot;POOLED&amp;quot;&amp;gt;
        &amp;lt;property name=&amp;quot;driver&amp;quot; value=&amp;quot;${jdbc.dirver}&amp;quot;/&amp;gt;
        &amp;lt;property name=&amp;quot;url&amp;quot; value=&amp;quot;${jdbc.url}&amp;quot;/&amp;gt;
        &amp;lt;property name=&amp;quot;username&amp;quot; value=&amp;quot;${jdbc.username}&amp;quot;/&amp;gt;
        &amp;lt;property name=&amp;quot;password&amp;quot; value=&amp;quot;${jdbc.password}&amp;quot;/&amp;gt;
      &amp;lt;/dataSource&amp;gt;
    &amp;lt;/environment&amp;gt;
  &amp;lt;/environments&amp;gt;
  &amp;lt;mappers&amp;gt;
    &amp;lt;package name=&amp;quot;cn.kgc.mapper&amp;quot;/&amp;gt;
  &amp;lt;/mappers&amp;gt;
  
&amp;lt;/configuration&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;@Select(&amp;quot;SQL&amp;quot;)&lt;/p&gt;
&lt;p&gt;@Insert(&amp;quot;SQL&amp;quot;)&lt;/p&gt;
&lt;p&gt;@Delete(&amp;quot;SQL&amp;quot;)&lt;/p&gt;
&lt;p&gt;@Update(&amp;quot;SQL&amp;quot;)&lt;/p&gt;
&lt;h2 id=&#34;解决数据库表中的列名和pojo中属性名不一致&#34;&gt;解决数据库表中的列名和pojo中属性名不一致&lt;/h2&gt;
&lt;h3 id=&#34;第一种&#34;&gt;第一种&lt;/h3&gt;
&lt;p&gt;给sql 语句起别名&lt;/p&gt;
&lt;h3 id=&#34;第二种&#34;&gt;第二种&lt;/h3&gt;
&lt;p&gt;@Results  相当于是&lt;code&gt;resultMap&lt;/code&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;@Select(&amp;quot;select * from book&amp;quot;)
@Results(id=&amp;quot;bookMap&amp;quot;,
    value={
        @Result(id=true,column=&amp;quot;id&amp;quot;,property=&amp;quot;id&amp;quot;),
        @Result(column=&amp;quot;book_name&amp;quot;,property=&amp;quot;name&amp;quot;),
        @Result(column=&amp;quot;price&amp;quot;,property=&amp;quot;price&amp;quot;)
})
List&amp;lt;Book&amp;gt; getAllBooks();
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;注解开发中的动态sql&#34;&gt;注解开发中的动态sql&lt;/h2&gt;
&lt;h3 id=&#34;输入映射类型为简单类型&#34;&gt;输入映射类型为简单类型&lt;/h3&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;/**
 * 有可能查询全部，有可能根据id查询
 * 动态sql中输入映射为简单类型，输入映射为简单类型  test中变量名必须叫_parameter
 */
@Select(&amp;quot;&amp;lt;script&amp;gt;SELECT * FROM book &amp;lt;if test=&#39;_parameter != null&#39;&amp;gt;WHERE id=#{id}&amp;lt;/if&amp;gt;&amp;lt;/script&amp;gt;&amp;quot;)
List&amp;lt;Book&amp;gt; getBooksOrById(Integer id);
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;输入映射类型为pojo&#34;&gt;输入映射类型为pojo&lt;/h3&gt;
&lt;p&gt;开发产生SQL语句的类和方法&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;package cn.kgc.sql.provider;

import cn.kgc.pojo.Book;

public class BookMapperProvider {
	/**
	 * 专门用来给BookMapper接口来提供动态sql语句的
	 * @param book
	 * @return
	 */
	public String getBooks(Book book){
		String sql = &amp;quot;select * from book&amp;quot;;
		if(book != null){
			if(book.getId() != null){
				//id有值
				sql = &amp;quot;select * from book where id=#{id}&amp;quot;;
			}
			if(book.getName() != null &amp;amp;&amp;amp; !book.getName().equals(&amp;quot;&amp;quot;)){
				sql = &amp;quot;select * from book where name like #{name}&amp;quot;;
			}
			if(book.getId() != null &amp;amp;&amp;amp; (book.getName() != null &amp;amp;&amp;amp; !book.getName().equals(&amp;quot;&amp;quot;))){
				sql = &amp;quot;select * from book where id=#{id} and name like #{name}&amp;quot;;
			}
		}
		return sql;
	}
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;接口&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;/**
 * 查询：有可能查询全部，有可能根据id查询，有可能根据name做模糊查询
 * @param book
 * @return
 */
@SelectProvider(type=BookMapperProvider.class,method=&amp;quot;getBooks&amp;quot;)
List&amp;lt;Book&amp;gt; getBooks(Book book);
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;注解开发实现复杂的映射关系&#34;&gt;注解开发实现复杂的映射关系&lt;/h2&gt;
&lt;p&gt;复杂的映射开发本质是两种一对一、一对多&lt;/p&gt;
&lt;p&gt;注解就对应的是：@One(一对一)  @Many(一对多)&lt;/p&gt;
&lt;p&gt;要求我们使用懒加载&lt;/p&gt;
&lt;h3 id=&#34;一对一关系&#34;&gt;一对一关系&lt;/h3&gt;
&lt;p&gt;在核心配置文件中开启懒加载&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-xml&#34;&gt; &amp;lt;settings&amp;gt;
  	&amp;lt;!-- 开启驼峰命名 --&amp;gt;
  	&amp;lt;setting name=&amp;quot;mapUnderscoreToCamelCase&amp;quot; value=&amp;quot;true&amp;quot;/&amp;gt;
  	&amp;lt;!-- 开启懒加载 --&amp;gt;
  	&amp;lt;setting name=&amp;quot;lazyLoadingEnabled&amp;quot; value=&amp;quot;true&amp;quot;/&amp;gt;
  	&amp;lt;!-- mybatis3.4.1之前默认值是true，需要设置为false（将积极加载改为消息加载也就是按需加载） --&amp;gt;
  	&amp;lt;setting name=&amp;quot;aggressiveLazyLoading&amp;quot; value=&amp;quot;false&amp;quot;/&amp;gt;
  	&amp;lt;!-- 因为我这里为了打印对象里信息的方便，所以都重写了toString方法，mybatis中默认是如果使用(equals,clone,hashCode,toString任意一个方法)那么就不再延迟加载 --&amp;gt;
  	&amp;lt;setting name=&amp;quot;lazyLoadTriggerMethods&amp;quot; value=&amp;quot;&amp;quot;/&amp;gt;
  &amp;lt;/settings&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;public interface GradeMapper {
	/**
	 * 根据id查询对象
	 * @param id
	 * @return
	 */
	@Select(&amp;quot;select * from grade where id=#{id}&amp;quot;)
	Grade getGradeById(Integer id);
}

&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;public interface StudentMapper {
	/**
	 * 查询学生顺便将学生所在的年级名称查询出来
	 */
	@Select(&amp;quot;select * from student&amp;quot;)
	@Results(id=&amp;quot;studentMap&amp;quot;,
			value={
			@Result(id=true,column=&amp;quot;id&amp;quot;,property=&amp;quot;id&amp;quot;),
			@Result(column=&amp;quot;name&amp;quot;,property=&amp;quot;name&amp;quot;),
			@Result(column=&amp;quot;grade_id&amp;quot;,property=&amp;quot;grade&amp;quot;,
					one=@One(select=&amp;quot;cn.kgc.mapper.GradeMapper.getGradeById&amp;quot;,fetchType=FetchType.LAZY))
			
	})
	List&amp;lt;Student&amp;gt; getAllStudents();
}
&lt;/code&gt;&lt;/pre&gt;
&lt;blockquote&gt;
&lt;p&gt;FetchType.LAZY表示加载的方式是懒加载,   FetchType.EAGER表示一定联合查询&lt;/p&gt;
&lt;p&gt;如果不添加fetchType，默认就是懒加载&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&#34;一对多的关系&#34;&gt;一对多的关系&lt;/h2&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;public interface StudentMapper {
	/**
	 * 根据年级编号查询学生列表
	 * @param id
	 * @return
	 */
	@Select(&amp;quot;select * from student where grade_id=#{gid}&amp;quot;)
	List&amp;lt;Student&amp;gt; findStudentsListByGradeId(Integer id);
}
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;package cn.kgc.mapper;

import java.util.List;

import org.apache.ibatis.annotations.Many;
import org.apache.ibatis.annotations.Result;
import org.apache.ibatis.annotations.Results;
import org.apache.ibatis.annotations.Select;
import org.apache.ibatis.mapping.FetchType;

import cn.kgc.pojo.Grade;

public interface GradeMapper {

	@Select(&amp;quot;select * from grade&amp;quot;)
	@Results(id=&amp;quot;gradeMap&amp;quot;,
			value={
				@Result(id=true,column=&amp;quot;id&amp;quot;,property=&amp;quot;id&amp;quot;),
				@Result(column=&amp;quot;name&amp;quot;,property=&amp;quot;name&amp;quot;),
				@Result(column=&amp;quot;id&amp;quot;,property=&amp;quot;studentList&amp;quot;,
						many=@Many(select=&amp;quot;cn.kgc.mapper.StudentMapper.findStudentsListByGradeId&amp;quot;,fetchType=FetchType.LAZY))
	})
	List&amp;lt;Grade&amp;gt; getGrades();
}
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;mybatis基于二级缓存的开发&#34;&gt;mybatis基于二级缓存的开发&lt;/h2&gt;
&lt;p&gt;一级缓存基于&lt;code&gt;sqlSession&lt;/code&gt;的，默认就存在的，咱们可以不用管，它一定会存在&lt;/p&gt;
&lt;h3 id=&#34;4-1-在核心配置文件中开启二级缓存&#34;&gt;4-1 在核心配置文件中开启二级缓存&lt;/h3&gt;
&lt;pre&gt;&lt;code class=&#34;language-xml&#34;&gt;&amp;lt;!-- 开启二级缓存(新版本的mybatis默认就已经开启了，所以我们不用专门开) --&amp;gt;
&amp;lt;setting name=&amp;quot;cacheEnabled&amp;quot; value=&amp;quot;true&amp;quot;/&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;4-2-在mapper接口中使用注解配置开启二级缓存&#34;&gt;4-2 在mapper接口中使用注解配置开启二级缓存&lt;/h3&gt;
&lt;pre&gt;&lt;code class=&#34;language-xml&#34;&gt;&amp;lt;!-- 开启二级缓存(新版本的mybatis默认就已经开启了，所以我们不用专门开) --&amp;gt;
&amp;lt;setting name=&amp;quot;cacheEnabled&amp;quot; value=&amp;quot;true&amp;quot;/&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;4-2-pojo需要实现序列化-接口&#34;&gt;4-2 &lt;code&gt;pojo&lt;/code&gt;需要实现序列化 接口&lt;/h3&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;public class Book implements Serializable{
}
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;4-3-mapper开启二级缓存&#34;&gt;4-3 mapper开启二级缓存&lt;/h3&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;@CacheNamespace(blocking=true)		//在mapper接口中开启二级缓存，默认是所有的查询都使用二级缓存
public interface BookMapper {
    /**
	 * 查询:根据主键查询
	 * 同样准守：输入映射类型为简单类型 #{随便写}
	 * 如果列名不一样,可以直接引用上面已经写好的@Results定义的列和pojo属性映射的关系，方式：@ResultMap(&amp;quot;@Results的id&amp;quot;)
	 */
	@Select(&amp;quot;SELECT * FROM book WHERE id=#{id}&amp;quot;)
	@ResultMap(&amp;quot;bookMap&amp;quot;)
	//@Options(useCache=true)   //默认就是开启二级缓存，可以不用添加该注解
	Book getBookById(Integer id);
}
&lt;/code&gt;&lt;/pre&gt;
&lt;h1 id=&#34;分页查询&#34;&gt;分页查询&lt;/h1&gt;
&lt;h2 id=&#34;添加分页插件的jar包依赖&#34;&gt;添加分页插件的jar包依赖&lt;/h2&gt;
&lt;pre&gt;&lt;code class=&#34;language-xml&#34;&gt;&amp;lt;!-- pageHelper --&amp;gt;
&amp;lt;dependency&amp;gt;
    &amp;lt;groupId&amp;gt;com.github.pagehelper&amp;lt;/groupId&amp;gt;
    &amp;lt;artifactId&amp;gt;pagehelper&amp;lt;/artifactId&amp;gt;
    &amp;lt;version&amp;gt;5.1.6&amp;lt;/version&amp;gt;
&amp;lt;/dependency&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;在核心配置文件中配置分页拦截器&#34;&gt;在核心配置文件中配置分页拦截器&lt;/h2&gt;
&lt;pre&gt;&lt;code class=&#34;language-xml&#34;&gt;&amp;lt;!-- 添加分页插件 --&amp;gt;
&amp;lt;plugins&amp;gt;
&amp;lt;plugin interceptor=&amp;quot;com.github.pagehelper.PageInterceptor&amp;quot;&amp;gt;&amp;lt;/plugin&amp;gt;
&amp;lt;/plugins&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;实现分页操作&#34;&gt;实现分页操作&lt;/h2&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;/**
 * 分页查询:在实际开发中我们都会去使用分页插件来完成
 * pageHelper是国人做的分页插件，非常的优秀
 */
@Test
public void testPage(){
    //1.开始分页(参数一：当前要展示的页码(1,2..)，  参数二：每页显示的信息条数)
    PageHelper.startPage(1, 3);
    //2.执行查询(正常的执行)
    BookExample example = new BookExample();
    /*如果分页中有条件
    Criteria criteria = example.createCriteria();
    criteria.andNameLike(&amp;quot;%龙%&amp;quot;);
    */
    List&amp;lt;Book&amp;gt; list = bookMapper.selectByExample(example);
    //3.分页就通过pageHelper拦截器来实现分页
    PageInfo&amp;lt;Book&amp;gt; pageInfo = new PageInfo&amp;lt;Book&amp;gt;(list);
    //一页信息
    List&amp;lt;Book&amp;gt; bookList = pageInfo.getList();
    for (Book book : bookList) {
        System.out.println(book);
    }
    System.out.println(&amp;quot;总的页数：&amp;quot; + pageInfo.getPages());
}
&lt;/code&gt;&lt;/pre&gt;
">MyBatis</a>
      </div>
      
      <div class="item">
        <a class="result-title" href="https://haohanya.github.io/post/java-fan-she/"" data-c="
          &lt;h2 id=&#34;获取class对象的方式&#34;&gt;获取Class对象的方式&lt;/h2&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;Class.forName(&amp;quot;全类名&amp;quot;);//将字节码文件加载进内存，返回Class对象
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;多用于配置文件，将类名定义在配置文件中。读取文件，加载类&lt;br&gt;
类名.class：通过类名的属性class获取&lt;br&gt;
多用于参数的传递&lt;br&gt;
对象.getClass()：getClass()方法在Object类中定义着。&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;//多用于对象的获取字节码的方式
Class clazz = News.class;
Object obj = clazz.newInstance();           //实例化一个对象：等同于 new 一个对象
System.out.println(clazz.getSimpleName());  //获取类名
System.out.println(clazz.getName());        //获取完整的包名+类名
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;class对象功能&#34;&gt;Class对象功能&lt;/h2&gt;
&lt;h3 id=&#34;获取成员变量&#34;&gt;获取成员变量&lt;/h3&gt;
&lt;p&gt;​        Field[] getFields() ：获取所有public修饰的成员变量&lt;/p&gt;
&lt;p&gt;​		Field getField(String name)   获取指定名称的 public修饰的成员变量&lt;/p&gt;
&lt;p&gt;​		Field[] getDeclaredFields();  //获取所有的成员变量，不考虑修饰符&lt;/p&gt;
&lt;p&gt;​		Field getDeclaredField(String name); // 获取指定名称的成员变量，不考虑修饰符&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;Class clazz = News.class;
System.out.println(clazz.getSimpleName());//获取类名
System.out.println(clazz.getName());//获取包名+类名
Object obj = clazz.newInstance();//实例化News的这个对象
Table table = obj.getClass().getAnnotation(Table.class);//获取obj对象的Table注解，没有返回null
System.out.println(table.value());
Field[] fields = clazz.getDeclaredFields();
for (Field field : fields) {
	field.setAccessible(true);//暴力反射,如果不写这个将会报错
    //获取属性的注解
    //Field field1 = obj.getClass().getDeclaredField(field.getName());//获取obj对象的指定属性
    PK pk = field.getAnnotation(PK.class);//获取属性的注解

	if(pk!=null){
    	System.out.println(field.getName()+&amp;quot;&amp;gt;&amp;gt;&amp;gt;&amp;quot;+pk);//获取属性名称
    }
        field.set(obj,null);//给当前clazz对象的field属性赋值为i
        System.out.println(field.get(obj));//输出clazz对象的field的属性值
}
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;获取构造方法&#34;&gt;获取构造方法&lt;/h3&gt;
&lt;p&gt;​	Constructor&amp;lt;?&amp;gt;[] getConstructors()&lt;/p&gt;
&lt;p&gt;​	Constructor&lt;T&gt; getConstructor(类&amp;lt;?&amp;gt;... parameterTypes)&lt;/p&gt;
&lt;p&gt;​	Constructor&lt;T&gt; getDeclaredConstructor(类&amp;lt;?&amp;gt;... parameterTypes)&lt;/p&gt;
&lt;p&gt;​	Constructor&amp;lt;?&amp;gt;[] getDeclaredConstructors()&lt;/p&gt;
&lt;h3 id=&#34;获取成员方法&#34;&gt;获取成员方法&lt;/h3&gt;
&lt;p&gt;​	Method[] getMethods()&lt;/p&gt;
&lt;p&gt;​	Method getMethod(String name, 类&amp;lt;?&amp;gt;... parameterTypes)&lt;/p&gt;
&lt;p&gt;​	Method[] getDeclaredMethods()&lt;/p&gt;
&lt;p&gt;​	Method getDeclaredMethod(String name, 类&amp;lt;?&amp;gt;... parameterTypes)&lt;/p&gt;
&lt;h3 id=&#34;field成员变量&#34;&gt;Field：成员变量&lt;/h3&gt;
&lt;p&gt;设置值&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;void set(Object obj, Object value)
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;获取值，传的是对象&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;get(Object obj) 
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;忽略访问权限修饰符的安全检查&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;setAccessible(true)
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;constructor构造方法&#34;&gt;Constructor:构造方法&lt;/h3&gt;
&lt;p&gt;创建对象，如果使用空参数构造方法创建对象，操作可以简化：Class对象的newInstance方法&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;T newInstance(Object... initargs)
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;method方法对象&#34;&gt;Method：方法对象&lt;/h3&gt;
&lt;p&gt;执行方法&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;Object invoke(Object obj, Object... args)
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;获取方法名称&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;String getName
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;反射获取注解&#34;&gt;反射获取注解&lt;/h2&gt;
&lt;p&gt;获取obj对象的Table注解，没有返回null，obj是要获取的对象&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;Table table = obj.getClass().getAnnotation(Table.class);
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;获取属性的注解，获取obj对象的field.getName()的属性注解&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;Field field1 = obj.getClass().getDeclaredField(field.getName());//获取obj对象的指定属性
PK pk = field1.getAnnotation(PK.class);//获取属性的注解
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;获取当前调用的方法上的注解&#34;&gt;获取当前调用的方法上的注解&lt;/h2&gt;
&lt;pre&gt;&lt;code&gt;StackTraceElement[] stack = new Throwable().getStackTrace();
Method method = this.getClass().getMethod(stack[1].getMethodName());//这里0是当前方法的注解，1是调用者方法的注解
for(Annotation an : method.getAnnotations()){
    System.out.println(an);
}
&lt;/code&gt;&lt;/pre&gt;
">Java反射</a>
      </div>
      
      <div class="item">
        <a class="result-title" href="https://haohanya.github.io/post/FastDFS/"" data-c="
          &lt;h2 id=&#34;什么是fastdfs&#34;&gt;什么是FastDFS&lt;/h2&gt;
&lt;blockquote&gt;
&lt;p&gt;FastDFS 是用 c 语言编写的一款开源的分布式文件系统。FastDFS 为互联网量身定制，充分考虑了冗余备份、负载均衡、线性扩容等机制，并注重高可用、高性能等指标，使用 FastDFS很容易搭建一套高性能的文件服务器集群提供文件上传、下载等服务。&lt;/p&gt;
&lt;p&gt;FastDFS 架构包括 Tracker server 和 Storage server。客户端请求 Tracker server 进行文件上传、下载，通过 Tracker server 调度最终由 Storage server 完成文件上传和下载。&lt;/p&gt;
&lt;p&gt;Tracker server 作用是负载均衡和调度，通过 Tracker server 在文件上传时可以根据一些策略找到 Storage server 提供文件上传服务。可以将 tracker 称为追踪服务器或调度服务器。&lt;/p&gt;
&lt;p&gt;Storage server 作用是文件存储，客户端上传的文件最终存储在 Storage 服务器上，Storageserver 没有实现自己的文件系统而是利用操作系统 的文件系统来管理文件。可以将storage称为存储服务器。&lt;/p&gt;
&lt;figure data-type=&#34;image&#34; tabindex=&#34;1&#34;&gt;&lt;img src=&#34;https://haohanya.github.io/post-images/1589686914052.jpg&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
&lt;p&gt;服务端两个角色：&lt;/p&gt;
&lt;p&gt;Tracker：管理集群，tracker 也可以实现集群。每个 tracker 节点地位平等。收集 Storage 集群的状态。&lt;/p&gt;
&lt;p&gt;Storage：实际保存文件  Storage 分为多个组，每个组之间保存的文件是不同的。每个组内部可以有多个成员，组成员内部保存的内容是一样的，组成员的地位是一致的，没有主从的概念。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&#34;文件上传流程&#34;&gt;文件上传流程&lt;/h2&gt;
&lt;blockquote&gt;
&lt;figure data-type=&#34;image&#34; tabindex=&#34;2&#34;&gt;&lt;img src=&#34;https://haohanya.github.io/post-images/1589687036366.jpg&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
&lt;p&gt;客户端上传文件后存储服务器将文件 ID 返回给客户端，此文件 ID 用于以后访问该文件的索引信息。文件索引信息包括：组名，虚拟磁盘路径，数据两级目录，文件名。&lt;/p&gt;
&lt;figure data-type=&#34;image&#34; tabindex=&#34;3&#34;&gt;&lt;img src=&#34;https://haohanya.github.io/post-images/1589687044591.jpg&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
&lt;p&gt;&lt;strong&gt;组名&lt;/strong&gt;：文件上传后所在的 storage 组名称，在文件上传成功后有 storage 服务器返回，需要客户端自行保存。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;虚拟磁盘路径&lt;/strong&gt;：storage 配置的虚拟路径，与磁盘选项 store_path*对应。如果配置了&lt;/p&gt;
&lt;p&gt;store_path0 则是 M00，如果配置了 store_path1 则是 M01，以此类推。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;数据两级目录&lt;/strong&gt;：storage 服务器在每个虚拟磁盘路径下创建的两级目录，用于存储数据&lt;/p&gt;
&lt;p&gt;文件。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;文件名&lt;/strong&gt;：与文件上传时不同。是由存储服务器根据特定信息生成，文件名包含：源存储&lt;/p&gt;
&lt;p&gt;服务器 IP 地址、文件创建时间戳、文件大小、随机数和文件拓展名等信息。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&#34;文件下载流程&#34;&gt;文件下载流程&lt;/h2&gt;
&lt;figure data-type=&#34;image&#34; tabindex=&#34;4&#34;&gt;&lt;img src=&#34;https://haohanya.github.io/post-images/1589687076743.jpg&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
&lt;h2 id=&#34;0-准备安装包上传到usrlocal&#34;&gt;0. 准备安装包上传到/usr/local/&lt;/h2&gt;
&lt;p&gt;FastDFS_v5.05.tar.gz  （FastDFS安装包）&lt;/p&gt;
&lt;p&gt;libfastcommonV1.0.7.tar.gz （FastDFS依赖程序）&lt;/p&gt;
&lt;p&gt;nginx-1.8.0.tar.gz （nginx安装包，用于做文件请求http代理服务器）&lt;/p&gt;
&lt;p&gt;fastdfs-nginx-module_v1.16.tar.gz （nginx和fastdfs的桥梁插件模块）&lt;/p&gt;
&lt;h2 id=&#34;1-安装cc编译环境&#34;&gt;1. 安装c/c++编译环境&lt;/h2&gt;
&lt;pre&gt;&lt;code&gt;yum install gcc-c++
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;2-安装libevent&#34;&gt;2. 安装libevent&lt;/h2&gt;
&lt;pre&gt;&lt;code&gt;yum -y install libevent
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;3-安装libfastcommon&#34;&gt;3. 安装libfastcommon&lt;/h2&gt;
&lt;p&gt;将&lt;code&gt;libfastcommonV1.0.7.tar.gz&lt;/code&gt;拷贝至&lt;code&gt;/usr/local/&lt;/code&gt;下&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;cd /usr/local
tar -zxvf libfastcommonV1.0.7.tar.gz
cd libfastcommon-1.0.7
./make.sh
./make.sh install
cp /usr/lib64/libfastcommon.so /usr/lib
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;4创建数据存储目录&#34;&gt;4.创建数据存储目录&lt;/h2&gt;
&lt;pre&gt;&lt;code&gt;mkdir -p /home/FastDFS/tracker /home/FastDFS/storage /home/FastDFS/client
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;5-tracker编译安装&#34;&gt;5. tracker编译安装&lt;/h2&gt;
&lt;p&gt;将FastDFS_v5.05.tar.gz拷贝至/usr/local/下&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;tar -zxvf FastDFS_v5.05.tar.gz
cd FastDFS
./make.sh
./make.sh install
cd conf
cp * /etc/fdfs
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;6-编辑etcfdfstrackerconf&#34;&gt;6. 编辑/etc/fdfs/tracker.conf&lt;/h2&gt;
&lt;pre&gt;&lt;code&gt;vi /etc/fdfs/tracker.conf
	base_path=/home/FastDFS/tracker
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;7-启动tracker&#34;&gt;7. 启动tracker&lt;/h2&gt;
&lt;pre&gt;&lt;code&gt;/usr/bin/fdfs_trackerd /etc/fdfs/tracker.conf [restart](重启)
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;8-配置storage节点&#34;&gt;8. 配置storage节点&lt;/h2&gt;
&lt;pre&gt;&lt;code&gt;vi /etc/fdfs/storage.conf
    base_path=/home/FastDFS/storage
    store_path0=/home/FastDFS/storage
    tracker_server = 192.168.100.151:22122
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;9-启动storage节点&#34;&gt;9. 启动storage节点&lt;/h2&gt;
&lt;pre&gt;&lt;code&gt;/usr/bin/fdfs_storage{fdfs_storaged} /etc/fdfs/storage.conf
fdfs_storage不存在就使用fdfs_storaged
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;10-安装nginx&#34;&gt;10. 安装nginx&lt;/h2&gt;
&lt;pre&gt;&lt;code&gt;yum install -y gcc-c++   (已安装)
yum install -y pcre pcre-devel
yum install -y zlib zlib-devel
yum install -y openssl openssl-devel
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;11解压fastdfs-nginx-module_v116targz&#34;&gt;11.解压fastdfs-nginx-module_v1.16.tar.gz&lt;/h2&gt;
&lt;pre&gt;&lt;code&gt;cd /usr/local/
tar -zxf fastdfs-nginx-module_v1.16.tar.gz
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;12修改fastdfs-nginx-modulesrcconfig配置文件&#34;&gt;12.修改fastdfs-nginx-module/src/config配置文件&lt;/h2&gt;
&lt;pre&gt;&lt;code&gt;vi fastdfs-nginx-module/src/config
&lt;/code&gt;&lt;/pre&gt;
&lt;blockquote&gt;
&lt;p&gt;把CORE_INCS=&amp;quot;$CORE_INCS /usr/local/include/fastdfs /usr/include/fastcommon/&amp;quot;&lt;/p&gt;
&lt;p&gt;修改为：CORE_INCS=&amp;quot;$CORE_INCS /usr/include/fastdfs /usr/include/fastcommon/&amp;quot;&lt;/p&gt;
&lt;p&gt;把CORE_LIBS=&amp;quot;$CORE_LIBS -L/usr/local/lib -lfastcommon -lfdfsclient&amp;quot;&lt;/p&gt;
&lt;p&gt;修改为：CORE_LIBS=&amp;quot;$CORE_LIBS -L/usr/lib -lfastcommon -lfdfsclient&amp;quot;&lt;/p&gt;
&lt;p&gt;实际就是把路径中的local这一层删除掉&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&#34;13复制fastdfs-nginx-modulesrcmod_fastdfsconf-到etcfdfs目录下并编辑&#34;&gt;13.复制fastdfs-nginx-module/src/mod_fastdfs.conf 到/etc/fdfs目录下并编辑&lt;/h2&gt;
&lt;pre&gt;&lt;code&gt;cp fastdfs-nginx-module/src/mod_fastdfs.conf /etc/fdfs/
	vi /etc/fdfs/mod_fastdfs.conf
        tracker_server=192.168.100.151:22122
        url_have_group_name = true
        storage_server_port=23000
        group_name=group1
        store_path0=/home/FastDFS/storage
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;14安装nginx&#34;&gt;14.安装nginx&lt;/h2&gt;
&lt;pre&gt;&lt;code&gt;cd /usr/local/
tar -zxf  nginx-1.8.1.tar.gz
cd nginx-1.8.1
./configure --add-module=/usr/local/fastdfs-nginx-module/src/
make
make install
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;15-配置nginx&#34;&gt;15. 配置nginx&lt;/h2&gt;
&lt;pre&gt;&lt;code&gt;cd /usr/local/nginx/conf
vi nginx.conf
	
	server{
        listen     80;
        server_name     localhost;
        location /group1/M00/{
            ngx_fastdfs_module;
        }
    }

&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;重启nginx&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;/usr/local/nginx/sbin/nginx
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;测试&#34;&gt;测试&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;引入依赖&lt;/li&gt;
&lt;/ol&gt;
&lt;pre&gt;&lt;code class=&#34;language-xml&#34;&gt;&amp;lt;!-- 文件上传组件 --&amp;gt;
&amp;lt;dependency&amp;gt;
    &amp;lt;groupId&amp;gt;commons-fileupload&amp;lt;/groupId&amp;gt;
    &amp;lt;artifactId&amp;gt;commons-fileupload&amp;lt;/artifactId&amp;gt;
    &amp;lt;version&amp;gt;1.3.1&amp;lt;/version&amp;gt;
&amp;lt;/dependency&amp;gt;
&amp;lt;!--fastdfs--&amp;gt;
&amp;lt;dependency&amp;gt;
    &amp;lt;groupId&amp;gt;org.csource.fastdfs&amp;lt;/groupId&amp;gt;
    &amp;lt;artifactId&amp;gt;fastdfs&amp;lt;/artifactId&amp;gt;
    &amp;lt;version&amp;gt;1.2&amp;lt;/version&amp;gt;
&amp;lt;/dependency&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;ol start=&#34;2&#34;&gt;
&lt;li&gt;编写配置文件&lt;pre&gt;&lt;code class=&#34;language-xml&#34;&gt; &amp;lt;!-- 配置多媒体解析器 --&amp;gt;
 &amp;lt;bean id=&amp;quot;multipartResolver&amp;quot; class=&amp;quot;org.springframework.web.multipart.commons.CommonsMultipartResolver&amp;quot;&amp;gt;
 	&amp;lt;property name=&amp;quot;defaultEncoding&amp;quot; value=&amp;quot;UTF-8&amp;quot;/&amp;gt;
 	&amp;lt;!-- 设定文件上传的最大值5MB，5*1024*1024 --&amp;gt;
 	&amp;lt;property name=&amp;quot;maxUploadSize&amp;quot; value=&amp;quot;5242880&amp;quot;/&amp;gt;
 &amp;lt;/bean&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/li&gt;
&lt;li&gt;UploadController&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt; /**
  * 文件服务器地址
  */
 @Value(&amp;quot;${FILE_SERVER_URL}&amp;quot;)
 private String FILE_SERVER_URL;

 @RequestMapping(&amp;quot;/upload&amp;quot;)
 public JdResult upload(MultipartFile file) {
     //1、取文件的扩展名
     String originalFilename = file.getOriginalFilename();
     String extName = originalFilename.substring(originalFilename.lastIndexOf(&amp;quot;.&amp;quot;) + 1);
     try {
         //2、创建一个 FastDFS 的客户端
         FastDFSClient dfsClient = new FastDFSClient(&amp;quot;classpath:conf/fdfs_client.conf&amp;quot;);
         //3、执行上传处理
         String path = dfsClient.uploadFile(file.getBytes(), extName);
         //4、拼接返回的 url 和 ip 地址，拼装成完整的 url
         String url = FILE_SERVER_URL + path;
         return JdResult.ok(url);
     } catch (Exception e) {
         e.printStackTrace();
         return JdResult.error(&amp;quot;文件上传失败&amp;quot;);
     }
 }
&lt;/code&gt;&lt;/pre&gt;
&lt;/li&gt;
&lt;/ol&gt;
">FastDFS</a>
      </div>
      
      <div class="item">
        <a class="result-title" href="https://haohanya.github.io/post/freemarker/"" data-c="
          &lt;h2 id=&#34;1-freemarker入门&#34;&gt;1、freemarker入门&lt;/h2&gt;
&lt;h3 id=&#34;1依赖核心包&#34;&gt;1.依赖核心包&lt;/h3&gt;
&lt;pre&gt;&lt;code class=&#34;language-xml&#34;&gt;&amp;lt;!-- 依赖freemarker --&amp;gt;
&amp;lt;dependency&amp;gt;
	&amp;lt;groupId&amp;gt;org.freemarker&amp;lt;/groupId&amp;gt;
	&amp;lt;artifactId&amp;gt;freemarker&amp;lt;/artifactId&amp;gt;
	&amp;lt;version&amp;gt;2.3.23&amp;lt;/version&amp;gt;
&amp;lt;/dependency&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;2创建模板文件&#34;&gt;2.创建模板文件&lt;/h3&gt;
&lt;pre&gt;&lt;code class=&#34;language-html&#34;&gt;&amp;lt;!DOCTYPE html&amp;gt;
&amp;lt;html&amp;gt;
&amp;lt;head&amp;gt;
&amp;lt;meta charset=&amp;quot;UTF-8&amp;quot;&amp;gt;
&amp;lt;title&amp;gt;这个是模板&amp;lt;/title&amp;gt;
&amp;lt;/head&amp;gt;
&amp;lt;body&amp;gt;
	&amp;lt;#--  这是我的注释，不会被输出 --&amp;gt;
	hello ${name}
&amp;lt;/body&amp;gt;
&amp;lt;/html&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;3生成文件&#34;&gt;3.生成文件&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;第一步：创建Configuration对象（直接new，在构造方法中添加&lt;code&gt;freemarker&lt;/code&gt;的版本号）&lt;br&gt;
第二步：设置模板所在的路径&lt;/li&gt;
&lt;li&gt;第三步：设置模板文件的编码字符集（一般使用&lt;code&gt;utf-8&lt;/code&gt;）&lt;/li&gt;
&lt;li&gt;第四步：加载一个模板，创建一个模板对象&lt;/li&gt;
&lt;li&gt;第五步：创建数据模型（使用的是Map&amp;lt;String,Object&amp;gt; 还可以使用自定义的&lt;code&gt;pojo&lt;/code&gt;实际开发中都用map）&lt;/li&gt;
&lt;li&gt;第六步：创建writer对象，一般用&lt;code&gt;FileWriter&lt;/code&gt;对象进行实例化，执行生成的文件&lt;/li&gt;
&lt;li&gt;第七步：调用模板对象的process方法输出文件&lt;/li&gt;
&lt;li&gt;第八步：关闭流&lt;/li&gt;
&lt;/ul&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;public static void main(String[] args) throws Exception{
    //1.创建配置类
    Configuration configuration = new Configuration(Configuration.getVersion());
    //2.设置模板所在目录
    configuration.setDirectoryForTemplateLoading(new File(&amp;quot;F:\\workspace002\\freemarker-demo01\\src\\main\\resources&amp;quot;));
    //3.设置编码集
    configuration.setDefaultEncoding(&amp;quot;UTF-8&amp;quot;);
    //4.加载模板
    Template template = configuration.getTemplate(&amp;quot;hello.html&amp;quot;);
    //5.创建数据模型
    Map&amp;lt;String, Object&amp;gt; data = new HashMap&amp;lt;String, Object&amp;gt;();
    data.put(&amp;quot;name&amp;quot;, &amp;quot;张三&amp;quot;);
    //6.创建writer对象，准备用来输出文件
    Writer out = new FileWriter(new File(&amp;quot;E:\\freemarker\\hello.html&amp;quot;));
    //7,输出文件
    template.process(data, out);
    //8.关闭流
    out.close();
}
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;ftl指令&#34;&gt;FTL指令&lt;/h2&gt;
&lt;h3 id=&#34;1assign&#34;&gt;1.assign&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;作用：用于在页面上定义一个变量&lt;/p&gt;
&lt;/blockquote&gt;
&lt;pre&gt;&lt;code class=&#34;language-html&#34;&gt;	&amp;lt;#-- assign：用来在页面上定义一个变量 --&amp;gt;
	&amp;lt;#assign name=&amp;quot;张三&amp;quot;&amp;gt;
	获取变量：${name}
	&amp;lt;hr/&amp;gt;
	&amp;lt;#-- assign:还可以用来定义一个对象 --&amp;gt;
	&amp;lt;#assign info={&amp;quot;name&amp;quot;:&amp;quot;李四&amp;quot;,&amp;quot;age&amp;quot;:18,&amp;quot;hobs&amp;quot;:&amp;quot;java&amp;quot;}&amp;gt;
	获取到对象的属性:姓名-${info.name},年龄-${info.age},爱好-${info.hobs}
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;2include&#34;&gt;2.include&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;作用：此指令用于模板文件之间的相互嵌套&lt;/p&gt;
&lt;/blockquote&gt;
&lt;pre&gt;&lt;code class=&#34;language-html&#34;&gt;&amp;lt;#include &amp;quot;head.ftl&amp;quot;&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;3if&#34;&gt;3.if&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;作用：用于条件判断&lt;/p&gt;
&lt;/blockquote&gt;
&lt;pre&gt;&lt;code class=&#34;language-html&#34;&gt;data.put(&amp;quot;success&amp;quot;, true);

&amp;lt;#if success = true&amp;gt;
	success的值是true
&amp;lt;#else&amp;gt;
	success的值是false
&amp;lt;/#if&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;4list&#34;&gt;4.list&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;作用：在页面中遍历集合&lt;/p&gt;
&lt;/blockquote&gt;
&lt;pre&gt;&lt;code class=&#34;language-html&#34;&gt;&amp;lt;ul&amp;gt;
	&amp;lt;#list mylist as user&amp;gt;
		&amp;lt;li&amp;gt;${user.name}&amp;lt;/li&amp;gt;
	&amp;lt;/#list&amp;gt;
&amp;lt;/ul&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;5内建函数&#34;&gt;5.内建函数&lt;/h3&gt;
&lt;p&gt;&lt;code&gt;语法：变量 + ? + 函数名&lt;/code&gt;&lt;/p&gt;
&lt;h4 id=&#34;5-1-获取集合的大小size&#34;&gt;5-1 获取集合的大小(size)&lt;/h4&gt;
&lt;p&gt;&lt;code&gt;${mylist?size}&lt;/code&gt;&lt;/p&gt;
&lt;h4 id=&#34;5-2-转换json字符串为json对象&#34;&gt;5-2 转换&lt;code&gt;json&lt;/code&gt;字符串为&lt;code&gt;json&lt;/code&gt;对象&lt;/h4&gt;
&lt;pre&gt;&lt;code class=&#34;language-html&#34;&gt;&amp;lt;#-- 定义一个json字符串  --&amp;gt;
&amp;lt;#assign text=&amp;quot;{&#39;name&#39;:&#39;张三&#39;,&#39;sex&#39;:&#39;男&#39;}&amp;quot;&amp;gt;
&amp;lt;#-- 将json字符串转换成json对象 --&amp;gt;
&amp;lt;#assign person=text?eval&amp;gt;
姓名：${person.name}，性别:${person.sex}
&lt;/code&gt;&lt;/pre&gt;
&lt;h4 id=&#34;5-3-日期&#34;&gt;5-3 日期&lt;/h4&gt;
&lt;pre&gt;&lt;code class=&#34;language-html&#34;&gt;年月日：${mydate?date}
&amp;lt;br/&amp;gt;
时分秒：${mydate?time}
&amp;lt;br/&amp;gt;
年月日时分秒：${mydate?datetime}
&amp;lt;br/&amp;gt;
自定义日期：${mydate?string(&#39;yyyy年MM月dd日  hh时mm分ss秒&#39;)}
&lt;/code&gt;&lt;/pre&gt;
&lt;h4 id=&#34;5-4-数字转换成字符串&#34;&gt;5-4 数字转换成字符串&lt;/h4&gt;
&lt;p&gt;&lt;code&gt;${mynum?c}&lt;/code&gt;&lt;/p&gt;
&lt;h3 id=&#34;6空值处理&#34;&gt;6.空值处理&lt;/h3&gt;
&lt;h4 id=&#34;6-1-处理方案一缺值表达式&#34;&gt;6-1 处理方案一(缺值表达式)&lt;/h4&gt;
&lt;pre&gt;&lt;code class=&#34;language-html&#34;&gt;${mytest!&amp;quot;值为null&amp;quot;}
&amp;lt;/br&amp;gt;
${mytest!}
&lt;/code&gt;&lt;/pre&gt;
&lt;h4 id=&#34;6-2-处理方案二&#34;&gt;6-2 处理方案二&lt;/h4&gt;
&lt;pre&gt;&lt;code class=&#34;language-html&#34;&gt;&amp;lt;#if mytest??&amp;gt;
	mytest值是存在的:${mytest}
&amp;lt;#else&amp;gt;
	mytest的值为null
&amp;lt;/#if&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;7运算符&#34;&gt;7.运算符&lt;/h3&gt;
&lt;h4 id=&#34;7-1-算术运算符&#34;&gt;7-1 算术运算符&lt;/h4&gt;
&lt;p&gt;&lt;code&gt;+ - * / %&lt;/code&gt;&lt;/p&gt;
&lt;h4 id=&#34;7-2-逻辑运算符&#34;&gt;7-2 逻辑运算符&lt;/h4&gt;
&lt;p&gt;&lt;code&gt;&amp;amp;&amp;amp; 、 || 、 !&lt;/code&gt;&lt;/p&gt;
&lt;h4 id=&#34;7-3-比较运算符&#34;&gt;7-3 比较运算符&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;= 或者 ==&lt;/li&gt;
&lt;li&gt;!=&lt;/li&gt;
&lt;li&gt;&amp;gt;  或者是 gt&lt;/li&gt;
&lt;li&gt;&amp;lt; 或者是 lt&lt;/li&gt;
&lt;li&gt;&amp;gt;= 或者是 gte&lt;/li&gt;
&lt;li&gt;&amp;lt;= 或者是 lte&lt;/li&gt;
&lt;/ul&gt;
">freemarker</a>
      </div>
      
      <div class="item">
        <a class="result-title" href="https://haohanya.github.io/post/about/"" data-c="
          &lt;blockquote&gt;
&lt;p&gt;欢迎来到我的小站呀，很高兴遇见你！🤝&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&#34;关于本站&#34;&gt;🏠 关于本站&lt;/h2&gt;
&lt;p&gt;磕磕碰碰的小破站,前不久域名的备案被注销...后换到Gridea,托管在GitHub&lt;/p&gt;
&lt;h2 id=&#34;博主是谁&#34;&gt;👨‍💻 博主是谁&lt;/h2&gt;
&lt;p&gt;一位正在努力成长的码农...&lt;/p&gt;
&lt;h2 id=&#34;兴趣爱好&#34;&gt;⛹ 兴趣爱好&lt;/h2&gt;
&lt;p&gt;吃,睡,coding&lt;/p&gt;
&lt;h2 id=&#34;联系我呀&#34;&gt;📬 联系我呀&lt;/h2&gt;
&lt;p&gt;QQ : 2369710264&lt;/p&gt;
">关于</a>
      </div>
      
      <div class="item">
        <a class="result-title" href="https://haohanya.github.io/post/hello/"" data-c="
          &lt;p&gt;又是一个新的开始！！！&lt;/p&gt;
&lt;!-- more --&gt;
&lt;p&gt;基于GitHub Pages + Gridea&lt;/p&gt;
">Hello</a>
      </div>
      
    </div>
  </div>
</div>
<script>
  // var escape = "[{&#34;content&#34;:&#34;&lt;h2 id=\&#34;什么是eureka\&#34;&gt;什么是Eureka&lt;/h2&gt;\n&lt;blockquote&gt;\n&lt;p&gt;百度百科：&lt;a href=\&#34;https://baike.baidu.com/item/Eureka/22402835?fr=aladdin\&#34;&gt;什么是Eureka&lt;/a&gt;&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;h3 id=\&#34;问题分析\&#34;&gt;问题分析&lt;/h3&gt;\n&lt;blockquote&gt;\n&lt;p&gt;刚才的案例，user-service对外提供服务，需要对外暴漏自己的地址。user-web需要记录服务提供者的地址。将来地址出现变更，还需要及时的去更新。这在服务较少的时候不会觉得有什么，但是在大型的互联网项目中，一个项目可能差分处几十个微服务，此时如果还是人为的管理，不仅开发困难，奖励啊测试、发布上线都会有大麻烦&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;p&gt;&lt;code&gt;与DevOps思想违背：就是系统可以通过一组过程、方法或者是系统，提高应用发布和运维的效率，降低管理成本&lt;/code&gt;&lt;/p&gt;\n&lt;h3 id=\&#34;eureka做什么\&#34;&gt;Eureka做什么&lt;/h3&gt;\n&lt;blockquote&gt;\n&lt;p&gt;好比是房产中介，负责管理、记录服务提供者的信息。服务调用者就无需自己去找服务，而是把自己的需求告诉Eureka，然后Eureka把符合你要求的服务告诉你&lt;/p&gt;\n&lt;p&gt;同时，服务的提供方与Eureka之间通过“心跳”机制进行监控，当某个服务提供方出现问题，Eureka自然会把它从服务列表中剔除&lt;/p&gt;\n&lt;p&gt;&lt;code&gt;这就实现了服务的自动注册、发现和状态监控&lt;/code&gt;&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;h2 id=\&#34;eureka注册中心说明\&#34;&gt;Eureka注册中心说明&lt;/h2&gt;\n&lt;blockquote&gt;\n&lt;p&gt;Eureka的主要功能是进行服务管理，定期检查服务状态，返回服务地址列表。&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;figure data-type=\&#34;image\&#34; tabindex=\&#34;1\&#34;&gt;&lt;img src=\&#34;https://haohanya.github.io/post-images/1591806137091.png\&#34; alt=\&#34;\&#34; loading=\&#34;lazy\&#34;&gt;&lt;/figure&gt;\n&lt;h2 id=\&#34;入门案例\&#34;&gt;入门案例&lt;/h2&gt;\n&lt;p&gt;1、创建springboot项目并添加依赖&lt;/p&gt;\n&lt;figure data-type=\&#34;image\&#34; tabindex=\&#34;2\&#34;&gt;&lt;img src=\&#34;https://haohanya.github.io/post-images/1591806146598.png\&#34; alt=\&#34;\&#34; loading=\&#34;lazy\&#34;&gt;&lt;/figure&gt;\n&lt;p&gt;2、在启动类中添加注解&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;@SpringBootApplication\n@EnableEurekaServer     //声明当前应用是eureka服务\npublic class EurekaServiceApplication {\n    public static void main(String[] args) {\n        SpringApplication.run(EurekaServiceApplication.class, args);\n    }\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;3、配置eureka&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-yml\&#34;&gt;#端口号\nserver:\n  port: 10086\nspring:\n  application:\n    name: eureka-server   #应用名称，会在eureka中作为服务的id标识\n\n#配置eurkea\neureka:\n  client:\n    service-url:\n      defaultZone: http://127.0.0.1:10086/eureka\n    register-with-eureka: false       #不注册自己，默认值是true（如果搭建eureka集群，需要相互之间注册）\n    fetch-registry: false   #不拉取自己的服务列表\n\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;4、启动服务&lt;/p&gt;\n&lt;p&gt;访问：http://localhost:10086/&lt;/p&gt;\n&lt;figure data-type=\&#34;image\&#34; tabindex=\&#34;3\&#34;&gt;&lt;img src=\&#34;Eureka%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83.assets/15.png\&#34; alt=\&#34;15\&#34; loading=\&#34;lazy\&#34;&gt;&lt;/figure&gt;\n&lt;h2 id=\&#34;服务注册\&#34;&gt;服务注册&lt;/h2&gt;\n&lt;blockquote&gt;\n&lt;p&gt;注册服务，就是在服务上添加Eureka的客户端依赖，客户端代码会自动把服务注册到EurekaService中&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;figure data-type=\&#34;image\&#34; tabindex=\&#34;4\&#34;&gt;&lt;img src=\&#34;https://haohanya.github.io/post-images/1591806162495.png\&#34; alt=\&#34;\&#34; loading=\&#34;lazy\&#34;&gt;&lt;/figure&gt;\n&lt;p&gt;添加依赖&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-xml\&#34;&gt;&amp;lt;!-- 添加mapper的启动器 --&amp;gt;\n&amp;lt;dependency&amp;gt;\n    &amp;lt;groupId&amp;gt;tk.mybatis&amp;lt;/groupId&amp;gt;\n    &amp;lt;artifactId&amp;gt;mapper-spring-boot-starter&amp;lt;/artifactId&amp;gt;\n    &amp;lt;version&amp;gt;2.0.3&amp;lt;/version&amp;gt;\n&amp;lt;/dependency&amp;gt;\n&amp;lt;!-- lombok --&amp;gt;\n&amp;lt;dependency&amp;gt;\n    &amp;lt;groupId&amp;gt;org.projectlombok&amp;lt;/groupId&amp;gt;\n    &amp;lt;artifactId&amp;gt;lombok&amp;lt;/artifactId&amp;gt;\n&amp;lt;/dependency&amp;gt;\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;1、修改启动类&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;@SpringBootApplication\n@MapperScan(basePackages = &amp;quot;com.kgc.mapper&amp;quot;)  //扫描mapper包，如果使用的是tb.mybatis\n@EnableEurekaClient     //开启Eureka客户端发现功能\npublic class UserServiceApplication {\n\n    public static void main(String[] args) {\n        SpringApplication.run(UserServiceApplication.class, args);\n    }\n\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;2、修改配置文件&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-yml\&#34;&gt;#端口号\nserver:\n  port: 9091\n#数据源\nspring:\n  datasource:\n    driver-class-name: com.mysql.jdbc.Driver\n    url: jdbc:mysql://localhost:3306/springcloud?useUnicode=true&amp;amp;characterEncoding=utf-8&amp;amp;serverTimezone=Asia/Shanghai\n    username: root\n    password: root\n  application:\n    name: user-service   #应用名\n#添加Eureka注册的配置\neureka:\n  client:\n    service-url:\n      defaultZone: http://127.0.0.1:10086/eureka\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;3、测试&lt;/p&gt;\n&lt;p&gt;启动user-service工程&lt;/p&gt;\n&lt;figure data-type=\&#34;image\&#34; tabindex=\&#34;5\&#34;&gt;&lt;img src=\&#34;Eureka%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83.assets/17.png\&#34; alt=\&#34;17\&#34; loading=\&#34;lazy\&#34;&gt;&lt;/figure&gt;\n&lt;h2 id=\&#34;服务发现\&#34;&gt;服务发现&lt;/h2&gt;\n&lt;figure data-type=\&#34;image\&#34; tabindex=\&#34;6\&#34;&gt;&lt;img src=\&#34;https://haohanya.github.io/post-images/1591806178141.png\&#34; alt=\&#34;\&#34; loading=\&#34;lazy\&#34;&gt;&lt;/figure&gt;\n&lt;p&gt;1、修改启动类&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;@SpringBootApplication\n@EnableDiscoveryClient     //开启Eureak客户端\npublic class UserWebApplication {\n    @Bean\n    public RestTemplate restTemplate(){\n        return new RestTemplate();\n    }\n\n    public static void main(String[] args) {\n        SpringApplication.run(UserWebApplication.class, args);\n    }\n\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;2、修改配置文件&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-yml\&#34;&gt;server:\n  port: 8080\nspring:\n  application:\n    name: user-web     #应用名称\neureka:\n  client:\n    service-url:\n      defaultZone: http://127.0.0.1:10086/eureka    #eurekaSerer地址\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;3、修改处理器&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;package com.cn.controller;\n\nimport com.cn.pojo.User;\nimport com.netflix.appinfo.InstanceInfo;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.cloud.client.ServiceInstance;\nimport org.springframework.cloud.client.discovery.DiscoveryClient;\nimport org.springframework.web.bind.annotation.PathVariable;\nimport org.springframework.web.bind.annotation.RequestMapping;\nimport org.springframework.web.bind.annotation.RestController;\nimport org.springframework.web.client.RestTemplate;\n\nimport java.util.List;\n\n@RestController\n@RequestMapping(&amp;quot;/consumer&amp;quot;)\npublic class ConsumerController {\n    @Autowired\n    private RestTemplate restTemplate;\n    //DiscoveryClient的用springCloud包中的\n    @Autowired(required = false)\n    private DiscoveryClient discoveryClient;\n\n    @RequestMapping(&amp;quot;/{id}&amp;quot;)\n    public User getByid(@PathVariable(&amp;quot;id&amp;quot;) Long id){\n        /*\n        //通过http的方式实现系统之间的通讯\n        String url = &amp;quot;http://localhost:9091/user/&amp;quot; + id;//这个是user-service提供的rest api风格的接口\n        User user = restTemplate.getForObject(url, User.class);\n        return user;\n         */\n        //从eurekaServer注册中心去获取user-service的实例列表\n        List&amp;lt;ServiceInstance&amp;gt; instancesList = discoveryClient.getInstances(&amp;quot;user-service&amp;quot;);\n        //因为我就一个服务，所以我就拿集合中的第一个就成\n        ServiceInstance serviceInstance = instancesList.get(0);\n        //服务的resutApi接口\n        String url = &amp;quot;http://&amp;quot; + serviceInstance.getHost() + &amp;quot;:&amp;quot; + serviceInstance.getPort() + &amp;quot;/user/&amp;quot; + id;\n        return restTemplate.getForObject(url,User.class);\n    }\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;4、测试&lt;/p&gt;\n&lt;figure data-type=\&#34;image\&#34; tabindex=\&#34;7\&#34;&gt;&lt;img src=\&#34;https://haohanya.github.io/post-images/1591806191931.png\&#34; alt=\&#34;\&#34; loading=\&#34;lazy\&#34;&gt;&lt;/figure&gt;\n&lt;h2 id=\&#34;eureak总结\&#34;&gt;Eureak总结&lt;/h2&gt;\n&lt;p&gt;三个角色&lt;/p&gt;\n&lt;ul&gt;\n&lt;li&gt;服务注册中心\n&lt;ul&gt;\n&lt;li&gt;Eureka的服务端应用，提供服务注册和发现功能，就是我们建立的eureka-server&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;li&gt;服务提供者\n&lt;ul&gt;\n&lt;li&gt;提供服务的应用，可以是springBoot应用，也可以是其他任意技术实现，只要对外提供的是Rest风格服务就可。就是我们建立的user-service&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;li&gt;服务消费者\n&lt;ul&gt;\n&lt;li&gt;消费者应用就是从注册中心获取服务列表，从而得知每个服务放的信息，知道去哪里调用服务，就是我们建立的user-web&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;/ul&gt;\n&lt;h2 id=\&#34;高可用的eureka-server\&#34;&gt;高可用的Eureka Server&lt;/h2&gt;\n&lt;p&gt;我们只有一个Eureak，事实上可以搭建一个集群，形成一个高可用的Eureka注册中心&lt;/p&gt;\n&lt;blockquote&gt;\n&lt;p&gt;服务同步&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;p&gt;多个EurekaServer之间会相互注册为服务，当服务提供者注册到EurekaServer结群中的某个节点的时候，该节点会把服务的信息同步到集群中的每个节点，从而实现数据的同步，一旦有一个节点挂掉了，那么其他的节点依然能提供服务注册和发现的功能&lt;/p&gt;\n&lt;h3 id=\&#34;1-修改eurekaserver配置\&#34;&gt;1、修改EurekaServer配置&lt;/h3&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-yml\&#34;&gt;#端口号\nserver:\n  port: ${port:10086}\nspring:\n  application:\n    name: eureka-server   #应用名称，会在eureka中作为服务的id标识\n\n#配置eurkea\neureka:\n  client:\n    service-url:\n      defaultZone: ${defualtZone:http://127.0.0.1:10086/eureka}\n    #register-with-eureka: false       #不注册自己，默认值是true（如果搭建eureka集群，需要相互之间注册）\n    #fetch-registry: false   #不拉取自己的服务列表\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;2、修改启动配置文件&lt;/p&gt;\n&lt;figure data-type=\&#34;image\&#34; tabindex=\&#34;8\&#34;&gt;&lt;img src=\&#34;https://haohanya.github.io/post-images/1591806205847.png\&#34; alt=\&#34;\&#34; loading=\&#34;lazy\&#34;&gt;&lt;/figure&gt;\n&lt;p&gt;3、复制一份并修改VM options&lt;/p&gt;\n&lt;figure data-type=\&#34;image\&#34; tabindex=\&#34;9\&#34;&gt;&lt;img src=\&#34;https://haohanya.github.io/post-images/1591806216118.png\&#34; alt=\&#34;\&#34; loading=\&#34;lazy\&#34;&gt;&lt;/figure&gt;\n&lt;p&gt;4、启动eureka集群&lt;/p&gt;\n&lt;figure data-type=\&#34;image\&#34; tabindex=\&#34;10\&#34;&gt;&lt;img src=\&#34;https://haohanya.github.io/post-images/1591806227522.png\&#34; alt=\&#34;\&#34; loading=\&#34;lazy\&#34;&gt;&lt;/figure&gt;\n&lt;h2 id=\&#34;服务注册eureka集群\&#34;&gt;服务注册Eureka集群&lt;/h2&gt;\n&lt;p&gt;因为Eureka不止一个，修改user-service关于注册中心的配置&lt;/p&gt;\n&lt;p&gt;服务提供者在启动的时候，会检测配置属性中&lt;code&gt;eureka.client.register-with-eureka=true&lt;/code&gt;参数是否正确，事实上默认是true，所以我们没有配置，如果值确实是true，则会向EurekaServer发起一个Rest请求，并且携带自己的元数据信息，EurekaServer会把这些信息保存到一个双层的Map结构中&lt;/p&gt;\n&lt;ul&gt;\n&lt;li&gt;第一层Map的key就是服务的id，一般就是配置&lt;code&gt;spring.applicaton.name&lt;/code&gt;属性&lt;/li&gt;\n&lt;li&gt;第二层Map的key就是服务的实例id，一般host + serviceId + port，例如：localhost:user-service:9091&lt;/li&gt;\n&lt;li&gt;值则是服务的实例对象，也就是说一个服务，可以同时启动多个不同的实例，形成集群&lt;/li&gt;\n&lt;/ul&gt;\n&lt;p&gt;默认注册的时候是主机名或者是localhost，如果想用ip进行注册，可以在&lt;code&gt;user-server&lt;/code&gt; 中添加配置&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-yml\&#34;&gt;#端口号\nserver:\n  port: 9091\n#数据源\nspring:\n  datasource:\n    driver-class-name: com.mysql.jdbc.Driver\n    url: jdbc:mysql://localhost:3306/springcloud?useUnicode=true&amp;amp;characterEncoding=utf-8&amp;amp;serverTimezone=Asia/Shanghai\n    username: root\n    password: root\n  application:\n    name: user-service   #应用名\n#添加Eureka注册的配置\neureka:\n  client:\n    service-url:  #EurekaServer地址，多个地址之间用逗号分隔\n      defaultZone: http://127.0.0.1:10086/eureka,http://127.0.0.1:10087/eureka\n  instance:\n    ip-address: 127.0.0.1    #ip地址\n    prefer-ip-address: true  #更倾向于使用ip，而不是host名    \n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;修改完成后重启&lt;code&gt;user-server&lt;/code&gt;工程和&lt;code&gt;user-web&lt;/code&gt;工程&lt;/p&gt;\n&lt;blockquote&gt;\n&lt;p&gt;可以测试一下，先关掉10086，然后在测试是否能正常通讯&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;h2 id=\&#34;失效的剔除和自我保护\&#34;&gt;失效的剔除和自我保护&lt;/h2&gt;\n&lt;p&gt;服务续约&lt;/p&gt;\n&lt;blockquote&gt;\n&lt;p&gt;在注册服务完成以后，服务提供者会持续一个心跳（定时向EurekaServer发起Rest请求），告诉EurekaServer：“我还活着”，这个我们就称之为服务的续约(renew)；&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;p&gt;向user-server工程配置文件中添加如下配置&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-yml\&#34;&gt;#添加Eureka注册的配置\neureka:\n  client:\n    service-url:  #EurekaServer地址，多个地址之间用逗号分隔\n      defaultZone: http://127.0.0.1:10086/eureka,http://127.0.0.1:10087/eureka\n  instance:\n    ip-address: 127.0.0.1    #ip地址\n    prefer-ip-address: true  #更倾向于使用ip，而不是host名\n    lease-expiration-duration-in-seconds: 5 #服务续约的时间间隔，默认是30秒，现在我这里设置为5秒\n    lease-renewal-interval-in-seconds: 5  #服务失效时间，默认是90秒，我这里设置为5秒\n&lt;/code&gt;&lt;/pre&gt;\n&lt;blockquote&gt;\n&lt;p&gt;也就是说，默认情况下每个30秒服务会向注册中心发送一次心跳，证明自己还活着，如果超过90秒还没有发送心跳，EurekaServer就会认为该服务已经宕机，会定时从服务列表中移除，这两个值在生产环境中不要修改（我这里修改是为了方便测试）&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;p&gt;服务下线&lt;/p&gt;\n&lt;blockquote&gt;\n&lt;p&gt;当服务进行正常关闭操作的时候，它会触发一个服务下线的REST请求给EurekaSever，告诉服务注册中心：“我要下线了”。服务中心接收到请求之后，会讲该服务置为下线状态&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;p&gt;失效剔除&lt;/p&gt;\n&lt;p&gt;自我保护&lt;/p&gt;\n&lt;blockquote&gt;\n&lt;p&gt;我们关停一个服务，很可能会在eureka面板出现一条警告：&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;figure data-type=\&#34;image\&#34; tabindex=\&#34;11\&#34;&gt;&lt;img src=\&#34;https://haohanya.github.io/post-images/1591806244663.png\&#34; alt=\&#34;\&#34; loading=\&#34;lazy\&#34;&gt;&lt;/figure&gt;\n&lt;blockquote&gt;\n&lt;p&gt;这个就是eureka的自我保护机制。当服务未按时进行心跳续约，Eureka会统计服务实例最近15分钟心跳续约的比例是否低于85%，在生产环境下，因为网络延迟等原因，心跳失败实例的比例很有可能会超标，但是此时就把服务剔除列表并不妥当，因为服务并没有宕机。Erueka在这段时间内不会剔除任何服务实例，直到网络恢复正常。生产环境下这很有效,因此服务调用者必须做好服务的失败容错&lt;/p&gt;\n&lt;p&gt;可以关闭自我保护（生产环境下，千万别干这事！）&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-yml\&#34;&gt;#配置eurkea\neureka:\n  client:\n    service-url:\n      defaultZone: ${defualtZone:http://127.0.0.1:10086/eureka}\n    #register-with-eureka: false       #不注册自己，默认值是true（如果搭建eureka集群，需要相互之间注册）\n    #fetch-registry: false   #不拉取自己的服务列表\n  server:\n    enable-self-preservation: false  #关闭自我保护模式(缺省为打开)\n&lt;/code&gt;&lt;/pre&gt;\n&#34;,&#34;fileName&#34;:&#34;eureka&#34;,&#34;abstract&#34;:&#34;&#34;,&#34;title&#34;:&#34;Eureka&#34;,&#34;tags&#34;:[{&#34;name&#34;:&#34;Eureka&#34;,&#34;slug&#34;:&#34;-ROTKfBE-&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://haohanya.github.io/tag/-ROTKfBE-/&#34;},{&#34;name&#34;:&#34;Spring-Cloud&#34;,&#34;slug&#34;:&#34;omgSh_ZiA&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://haohanya.github.io/tag/omgSh_ZiA/&#34;}],&#34;date&#34;:&#34;2020-06-11 00:21:09&#34;,&#34;dateFormat&#34;:&#34;2020-06-11&#34;,&#34;feature&#34;:&#34;&#34;,&#34;link&#34;:&#34;https://haohanya.github.io/post/eureka/&#34;,&#34;hideInList&#34;:false,&#34;isTop&#34;:false,&#34;stats&#34;:{&#34;text&#34;:&#34;11 min read&#34;,&#34;time&#34;:615000,&#34;words&#34;:2485,&#34;minutes&#34;:11},&#34;description&#34;:&#34;什么是Eureka\n\n百度百科：什么是Eureka\n\n问题分析\n\n刚才的案例，user-service对外提供服务，需要对外暴漏自己的地址。user-web需要记录服务提供者的地址。将来地址出现变更，还需要及时的去更新。这在服务较少的时候不...&#34;,&#34;toc&#34;:&#34;&lt;ul class=\&#34;markdownIt-TOC\&#34;&gt;\n&lt;li&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E4%BB%80%E4%B9%88%E6%98%AFeureka\&#34;&gt;什么是Eureka&lt;/a&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E9%97%AE%E9%A2%98%E5%88%86%E6%9E%90\&#34;&gt;问题分析&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#eureka%E5%81%9A%E4%BB%80%E4%B9%88\&#34;&gt;Eureka做什么&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#eureka%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83%E8%AF%B4%E6%98%8E\&#34;&gt;Eureka注册中心说明&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E5%85%A5%E9%97%A8%E6%A1%88%E4%BE%8B\&#34;&gt;入门案例&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C\&#34;&gt;服务注册&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E6%9C%8D%E5%8A%A1%E5%8F%91%E7%8E%B0\&#34;&gt;服务发现&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#eureak%E6%80%BB%E7%BB%93\&#34;&gt;Eureak总结&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E9%AB%98%E5%8F%AF%E7%94%A8%E7%9A%84eureka-server\&#34;&gt;高可用的Eureka Server&lt;/a&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#1-%E4%BF%AE%E6%94%B9eurekaserver%E9%85%8D%E7%BD%AE\&#34;&gt;1、修改EurekaServer配置&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8Ceureka%E9%9B%86%E7%BE%A4\&#34;&gt;服务注册Eureka集群&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E5%A4%B1%E6%95%88%E7%9A%84%E5%89%94%E9%99%A4%E5%92%8C%E8%87%AA%E6%88%91%E4%BF%9D%E6%8A%A4\&#34;&gt;失效的剔除和自我保护&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;/ul&gt;\n&#34;},{&#34;content&#34;:&#34;&lt;h2 id=\&#34;系统架构的演变\&#34;&gt;系统架构的演变&lt;/h2&gt;\n&lt;blockquote&gt;\n&lt;p&gt;随着互联网的发展，网站的应用规模不断扩大，需求的激增，带来的是技术上的压力。系统架构也因此在不断的演变、升级、迭代。&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;figure data-type=\&#34;image\&#34; tabindex=\&#34;1\&#34;&gt;&lt;img src=\&#34;https://haohanya.github.io/post-images/1591797493895.png\&#34; alt=\&#34;\&#34; loading=\&#34;lazy\&#34;&gt;&lt;/figure&gt;\n&lt;h3 id=\&#34;集中式架构\&#34;&gt;集中式架构&lt;/h3&gt;\n&lt;blockquote&gt;\n&lt;p&gt;当网站流量很小的时候，只需要一个应用，将所有的功能都部署到一起，以减少部署节点和成本。&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;figure data-type=\&#34;image\&#34; tabindex=\&#34;2\&#34;&gt;&lt;img src=\&#34;https://haohanya.github.io/post-images/1591797514846.png\&#34; alt=\&#34;\&#34; loading=\&#34;lazy\&#34;&gt;&lt;/figure&gt;\n&lt;p&gt;优点：系统开发速度快，维护成本低，适合开发并发要求较低的系统&lt;/p&gt;\n&lt;p&gt;缺点：单点容错率低，并发能力差&lt;/p&gt;\n&lt;h3 id=\&#34;垂直应用架构\&#34;&gt;垂直应用架构&lt;/h3&gt;\n&lt;blockquote&gt;\n&lt;p&gt;当访问量逐渐增大，单一应用无法满足需求，此时为了应对更高的并发和业务需求，我们根据业务功能对系统进行拆分：&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;figure data-type=\&#34;image\&#34; tabindex=\&#34;3\&#34;&gt;&lt;img src=\&#34;https://haohanya.github.io/post-images/1591797530176.png\&#34; alt=\&#34;\&#34; loading=\&#34;lazy\&#34;&gt;&lt;/figure&gt;\n&lt;p&gt;优点：&lt;/p&gt;\n&lt;p&gt;系统拆分实现了流量分担，解决了并发问题&lt;/p&gt;\n&lt;p&gt;可以针对不同的模块进行优化&lt;/p&gt;\n&lt;p&gt;方便水平扩展，负载均衡，容错率高&lt;/p&gt;\n&lt;p&gt;缺点：系统之间相互独立，开发中会有很多重复代码，影响开发效率&lt;/p&gt;\n&lt;h3 id=\&#34;分布式服务\&#34;&gt;分布式服务&lt;/h3&gt;\n&lt;blockquote&gt;\n&lt;p&gt;当垂直应用越来越多的时候，应用之间交互不可避免，作为独立的服务，逐渐形成稳定的服务中心，是前段应用能更快速的影响多变的市场需求&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;figure data-type=\&#34;image\&#34; tabindex=\&#34;4\&#34;&gt;&lt;img src=\&#34;https://haohanya.github.io/post-images/1591797545349.png\&#34; alt=\&#34;\&#34; loading=\&#34;lazy\&#34;&gt;&lt;/figure&gt;\n&lt;p&gt;优点：将基础服务进行了抽取，系统之间互相通用，提高了代码的重用性和开发效率&lt;/p&gt;\n&lt;p&gt;缺点：系统之间耦合较高，调用关系复杂，难以维护&lt;/p&gt;\n&lt;h3 id=\&#34;面向服务架构\&#34;&gt;面向服务架构&lt;/h3&gt;\n&lt;blockquote&gt;\n&lt;p&gt;SOA(Service Oriented Architecure)面向服务的架构：它是一种设计方法，其中包含了多个服务，服务与服务之间通过互相依赖最终提供一系列的功能。一个服务通常以独立的形式存在与操作系统进行中，各个服务之间通过网络调用。&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;figure data-type=\&#34;image\&#34; tabindex=\&#34;5\&#34;&gt;&lt;img src=\&#34;https://haohanya.github.io/post-images/1591797558773.png\&#34; alt=\&#34;\&#34; loading=\&#34;lazy\&#34;&gt;&lt;/figure&gt;\n&lt;blockquote&gt;\n&lt;p&gt;ESB(企业服务总线)：简单的说ESB就是一根管道，用来连接各个服务节点，为了继承不同系统，不同协议的服务，ESB做了消息的转换解释和路由工作，让不同的服务互联互通&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;p&gt;SOA缺点&lt;/p&gt;\n&lt;blockquote&gt;\n&lt;p&gt;每个供应商的ESB产品有偏差，自身实现较为复杂；应用服务粒度较大，ESB继承整合所有的服务和协议，数据转换使得运维、测试和部署比较困难，所有的服务都通过一个通路通讯，直接降低了通信速度&lt;/p&gt;\n&lt;p&gt;(dubbo要比这个优化，系统之间通讯采用RPC这种方式，这种方式是直接使用二进制，效率比较高)&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;h3 id=\&#34;微服务架构\&#34;&gt;微服务架构&lt;/h3&gt;\n&lt;blockquote&gt;\n&lt;p&gt;微服务架构是使用&lt;code&gt;一套小服务开发单个应用的方式或途径&lt;/code&gt;，每个服务基于单一业务能力构建（职能单一），运行在自己的进程中，并使用轻量级机制通信，通常是Http API，并能够通过自动化部署机制来独立部署，这些服务可以使用不同的编程语言，以及不同的数据存储技术，并保持最低的集中式管理&lt;/p&gt;\n&lt;p&gt;(dubbo：使用RPC协议通讯，采用的就是二进制通讯，如果要使用dubbo实现系统之间的通讯，必须保证项目是java语言开发的。dubbo是不能实现跨语言平台通讯&lt;/p&gt;\n&lt;p&gt;dubbox：后来是当当网对它进行升级，让dubbo在支持RPC的同时，也支持Http API（RestAPI）通讯 )&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;figure data-type=\&#34;image\&#34; tabindex=\&#34;6\&#34;&gt;&lt;img src=\&#34;https://haohanya.github.io/post-images/1591797585782.png\&#34; alt=\&#34;\&#34; loading=\&#34;lazy\&#34;&gt;&lt;/figure&gt;\n&lt;blockquote&gt;\n&lt;p&gt;API Gateway: 网关是一个服务器，是系统的唯一入口，为每个客户端提供了一个定制的API。API网关核心是，所有的客户端和消费端都通过统一的网关介入微服务，在网管层处理所有的非业务功能。如它还可以具有其他职责：身份验证、监控、负载均衡、缓存、请求分片与管理。通常网关提供RESTFUL/http的方式访问服务，而服务端通过服务注册中心进行服务注册和管理&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;h4 id=\&#34;微服务特点\&#34;&gt;微服务特点&lt;/h4&gt;\n&lt;ul&gt;\n&lt;li&gt;单一职责：微服务中每个服务都对应唯一的业务能力,做到单一职责&lt;/li&gt;\n&lt;li&gt;微：微服务的服务拆分粒度很小，例如一个用户管理就可以作为一个服务，每个服务虽然小，但是“五脏俱全”&lt;/li&gt;\n&lt;li&gt;面向服务：每个服务都要对外暴漏Rest风格服务接口API。并不关心服务的技术实现，做到与平台和语言无关，也不限定用什么技术实现，只要提供Rest的接口即可&lt;/li&gt;\n&lt;li&gt;自治：服务之间相互独立，互不干扰\n&lt;ul&gt;\n&lt;li&gt;团队独立：每个服务都可以一个独立的团队开发，人数不能过多&lt;/li&gt;\n&lt;li&gt;技术独立：面向的是服务，提供Rest接口，使用什么技术没有人干涉&lt;/li&gt;\n&lt;li&gt;前后端分离：采用前后端分离开发，提供统一Rest接口，后端不用再为PC、移动端开发不同的接口&lt;/li&gt;\n&lt;li&gt;部署独立：服务之间虽然有调用，但是要做到服务器重启不影响其他的服务器。有利于持续集成和持续交付。每个服务都是独立的组件，可以复用、可以替换、降低了耦合度，易于维护&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;/ul&gt;\n&lt;blockquote&gt;\n&lt;p&gt;互联网精神：先上线，后迭代&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;p&gt;微服务架构与SOA都是对系统进行了拆分；微服务架构师基于SOA思想，可以把微服务当作去除了ESB总线的SOA。ESB是SOA架构中的中心总线&lt;/p&gt;\n&lt;h2 id=\&#34;服务调用方式\&#34;&gt;服务调用方式&lt;/h2&gt;\n&lt;h3 id=\&#34;常见的远程调用方式\&#34;&gt;常见的远程调用方式&lt;/h3&gt;\n&lt;h4 id=\&#34;1-rpc\&#34;&gt;1、RPC&lt;/h4&gt;\n&lt;blockquote&gt;\n&lt;p&gt;Remote Produce Call。基于Socket的通讯（是用最底层的方式来实现通讯，采用二进制的形式，通讯的效率最高的）。工作在会话层。自定义数据格式，速度快，效率高。早期的webservice，现在热门的dubbox，都是RPC的典型代表（只能是java语言编写的服务之间通讯）&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;h4 id=\&#34;2-http\&#34;&gt;2、Http&lt;/h4&gt;\n&lt;blockquote&gt;\n&lt;p&gt;http其实是一种网络传输协议，基于TCP，工作在应用层，规定了数据传输的格式。现在客户端浏览器与服务器通讯基本上都是采用的http协议，也可以用来进行远程服务调用。缺点是消息封装臃肿，优势是对服务的提供和调用方没有任何技术限定（可以跨语言），自由灵活，更符合微服务的理念&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;blockquote&gt;\n&lt;p&gt;如果你们的公司全部采用的java技术栈，那么使用dubbo作为微服务架构师一个不错的选择。&lt;/p&gt;\n&lt;p&gt;相反如果公司的技术栈多样化，而且你更加青睐于Spring家族，那么SpringCloud搭建微服务就是不二选择，在我们的项目中，会所选择SpringCloud套件，因此会使用http方式来实现微服务之间的调用&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;h3 id=\&#34;http客户端工具\&#34;&gt;Http客户端工具&lt;/h3&gt;\n&lt;p&gt;既然微服务选择了http，那么我们就需要考虑自己来实现对请求和响应的处理，不过开源世界已经有很多的http客户端工具，能够帮助我们做这些事情，例如：&lt;/p&gt;\n&lt;ul&gt;\n&lt;li&gt;HttpClient&lt;/li&gt;\n&lt;li&gt;OkHttp&lt;/li&gt;\n&lt;li&gt;URLConnection&lt;/li&gt;\n&lt;/ul&gt;\n&lt;p&gt;他们之间的API各不相同，而spring也有对http的客户端工具进行了封装（这三种都有），提供了工具类：RestTemplate&lt;/p&gt;\n&lt;h3 id=\&#34;spring的resttemplate\&#34;&gt;Spring的RestTemplate&lt;/h3&gt;\n&lt;blockquote&gt;\n&lt;p&gt;使用spring提供的一个RestTemplate来实现http的交互&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;p&gt;创建springboot项目&lt;/p&gt;\n&lt;h4 id=\&#34;1-创建业务逻辑层user-service\&#34;&gt;1、创建业务逻辑层(user-service)&lt;/h4&gt;\n&lt;p&gt;依赖&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-xml\&#34;&gt;&amp;lt;!-- mapper启动器(准备使用mybatis作为持久层) --&amp;gt;\n&amp;lt;dependency&amp;gt;\n    &amp;lt;groupId&amp;gt;tk.mybatis&amp;lt;/groupId&amp;gt;\n    &amp;lt;artifactId&amp;gt;mapper-spring-boot-starter&amp;lt;/artifactId&amp;gt;\n    &amp;lt;version&amp;gt;2.0.3&amp;lt;/version&amp;gt;\n&amp;lt;/dependency&amp;gt;\n&amp;lt;!-- mysql驱动 --&amp;gt;\n&amp;lt;dependency&amp;gt;\n    &amp;lt;groupId&amp;gt;mysql&amp;lt;/groupId&amp;gt;\n    &amp;lt;artifactId&amp;gt;mysql-connector-java&amp;lt;/artifactId&amp;gt;\n&amp;lt;/dependency&amp;gt;\n&amp;lt;!-- 为了开发方便，我这里引入lombok --&amp;gt;\n&amp;lt;dependency&amp;gt;\n    &amp;lt;groupId&amp;gt;org.projectlombok&amp;lt;/groupId&amp;gt;\n    &amp;lt;artifactId&amp;gt;lombok&amp;lt;/artifactId&amp;gt;\n&amp;lt;/dependency&amp;gt;\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;pojo&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;@Data\n@Table(name = &amp;quot;tb_user&amp;quot;)\npublic class User {\n    @Id\n    @KeySql(useGeneratedKeys = true)\n    private Long id;\n    private String userName;        /*用户名*/\n    private String password;        /*密码*/\n    private String name;            /*姓名*/\n    private Integer age;            /*年龄*/\n    private Integer sex;            /*性别，1男性，2女性*/\n    private Date birthday;          /*生日*/\n    private String note;            /*备注*/\n    private Date created;           /*创建时间*/\n    private Date updated;           /*修改时间*/\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;mapper接口&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;import tk.mybatis.mapper.common.Mapper;\npublic interface UserMapper extends Mapper&amp;lt;User&amp;gt; {\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;在启动类中扫描mapper&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;@SpringBootApplication\n@MapperScan(basePackages = &amp;quot;com.cn.mapper&amp;quot;)\npublic class UserServiceApplication {\n   \n    public static void main(String[] args) {\n        SpringApplication.run(UserServiceApplication.class, args);\n    }\n\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;service&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;public interface UserService {\n    /**\n     * 根据主键查询对象\n     * @param id     主键\n     * @return       对象\n     */\n    User getUserById(Long id);\n}\n-------------\n@Service\npublic class UserServiceImpl implements UserService {\n    @Autowired(required = false)\n    private UserMapper userMapper;\n\n    @Override\n    public User getUserById(Long id) {\n        return userMapper.selectByPrimaryKey(id);\n    }\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;编写控制层提供Rstful接口&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;@RestController\n@RequestMapping(&amp;quot;/user&amp;quot;)\npublic class UserContorller {\n    @Autowired\n    private UserService userService;\n\n    @RequestMapping(&amp;quot;/{id}&amp;quot;)\n    public User getById(@PathVariable(&amp;quot;id&amp;quot;) Long id){\n        return userService.getUserById(id);\n    }\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;2、创建表现层（user-web）&lt;/p&gt;\n&lt;p&gt;pojo：同上&lt;/p&gt;\n&lt;p&gt;启动类配置RestTemplate&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;@SpringBootApplication\npublic class UserWebApplication {\n    @Bean\n    public RestTemplate restTemplate(){\n        return new RestTemplate();\n    }\n    public static void main(String[] args) {\n        SpringApplication.run(UserWebApplication.class, args);\n    }\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;import com.cn.pojo.User;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.web.bind.annotation.PathVariable;\nimport org.springframework.web.bind.annotation.RequestMapping;\nimport org.springframework.web.bind.annotation.RestController;\nimport org.springframework.web.client.RestTemplate;\n\n@RestController\n@RequestMapping(&amp;quot;/consumer&amp;quot;)\npublic class ConsumerController {\n    @Autowired\n    private RestTemplate restTemplate;\n    @RequestMapping(&amp;quot;/{id}&amp;quot;)\n    public User getByid(@PathVariable(&amp;quot;id&amp;quot;) Long id){\n        //通过http的方式实现系统之间的通讯\n        String url = &amp;quot;http://localhost:9091/user/&amp;quot; + id;//这个是user-service提供的rest api风格的接口\n        User user = restTemplate.getForObject(url, User.class);\n        return user;\n    }\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;blockquote&gt;\n&lt;p&gt;上面的操作我们是使用user-service对外提供了根据主键查询用户的接口，然后在user-web通过RestTemplate调用service的接口&lt;/p&gt;\n&lt;p&gt;这样写会存在硬编码的问题，不方便后期维护，并且我们需要记住url的地址，如果发生改变，收不到通知，地址将会失效&lt;/p&gt;\n&lt;p&gt;web层并不知道service层的状态，例如服务器宕机&lt;/p&gt;\n&lt;p&gt;service层也只有一台，不具备高可用&lt;/p&gt;\n&lt;p&gt;即便是service搭建成了集群，web还需要去实现负载均衡&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;p&gt;其实上面说的问题，概括一下就是分布式服务必然要面临的问题：&lt;/p&gt;\n&lt;ul&gt;\n&lt;li&gt;服务管理\n&lt;ul&gt;\n&lt;li&gt;如何自动注册和发现&lt;/li&gt;\n&lt;li&gt;如何实现状态监控&lt;/li&gt;\n&lt;li&gt;如何实现动态路由&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;li&gt;服务如何实现负载均衡&lt;/li&gt;\n&lt;li&gt;服务如何解决容灾问题&lt;/li&gt;\n&lt;li&gt;服务如何实现统一配置&lt;/li&gt;\n&lt;/ul&gt;\n&#34;,&#34;fileName&#34;:&#34;chu-shi-springcloud&#34;,&#34;abstract&#34;:&#34;&#34;,&#34;title&#34;:&#34;初识SpringCloud&#34;,&#34;tags&#34;:[{&#34;name&#34;:&#34;Spring-Cloud&#34;,&#34;slug&#34;:&#34;omgSh_ZiA&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://haohanya.github.io/tag/omgSh_ZiA/&#34;}],&#34;date&#34;:&#34;2020-06-10 21:57:42&#34;,&#34;dateFormat&#34;:&#34;2020-06-10&#34;,&#34;feature&#34;:&#34;&#34;,&#34;link&#34;:&#34;https://haohanya.github.io/post/chu-shi-springcloud/&#34;,&#34;hideInList&#34;:false,&#34;isTop&#34;:false,&#34;stats&#34;:{&#34;text&#34;:&#34;10 min read&#34;,&#34;time&#34;:589000,&#34;words&#34;:2571,&#34;minutes&#34;:10},&#34;description&#34;:&#34;系统架构的演变\n\n随着互联网的发展，网站的应用规模不断扩大，需求的激增，带来的是技术上的压力。系统架构也因此在不断的演变、升级、迭代。\n\n\n集中式架构\n\n当网站流量很小的时候，只需要一个应用，将所有的功能都部署到一起，以减少部署节点和成本。...&#34;,&#34;toc&#34;:&#34;&lt;ul class=\&#34;markdownIt-TOC\&#34;&gt;\n&lt;li&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E7%B3%BB%E7%BB%9F%E6%9E%B6%E6%9E%84%E7%9A%84%E6%BC%94%E5%8F%98\&#34;&gt;系统架构的演变&lt;/a&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E9%9B%86%E4%B8%AD%E5%BC%8F%E6%9E%B6%E6%9E%84\&#34;&gt;集中式架构&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E5%9E%82%E7%9B%B4%E5%BA%94%E7%94%A8%E6%9E%B6%E6%9E%84\&#34;&gt;垂直应用架构&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E5%88%86%E5%B8%83%E5%BC%8F%E6%9C%8D%E5%8A%A1\&#34;&gt;分布式服务&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E9%9D%A2%E5%90%91%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84\&#34;&gt;面向服务架构&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84\&#34;&gt;微服务架构&lt;/a&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E5%BE%AE%E6%9C%8D%E5%8A%A1%E7%89%B9%E7%82%B9\&#34;&gt;微服务特点&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E6%9C%8D%E5%8A%A1%E8%B0%83%E7%94%A8%E6%96%B9%E5%BC%8F\&#34;&gt;服务调用方式&lt;/a&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E5%B8%B8%E8%A7%81%E7%9A%84%E8%BF%9C%E7%A8%8B%E8%B0%83%E7%94%A8%E6%96%B9%E5%BC%8F\&#34;&gt;常见的远程调用方式&lt;/a&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#1-rpc\&#34;&gt;1、RPC&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#2-http\&#34;&gt;2、Http&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#http%E5%AE%A2%E6%88%B7%E7%AB%AF%E5%B7%A5%E5%85%B7\&#34;&gt;Http客户端工具&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#spring%E7%9A%84resttemplate\&#34;&gt;Spring的RestTemplate&lt;/a&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#1-%E5%88%9B%E5%BB%BA%E4%B8%9A%E5%8A%A1%E9%80%BB%E8%BE%91%E5%B1%82user-service\&#34;&gt;1、创建业务逻辑层(user-service)&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;/ul&gt;\n&#34;},{&#34;content&#34;:&#34;&lt;h2 id=\&#34;什么是jap\&#34;&gt;什么是JAP&lt;/h2&gt;\n&lt;blockquote&gt;\n&lt;p&gt;JPA是Java Persistence API的简称，中文名Java持久层API，是JDK 5.0注解或XML描述对象－关系表的映射关系，并将运行期的实体对象持久化到数据库中&lt;br&gt;\nSun引入新的JPA ORM规范出于两个原因：其一，简化现有Java EE和Java SE应用开发工作；其二，Sun希望整合ORM技术，实现天下归一。&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;h2 id=\&#34;mybatis和hibernate的区别\&#34;&gt;mybatis和hibernate的区别&lt;/h2&gt;\n&lt;blockquote&gt;\n&lt;p&gt;mybatis和hibernate一样是个orm数据库框架&lt;br&gt;\n1). hibernate是全自动，而mybatis是半自动。&lt;br&gt;\nmybatis开发是需要去写sql语句，而使用hibernate不需要写任何的sql语句就能实现各种操作&lt;br&gt;\n2).hibernate数据库移植性远大于mybatis。&lt;br&gt;\n如果使用mybatis，一旦数据库发生变化，需要重写编码（比如mysql数据库的sql语句和oracle以及sqlServer数据库他们用的sql语句会有一些差别）。但是使用hibernate一旦数据库发生变化，我们不需要重写编码，只需要改少许的配置就能实现&lt;br&gt;\n3).hibernate拥有完整的日志系统，mybatis则欠缺一些。&lt;br&gt;\n4).mybatis相比hibernate需要关心很多细节&lt;br&gt;\nhibernate配置要比mybatis复杂的多，学习成本也比mybatis高。但也正因为 mybatis使用简单，才导致它要比hibernate关心很多技术细节。mybatis由于不用考虑很多细节，开发模式上与传统jdbc区别很小，因 此很容易上手并开发项目，但忽略细节会导致项目前期bug较多，因而开发出相对稳定的软件很慢，而开发出软件却很快。hibernate则正好与之相反。 但是如果使用hibernate很熟练的话，实际上开发效率丝毫不差于甚至超越mybatis。&lt;/p&gt;\n&lt;p&gt;5).sql直接优化上，mybatis要比hibernate方便很多&lt;br&gt;\n这也是hibernate没落的原因之一。因为sql语句自动生成的，效率上不好控制&lt;/p&gt;\n&lt;p&gt;为什么现在mybatis要比hiernate流行？&lt;br&gt;\n很重要的原因：hibernate的学习难度是目前大家接触的框架中最大的，学习成本远远高于mybatis，所以mybatis更流行&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;h2 id=\&#34;入门\&#34;&gt;入门&lt;/h2&gt;\n&lt;p&gt;1、引入依赖.....&lt;/p&gt;\n&lt;p&gt;2、配置数据源&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-properties\&#34;&gt;spring.datasource.url=jdbc:mysql://localhost:3306/springboot?serverTimezone=UTC&amp;amp;useUnicode=true&amp;amp;characterEncoding=utf8&amp;amp;useSSL=true\nspring.datasource.username=root\nspring.datasource.password=root\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;3、编写实体类&lt;/p&gt;\n&lt;blockquote&gt;\n&lt;p&gt;在mybatis的开发中，实体类所在包名都用的是pojo，但是在spring-data-jpa中，因为spring中实体类的包名一般都是叫做domain，所以我们开发的时候实体类的包名也叫domain&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;import javax.persistence.*;\n/**\n\t@Entity ：该注解表示这个类是一个实体类，（准备用来建立数据库表的映射关系）\n\t@Table ：用来建立实体类和数据库表的真实映射关系，属性name为表名，表名和类名一致可以省略\n\t\n\t\t@id ：表示主键\n\t\t@GeneratedValue(strategy = GenerationType.IDENTITY) ：该字段是自增的\n\t\t@Column ：建立数据库列名的映射\n*/\n@Entity\n@Table(name = &amp;quot;grade&amp;quot;)\npublic class Grade {\n\n    @Id\n    @GeneratedValue(strategy = GenerationType.IDENTITY)\n    @Column(name = &amp;quot;id&amp;quot;,nullable = false)\n    private Integer id;\n\n    @Column(name = &amp;quot;name&amp;quot;,nullable = false,length = 50)\n    private String name;\n\t\n    ....\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;4、编写接口&lt;/p&gt;\n&lt;blockquote&gt;\n&lt;p&gt;在spring-data-jpa中，接口所在的包名，官方用的是repository，所以我们也这么用，它等同于我们之前的dao或者是mapper&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;/**\n * 编写spring-data-jpa接口要点：\n *      1.继承JpaRepository&amp;lt;参数一要操作的类,参数二改类的主键类型&amp;gt;\n *      2.在接口上添加注解@Repository，如果该接口在启动类的同一个包或者是在启动类的子包中，那么该类将交给spring管理\n *   spring-data-jpa接口编写的规则（因为增删改是就用封装好的就可以，该接口主要是用于查询）\n *   精确查询的规则：find + 表名 + By + domain中的属性名\n *   模糊查询的规则：find + 表名 + By + domain中的属性名 + Like\t\n */\n@Repository\npublic interface GradeAreaRepository extends JpaRepository&amp;lt;Grade,Integer&amp;gt; {\n\t/**\n     * 根据年级名称查询年级\n     * @param name\n     * @return\n     */\n    Grade findGradeByName(String name);\n\n    /**\n     * 根据年级名称做模糊查询\n     * @param name\n     * @return\n     */\n    List&amp;lt;Grade&amp;gt; findGradeByNameLike(String name);\n\n    /**\n     * 根据主键查询\n     */\n    Grade findGradeById(Integer id);\n    \n    /**\n     * 根据id和年级名称做联合查询\n     */\n    Grade findGradeByIdAndNameLike(Integer id,String name);\n    \n    /**\n     * 单独的分页操作\n     * 如果希望做分页操作，返回的数据类型必须是spring-data-jpa跟我们封装好的Page，参数放Pageable接口\n     */\n    Page&amp;lt;Grade&amp;gt; findAll(Pageable page);\n}\n\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;5、测试&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-xml\&#34;&gt;&amp;lt;!-- spring-data-jpa测试需要添加的依赖,如果直接在tomcat中运行不需要该包 --&amp;gt;\n&amp;lt;dependency&amp;gt;\n    &amp;lt;groupId&amp;gt;net.minidev&amp;lt;/groupId&amp;gt;\n    &amp;lt;artifactId&amp;gt;asm&amp;lt;/artifactId&amp;gt;\n    &amp;lt;version&amp;gt;1.0.2&amp;lt;/version&amp;gt;\n    &amp;lt;scope&amp;gt;test&amp;lt;/scope&amp;gt;\n&amp;lt;/dependency&amp;gt;\n&lt;/code&gt;&lt;/pre&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;//测试增加\n@Test\npublic void testSave(){\n    Grade grade = new Grade();\n    grade.setName(&amp;quot;五年级&amp;quot;);\n    Grade g = gradeRepository.save(grade);\n    //增加后很容易拿到主键\n    System.out.println(g);\n}\n\n//测试修改(如果不给主键是增加，给主键就是修改)\n@Test\npublic void testUpdate(){\n    Grade grade = new Grade();\n    grade.setId(4);\n    grade.setName(&amp;quot;原子弹设置与制造&amp;quot;);\n    Grade g = gradeRepository.save(grade);\n    System.out.println(g);\n}\n//测试删除--根据主键删除\n@Test\npublic void testDeleteById(){\n    //执行删除\n    gradeRepository.deleteById(5);\n}\n//测试删除--根据对象删除\n@Test\npublic void testDeleteByObject(){\n    //执行删除\n    Grade grade = new Grade();\n    grade.setId(4);\n    gradeRepository.delete(grade);\n}\n//测试删除--删除全部\n@Test\npublic void testDeleteAll(){\n    gradeRepository.deleteAll();\n}\n\n@Test\npublic void testSave100(){\n    for (int i = 1; i &amp;lt;= 100; i++) {\n        Grade grade = new Grade();\n        grade.setName(i+ &amp;quot;年级&amp;quot;);\n        gradeRepository.save(grade);\n    }\n\n}\n\n//测试查询--查询全部\n@Test\npublic void testGetAll(){\n    List&amp;lt;Grade&amp;gt; list = gradeRepository.findAll();\n    for (Grade grade : list) {\n        System.out.println(grade);\n    }\n}\n//测试查询--根据id查询\n@Test\npublic void testGetById(){\n    //根据主键查询\n    Grade grade = gradeRepository.findById(1).get();\n    System.out.println(grade);\n}\n\n//测试查询--根据id查询(在tomcat容器中不会有问题，但是在测试的时候会出现懒加载导致session关闭的问题)\n@Test\npublic void testGetById2(){\n    //根据主键查询\n    //使用getOne方法需要在配置文件中添加   spring.jpa.properties.hibernate.enable_lazy_load_no_trans=true\n    Grade grade = gradeRepository.getOne(1);\n    System.out.println(grade);\n}\n\n\n//测试查询--非主键的精确查询--根据年级名称做精确查询\n@Test\npublic void testGetGradeByName(){\n    Grade grade = gradeRepository.findGradeByName(&amp;quot;1年级&amp;quot;);\n    System.out.println(grade);\n}\n\n//测试查询--模糊查询--根据年级名称做模糊查询\n@Test\npublic void testGetGradeByNameLike(){\n    String name = &amp;quot;火&amp;quot;;\n    List&amp;lt;Grade&amp;gt; list = gradeRepository.findGradeByNameLike(&amp;quot;%&amp;quot; + name + &amp;quot;%&amp;quot;);\n    for (Grade grade : list) {\n        System.out.println(grade);\n    }\n}\n\n@Test\npublic void testGetById3(){\n    Grade grade = gradeRepository.findGradeById(2);\n    System.out.println(grade);\n}\n\n//测试查询--多条件联合查询\n@Test\npublic void testGetGradeByIdAndNameLike(){\n    Grade grade = gradeRepository.findGradeByIdAndNameLike(1, &amp;quot;%1年级%&amp;quot;);\n    System.out.println(grade);\n}\n\n//测试查询--分页查询\n@Test\npublic void testFindAllPages(){\n    //构造Pageable使用PageRequest.of(参数一当前要展示的页码，参数二每页显示的信息条数)\n    //注意：在mybatis的pagehelper中，当前源码是从1开始的，但是在spring-data-jpa中分页页码是从0开始\n    \n    //PageRequest中的其他参数\n    //Pageable pageable = PageRequest.of(0,10, Sort.by(Sort.Direction.DESC,&amp;quot;id&amp;quot;));\n\t//Pageable pageable = PageRequest.of(0,10,Sort.Direction.DESC,&amp;quot;id&amp;quot;);\n    Pageable pageable = PageRequest.of(1,10);\n    Page&amp;lt;Grade&amp;gt; all = gradeRepository.findAll(pageable);\n    System.out.println(&amp;quot;总条数&amp;quot;+all.getTotalElements());\n    System.out.println(&amp;quot;总页数&amp;quot; + all.getTotalPages());\n    System.out.println(&amp;quot;是否有下一页&amp;quot;+all.hasNext());\n    System.out.println(&amp;quot;是否有上一页&amp;quot;+all.hasPrevious());\n    System.out.println(&amp;quot;是否有内容&amp;quot;+all.hasContent());\n    System.out.println(&amp;quot;是否首页&amp;quot;+all.isFirst());\n    System.out.println(&amp;quot;是否最后一页&amp;quot;+all.isLast());\n    System.out.println(&amp;quot;元素数量&amp;quot;+all.getNumberOfElements());\n    //获取到一页数据\n    List&amp;lt;Grade&amp;gt; list = all.getContent();\n    for (Grade grade : list) {\n        System.out.println(grade);\n    }\n        \n}\n&lt;/code&gt;&lt;/pre&gt;\n&#34;,&#34;fileName&#34;:&#34;spring-data-jpa&#34;,&#34;abstract&#34;:&#34;&#34;,&#34;title&#34;:&#34;Spring-Data-Jpa&#34;,&#34;tags&#34;:[{&#34;name&#34;:&#34;jpa&#34;,&#34;slug&#34;:&#34;y_7xhV2bq&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://haohanya.github.io/tag/y_7xhV2bq/&#34;}],&#34;date&#34;:&#34;2020-06-10 21:07:53&#34;,&#34;dateFormat&#34;:&#34;2020-06-10&#34;,&#34;feature&#34;:&#34;&#34;,&#34;link&#34;:&#34;https://haohanya.github.io/post/spring-data-jpa/&#34;,&#34;hideInList&#34;:false,&#34;isTop&#34;:false,&#34;stats&#34;:{&#34;text&#34;:&#34;8 min read&#34;,&#34;time&#34;:471000,&#34;words&#34;:1832,&#34;minutes&#34;:8},&#34;description&#34;:&#34;什么是JAP\n\nJPA是Java Persistence API的简称，中文名Java持久层API，是JDK 5.0注解或XML描述对象－关系表的映射关系，并将运行期的实体对象持久化到数据库中\nSun引入新的JPA ORM规范出于两个原因：...&#34;,&#34;toc&#34;:&#34;&lt;ul class=\&#34;markdownIt-TOC\&#34;&gt;\n&lt;li&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E4%BB%80%E4%B9%88%E6%98%AFjap\&#34;&gt;什么是JAP&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#mybatis%E5%92%8Chibernate%E7%9A%84%E5%8C%BA%E5%88%AB\&#34;&gt;mybatis和hibernate的区别&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E5%85%A5%E9%97%A8\&#34;&gt;入门&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;/ul&gt;\n&#34;},{&#34;content&#34;:&#34;&lt;h2 id=\&#34;mongo\&#34;&gt;Mongo&lt;/h2&gt;\n&lt;h3 id=\&#34;什么是mongodb\&#34;&gt;什么是MongoDB&lt;/h3&gt;\n&lt;blockquote&gt;\n&lt;p&gt;MongoDB是一个基于分布式文件存储的数据库。由C++语言编写。旨在为WEB应用提供可扩展的高性能数据存储解决方案。&lt;br&gt;\nMongoDB是一个介于关系数据库和非关系数据库之间的产品，是非关系数据库当中功能最丰富，最像关系数据库的。它支持的数据结构非常松散，是类似json的bson格式，因此可以存储比较复杂的数据类型。Mongo最大的特点是它支持的查询语言非常强大，其语法有点类似于面向对象的查询语言，几乎可以实现类似关系数据库单表查询的绝大部分功能，而且还支持对数据建立索引。&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;h3 id=\&#34;mongodb特点\&#34;&gt;MongoDB特点&lt;/h3&gt;\n&lt;blockquote&gt;\n&lt;p&gt;它的特点是高性能、易部署、易使用，存储数据非常方便。主要功能特性有：&lt;/p&gt;\n&lt;p&gt;*面向集合存储的，易于存储对象类型的数据&lt;/p&gt;\n&lt;p&gt;*模式自由。&lt;/p&gt;\n&lt;p&gt;*支持动态[查询]&lt;/p&gt;\n&lt;p&gt;*支持完全索引，包含内部对象。&lt;/p&gt;\n&lt;p&gt;*支持查询。&lt;/p&gt;\n&lt;p&gt;*支持复制和故障恢复。&lt;/p&gt;\n&lt;p&gt;*使用高效的二进制数据存储，包括大型对象（如视频等）。&lt;/p&gt;\n&lt;p&gt;*自动处理碎片，以支持云计算层次的扩展性。&lt;/p&gt;\n&lt;p&gt;*支持 Golang，RUBY，PYTHON，JAVA，C++，PHP，C#等多种语言。&lt;/p&gt;\n&lt;p&gt;*文件存储格式为BSON（一种JSON的扩展）。&lt;/p&gt;\n&lt;p&gt;*可通过网络访问。&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;h3 id=\&#34;mongodb体系结构\&#34;&gt;MongoDB体系结构&lt;/h3&gt;\n&lt;blockquote&gt;\n&lt;p&gt;mongo的逻辑结果是一种层次结构&lt;/p&gt;\n&lt;p&gt;主要由如下几个东西组成：&lt;/p&gt;\n&lt;p&gt;文档(document)、集合(collection)、数据库(database)这三部分组成，逻辑结构是面向用户的。&lt;/p&gt;\n&lt;p&gt;用户就可以通过MongoDB开发应用程序使用的就是逻辑结构&lt;/p&gt;\n&lt;p&gt;(1)MongoDB的document，相当于是MySQL（关系型数据库）中的一行记录&lt;/p&gt;\n&lt;p&gt;(2)多个文档组成一个集合，在MySQL中多条记录组成的是表&lt;/p&gt;\n&lt;p&gt;(3)多个集合，逻辑上组织在一起，就是一个数据库&lt;/p&gt;\n&lt;p&gt;(4)一个MongoDB实例支持多个数据库&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;table&gt;\n&lt;thead&gt;\n&lt;tr&gt;\n&lt;th style=\&#34;text-align:center\&#34;&gt;MongoDB&lt;/th&gt;\n&lt;th style=\&#34;text-align:center\&#34;&gt;Mysql&lt;/th&gt;\n&lt;/tr&gt;\n&lt;/thead&gt;\n&lt;tbody&gt;\n&lt;tr&gt;\n&lt;td style=\&#34;text-align:center\&#34;&gt;数据库(database)&lt;/td&gt;\n&lt;td style=\&#34;text-align:center\&#34;&gt;数据库(database)&lt;/td&gt;\n&lt;/tr&gt;\n&lt;tr&gt;\n&lt;td style=\&#34;text-align:center\&#34;&gt;集合(collection)&lt;/td&gt;\n&lt;td style=\&#34;text-align:center\&#34;&gt;表(table)&lt;/td&gt;\n&lt;/tr&gt;\n&lt;tr&gt;\n&lt;td style=\&#34;text-align:center\&#34;&gt;文档(document)&lt;/td&gt;\n&lt;td style=\&#34;text-align:center\&#34;&gt;行(row)&lt;/td&gt;\n&lt;/tr&gt;\n&lt;/tbody&gt;\n&lt;/table&gt;\n&lt;h2 id=\&#34;安装mongo\&#34;&gt;安装Mongo&lt;/h2&gt;\n&lt;h3 id=\&#34;1-拉取镜像\&#34;&gt;1、拉取镜像&lt;/h3&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-bash\&#34;&gt;docker pull mongo:latest\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h3 id=\&#34;2-创建容器\&#34;&gt;2、创建容器&lt;/h3&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-bash\&#34;&gt;docker run -di --name=mymongo -p 27017:27017 mongo --auth\n&lt;/code&gt;&lt;/pre&gt;\n&lt;blockquote&gt;\n&lt;p&gt;27017 ：mongo默认的端口&lt;/p&gt;\n&lt;p&gt;--auth：启用验证，默认关闭&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;h3 id=\&#34;3-创建用户\&#34;&gt;3、创建用户&lt;/h3&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-bash\&#34;&gt;# 进入容器\ndocker exec -it mymongo /bin/bash\n# 进入Mongo\nmongo\n# 选择数据库\nuse admin\n# 创建用户\ndb.createUser({user:&amp;quot;root&amp;quot;,pwd:&amp;quot;root&amp;quot;,roles:[{role:&amp;quot;root&amp;quot;,db:&amp;quot;admin&amp;quot;}]})\n&lt;/code&gt;&lt;/pre&gt;\n&lt;figure data-type=\&#34;image\&#34; tabindex=\&#34;1\&#34;&gt;&lt;img src=\&#34;https://haohanya.github.io/post-images/1590650660588.png\&#34; alt=\&#34;\&#34; loading=\&#34;lazy\&#34;&gt;&lt;/figure&gt;\n&lt;h2 id=\&#34;crud\&#34;&gt;CRUD&lt;/h2&gt;\n&lt;blockquote&gt;\n&lt;p&gt;如果涉及到认证问题，必须在操作之前登陆&lt;/p&gt;\n&lt;p&gt;&lt;code&gt;db.auth(&amp;quot;账号&amp;quot;,&amp;quot;密码&amp;quot;)&lt;/code&gt;&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;h3 id=\&#34;添加\&#34;&gt;添加&lt;/h3&gt;\n&lt;p&gt;语法：&lt;code&gt;db.collection.save(json)&lt;/code&gt;&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-sql\&#34;&gt;db.student.save({name:&amp;quot;张三&amp;quot;,sex:&amp;quot;男&amp;quot;,address:&amp;quot;湖北&amp;quot;})\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h3 id=\&#34;查询\&#34;&gt;查询&lt;/h3&gt;\n&lt;h4 id=\&#34;查询全部\&#34;&gt;查询全部&lt;/h4&gt;\n&lt;p&gt;语法：&lt;code&gt;db.collection.find()&lt;/code&gt;&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-sql\&#34;&gt;db.student.find()\n# 结果\n# { &amp;quot;_id&amp;quot; : ObjectId(&amp;quot;5ece87413b6767c1aa235b37&amp;quot;), &amp;quot;name&amp;quot; : &amp;quot;张三&amp;quot;, &amp;quot;sex&amp;quot; : &amp;quot;女&amp;quot;, &amp;quot;address&amp;quot; : &amp;quot;湖北&amp;quot; }\n&lt;/code&gt;&lt;/pre&gt;\n&lt;blockquote&gt;\n&lt;p&gt;这里大家会发现每条文档都有一个叫 &amp;quot;_id&amp;quot;字段，这个相当于mysql数据库中表的主键，当你在插入记录的时候，没有指定该字段，mongo会自动创建，类型是ObjectId类型&lt;/p&gt;\n&lt;p&gt;如果我们在插入文档记录的时候指定了该字段，其类型可以是ObjectId，也可以是mongo支持的任意数据类型&lt;/p&gt;\n&lt;p&gt;如：&lt;code&gt;db.student.save({_id:1,name:&amp;quot;张三&amp;quot;,sex:15,address:&amp;quot;湖北&amp;quot;})&lt;/code&gt;&lt;/p&gt;\n&lt;p&gt;如果_id 的值是一样的会覆盖原有的数据&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;h4 id=\&#34;条件查询\&#34;&gt;条件查询&lt;/h4&gt;\n&lt;p&gt;语法：&lt;code&gt;db.collection.find({key:&amp;quot;value&amp;quot;})&lt;/code&gt;&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-sql\&#34;&gt;db.student.find({name:&amp;quot;李四&amp;quot;})\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h4 id=\&#34;查询单个\&#34;&gt;查询单个&lt;/h4&gt;\n&lt;p&gt;语法：&lt;code&gt;db.collection.findOne({key:value})&lt;/code&gt;&lt;/p&gt;\n&lt;h3 id=\&#34;修改\&#34;&gt;修改&lt;/h3&gt;\n&lt;h4 id=\&#34;完全修改\&#34;&gt;完全修改&lt;/h4&gt;\n&lt;p&gt;语法：&lt;code&gt;db.collection.update(条件json,修改后的json)&lt;/code&gt;&lt;/p&gt;\n&lt;h4 id=\&#34;部分修改\&#34;&gt;部分修改&lt;/h4&gt;\n&lt;p&gt;语法：&lt;code&gt;db.collection.update(条件json,{$set:{key:value,key:value}})&lt;/code&gt;&lt;/p&gt;\n&lt;h3 id=\&#34;删除\&#34;&gt;删除&lt;/h3&gt;\n&lt;p&gt;语法：&lt;code&gt;db.collection.remove(json条件)&lt;/code&gt;&lt;/p&gt;\n&lt;h2 id=\&#34;高级查询\&#34;&gt;高级查询&lt;/h2&gt;\n&lt;h3 id=\&#34;模糊查询\&#34;&gt;模糊查询&lt;/h3&gt;\n&lt;p&gt;语法：&lt;code&gt;db.collection.find({key:/value/})&lt;/code&gt;&lt;/p&gt;\n&lt;blockquote&gt;\n&lt;p&gt;查询key中带有value的文档&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;h3 id=\&#34;查询null\&#34;&gt;查询NULL&lt;/h3&gt;\n&lt;p&gt;语法：&lt;code&gt;db.collection.find({key:null})&lt;/code&gt;&lt;/p&gt;\n&lt;blockquote&gt;\n&lt;p&gt;查询没有key的文档&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;h3 id=\&#34;比较查询\&#34;&gt;比较查询&lt;/h3&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-sql\&#34;&gt;# 大于\ndb.collection.find({key:{$gt:value}})\n# 小于\ndb.collection.find({key:{$lt:value}})\n# 大于或等于\ndb.collection.find({key:{$gte:value}})\n# 小于等于\ndb.collection.find({key:{$lte:value}})\n# 不等于\ndb.collection.find({key:{$ne:value}})\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h3 id=\&#34;判断域字段是否存在\&#34;&gt;判断域/字段是否存在&lt;/h3&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-sql\&#34;&gt;# 语法\ndb.collection.find({key:{$exists:true}})\n# 例子：查询带有address的文档\ndb.student.find({address:{$exists:true}})\n# 例子：查询没有address的文档\ndb.student.find({address:{$exists:false}})\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h3 id=\&#34;包含\&#34;&gt;包含&lt;/h3&gt;\n&lt;blockquote&gt;\n&lt;p&gt;类似于mysql的in&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;p&gt;语法：&lt;code&gt;db.collection.find({key:{$in:[v1,v2,v3,.....]}})&lt;/code&gt;&lt;/p&gt;\n&lt;h3 id=\&#34;统计数量\&#34;&gt;统计数量&lt;/h3&gt;\n&lt;p&gt;语法：&lt;code&gt;db.collection.count()&lt;/code&gt;&lt;/p&gt;\n&lt;p&gt;添加条件语法：&lt;code&gt;db.collection.count(json条件)&lt;/code&gt;&lt;/p&gt;\n&lt;h3 id=\&#34;逻辑运算符\&#34;&gt;逻辑运算符&lt;/h3&gt;\n&lt;h4 id=\&#34;并且\&#34;&gt;并且&lt;/h4&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-sql\&#34;&gt;# 语法\ndb.collection.find($and:[{k1:v1},{k2:{表达式:v2}}])\n# 例子：查询年龄大于10并且小于20\ndb.student.find($and:[{age:{$gt:10}},{age:{$lt:20}}])\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h4 id=\&#34;或者\&#34;&gt;或者&lt;/h4&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-sql\&#34;&gt;# 语法\ndb.collection.find($or:[{k1:v1},{v2:{表达式:v2}}])\n# 例子：查询年龄大于18或者性别为女\ndb.student.find($or:[{age:{$gt:18}},{sex:&amp;quot;女&amp;quot;}])\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h4 id=\&#34;非\&#34;&gt;非&lt;/h4&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-sql\&#34;&gt;db.collection.find({key:{$ne:value}})\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h2 id=\&#34;java操作mongo\&#34;&gt;JAVA操作Mongo&lt;/h2&gt;\n&lt;h3 id=\&#34;1-添加依赖\&#34;&gt;1、添加依赖&lt;/h3&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-xml\&#34;&gt;&amp;lt;!-- mongodb客户端 --&amp;gt;\n&amp;lt;dependency&amp;gt;\n    &amp;lt;groupId&amp;gt;org.mongodb&amp;lt;/groupId&amp;gt;\n    &amp;lt;artifactId&amp;gt;mongo-java-driver&amp;lt;/artifactId&amp;gt;\n    &amp;lt;version&amp;gt;3.9.1&amp;lt;/version&amp;gt;\n&amp;lt;/dependency&amp;gt;\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h3 id=\&#34;2-连接测试\&#34;&gt;2、连接测试&lt;/h3&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;@Test\npublic void testConnection(){\n    //创建认证对象，参数1：用户名、参数2：数据库、参数3：密码\n    MongoCredential credential = MongoCredential.createCredential(&amp;quot;root&amp;quot;,&amp;quot;admin&amp;quot;,&amp;quot;root&amp;quot;.toCharArray());\n    //创建mongo客户端对象，参数1：服务器地址，参数2：mongodb的端口号\n    ServerAddress serverAddress = new ServerAddress(&amp;quot;192.168.25.146&amp;quot;,27017);\n    MongoClient client = new MongoClient(serverAddress, Arrays.asList(credential));\n    //获取到集合（数据库）\n    MongoDatabase database = client.getDatabase(&amp;quot;admin&amp;quot;);\n    //获取collection\n    MongoCollection&amp;lt;Document&amp;gt; student = database.getCollection(&amp;quot;student&amp;quot;);\n    //获取到document集合（一行记录）\n    FindIterable&amp;lt;Document&amp;gt; documents = student.find();\n    for (Document document : documents) {\n        System.out.println(document.getString(&amp;quot;name&amp;quot;));\n        System.out.println(document.getDouble(&amp;quot;age&amp;quot;));\n        System.out.println(document.getString(&amp;quot;sex&amp;quot;));\n    }\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h3 id=\&#34;3-条件查询-匹配\&#34;&gt;3、条件查询-匹配&lt;/h3&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;@Test\npublic void testFindBasi(){\n    //创建认证对象，参数1：用户名、参数2：数据库、参数3：密码\n    MongoCredential credential = MongoCredential.createCredential(&amp;quot;root&amp;quot;,&amp;quot;admin&amp;quot;,&amp;quot;root&amp;quot;.toCharArray());\n    //创建mongo客户端对象，参数1：服务器地址，参数2：mongodb的端口号\n    ServerAddress serverAddress = new ServerAddress(&amp;quot;192.168.25.146&amp;quot;,27017);\n    MongoClient client = new MongoClient(serverAddress, Arrays.asList(credential));\n    //获取到集合（数据库）\n    MongoDatabase database = client.getDatabase(&amp;quot;admin&amp;quot;);\n    //获取collection\n    MongoCollection&amp;lt;Document&amp;gt; student = database.getCollection(&amp;quot;student&amp;quot;);\n\n    /*------------------------------------创建查询条件----------------------------------------------*/\n\n    Map&amp;lt;String,Object&amp;gt; map = new HashMap&amp;lt;&amp;gt;();\n    map.put(&amp;quot;name&amp;quot;,&amp;quot;张三&amp;quot;);\n    BasicDBObject basicDBObject = new BasicDBObject(map);\n\n    /*------------------------------------创建查询条件----------------------------------------------*/\n\n    //获取到document集合（一行记录）\n    FindIterable&amp;lt;Document&amp;gt; documents = student.find(basicDBObject);\n    for (Document document : documents) {\n        System.out.println(document.getString(&amp;quot;name&amp;quot;));\n        System.out.println(document.getDouble(&amp;quot;age&amp;quot;));\n        System.out.println(document.getString(&amp;quot;sex&amp;quot;));\n    }\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h3 id=\&#34;4-条件查询-模糊\&#34;&gt;4、条件查询-模糊&lt;/h3&gt;\n&lt;h4 id=\&#34;完全匹配\&#34;&gt;完全匹配&lt;/h4&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;/*------------------------------------创建查询条件----------------------------------------------*/\nPattern pattern = Pattern.compile(&amp;quot;^张三$&amp;quot;);\n\nMap&amp;lt;String,Object&amp;gt; map = new HashMap&amp;lt;&amp;gt;();\nmap.put(&amp;quot;name&amp;quot;,pattern);\nBasicDBObject basicDBObject = new BasicDBObject(map);\n/*------------------------------------创建查询条件----------------------------------------------*/\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h4 id=\&#34;右匹配\&#34;&gt;右匹配&lt;/h4&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;Pattern pattern = Pattern.compile(&amp;quot;^张.*$&amp;quot;);\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h4 id=\&#34;左匹配\&#34;&gt;左匹配&lt;/h4&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;Pattern pattern = Pattern.compile(&amp;quot;^.*张$&amp;quot;);\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h4 id=\&#34;模糊匹配\&#34;&gt;模糊匹配&lt;/h4&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;Pattern pattern = Pattern.compile(&amp;quot;^.*张.*$&amp;quot;);\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h3 id=\&#34;5-数字比较\&#34;&gt;5、数字比较&lt;/h3&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;//查询年龄大于10\n/*------------------------------------创建查询条件----------------------------------------------*/\nBasicDBObject basicDBObject = new BasicDBObject(&amp;quot;age&amp;quot;,new BasicDBObject(&amp;quot;$gt&amp;quot;,10));\n/*------------------------------------创建查询条件----------------------------------------------*/\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h3 id=\&#34;6-条件连接-并且\&#34;&gt;6、条件连接-并且&lt;/h3&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;//查询性别为男并且年龄大于10岁\n/*------------------------------------创建查询条件----------------------------------------------*/\nBasicDBObject basicDBObject1 = new BasicDBObject(&amp;quot;sex&amp;quot;,&amp;quot;男&amp;quot;);\nBasicDBObject basicDBObject2 = new BasicDBObject(&amp;quot;age&amp;quot;,new BasicDBObject(&amp;quot;$gt&amp;quot;,10));\nBasicDBObject basicDBObject = new BasicDBObject(&amp;quot;$and&amp;quot;,Arrays.asList(basicDBObject1,basicDBObject2));\n/*------------------------------------创建查询条件----------------------------------------------*/\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h3 id=\&#34;7-条件连接-或者\&#34;&gt;7、条件连接-或者&lt;/h3&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;//查询性别为男或者年龄大于20\n/*------------------------------------创建查询条件----------------------------------------------*/\nBasicDBObject basicDBObject1 = new BasicDBObject(&amp;quot;sex&amp;quot;,&amp;quot;男&amp;quot;);\nBasicDBObject basicDBObject2 = new BasicDBObject(&amp;quot;age&amp;quot;,new BasicDBObject(&amp;quot;$gt&amp;quot;,20));\nBasicDBObject basicDBObject = new BasicDBObject(&amp;quot;$or&amp;quot;,Arrays.asList(basicDBObject1,basicDBObject2));\n/*------------------------------------创建查询条件----------------------------------------------*/\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h3 id=\&#34;8-添加\&#34;&gt;8、添加&lt;/h3&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;//创建认证对象，参数1：用户名、参数2：数据库、参数3：密码\nMongoCredential credential = MongoCredential.createCredential(&amp;quot;root&amp;quot;,&amp;quot;admin&amp;quot;,&amp;quot;root&amp;quot;.toCharArray());\n//创建mongo客户端对象，参数1：服务器地址，参数2：mongodb的端口号\nServerAddress serverAddress = new ServerAddress(&amp;quot;192.168.25.146&amp;quot;,27017);\nMongoClient client = new MongoClient(serverAddress, Arrays.asList(credential));\n//获取到集合（数据库）\nMongoDatabase database = client.getDatabase(&amp;quot;admin&amp;quot;);\n//获取collection\nMongoCollection&amp;lt;Document&amp;gt; student = database.getCollection(&amp;quot;student&amp;quot;);\n\nMap&amp;lt;String,Object&amp;gt; map = new HashMap&amp;lt;&amp;gt;();\nmap.put(&amp;quot;name&amp;quot;,&amp;quot;王五&amp;quot;);\nmap.put(&amp;quot;sex&amp;quot;,&amp;quot;男&amp;quot;);\nmap.put(&amp;quot;age&amp;quot;,15);\nmap.put(&amp;quot;address&amp;quot;,&amp;quot;湖南&amp;quot;);\n\nDocument document = new Document(map);\nstudent.insertOne(document);\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h3 id=\&#34;9-修改\&#34;&gt;9、修改&lt;/h3&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;//把_id为1的文档中age修改为55\npublic void update(){\n    //创建认证对象，参数1：用户名、参数2：数据库、参数3：密码\n    MongoCredential credential = MongoCredential.createCredential(&amp;quot;root&amp;quot;,&amp;quot;admin&amp;quot;,&amp;quot;root&amp;quot;.toCharArray());\n    //创建mongo客户端对象，参数1：服务器地址，参数2：mongodb的端口号\n    ServerAddress serverAddress = new ServerAddress(&amp;quot;192.168.25.146&amp;quot;,27017);\n    MongoClient client = new MongoClient(serverAddress, Arrays.asList(credential));\n    //获取到集合（数据库）\n    MongoDatabase database = client.getDatabase(&amp;quot;admin&amp;quot;);\n    //获取collection\n    MongoCollection&amp;lt;Document&amp;gt; student = database.getCollection(&amp;quot;student&amp;quot;);\n\t//修改的条件\n    BasicDBObject filter = new BasicDBObject(&amp;quot;_id&amp;quot;,1);\n    //修改后的域和值\n    BasicDBObject update = new BasicDBObject(&amp;quot;$set&amp;quot;,new BasicDBObject(&amp;quot;age&amp;quot;,55));\n\n    student.updateOne(filter,update);\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h3 id=\&#34;10-删除文档\&#34;&gt;10、删除文档&lt;/h3&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;public void delete(){\n    //创建认证对象，参数1：用户名、参数2：数据库、参数3：密码\n    MongoCredential credential = MongoCredential.createCredential(&amp;quot;root&amp;quot;,&amp;quot;admin&amp;quot;,&amp;quot;root&amp;quot;.toCharArray());\n    //创建mongo客户端对象，参数1：服务器地址，参数2：mongodb的端口号\n    ServerAddress serverAddress = new ServerAddress(&amp;quot;192.168.25.146&amp;quot;,27017);\n    MongoClient client = new MongoClient(serverAddress, Arrays.asList(credential));\n    //获取到集合（数据库）\n    MongoDatabase database = client.getDatabase(&amp;quot;admin&amp;quot;);\n    //获取collection\n    MongoCollection&amp;lt;Document&amp;gt; student = database.getCollection(&amp;quot;student&amp;quot;);\n\n    //删除条件\n    BasicDBObject basicDBObject = new BasicDBObject(&amp;quot;_id&amp;quot;,1);\n    student.deleteOne(basicDBObject);//删除一个\n    student.deleteMany(basicDBObject);//删除所有满足条件的\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h2 id=\&#34;mongodb工具类\&#34;&gt;MongoDB工具类&lt;/h2&gt;\n&lt;blockquote&gt;\n&lt;p&gt;MongoClient被设计成线程安全的类（单线程），也就是我们在使用该类的时候不用考虑并发的情况，这样我们就可以考虑将mongoClient做成一个静态变量，为所有的线程共用，不必每次都销毁，这样就可以极大的提高执行的效率，实际上mongodb提供了内置的连接池来实现&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;package com.mongo.util;\n\nimport com.mongodb.*;\nimport com.mongodb.client.MongoDatabase;\n\nimport java.util.Arrays;\n\n/**\n * @program: mongodb\n * @author: 潘\n * @create: 2020-05-28 12:57\n **/\npublic class MongoManager {\n\n    private static MongoClient client = null;\n\n    private static void init(){\n        MongoCredential credential = MongoCredential.createCredential(&amp;quot;root&amp;quot;, &amp;quot;admin&amp;quot;, &amp;quot;root&amp;quot;.toCharArray());\n        ServerAddress serverAddress = new ServerAddress(&amp;quot;192.168.25.146&amp;quot;, 27017);\n        //选项构造者\n        MongoClientOptions.Builder builder = new MongoClientOptions.Builder();\n        //读取数据的超时时间\n        builder.socketTimeout(5000);\n        //每个地址最大请求数\n        builder.connectionsPerHost(30);\n        //写入的策略,仅仅抛出网络异常\n        builder.writeConcern(WriteConcern.NORMAL);\n        MongoClientOptions options = builder.build();\n        client = new MongoClient(serverAddress, Arrays.asList(credential), options);\n    }\n    public static MongoDatabase getDatabase(String db){\n\n        if(client == null){\n            init();\n        }\n\n        return client.getDatabase(db);\n    }\n\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;dao&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;public class StudentDao {\n\tpublic void save(String name,String sex,double age,String address){\n\t\t// 2.获取数据库(数据库)\n\t\tMongoDatabase database = MongoManager.getDatabase(&amp;quot;admin&amp;quot;);\n\t\t// 3.获取到collection(表)\n\t\tMongoCollection&amp;lt;Document&amp;gt; collection = database.getCollection(&amp;quot;student&amp;quot;);\n\t\t//4.准备要添加的数据\n\t\tMap&amp;lt;String, Object&amp;gt; map = new HashMap&amp;lt;String, Object&amp;gt;();\n\t\tmap.put(&amp;quot;name&amp;quot;, name);\n\t\tmap.put(&amp;quot;sex&amp;quot;, sex);\n\t\tmap.put(&amp;quot;age&amp;quot;, age);\n\t\tmap.put(&amp;quot;address&amp;quot;, address);\n\t\tDocument document = new Document(map);\n\t\t//5.添加数据\n\t\tcollection.insertOne(document);\n\t}\n}\n&lt;/code&gt;&lt;/pre&gt;\n&#34;,&#34;fileName&#34;:&#34;mongodb&#34;,&#34;abstract&#34;:&#34;&#34;,&#34;title&#34;:&#34;MongoDB&#34;,&#34;tags&#34;:[{&#34;name&#34;:&#34;MongoDB&#34;,&#34;slug&#34;:&#34;iYO3GrMyx&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://haohanya.github.io/tag/iYO3GrMyx/&#34;}],&#34;date&#34;:&#34;2020-05-28 15:24:00&#34;,&#34;dateFormat&#34;:&#34;2020-05-28&#34;,&#34;feature&#34;:&#34;&#34;,&#34;link&#34;:&#34;https://haohanya.github.io/post/mongodb/&#34;,&#34;hideInList&#34;:false,&#34;isTop&#34;:false,&#34;stats&#34;:{&#34;text&#34;:&#34;13 min read&#34;,&#34;time&#34;:743000,&#34;words&#34;:2695,&#34;minutes&#34;:13},&#34;description&#34;:&#34;Mongo\n什么是MongoDB\n\nMongoDB是一个基于分布式文件存储的数据库。由C++语言编写。旨在为WEB应用提供可扩展的高性能数据存储解决方案。\nMongoDB是一个介于关系数据库和非关系数据库之间的产品，是非关系数据库当中功能最...&#34;,&#34;toc&#34;:&#34;&lt;ul class=\&#34;markdownIt-TOC\&#34;&gt;\n&lt;li&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#mongo\&#34;&gt;Mongo&lt;/a&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E4%BB%80%E4%B9%88%E6%98%AFmongodb\&#34;&gt;什么是MongoDB&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#mongodb%E7%89%B9%E7%82%B9\&#34;&gt;MongoDB特点&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#mongodb%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84\&#34;&gt;MongoDB体系结构&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E5%AE%89%E8%A3%85mongo\&#34;&gt;安装Mongo&lt;/a&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#1-%E6%8B%89%E5%8F%96%E9%95%9C%E5%83%8F\&#34;&gt;1、拉取镜像&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#2-%E5%88%9B%E5%BB%BA%E5%AE%B9%E5%99%A8\&#34;&gt;2、创建容器&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#3-%E5%88%9B%E5%BB%BA%E7%94%A8%E6%88%B7\&#34;&gt;3、创建用户&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#crud\&#34;&gt;CRUD&lt;/a&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E6%B7%BB%E5%8A%A0\&#34;&gt;添加&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E6%9F%A5%E8%AF%A2\&#34;&gt;查询&lt;/a&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E6%9F%A5%E8%AF%A2%E5%85%A8%E9%83%A8\&#34;&gt;查询全部&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E6%9D%A1%E4%BB%B6%E6%9F%A5%E8%AF%A2\&#34;&gt;条件查询&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E6%9F%A5%E8%AF%A2%E5%8D%95%E4%B8%AA\&#34;&gt;查询单个&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E4%BF%AE%E6%94%B9\&#34;&gt;修改&lt;/a&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E5%AE%8C%E5%85%A8%E4%BF%AE%E6%94%B9\&#34;&gt;完全修改&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E9%83%A8%E5%88%86%E4%BF%AE%E6%94%B9\&#34;&gt;部分修改&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E5%88%A0%E9%99%A4\&#34;&gt;删除&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E9%AB%98%E7%BA%A7%E6%9F%A5%E8%AF%A2\&#34;&gt;高级查询&lt;/a&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E6%A8%A1%E7%B3%8A%E6%9F%A5%E8%AF%A2\&#34;&gt;模糊查询&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E6%9F%A5%E8%AF%A2null\&#34;&gt;查询NULL&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E6%AF%94%E8%BE%83%E6%9F%A5%E8%AF%A2\&#34;&gt;比较查询&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E5%88%A4%E6%96%AD%E5%9F%9F%E5%AD%97%E6%AE%B5%E6%98%AF%E5%90%A6%E5%AD%98%E5%9C%A8\&#34;&gt;判断域/字段是否存在&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E5%8C%85%E5%90%AB\&#34;&gt;包含&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E7%BB%9F%E8%AE%A1%E6%95%B0%E9%87%8F\&#34;&gt;统计数量&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E9%80%BB%E8%BE%91%E8%BF%90%E7%AE%97%E7%AC%A6\&#34;&gt;逻辑运算符&lt;/a&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E5%B9%B6%E4%B8%94\&#34;&gt;并且&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E6%88%96%E8%80%85\&#34;&gt;或者&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E9%9D%9E\&#34;&gt;非&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#java%E6%93%8D%E4%BD%9Cmongo\&#34;&gt;JAVA操作Mongo&lt;/a&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#1-%E6%B7%BB%E5%8A%A0%E4%BE%9D%E8%B5%96\&#34;&gt;1、添加依赖&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#2-%E8%BF%9E%E6%8E%A5%E6%B5%8B%E8%AF%95\&#34;&gt;2、连接测试&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#3-%E6%9D%A1%E4%BB%B6%E6%9F%A5%E8%AF%A2-%E5%8C%B9%E9%85%8D\&#34;&gt;3、条件查询-匹配&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#4-%E6%9D%A1%E4%BB%B6%E6%9F%A5%E8%AF%A2-%E6%A8%A1%E7%B3%8A\&#34;&gt;4、条件查询-模糊&lt;/a&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E5%AE%8C%E5%85%A8%E5%8C%B9%E9%85%8D\&#34;&gt;完全匹配&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E5%8F%B3%E5%8C%B9%E9%85%8D\&#34;&gt;右匹配&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E5%B7%A6%E5%8C%B9%E9%85%8D\&#34;&gt;左匹配&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E6%A8%A1%E7%B3%8A%E5%8C%B9%E9%85%8D\&#34;&gt;模糊匹配&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#5-%E6%95%B0%E5%AD%97%E6%AF%94%E8%BE%83\&#34;&gt;5、数字比较&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#6-%E6%9D%A1%E4%BB%B6%E8%BF%9E%E6%8E%A5-%E5%B9%B6%E4%B8%94\&#34;&gt;6、条件连接-并且&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#7-%E6%9D%A1%E4%BB%B6%E8%BF%9E%E6%8E%A5-%E6%88%96%E8%80%85\&#34;&gt;7、条件连接-或者&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#8-%E6%B7%BB%E5%8A%A0\&#34;&gt;8、添加&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#9-%E4%BF%AE%E6%94%B9\&#34;&gt;9、修改&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#10-%E5%88%A0%E9%99%A4%E6%96%87%E6%A1%A3\&#34;&gt;10、删除文档&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#mongodb%E5%B7%A5%E5%85%B7%E7%B1%BB\&#34;&gt;MongoDB工具类&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;/ul&gt;\n&#34;},{&#34;content&#34;:&#34;&lt;h1 id=\&#34;docker\&#34;&gt;Docker&lt;/h1&gt;\n&lt;h2 id=\&#34;安装docker\&#34;&gt;安装Docker&lt;/h2&gt;\n&lt;h3 id=\&#34;1-使用yum命令在线安装\&#34;&gt;1、使用yum命令在线安装&lt;/h3&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-bash\&#34;&gt;yum install docker\n# 遇事不决就选y\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h3 id=\&#34;2-查看docker版本\&#34;&gt;2、查看docker版本&lt;/h3&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-bash\&#34;&gt;docker -v\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h3 id=\&#34;3-启动与停止\&#34;&gt;3、启动与停止&lt;/h3&gt;\n&lt;blockquote&gt;\n&lt;p&gt;systemctl 命令是系统服务管理器指令，它是 service 和 chkconfig 两个命令组合&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-bash\&#34;&gt;# 启动 docker\nsystemctl start docker\n# 停止 docker\nsystemctl stop docker\n# 重启 docker\nsystemctl restart docker\n# 查看 docker 状态\nsystemctl status docker\n# 开机自启\nsystemctl enable docker\n# 查看 docker 概要信息\ndocker info\n# 查看 docker 帮助文档\ndocker --info\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h2 id=\&#34;docker-镜像操作\&#34;&gt;Docker 镜像操作&lt;/h2&gt;\n&lt;h3 id=\&#34;1-列出镜像\&#34;&gt;1、列出镜像&lt;/h3&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-bash\&#34;&gt;docker images\n# REPOSITORY   镜像所在的仓库名称 \n# TAG          镜像标签（版本号）\n# IMAGE ID     镜像ID\n# CREATE       镜像创建的时间（仓库中创建的时间）\n# SIZE         镜像大小\n&lt;/code&gt;&lt;/pre&gt;\n&lt;figure data-type=\&#34;image\&#34; tabindex=\&#34;1\&#34;&gt;&lt;img src=\&#34;https://haohanya.github.io/post-images/1590650520863.png\&#34; alt=\&#34;\&#34; loading=\&#34;lazy\&#34;&gt;&lt;/figure&gt;\n&lt;h3 id=\&#34;2-搜索镜像\&#34;&gt;2、搜索镜像&lt;/h3&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-bash\&#34;&gt;docker search 镜像名称\n# INDEX \n# NAME         仓库名称\n# DESCRIPTION  镜像描述\n# STARS        用户评价，反应一个镜像的受欢迎程度\n# OFFICIAL     是否是官方\n# AUTOMATED    自动构建，表示该镜像由Docker Hub自动构建流程创建的\n&lt;/code&gt;&lt;/pre&gt;\n&lt;figure data-type=\&#34;image\&#34; tabindex=\&#34;2\&#34;&gt;&lt;img src=\&#34;https://haohanya.github.io/post-images/1590650561249.png\&#34; alt=\&#34;\&#34; loading=\&#34;lazy\&#34;&gt;&lt;/figure&gt;\n&lt;h3 id=\&#34;3-拉取镜像\&#34;&gt;3、拉取镜像&lt;/h3&gt;\n&lt;h4 id=\&#34;从docker-hub上拉取\&#34;&gt;从Docker Hub上拉取&lt;/h4&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-bash\&#34;&gt;docker pull centos:7\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h4 id=\&#34;ustc的镜像\&#34;&gt;ustc的镜像&lt;/h4&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-bash\&#34;&gt;https://lug.ustc.edu.cn/wiki/mirrors/help/docker\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h4 id=\&#34;阿里云镜像\&#34;&gt;阿里云镜像&lt;/h4&gt;\n&lt;p&gt;1、进入阿里云&lt;/p&gt;\n&lt;p&gt;https://cr.console.aliyun.com/cn-hangzhou/instances/mirrors&lt;/p&gt;\n&lt;p&gt;2、得到镜像URL并修改daemon.json&lt;/p&gt;\n&lt;p&gt;3、重启daemon&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-bash\&#34;&gt;systemctl daemon-reload\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;4、重启docker服务&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-bash\&#34;&gt;systemctl restart docker\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h4 id=\&#34;修改daemonjson\&#34;&gt;修改daemon.json&lt;/h4&gt;\n&lt;p&gt;1、编辑文件&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-bash\&#34;&gt;vi /etc/docker/daemon.json\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;2、修改文件内容&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-bash\&#34;&gt;{\n&amp;quot;registry-mirrors&amp;quot;: [&amp;quot;https://docker.mirrors.ustc.edu.cn&amp;quot;]\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;3、重启&lt;/p&gt;\n&lt;h3 id=\&#34;4-删除镜像\&#34;&gt;4、删除镜像&lt;/h3&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-bash\&#34;&gt;# 删除指定镜像\ndocker rmi $IMAGE_ID\n# 删除所有镜像\ndocker rmi `docker images -q`\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h2 id=\&#34;docker容器操作\&#34;&gt;Docker容器操作&lt;/h2&gt;\n&lt;h3 id=\&#34;1-查看容器\&#34;&gt;1、查看容器&lt;/h3&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-bash\&#34;&gt;# 查看正在运行的容器\ndocker ps\n# 查看运行过的容器\ndocker ps -a\n# 查看最后一次运行的容器\ndocker ps -i\n# 查看停止的容器\ndocker ps -f status=exited\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h3 id=\&#34;2-创建与启动容器\&#34;&gt;2、创建与启动容器&lt;/h3&gt;\n&lt;p&gt;创建容器常用的参数说明&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-bash\&#34;&gt;docker run  创建容器命令\n-i          运行该容器\n-t          表示容器启动后会进入其命令行。加入这两个参数后，容器创建就能登录进去。即分配一个伪终端。\n--name      为创建的容器命名\n-v          表示目录映射关系（前者是宿主机目录，后者是映射到宿主机上的目录），可以使用多个－v做多个目录或文件映射。注意：最好做目录映射，在宿主机上做修改，然后共享到容器上。\n-d          在run后面加上-d参数则会创建一个守护式容器在后台运行（这样创建容器后不会自动登陆容器，如果只加-i-t两个参数，创建后就会自动进入容器）\n-p          端口映射，前者是宿主机端口，后者是容器内的映射端口，可以使用多个-p做多个端口映射\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h4 id=\&#34;交互式容器\&#34;&gt;交互式容器&lt;/h4&gt;\n&lt;p&gt;创建一个交互式容器并命名为：mycentos&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-bash\&#34;&gt;docker run -it --name=mycentos centos:7 /bin/bash\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;使用exit命令 退出当前容器&lt;/p&gt;\n&lt;h4 id=\&#34;创建守护式容器\&#34;&gt;创建守护式容器&lt;/h4&gt;\n&lt;p&gt;创建一个守护式容器：如果对于一个需要长期运行的容器来说，我们可以创建一个守护式容器。命令如下（容器名称不能重复）&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-bash\&#34;&gt;docker run -id --name=mycentos2  centos:7\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;登陆守护式容器&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-bash\&#34;&gt;docker exec -it container_name(或者container_id) /bin/bash (exit退出时容器不会停止)\n&lt;/code&gt;&lt;/pre&gt;\n&lt;figure data-type=\&#34;image\&#34; tabindex=\&#34;3\&#34;&gt;&lt;img src=\&#34;https://haohanya.github.io/post-images/1590650581316.png\&#34; alt=\&#34;\&#34; loading=\&#34;lazy\&#34;&gt;&lt;/figure&gt;\n&lt;h3 id=\&#34;3-停止与启动容器\&#34;&gt;3、停止与启动容器&lt;/h3&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-bash\&#34;&gt;# 停止正在运行的容器\ndocker stop $CONTAINER_NAME/ID\n# 运行已停止的容器\ndocker start $CONTAINER_NAME/ID\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h3 id=\&#34;4-文件拷贝\&#34;&gt;4、文件拷贝&lt;/h3&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-bash\&#34;&gt;# 将文件拷贝到容器内\ndocker cp 宿主机内要拷贝的文件或目录 容器名称:拷贝到容器目录\n# 将容器内的文件拷贝出来\ndocker cp 容器名称:容器要拷贝出开的文件或目录 拷贝到宿主机那个目录\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h3 id=\&#34;5-目录挂载\&#34;&gt;5、目录挂载&lt;/h3&gt;\n&lt;blockquote&gt;\n&lt;p&gt;我们可以在创建容器的时候，将宿主机的目录与容器内的目录进行映射，这样我们就可以通过修改宿主机某个目录的文件从而去影响容器。&lt;/p&gt;\n&lt;p&gt;创建容器 添加-v参数 后边为  宿主机目录:容器目录&lt;/p&gt;\n&lt;p&gt;如果共享多级目录可能会出现权限不足的情况&lt;/p&gt;\n&lt;p&gt;这是因为CentOS7中的安全模块selinux把权限禁掉了，我们需要添加参数 --privileged=true 来解决挂载的目录没有权限的问题&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-bash\&#34;&gt;docker run -di -v /usr/test:/usr/test --name=mycentos centos:7\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h3 id=\&#34;6-查看容器ip地址\&#34;&gt;6、查看容器IP地址&lt;/h3&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-bash\&#34;&gt;# 可以通过以下命令查看容器运行的各种数据\ndocker inspect container_name\n# 也可以直接执行下面的命令直接输出IP地址\ndocker inspect --format=&#39;{{.NetworkSettings.IPAddress}}&#39; container_name\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h3 id=\&#34;7-删除容器\&#34;&gt;7、删除容器&lt;/h3&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-bash\&#34;&gt;# 删除指定容器\ndocker rm container_id/name\n# 删除所有容器（以停止运行的）\ndocker rm `docker ps -a -q`\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h2 id=\&#34;部署应用\&#34;&gt;部署应用&lt;/h2&gt;\n&lt;h3 id=\&#34;mysql部署\&#34;&gt;MySQL部署&lt;/h3&gt;\n&lt;p&gt;1、拉取MySQL镜像&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-bash\&#34;&gt;docker pull mysql\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;2、创建MySQL容器&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-bash\&#34;&gt;# -p 宿主机映射端口:容器运行端口\n# -e 表示添加环境变量，MYSQL_ROOT_PASSWORD 为root用户的登陆密码\ndocker run -di --name=jd_mysql -p 33306:3306 -e MYSQL_ROOT_PASSWORD=root mysql\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;3、进入MySQL容器&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-bash\&#34;&gt;docker exec -it jd_mysql /bin/bash\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;4、登陆MySQL&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-bash\&#34;&gt;# -u 用户名，-u后面需要打空格\n# -p密码，-p后面没有空格,加了空格会再输入一遍密码\nmysql -u root -proot\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;5、退出MySQL&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-bash\&#34;&gt;# 退出mysql\nquit\n# 退出容器\nexit\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h3 id=\&#34;tomcat部署\&#34;&gt;Tomcat部署&lt;/h3&gt;\n&lt;p&gt;1、拉取Tomcat镜像&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-bash\&#34;&gt;docker pull tomcat:7-jre7\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;2、创建tomcat容器&lt;/p&gt;\n&lt;blockquote&gt;\n&lt;p&gt;创建容器用于部署单点登录系统（CAS） -p表示地址映射&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-bash\&#34;&gt;docker run -di --name=jd_tomcat -p 9100:8080 -v /usr/local/webapps:/usr/local/tomcat/webapps --privileged=true tomcat:7-jre7\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;3、访问ip:9100/cas&lt;/p&gt;\n&lt;blockquote&gt;\n&lt;p&gt;登陆测试，如果出现Invalid credentials重启.&lt;/p&gt;\n&lt;p&gt;docker restart jd_tomcat&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;h3 id=\&#34;nginx部署\&#34;&gt;nginx部署&lt;/h3&gt;\n&lt;p&gt;1、拉取镜像&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-bash\&#34;&gt;docker pull nginx\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;2、创建容器&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-bash\&#34;&gt;docker run -di --name=mynginx -p 80:80 nginx /bin/bash\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;3、测试&lt;/p&gt;\n&lt;p&gt;无法访问需要手动启动nginx&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-bash\&#34;&gt;docker exec -it jd_nginx /bin/bash\n/etc/init.d/nginx start\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;4、编辑配置文件&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-bash\&#34;&gt;# 将nginx配置文件复制出来\ndocker cp jd_nginx:/etc/nginx/nginx.conf  nginx.conf\n# 修改nginx.conf\n.......\n# 将文件拷贝到容器\ndocker cp nginx.conf jd_nginx:/etc/nginx/nginx.conf\n#重启容器\ndocker restart jd_nginx\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h3 id=\&#34;redis部署\&#34;&gt;Redis部署&lt;/h3&gt;\n&lt;p&gt;1、拉取镜像&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-bash\&#34;&gt;docker pull redis\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;2、创建容器&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-bash\&#34;&gt;docker run -di --name=jd_redis -p 6379:6379 redis\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;3、测试连接&lt;/p&gt;\n&lt;p&gt;&lt;code&gt;redis Desktop&lt;/code&gt;&lt;/p&gt;\n&lt;h2 id=\&#34;备份与迁移\&#34;&gt;备份与迁移&lt;/h2&gt;\n&lt;h3 id=\&#34;1-将容器保存为镜像\&#34;&gt;1、将容器保存为镜像&lt;/h3&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-bash\&#34;&gt;docker commit jd_nginx mynginx\n&lt;/code&gt;&lt;/pre&gt;\n&lt;blockquote&gt;\n&lt;p&gt;jd_nginx：容器名称&lt;/p&gt;\n&lt;p&gt;mynginx：新镜像名称&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;h3 id=\&#34;2-镜像备份\&#34;&gt;2、镜像备份&lt;/h3&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-bash\&#34;&gt;docker save -o mynginx.tar mynginx\n&lt;/code&gt;&lt;/pre&gt;\n&lt;blockquote&gt;\n&lt;p&gt;-o ：输出到的文件&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;h3 id=\&#34;3-镜像恢复与迁移\&#34;&gt;3、镜像恢复与迁移&lt;/h3&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-bash\&#34;&gt;docker load -i mynginx.tar\n&lt;/code&gt;&lt;/pre&gt;\n&lt;blockquote&gt;\n&lt;p&gt;-i ：输入的文件&lt;/p&gt;\n&lt;/blockquote&gt;\n&#34;,&#34;fileName&#34;:&#34;docker&#34;,&#34;abstract&#34;:&#34;&#34;,&#34;title&#34;:&#34;Docker&#34;,&#34;tags&#34;:[{&#34;name&#34;:&#34;Docker&#34;,&#34;slug&#34;:&#34;2aIYOzt0W&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://haohanya.github.io/tag/2aIYOzt0W/&#34;}],&#34;date&#34;:&#34;2020-05-28 15:21:32&#34;,&#34;dateFormat&#34;:&#34;2020-05-28&#34;,&#34;feature&#34;:&#34;&#34;,&#34;link&#34;:&#34;https://haohanya.github.io/post/docker/&#34;,&#34;hideInList&#34;:false,&#34;isTop&#34;:false,&#34;stats&#34;:{&#34;text&#34;:&#34;7 min read&#34;,&#34;time&#34;:393000,&#34;words&#34;:1595,&#34;minutes&#34;:7},&#34;description&#34;:&#34;Docker\n安装Docker\n1、使用yum命令在线安装\nyum install docker\n# 遇事不决就选y\n\n2、查看docker版本\ndocker -v\n\n3、启动与停止\n\nsystemctl 命令是系统服务管理器指令，它是 s...&#34;,&#34;toc&#34;:&#34;&lt;ul class=\&#34;markdownIt-TOC\&#34;&gt;\n&lt;li&gt;&lt;a href=\&#34;#docker\&#34;&gt;Docker&lt;/a&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E5%AE%89%E8%A3%85docker\&#34;&gt;安装Docker&lt;/a&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#1-%E4%BD%BF%E7%94%A8yum%E5%91%BD%E4%BB%A4%E5%9C%A8%E7%BA%BF%E5%AE%89%E8%A3%85\&#34;&gt;1、使用yum命令在线安装&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#2-%E6%9F%A5%E7%9C%8Bdocker%E7%89%88%E6%9C%AC\&#34;&gt;2、查看docker版本&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#3-%E5%90%AF%E5%8A%A8%E4%B8%8E%E5%81%9C%E6%AD%A2\&#34;&gt;3、启动与停止&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#docker-%E9%95%9C%E5%83%8F%E6%93%8D%E4%BD%9C\&#34;&gt;Docker 镜像操作&lt;/a&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#1-%E5%88%97%E5%87%BA%E9%95%9C%E5%83%8F\&#34;&gt;1、列出镜像&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#2-%E6%90%9C%E7%B4%A2%E9%95%9C%E5%83%8F\&#34;&gt;2、搜索镜像&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#3-%E6%8B%89%E5%8F%96%E9%95%9C%E5%83%8F\&#34;&gt;3、拉取镜像&lt;/a&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E4%BB%8Edocker-hub%E4%B8%8A%E6%8B%89%E5%8F%96\&#34;&gt;从Docker Hub上拉取&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#ustc%E7%9A%84%E9%95%9C%E5%83%8F\&#34;&gt;ustc的镜像&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E9%98%BF%E9%87%8C%E4%BA%91%E9%95%9C%E5%83%8F\&#34;&gt;阿里云镜像&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E4%BF%AE%E6%94%B9daemonjson\&#34;&gt;修改daemon.json&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#4-%E5%88%A0%E9%99%A4%E9%95%9C%E5%83%8F\&#34;&gt;4、删除镜像&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#docker%E5%AE%B9%E5%99%A8%E6%93%8D%E4%BD%9C\&#34;&gt;Docker容器操作&lt;/a&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#1-%E6%9F%A5%E7%9C%8B%E5%AE%B9%E5%99%A8\&#34;&gt;1、查看容器&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#2-%E5%88%9B%E5%BB%BA%E4%B8%8E%E5%90%AF%E5%8A%A8%E5%AE%B9%E5%99%A8\&#34;&gt;2、创建与启动容器&lt;/a&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E4%BA%A4%E4%BA%92%E5%BC%8F%E5%AE%B9%E5%99%A8\&#34;&gt;交互式容器&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E5%88%9B%E5%BB%BA%E5%AE%88%E6%8A%A4%E5%BC%8F%E5%AE%B9%E5%99%A8\&#34;&gt;创建守护式容器&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#3-%E5%81%9C%E6%AD%A2%E4%B8%8E%E5%90%AF%E5%8A%A8%E5%AE%B9%E5%99%A8\&#34;&gt;3、停止与启动容器&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#4-%E6%96%87%E4%BB%B6%E6%8B%B7%E8%B4%9D\&#34;&gt;4、文件拷贝&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#5-%E7%9B%AE%E5%BD%95%E6%8C%82%E8%BD%BD\&#34;&gt;5、目录挂载&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#6-%E6%9F%A5%E7%9C%8B%E5%AE%B9%E5%99%A8ip%E5%9C%B0%E5%9D%80\&#34;&gt;6、查看容器IP地址&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#7-%E5%88%A0%E9%99%A4%E5%AE%B9%E5%99%A8\&#34;&gt;7、删除容器&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E9%83%A8%E7%BD%B2%E5%BA%94%E7%94%A8\&#34;&gt;部署应用&lt;/a&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#mysql%E9%83%A8%E7%BD%B2\&#34;&gt;MySQL部署&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#tomcat%E9%83%A8%E7%BD%B2\&#34;&gt;Tomcat部署&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#nginx%E9%83%A8%E7%BD%B2\&#34;&gt;nginx部署&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#redis%E9%83%A8%E7%BD%B2\&#34;&gt;Redis部署&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E5%A4%87%E4%BB%BD%E4%B8%8E%E8%BF%81%E7%A7%BB\&#34;&gt;备份与迁移&lt;/a&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#1-%E5%B0%86%E5%AE%B9%E5%99%A8%E4%BF%9D%E5%AD%98%E4%B8%BA%E9%95%9C%E5%83%8F\&#34;&gt;1、将容器保存为镜像&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#2-%E9%95%9C%E5%83%8F%E5%A4%87%E4%BB%BD\&#34;&gt;2、镜像备份&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#3-%E9%95%9C%E5%83%8F%E6%81%A2%E5%A4%8D%E4%B8%8E%E8%BF%81%E7%A7%BB\&#34;&gt;3、镜像恢复与迁移&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;/ul&gt;\n&#34;},{&#34;content&#34;:&#34;&lt;h2 id=\&#34;搭建redis-cluster\&#34;&gt;搭建Redis-Cluster&lt;/h2&gt;\n&lt;h3 id=\&#34;搭建要求\&#34;&gt;搭建要求&lt;/h3&gt;\n&lt;blockquote&gt;\n&lt;p&gt;需要 6 台 redis 服务器。搭建伪集群。&lt;/p&gt;\n&lt;p&gt;需要 6 个 redis 实例。&lt;/p&gt;\n&lt;p&gt;需要运行在不同的端口 7001-7006&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;h3 id=\&#34;准备工作\&#34;&gt;准备工作&lt;/h3&gt;\n&lt;h4 id=\&#34;1-安装gcc\&#34;&gt;1、安装gcc&lt;/h4&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-bash\&#34;&gt;yum install gcc-c++\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h4 id=\&#34;2-使用yum命令安装-ruby-我们需要使用ruby脚本来实现集群搭建\&#34;&gt;2、使用yum命令安装 ruby （我们需要使用ruby脚本来实现集群搭建）&lt;/h4&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-bash\&#34;&gt;yum install ruby\nyum install rubygems\n&lt;/code&gt;&lt;/pre&gt;\n&lt;blockquote&gt;\n&lt;p&gt;以上两步遇到选择y/N直接填y即可&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;h4 id=\&#34;3-将redis源码包上传到-linux-系统-解压redis源码包\&#34;&gt;3、将redis源码包上传到 linux 系统 ，解压redis源码包&lt;/h4&gt;\n&lt;blockquote&gt;\n&lt;p&gt;tar -zxvf redis-3.0.0.tar.gz&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;h4 id=\&#34;4-编译redis源码-进入redis源码文件夹\&#34;&gt;4、编译redis源码 ，进入redis源码文件夹&lt;/h4&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-bash\&#34;&gt;cd redis-3.0.0\nmake\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h4 id=\&#34;5-创建目录usrlocalredis-cluster目录-安装6个redis实例分别安装在以下目录\&#34;&gt;5、创建目录/usr/local/redis-cluster目录， 安装6个redis实例，分别安装在以下目录&lt;/h4&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-bash\&#34;&gt;mkdir /usr/local/redis-cluster\ncd redis-3.0.0\nmake install PREFIX=/usr/local/redis-cluster/redis-1\n......\nmake install PREFIX=/usr/local/redis-cluster/redis-6\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h4 id=\&#34;6-复制配置文件-将-redis-300redisconf-复制到redis下的bin目录下\&#34;&gt;6、复制配置文件 将 /redis-3.0.0/redis.conf 复制到redis下的bin目录下&lt;/h4&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-bash\&#34;&gt;cp redis.conf /usr/local/redis-cluster/redis-1/bin\n......\ncp redis.conf /usr/local/redis-cluster/redis-6/bin\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h3 id=\&#34;配置集群\&#34;&gt;配置集群&lt;/h3&gt;\n&lt;p&gt;1、修改每个redis节点的配置文件redis.conf&lt;/p&gt;\n&lt;blockquote&gt;\n&lt;p&gt;修改运行端口为7001 （7002 7003 .....）(45行)&lt;/p&gt;\n&lt;p&gt;将cluster-enabled yes 前的注释去掉(632行)&lt;/p&gt;\n&lt;p&gt;daemonize no 改为yes （43行）&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-bash\&#34;&gt;cd /usr/local/redis-cluster/\nvi redis-1/bin/redis.conf\n......\nvi redis-6/bin/redis.conf\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;2、启动每个redis实例&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-bash\&#34;&gt;cd redis-1/bin/\n./redis-server redis.conf\n.......\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;3、上传redis-3.0.0.gem ，安装 ruby用于搭建redis集群的脚本。&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-bash\&#34;&gt;cd ~\ncp redis-3.0.0.gem /usr/local/redis-cluster/\ncd redis-3.0.0/src/\ncp redis-trib.rb /usr/local/redis-cluster/\ncd /usr/local/redis-cluster/\ngem install redis-3.0.0.gem\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;4、使用 ruby 脚本搭建集群。&lt;/p&gt;\n&lt;blockquote&gt;\n&lt;p&gt;进入redis源码目录中的src目录 执行下面的命令&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-bash\&#34;&gt;./redis-trib.rb create --replicas 1 192.168.25.144:7001 192.168.25.144:7002 192.168.25.144:7003 192.168.25.144:7004 192.168.25.144:7005 192.168.25.144:7006\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;5、查看是否启动成功&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-bash\&#34;&gt;ps -ef | grep redis\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h3 id=\&#34;springdataredis连接redis集群\&#34;&gt;SpringDataRedis连接Redis集群&lt;/h3&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-xml\&#34;&gt;&amp;lt;?xml version=&amp;quot;1.0&amp;quot; encoding=&amp;quot;UTF-8&amp;quot;?&amp;gt; \n&amp;lt;beans xmlns=&amp;quot;http://www.springframework.org/schema/beans&amp;quot; \n  xmlns:xsi=&amp;quot;http://www.w3.org/2001/XMLSchema-instance&amp;quot; xmlns:p=&amp;quot;http://www.springframework.org/schema/p&amp;quot; \n  xmlns:context=&amp;quot;http://www.springframework.org/schema/context&amp;quot; \n  xsi:schemaLocation=&amp;quot;http://www.springframework.org/schema/beans   \n            http://www.springframework.org/schema/beans/spring-beans.xsd   \n            http://www.springframework.org/schema/context   \n            http://www.springframework.org/schema/context/spring-context.xsd&amp;quot;&amp;gt;  \n\t&amp;lt;!-- 加载配置属性文件 --&amp;gt;  \n&amp;lt;context:property-placeholder ignore-unresolvable=&amp;quot;true&amp;quot; location=&amp;quot;classpath:properties/redis-cluster-config.properties&amp;quot; /&amp;gt;  \n&amp;lt;bean id=&amp;quot;redis-clusterConfiguration&amp;quot; class=&amp;quot;org.springframework.data.redis.connection.redis-clusterConfiguration&amp;quot;&amp;gt;  \n\t&amp;lt;property name=&amp;quot;maxRedirects&amp;quot; value=&amp;quot;${redis.maxRedirects}&amp;quot;&amp;gt;&amp;lt;/property&amp;gt;  \n\t&amp;lt;property name=&amp;quot;clusterNodes&amp;quot;&amp;gt;  \n\t&amp;lt;set&amp;gt;  \n\t\t&amp;lt;bean class=&amp;quot;org.springframework.data.redis.connection.redis-clusterNode&amp;quot;&amp;gt;  \n\t\t\t&amp;lt;constructor-arg name=&amp;quot;host&amp;quot; value=&amp;quot;${redis.host1}&amp;quot;&amp;gt;&amp;lt;/constructor-arg&amp;gt;  \n\t\t\t&amp;lt;constructor-arg name=&amp;quot;port&amp;quot; value=&amp;quot;${redis.port1}&amp;quot;&amp;gt;&amp;lt;/constructor-arg&amp;gt;  \n\t\t&amp;lt;/bean&amp;gt;  \n\t\t&amp;lt;bean class=&amp;quot;org.springframework.data.redis.connection.redis-clusterNode&amp;quot;&amp;gt;  \n\t\t\t&amp;lt;constructor-arg name=&amp;quot;host&amp;quot; value=&amp;quot;${redis.host2}&amp;quot;&amp;gt;&amp;lt;/constructor-arg&amp;gt;  \n\t\t\t&amp;lt;constructor-arg name=&amp;quot;port&amp;quot; value=&amp;quot;${redis.port2}&amp;quot;&amp;gt;&amp;lt;/constructor-arg&amp;gt;  \n\t\t&amp;lt;/bean&amp;gt;  \n\t\t&amp;lt;bean class=&amp;quot;org.springframework.data.redis.connection.redis-clusterNode&amp;quot;&amp;gt;  \n\t\t\t&amp;lt;constructor-arg name=&amp;quot;host&amp;quot; value=&amp;quot;${redis.host3}&amp;quot;&amp;gt;&amp;lt;/constructor-arg&amp;gt;  \n\t\t\t&amp;lt;constructor-arg name=&amp;quot;port&amp;quot; value=&amp;quot;${redis.port3}&amp;quot;&amp;gt;&amp;lt;/constructor-arg&amp;gt;  \n\t\t&amp;lt;/bean&amp;gt;  \n\t     &amp;lt;bean class=&amp;quot;org.springframework.data.redis.connection.redis-clusterNode&amp;quot;&amp;gt;  \n\t         &amp;lt;constructor-arg name=&amp;quot;host&amp;quot; value=&amp;quot;${redis.host4}&amp;quot;&amp;gt;&amp;lt;/constructor-arg&amp;gt;  \n\t         &amp;lt;constructor-arg name=&amp;quot;port&amp;quot; value=&amp;quot;${redis.port4}&amp;quot;&amp;gt;&amp;lt;/constructor-arg&amp;gt;  \n\t      &amp;lt;/bean&amp;gt;  \n\t      &amp;lt;bean class=&amp;quot;org.springframework.data.redis.connection.redis-clusterNode&amp;quot;&amp;gt;  \n\t         &amp;lt;constructor-arg name=&amp;quot;host&amp;quot; value=&amp;quot;${redis.host5}&amp;quot;&amp;gt;&amp;lt;/constructor-arg&amp;gt;  \n\t         &amp;lt;constructor-arg name=&amp;quot;port&amp;quot; value=&amp;quot;${redis.port5}&amp;quot;&amp;gt;&amp;lt;/constructor-arg&amp;gt;  \n\t      &amp;lt;/bean&amp;gt;  \n\t\t &amp;lt;bean class=&amp;quot;org.springframework.data.redis.connection.redis-clusterNode&amp;quot;&amp;gt;  \n\t\t\t&amp;lt;constructor-arg name=&amp;quot;host&amp;quot; value=&amp;quot;${redis.host6}&amp;quot;&amp;gt;&amp;lt;/constructor-arg&amp;gt;  \n\t\t\t&amp;lt;constructor-arg name=&amp;quot;port&amp;quot; value=&amp;quot;${redis.port6}&amp;quot;&amp;gt;&amp;lt;/constructor-arg&amp;gt;  \n\t\t &amp;lt;/bean&amp;gt;  \n\t   &amp;lt;/set&amp;gt;  \n\t &amp;lt;/property&amp;gt;  \n&amp;lt;/bean&amp;gt;  \n&amp;lt;bean id=&amp;quot;jedisPoolConfig&amp;quot;   class=&amp;quot;redis.clients.jedis.JedisPoolConfig&amp;quot;&amp;gt;  \n\t   &amp;lt;property name=&amp;quot;maxIdle&amp;quot; value=&amp;quot;${redis.maxIdle}&amp;quot; /&amp;gt;   \n\t   &amp;lt;property name=&amp;quot;maxTotal&amp;quot; value=&amp;quot;${redis.maxTotal}&amp;quot; /&amp;gt;   \n&amp;lt;/bean&amp;gt;  \n&amp;lt;bean id=&amp;quot;jeidsConnectionFactory&amp;quot; class=&amp;quot;org.springframework.data.redis.connection.jedis.JedisConnectionFactory&amp;quot;  &amp;gt;  \n\t\t&amp;lt;constructor-arg ref=&amp;quot;redis-clusterConfiguration&amp;quot; /&amp;gt;  \n\t\t&amp;lt;constructor-arg ref=&amp;quot;jedisPoolConfig&amp;quot; /&amp;gt;  \n&amp;lt;/bean&amp;gt;    \n&amp;lt;bean id=&amp;quot;redisTemplate&amp;quot; class=&amp;quot;org.springframework.data.redis.core.RedisTemplate&amp;quot;&amp;gt;  \n\t\t&amp;lt;property name=&amp;quot;connectionFactory&amp;quot; ref=&amp;quot;jeidsConnectionFactory&amp;quot; /&amp;gt;  \n&amp;lt;/bean&amp;gt;  \n&amp;lt;/beans&amp;gt;\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;redis-cluster-config.properties&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-properties\&#34;&gt;redis.host1=192.168.25.140\nredis.port1=7001\n\nredis.host2=192.168.25.140\nredis.port2=7002\n\nredis.host3=192.168.25.140\nredis.port3=7003\n\nredis.host4=192.168.25.140\nredis.port4=7004\n\nredis.host5=192.168.25.140\nredis.port5=7005\n\nredis.host6=192.168.25.140\nredis.port6=7006\n\nredis.maxRedirects=3\nredis.maxIdle=100\nredis.maxTotal=600\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h2 id=\&#34;模拟集群异常测试\&#34;&gt;模拟集群异常测试&lt;/h2&gt;\n&lt;p&gt;关闭节点命令&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-bash\&#34;&gt;./redis-cli -p 端口 shutdown \n&lt;/code&gt;&lt;/pre&gt;\n&lt;blockquote&gt;\n&lt;p&gt;测试关闭7001 和7004, 看看会发生什么。&lt;/p&gt;\n&lt;p&gt;测试关闭7001、7002、7003 会发生什么。&lt;/p&gt;\n&lt;/blockquote&gt;\n&#34;,&#34;fileName&#34;:&#34;redis-cluster&#34;,&#34;abstract&#34;:&#34;&#34;,&#34;title&#34;:&#34;Redis-Cluster&#34;,&#34;tags&#34;:[{&#34;name&#34;:&#34;Redis-Cluster&#34;,&#34;slug&#34;:&#34;OmikDdlZN&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://haohanya.github.io/tag/OmikDdlZN/&#34;},{&#34;name&#34;:&#34;Redis&#34;,&#34;slug&#34;:&#34;WWST57yMi&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://haohanya.github.io/tag/WWST57yMi/&#34;}],&#34;date&#34;:&#34;2020-05-26 01:19:43&#34;,&#34;dateFormat&#34;:&#34;2020-05-26&#34;,&#34;feature&#34;:&#34;&#34;,&#34;link&#34;:&#34;https://haohanya.github.io/post/redis-cluster/&#34;,&#34;hideInList&#34;:false,&#34;isTop&#34;:false,&#34;stats&#34;:{&#34;text&#34;:&#34;7 min read&#34;,&#34;time&#34;:387000,&#34;words&#34;:1157,&#34;minutes&#34;:7},&#34;description&#34;:&#34;搭建Redis-Cluster\n搭建要求\n\n需要 6 台 redis 服务器。搭建伪集群。\n需要 6 个 redis 实例。\n需要运行在不同的端口 7001-7006\n\n准备工作\n1、安装gcc\nyum install gcc-c++\n\n2...&#34;,&#34;toc&#34;:&#34;&lt;ul class=\&#34;markdownIt-TOC\&#34;&gt;\n&lt;li&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E6%90%AD%E5%BB%BAredis-cluster\&#34;&gt;搭建Redis-Cluster&lt;/a&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E6%90%AD%E5%BB%BA%E8%A6%81%E6%B1%82\&#34;&gt;搭建要求&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E5%87%86%E5%A4%87%E5%B7%A5%E4%BD%9C\&#34;&gt;准备工作&lt;/a&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#1-%E5%AE%89%E8%A3%85gcc\&#34;&gt;1、安装gcc&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#2-%E4%BD%BF%E7%94%A8yum%E5%91%BD%E4%BB%A4%E5%AE%89%E8%A3%85-ruby-%E6%88%91%E4%BB%AC%E9%9C%80%E8%A6%81%E4%BD%BF%E7%94%A8ruby%E8%84%9A%E6%9C%AC%E6%9D%A5%E5%AE%9E%E7%8E%B0%E9%9B%86%E7%BE%A4%E6%90%AD%E5%BB%BA\&#34;&gt;2、使用yum命令安装 ruby （我们需要使用ruby脚本来实现集群搭建）&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#3-%E5%B0%86redis%E6%BA%90%E7%A0%81%E5%8C%85%E4%B8%8A%E4%BC%A0%E5%88%B0-linux-%E7%B3%BB%E7%BB%9F-%E8%A7%A3%E5%8E%8Bredis%E6%BA%90%E7%A0%81%E5%8C%85\&#34;&gt;3、将redis源码包上传到 linux 系统 ，解压redis源码包&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#4-%E7%BC%96%E8%AF%91redis%E6%BA%90%E7%A0%81-%E8%BF%9B%E5%85%A5redis%E6%BA%90%E7%A0%81%E6%96%87%E4%BB%B6%E5%A4%B9\&#34;&gt;4、编译redis源码 ，进入redis源码文件夹&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#5-%E5%88%9B%E5%BB%BA%E7%9B%AE%E5%BD%95usrlocalredis-cluster%E7%9B%AE%E5%BD%95-%E5%AE%89%E8%A3%856%E4%B8%AAredis%E5%AE%9E%E4%BE%8B%E5%88%86%E5%88%AB%E5%AE%89%E8%A3%85%E5%9C%A8%E4%BB%A5%E4%B8%8B%E7%9B%AE%E5%BD%95\&#34;&gt;5、创建目录/usr/local/redis-cluster目录， 安装6个redis实例，分别安装在以下目录&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#6-%E5%A4%8D%E5%88%B6%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6-%E5%B0%86-redis-300redisconf-%E5%A4%8D%E5%88%B6%E5%88%B0redis%E4%B8%8B%E7%9A%84bin%E7%9B%AE%E5%BD%95%E4%B8%8B\&#34;&gt;6、复制配置文件 将 /redis-3.0.0/redis.conf 复制到redis下的bin目录下&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E9%85%8D%E7%BD%AE%E9%9B%86%E7%BE%A4\&#34;&gt;配置集群&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#springdataredis%E8%BF%9E%E6%8E%A5redis%E9%9B%86%E7%BE%A4\&#34;&gt;SpringDataRedis连接Redis集群&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E6%A8%A1%E6%8B%9F%E9%9B%86%E7%BE%A4%E5%BC%82%E5%B8%B8%E6%B5%8B%E8%AF%95\&#34;&gt;模拟集群异常测试&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;/ul&gt;\n&#34;},{&#34;content&#34;:&#34;&lt;p&gt;查看tomcat运行日志：tail -f logs/catalina.out&lt;/p&gt;\n&lt;h2 id=\&#34;zookeeper安装\&#34;&gt;ZooKeeper安装&lt;/h2&gt;\n&lt;p&gt;官网下载：http://zookeeper.apache.org/releases.html&lt;/p&gt;\n&lt;p&gt;第一次启动会出现错误&lt;/p&gt;\n&lt;p&gt;解决方案：把conf目录下的zoo_sample.cfg复制一份，并改名为zoo.cfg&lt;/p&gt;\n&lt;p&gt;在zookeeper根目录新建一个data目录&lt;/p&gt;\n&lt;p&gt;修改zoo.cfg里面的dataDir=/tmp/zookeeper&lt;/p&gt;\n&lt;p&gt;修改为：../data&lt;/p&gt;\n&lt;h2 id=\&#34;服务提供者\&#34;&gt;服务提供者&lt;/h2&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-xml\&#34;&gt;&amp;lt;!--使用dubbo暴漏服务--&amp;gt;\n&amp;lt;dubbo:protocol name=&amp;quot;dubbo&amp;quot; port=&amp;quot;20881&amp;quot;/&amp;gt;\n&amp;lt;!--将工程注册到dubbo中--&amp;gt;\n&amp;lt;dubbo:application name=&amp;quot;jd-sellergoods-service&amp;quot;/&amp;gt;\n&amp;lt;!--注册中心地址--&amp;gt;\n&amp;lt;dubbo:registry address=&amp;quot;zookeeper://192.168.25.128:2181&amp;quot;/&amp;gt;\n&amp;lt;!--开启注解开发--&amp;gt;\n&amp;lt;dubbo:annotation package=&amp;quot;com.jd.service.impl&amp;quot; /&amp;gt;\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h2 id=\&#34;服务消费者\&#34;&gt;服务消费者&lt;/h2&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-xml\&#34;&gt;&amp;lt;!-- 引用dubbo 服务 --&amp;gt;\n&amp;lt;dubbo:application name=&amp;quot;jd-sellergoods-web&amp;quot; /&amp;gt;\n&amp;lt;dubbo:registry address=&amp;quot;zookeeper://192.168.25.128:2181&amp;quot; timeout=&amp;quot;30000&amp;quot;/&amp;gt;\n&amp;lt;dubbo:annotation package=&amp;quot;com.jd.controller&amp;quot; /&amp;gt;\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h2 id=\&#34;zookeeper集群简介\&#34;&gt;Zookeeper集群简介&lt;/h2&gt;\n&lt;h3 id=\&#34;为什么搭建zookeeper集群\&#34;&gt;为什么搭建Zookeeper集群&lt;/h3&gt;\n&lt;blockquote&gt;\n&lt;p&gt;大部分分布式应用需要一个主控、协调器或者控制器来管理物理分布的子进程。目前，大多数都要开发私有的协调程序，缺乏一个通用机制，协调程序的反复编写浪费，且难以形成通用、伸缩性好的协调器，zookeeper提供通用的分布式锁服务，用以协调分布式应用。所以说zookeeper是分布式应用的协作服务。&lt;/p&gt;\n&lt;p&gt;zookeeper作为注册中心，服务器和客户端都要访问，如果有大量的并发，肯定会有等待。所以可以通过zookeeper集群解决。&lt;/p&gt;\n&lt;p&gt;下面是zookeeper集群部署结构图：&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;figure data-type=\&#34;image\&#34; tabindex=\&#34;1\&#34;&gt;&lt;img src=\&#34;https://haohanya.github.io/post-images/1590380537479.jpg\&#34; alt=\&#34;\&#34; loading=\&#34;lazy\&#34;&gt;&lt;/figure&gt;\n&lt;h3 id=\&#34;了解leader选举\&#34;&gt;了解Leader选举&lt;/h3&gt;\n&lt;blockquote&gt;\n&lt;p&gt;Zookeeper的启动过程中leader选举是非常重要而且最复杂的一个环节。那么什么是leader选举呢？zookeeper为什么需要leader选举呢？zookeeper的leader选举的过程又是什么样子的？&lt;/p&gt;\n&lt;p&gt;首先我们来看看什么是leader选举。其实这个很好理解，leader选举就像总统选举一样，每人一票，获得多数票的人就当选为总统了。在zookeeper集群中也是一样，每个节点都会投票，如果某个节点获得超过半数以上的节点的投票，则该节点就是leader节点了。&lt;/p&gt;\n&lt;p&gt;以一个简单的例子来说明整个选举的过程.&lt;br&gt;\n假设有五台服务器组成的zookeeper集群,它们的id从1-5,同时它们都是最新启动的,也就是没有历史数据,在存放数据量这一点上,都是一样的.假设这些服务器依序启动,来看看会发生什么 。&lt;br&gt;\n1) 服务器1启动,此时只有它一台服务器启动了,它发出去的报没有任何响应,所以它的选举状态一直是LOOKING状态&lt;br&gt;\n2) 服务器2启动,它与最开始启动的服务器1进行通信,互相交换自己的选举结果,由于两者都没有历史数据,所以id值较大的服务器2胜出,但是由于没有达到超过半数以上的服务器都同意选举它(这个例子中的半数以上是3),所以服务器1,2还是继续保持LOOKING状态.&lt;br&gt;\n3) 服务器3启动,根据前面的理论分析,服务器3成为服务器1,2,3中的老大,而与上面不同的是,此时有三台服务器选举了它,所以它成为了这次选举的leader.&lt;br&gt;\n4) 服务器4启动,根据前面的分析,理论上服务器4应该是服务器1,2,3,4中最大的,但是由于前面已经有半数以上的服务器选举了服务器3,所以它只能接收当小弟的命了.&lt;br&gt;\n5) 服务器5启动,同4一样,当小弟&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;h2 id=\&#34;zookeeper集群搭建\&#34;&gt;ZooKeeper集群搭建&lt;/h2&gt;\n&lt;blockquote&gt;\n&lt;p&gt;真实的集群是需要部署在不同的服务器上的，但是在我们测试时同时启动十几个虚拟机内存会吃不消，所以我们通常会搭建&lt;strong&gt;伪集群&lt;/strong&gt;，也就是把所有的服务都搭建在一台虚拟机上，用端口进行区分。&lt;/p&gt;\n&lt;p&gt;我们这里要求搭建一个三个节点的Zookeeper集群（伪集群）。&lt;/p&gt;\n&lt;p&gt;测试环境&lt;/p&gt;\n&lt;p&gt;​\tjdk：1.7&lt;/p&gt;\n&lt;p&gt;​\tzookeeper：3.4.6&lt;/p&gt;\n&lt;p&gt;​\tcentos ：6.x&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;h3 id=\&#34;1-创建一个目录\&#34;&gt;1、创建一个目录&lt;/h3&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-bash\&#34;&gt; mkdir /usr/local/zookeeper-cluster\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h3 id=\&#34;2-上传zookeeper文件并解压\&#34;&gt;2、上传zookeeper文件并解压&lt;/h3&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-bash\&#34;&gt;tar -zxvf zookeeper-3.4.6.tar.gz\n# 新建文件夹\nmkdir zookeeper-3.4.6/data\n#修改coo.cfg名\ncd zookeeper-3.4.6/conf/\nmv zoo_sample.cfg zoo.cfg\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h3 id=\&#34;3-复制zookeeper\&#34;&gt;3、复制zookeeper&lt;/h3&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-bash\&#34;&gt;cp -r  zookeeper-3.4.6 /usr/local/zookeeper-cluster/zookeeper-1\ncp -r  zookeeper-3.4.6 /usr/local/zookeeper-cluster/zookeeper-2\ncp -r  zookeeper-3.4.6 /usr/local/zookeeper-cluster/zookeeper-3\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h3 id=\&#34;4-配置每一个zookeeper\&#34;&gt;4、配置每一个Zookeeper&lt;/h3&gt;\n&lt;blockquote&gt;\n&lt;p&gt;配置每一个Zookeeper 的dataDir（zoo.cfg） clientPort 分别为2181 2182 2183&lt;/p&gt;\n&lt;p&gt;vi /usr/local/zookeeper-cluster/zookeeper-1/conf/zoo.cfg&lt;/p&gt;\n&lt;blockquote&gt;\n&lt;p&gt;clientPort=2181&lt;/p&gt;\n&lt;p&gt;dataDir=/usr/local/zookeeper-cluster/zookeeper-1/data&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;p&gt;vi /usr/local/zookeeper-cluster/zookeeper-2/conf/zoo.cfg&lt;/p&gt;\n&lt;blockquote&gt;\n&lt;p&gt;clientPort=2182&lt;/p&gt;\n&lt;p&gt;dataDir=/usr/local/zookeeper-cluster/zookeeper-2/data&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;p&gt;vi /usr/local/zookeeper-cluster/zookeeper-3/conf/zoo.cfg&lt;/p&gt;\n&lt;blockquote&gt;\n&lt;p&gt;clientPort=2183&lt;/p&gt;\n&lt;p&gt;dataDir=/usr/local/zookeeper-cluster/zookeeper-3/data&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;/blockquote&gt;\n&lt;h3 id=\&#34;5-配置集群\&#34;&gt;5、配置集群&lt;/h3&gt;\n&lt;blockquote&gt;\n&lt;p&gt;在每个zookeeper的 data 目录下创建一个 myid 文件，内容分别是1、2、3 。这个文件就是记录每个服务器的ID（内容为自定义，后面会用到，只要不重复即可）&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-bash\&#34;&gt;cd /usr/local/zookeeper-cluster/\necho 1 &amp;gt;zookeeper-1/data/myid\necho 2 &amp;gt;zookeeper-2/data/myid\necho 3 &amp;gt;zookeeper-3/data/myid\n&lt;/code&gt;&lt;/pre&gt;\n&lt;blockquote&gt;\n&lt;p&gt;在每一个zookeeper 的 zoo.cfg配置客户端访问端口（clientPort）和集群服务器IP列表。&lt;/p&gt;\n&lt;blockquote&gt;\n&lt;p&gt;解释：server.服务器ID=服务器IP地址:服务器之间通信端口:服务器之间投票选举端口&lt;/p&gt;\n&lt;p&gt;服务器ID为上面自定义的内容&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;/blockquote&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-bash\&#34;&gt;server.1=192.168.25.143:2881:3881\nserver.2=192.168.25.143:2882:3882\nserver.3=192.168.25.143:2883:3883\n&lt;/code&gt;&lt;/pre&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-bash\&#34;&gt;vi zookeeper-1/conf/zoo.cfg\nvi zookeeper-2/conf/zoo.cfg\nvi zookeeper-3/conf/zoo.cfg\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h3 id=\&#34;6-启动集群\&#34;&gt;6、启动集群&lt;/h3&gt;\n&lt;blockquote&gt;\n&lt;p&gt;启动集群就是分别启动每个实例。&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-bash\&#34;&gt;./zookeeper-1/bin/zkServer.sh start\n./zookeeper-2/bin/zkServer.sh start\n./zookeeper-3/bin/zkServer.sh start\n# 查看启动状态\n./zookeeper-1/bin/zkServer.sh status\n./zookeeper-2/bin/zkServer.sh status\n./zookeeper-3/bin/zkServer.sh status\n# 如果出现错误，则需要查看日志\nvi zookeeper.out\n&lt;/code&gt;&lt;/pre&gt;\n&lt;figure data-type=\&#34;image\&#34; tabindex=\&#34;2\&#34;&gt;&lt;img src=\&#34;https://haohanya.github.io/post-images/1590380587607.png\&#34; alt=\&#34;\&#34; loading=\&#34;lazy\&#34;&gt;&lt;/figure&gt;\n&lt;blockquote&gt;\n&lt;p&gt;Mode为follower表示是&lt;strong&gt;跟随者&lt;/strong&gt;（从）&lt;/p&gt;\n&lt;p&gt;Mod 为leader表示是&lt;strong&gt;领导者&lt;/strong&gt;（主）&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;h2 id=\&#34;7-模拟集群异常\&#34;&gt;7、模拟集群异常&lt;/h2&gt;\n&lt;blockquote&gt;\n&lt;p&gt;首先我们先测试如果是从服务器挂掉，会怎么样&lt;/p&gt;\n&lt;p&gt;把3号服务器停掉，观察1号和2号，发现状态并没有变化&lt;/p&gt;\n&lt;p&gt;由此得出结论，3个节点的集群，从服务器挂掉，集群正常&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;figure data-type=\&#34;image\&#34; tabindex=\&#34;3\&#34;&gt;&lt;img src=\&#34;https://haohanya.github.io/post-images/1590380605531.png\&#34; alt=\&#34;\&#34; loading=\&#34;lazy\&#34;&gt;&lt;/figure&gt;\n&lt;blockquote&gt;\n&lt;p&gt;我们再把1号服务器（从服务器）也停掉，查看2号（主服务器）的状态，发现已经停止运行了。&lt;/p&gt;\n&lt;p&gt;由此得出结论，3个节点的集群，2个从服务器都挂掉，主服务器也无法运行。因为可运行的机器没有超过集群总数量的半数。&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;figure data-type=\&#34;image\&#34; tabindex=\&#34;4\&#34;&gt;&lt;img src=\&#34;https://haohanya.github.io/post-images/1590380619018.png\&#34; alt=\&#34;\&#34; loading=\&#34;lazy\&#34;&gt;&lt;/figure&gt;\n&lt;blockquote&gt;\n&lt;p&gt;我们再次把1号服务器启动起来，发现2号服务器又开始正常工作了。而且依然是领导者。&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;figure data-type=\&#34;image\&#34; tabindex=\&#34;5\&#34;&gt;&lt;img src=\&#34;https://haohanya.github.io/post-images/1590380630247.png\&#34; alt=\&#34;\&#34; loading=\&#34;lazy\&#34;&gt;&lt;/figure&gt;\n&lt;blockquote&gt;\n&lt;p&gt;我们把3号服务器也启动起来，把2号服务器停掉（汗~~干嘛？领导挂了？）停掉后观察1号和3号的状态。&lt;/p&gt;\n&lt;p&gt;发现新的leader产生了~&lt;/p&gt;\n&lt;p&gt;由此我们得出结论，当集群中的主服务器挂了，集群中的其他服务器会自动进行选举状态，然后产生新得leader&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;figure data-type=\&#34;image\&#34; tabindex=\&#34;6\&#34;&gt;&lt;img src=\&#34;https://haohanya.github.io/post-images/1590380642196.png\&#34; alt=\&#34;\&#34; loading=\&#34;lazy\&#34;&gt;&lt;/figure&gt;\n&lt;blockquote&gt;\n&lt;p&gt;我们再次测试，当我们把2号服务器重新启动起来（汗~~这是诈尸啊!）启动后，会发生什么？2号服务器会再次成为新的领导吗？我们看结果&lt;/p&gt;\n&lt;p&gt;我们会发现，2号服务器启动后依然是跟随者（从服务器），3号服务器依然是领导者（主服务器），没有撼动3号服务器的领导地位。哎~退休了就是退休了，说了不算了，哈哈。&lt;/p&gt;\n&lt;p&gt;由此我们得出结论，当领导者产生后，再次有新服务器加入集群，不会影响到现任领导者。&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;figure data-type=\&#34;image\&#34; tabindex=\&#34;7\&#34;&gt;&lt;img src=\&#34;https://haohanya.github.io/post-images/1590380653854.png\&#34; alt=\&#34;\&#34; loading=\&#34;lazy\&#34;&gt;&lt;/figure&gt;\n&lt;h2 id=\&#34;dubbox连接zookeeper集群\&#34;&gt;Dubbox连接zookeeper集群&lt;/h2&gt;\n&lt;p&gt;修改服务提供者和服务调用者的spring 配置文件,多个节点使用“,”分割&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-xml\&#34;&gt;&amp;lt;!-- 指定注册中心地址 --&amp;gt;\n&amp;lt;dubbo:registry protocol=&amp;quot;zookeeper&amp;quot; address=&amp;quot;192.168.25.129:2181,192.168.25.129:2182,192.168.25.129:2183&amp;quot; /&amp;gt;\n&lt;/code&gt;&lt;/pre&gt;\n&#34;,&#34;fileName&#34;:&#34;zookeeper-cluster&#34;,&#34;abstract&#34;:&#34;&#34;,&#34;title&#34;:&#34; Zookeeper-Cluster&#34;,&#34;tags&#34;:[{&#34;name&#34;:&#34;zookeeper&#34;,&#34;slug&#34;:&#34;vDJgew0mp&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://haohanya.github.io/tag/vDJgew0mp/&#34;},{&#34;name&#34;:&#34;zookeeper-cluster&#34;,&#34;slug&#34;:&#34;12Tyemx1Ht&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://haohanya.github.io/tag/12Tyemx1Ht/&#34;}],&#34;date&#34;:&#34;2020-05-25 12:21:16&#34;,&#34;dateFormat&#34;:&#34;2020-05-25&#34;,&#34;feature&#34;:&#34;&#34;,&#34;link&#34;:&#34;https://haohanya.github.io/post/zookeeper-cluster/&#34;,&#34;hideInList&#34;:false,&#34;isTop&#34;:false,&#34;stats&#34;:{&#34;text&#34;:&#34;9 min read&#34;,&#34;time&#34;:500000,&#34;words&#34;:2069,&#34;minutes&#34;:9},&#34;description&#34;:&#34;查看tomcat运行日志：tail -f logs/catalina.out\nZooKeeper安装\n官网下载：http://zookeeper.apache.org/releases.html\n第一次启动会出现错误\n解决方案：把conf目...&#34;,&#34;toc&#34;:&#34;&lt;ul class=\&#34;markdownIt-TOC\&#34;&gt;\n&lt;li&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#zookeeper%E5%AE%89%E8%A3%85\&#34;&gt;ZooKeeper安装&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E6%9C%8D%E5%8A%A1%E6%8F%90%E4%BE%9B%E8%80%85\&#34;&gt;服务提供者&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E6%9C%8D%E5%8A%A1%E6%B6%88%E8%B4%B9%E8%80%85\&#34;&gt;服务消费者&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#zookeeper%E9%9B%86%E7%BE%A4%E7%AE%80%E4%BB%8B\&#34;&gt;Zookeeper集群简介&lt;/a&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E4%B8%BA%E4%BB%80%E4%B9%88%E6%90%AD%E5%BB%BAzookeeper%E9%9B%86%E7%BE%A4\&#34;&gt;为什么搭建Zookeeper集群&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E4%BA%86%E8%A7%A3leader%E9%80%89%E4%B8%BE\&#34;&gt;了解Leader选举&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#zookeeper%E9%9B%86%E7%BE%A4%E6%90%AD%E5%BB%BA\&#34;&gt;ZooKeeper集群搭建&lt;/a&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#1-%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA%E7%9B%AE%E5%BD%95\&#34;&gt;1、创建一个目录&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#2-%E4%B8%8A%E4%BC%A0zookeeper%E6%96%87%E4%BB%B6%E5%B9%B6%E8%A7%A3%E5%8E%8B\&#34;&gt;2、上传zookeeper文件并解压&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#3-%E5%A4%8D%E5%88%B6zookeeper\&#34;&gt;3、复制zookeeper&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#4-%E9%85%8D%E7%BD%AE%E6%AF%8F%E4%B8%80%E4%B8%AAzookeeper\&#34;&gt;4、配置每一个Zookeeper&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#5-%E9%85%8D%E7%BD%AE%E9%9B%86%E7%BE%A4\&#34;&gt;5、配置集群&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#6-%E5%90%AF%E5%8A%A8%E9%9B%86%E7%BE%A4\&#34;&gt;6、启动集群&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#7-%E6%A8%A1%E6%8B%9F%E9%9B%86%E7%BE%A4%E5%BC%82%E5%B8%B8\&#34;&gt;7、模拟集群异常&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#dubbox%E8%BF%9E%E6%8E%A5zookeeper%E9%9B%86%E7%BE%A4\&#34;&gt;Dubbox连接zookeeper集群&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;/ul&gt;\n&#34;},{&#34;content&#34;:&#34;&lt;h2 id=\&#34;什么是单点登录\&#34;&gt;什么是单点登录&lt;/h2&gt;\n&lt;blockquote&gt;\n&lt;p&gt;&lt;a href=\&#34;http://baike.baidu.com/item/%E5%8D%95%E7%82%B9%E7%99%BB%E5%BD%95\&#34;&gt;单点登录&lt;/a&gt;（Single Sign On），简称为 SSO，是目前比较流行的企业业务整合的解决方案之一。SSO的定义是在多个应用系统中，用户只需要登录一次就可以访问所有相互信任的应用系统。&lt;/p&gt;\n&lt;p&gt;我们目前的系统存在诸多子系统，而这些子系统是分别部署在不同的服务器中，那么使用传统方式的session是无法解决的，我们需要使用相关的单点登录技术来解决。&lt;br&gt;\n&lt;img src=\&#34;https://haohanya.github.io/post-images/1589897963520.jpg\&#34; alt=\&#34;\&#34; loading=\&#34;lazy\&#34;&gt;&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;h2 id=\&#34;什么是cas\&#34;&gt;什么是CAS&lt;/h2&gt;\n&lt;blockquote&gt;\n&lt;p&gt;CAS 是 Yale 大学发起的一个开源项目，旨在为 Web 应用系统提供一种可靠的单点登录方法，CAS 在 2004 年 12 月正式成为 JA-SIG 的一个项目。CAS 具有以下特点：&lt;/p&gt;\n&lt;p&gt;【1】开源的企业级单点登录解决方案。&lt;/p&gt;\n&lt;p&gt;【2】CAS Server 为需要独立部署的 Web 应用。&lt;/p&gt;\n&lt;p&gt;【3】CAS Client 支持非常多的客户端(这里指单点登录系统中的各个 Web 应用)，包括 Java, .Net, PHP, Perl, Apache, uPortal, Ruby 等。&lt;/p&gt;\n&lt;p&gt;从结构上看，CAS 包含两个部分： CAS Server 和 CAS Client。CAS Server 需要独立部署，主要负责对用户的认证工作；CAS Client 负责处理对客户端受保护资源的访问请求，需要登录时，重定向到 CAS Server。下图是 CAS 最基本的协议过程：&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;figure data-type=\&#34;image\&#34; tabindex=\&#34;1\&#34;&gt;&lt;img src=\&#34;https://haohanya.github.io/post-images/1589897985205.jpg\&#34; alt=\&#34;\&#34; loading=\&#34;lazy\&#34;&gt;&lt;/figure&gt;\n&lt;blockquote&gt;\n&lt;p&gt;SSO单点登录访问流程主要有以下步骤：&lt;/p&gt;\n&lt;ol&gt;\n&lt;li&gt;\n&lt;p&gt;访问服务：SSO客户端发送请求访问应用系统提供的服务资源。&lt;/p&gt;\n&lt;/li&gt;\n&lt;li&gt;\n&lt;p&gt;定向认证：SSO客户端会重定向用户请求到SSO服务器。&lt;/p&gt;\n&lt;/li&gt;\n&lt;li&gt;\n&lt;p&gt;用户认证：用户身份认证。&lt;/p&gt;\n&lt;/li&gt;\n&lt;li&gt;\n&lt;p&gt;发放票据：SSO服务器会产生一个随机的Service Ticket。&lt;/p&gt;\n&lt;/li&gt;\n&lt;li&gt;\n&lt;p&gt;验证票据：SSO服务器验证票据Service Ticket的合法性，验证通过后，允许客户端访问服务。&lt;/p&gt;\n&lt;/li&gt;\n&lt;li&gt;\n&lt;p&gt;传输用户信息：SSO服务器验证票据通过后，传输用户认证结果信息给客户端。&lt;/p&gt;\n&lt;/li&gt;\n&lt;/ol&gt;\n&lt;/blockquote&gt;\n&lt;h2 id=\&#34;cas服务端部署\&#34;&gt;CAS服务端部署&lt;/h2&gt;\n&lt;h3 id=\&#34;1-cas安装\&#34;&gt;1、cas安装&lt;/h3&gt;\n&lt;p&gt;在资源\\cas\\source\\cas-server-4.0.0-release\\cas-server-4.0.0\\modules目录下&lt;/p&gt;\n&lt;p&gt;cas-server-webapp-4.0.0.war 将其改名为cas.war放入tomcat目录下的webapps下。启动tomcat自动解压war包。浏览器输入http://localhost:8080/cas/login ，可看到登录页面&lt;/p&gt;\n&lt;figure data-type=\&#34;image\&#34; tabindex=\&#34;2\&#34;&gt;&lt;img src=\&#34;https://haohanya.github.io/post-images/1589897998952.jpg\&#34; alt=\&#34;\&#34; loading=\&#34;lazy\&#34;&gt;&lt;/figure&gt;\n&lt;p&gt;这里有个固定的用户名和密码  casuser/Mellon&lt;/p&gt;\n&lt;p&gt;登录成功后会跳到登录成功的提示页面&lt;/p&gt;\n&lt;figure data-type=\&#34;image\&#34; tabindex=\&#34;3\&#34;&gt;&lt;img src=\&#34;https://haohanya.github.io/post-images/1589898004970.jpg\&#34; alt=\&#34;\&#34; loading=\&#34;lazy\&#34;&gt;&lt;/figure&gt;\n&lt;h3 id=\&#34;2-修改端口\&#34;&gt;2、修改端口&lt;/h3&gt;\n&lt;ol&gt;\n&lt;li&gt;\n&lt;p&gt;修改tomcat端口&lt;/p&gt;\n&lt;p&gt;打开tomcat 目录 conf\\server.xml 找到下面的配置&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-xml\&#34;&gt;&amp;lt;Connector port=&amp;quot;8080&amp;quot; protocol=&amp;quot;HTTP/1.1&amp;quot;\n               connectionTimeout=&amp;quot;20000&amp;quot;\n               redirectPort=&amp;quot;8443&amp;quot; /&amp;gt;\n&amp;lt;!--修改port为9100--&amp;gt;\n&lt;/code&gt;&lt;/pre&gt;\n&lt;/li&gt;\n&lt;li&gt;\n&lt;p&gt;修改CAS配置文件&lt;/p&gt;\n&lt;p&gt;WEB-INF/cas.properties&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-properties\&#34;&gt;server.name=http://localhost:9100\n&lt;/code&gt;&lt;/pre&gt;\n&lt;/li&gt;\n&lt;/ol&gt;\n&lt;h3 id=\&#34;3-去除https认证\&#34;&gt;3、去除https认证&lt;/h3&gt;\n&lt;blockquote&gt;\n&lt;p&gt;CAS默认使用的是HTTPS协议，如果使用HTTPS协议需要SSL安全证书（需向特定的机构申请和购买） 。如果对安全要求不高或是在开发测试阶段，可使用HTTP协议。我们这里讲解通过修改配置，让CAS使用HTTP协议。&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;ol&gt;\n&lt;li&gt;\n&lt;p&gt;修改cas的WEB-INF/deployerConfigContext.xml&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-xml\&#34;&gt;&amp;lt;bean class=&amp;quot;org.jasig.cas.authentication.handler.support.HttpBasedServiceCredentialsAuthenticationHandler&amp;quot;\np:httpClient-ref=&amp;quot;httpClient&amp;quot;/&amp;gt;\n&amp;lt;!-- \n\t这里需要增加参数p:requireSecure=&amp;quot;false&amp;quot;\n\trequireSecure属性意思为是否需要安全验证\n\t即HTTPS，false为不采用\n --&amp;gt;\n&lt;/code&gt;&lt;/pre&gt;\n&lt;/li&gt;\n&lt;li&gt;\n&lt;p&gt;修改cas的/WEB-INF/&lt;a href=\&#34;http://lib.csdn.net/base/javaee\&#34;&gt;&lt;strong&gt;spring&lt;/strong&gt;&lt;/a&gt;-configuration/ticketGrantingTicketCookieGenerator.xml&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-xml\&#34;&gt;&amp;lt;bean id=&amp;quot;ticketGrantingTicketCookieGenerator&amp;quot; class=&amp;quot;org.jasig.cas.web.support.CookieRetrievingCookieGenerator&amp;quot;\n      p:cookieSecure=&amp;quot;true&amp;quot;\n      p:cookieMaxAge=&amp;quot;-1&amp;quot;\n      p:cookieName=&amp;quot;CASTGC&amp;quot;\n      p:cookiePath=&amp;quot;/cas&amp;quot; /&amp;gt;\n&amp;lt;!--\n\t参数p:cookieSecure=&amp;quot;true&amp;quot;，同理为HTTPS验证相关，TRUE为采用HTTPS验证，FALSE为不采用https验证。\n    参数p:cookieMaxAge=&amp;quot;-1&amp;quot;，是COOKIE的最大生命周期，-1为无生命周期，即只在当前打开的窗口有效，关闭或重新打开其它窗口，仍会要求验证。可以根据需要修改为大于0的数字，比如3600等，意思是在3600秒内，打开任意窗口，都不需要验证。\n    我们这里将cookieSecure改为false ,  cookieMaxAge 改为3600\n--&amp;gt;\n&lt;/code&gt;&lt;/pre&gt;\n&lt;/li&gt;\n&lt;li&gt;\n&lt;p&gt;修改cas的WEB-INF/spring-configuration/warnCookieGenerator.xml&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-xml\&#34;&gt;&amp;lt;bean id=&amp;quot;warnCookieGenerator&amp;quot; class=&amp;quot;org.jasig.cas.web.support.CookieRetrievingCookieGenerator&amp;quot;\n    p:cookieSecure=&amp;quot;true&amp;quot;\n    p:cookieMaxAge=&amp;quot;-1&amp;quot;\n    p:cookieName=&amp;quot;CASPRIVACY&amp;quot;\n    p:cookiePath=&amp;quot;/cas&amp;quot; /&amp;gt;\n&amp;lt;!-- 将cookieSecure改为false ,  cookieMaxAge 改为3600 --&amp;gt;\n&lt;/code&gt;&lt;/pre&gt;\n&lt;/li&gt;\n&lt;/ol&gt;\n&lt;h2 id=\&#34;cas客户端入门小demo\&#34;&gt;CAS客户端入门小Demo&lt;/h2&gt;\n&lt;h3 id=\&#34;客户端工程1搭建\&#34;&gt;客户端工程1搭建&lt;/h3&gt;\n&lt;h4 id=\&#34;1-搭建工程引入依赖\&#34;&gt;1、搭建工程引入依赖&lt;/h4&gt;\n&lt;p&gt;创建Maven工程 （war）casclient_demo1 引入cas客户端依赖并制定tomcat运行端口为9001&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-xml\&#34;&gt;&amp;lt;dependencies&amp;gt;\n    &amp;lt;!-- cas --&amp;gt;\n    &amp;lt;dependency&amp;gt;\n        &amp;lt;groupId&amp;gt;org.jasig.cas.client&amp;lt;/groupId&amp;gt;\n        &amp;lt;artifactId&amp;gt;cas-client-core&amp;lt;/artifactId&amp;gt;\n        &amp;lt;version&amp;gt;3.3.3&amp;lt;/version&amp;gt;\n    &amp;lt;/dependency&amp;gt;\n    &amp;lt;dependency&amp;gt;\n        &amp;lt;groupId&amp;gt;javax.servlet&amp;lt;/groupId&amp;gt;\n        &amp;lt;artifactId&amp;gt;servlet-api&amp;lt;/artifactId&amp;gt;\n        &amp;lt;version&amp;gt;2.5&amp;lt;/version&amp;gt;\n        &amp;lt;scope&amp;gt;provided&amp;lt;/scope&amp;gt;\n    &amp;lt;/dependency&amp;gt;\n&amp;lt;/dependencies&amp;gt;\n\n&amp;lt;build&amp;gt;\n    &amp;lt;plugins&amp;gt;\n        &amp;lt;!-- 配置Tomcat插件 --&amp;gt;\n        &amp;lt;plugin&amp;gt;\n            &amp;lt;groupId&amp;gt;org.apache.tomcat.maven&amp;lt;/groupId&amp;gt;\n            &amp;lt;artifactId&amp;gt;tomcat7-maven-plugin&amp;lt;/artifactId&amp;gt;\n            &amp;lt;configuration&amp;gt;\n                &amp;lt;port&amp;gt;9001&amp;lt;/port&amp;gt;\n                &amp;lt;path&amp;gt;/&amp;lt;/path&amp;gt;\n                &amp;lt;uriEncoding&amp;gt;utf-8&amp;lt;/uriEncoding&amp;gt;\n            &amp;lt;/configuration&amp;gt;\n        &amp;lt;/plugin&amp;gt;\n    &amp;lt;/plugins&amp;gt;\n&amp;lt;/build&amp;gt;\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h4 id=\&#34;2-修改webxml\&#34;&gt;2、修改web.xml&lt;/h4&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-xml\&#34;&gt;&amp;lt;?xml version=&amp;quot;1.0&amp;quot; encoding=&amp;quot;UTF-8&amp;quot;?&amp;gt;\n&amp;lt;web-app xmlns=&amp;quot;http://xmlns.jcp.org/xml/ns/javaee&amp;quot;\n         xmlns:xsi=&amp;quot;http://www.w3.org/2001/XMLSchema-instance&amp;quot;\n         xsi:schemaLocation=&amp;quot;http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_4_0.xsd&amp;quot;\n         version=&amp;quot;4.0&amp;quot;&amp;gt;\n\n    &amp;lt;!-- 用于单点退出，该过滤器用于实现单点登出功能，可选配置 --&amp;gt;\n    &amp;lt;listener&amp;gt;\n        &amp;lt;listener-class&amp;gt;org.jasig.cas.client.session.SingleSignOutHttpSessionListener&amp;lt;/listener-class&amp;gt;\n    &amp;lt;/listener&amp;gt;\n\n    &amp;lt;!-- 该过滤器用于实现单点登出功能，可选配置。 --&amp;gt;\n    &amp;lt;filter&amp;gt;\n        &amp;lt;filter-name&amp;gt;CAS Single Sign Out Filter&amp;lt;/filter-name&amp;gt;\n        &amp;lt;filter-class&amp;gt;org.jasig.cas.client.session.SingleSignOutFilter&amp;lt;/filter-class&amp;gt;\n    &amp;lt;/filter&amp;gt;\n    &amp;lt;filter-mapping&amp;gt;\n        &amp;lt;filter-name&amp;gt;CAS Single Sign Out Filter&amp;lt;/filter-name&amp;gt;\n        &amp;lt;url-pattern&amp;gt;/*&amp;lt;/url-pattern&amp;gt;\n    &amp;lt;/filter-mapping&amp;gt;\n\n    &amp;lt;!-- 该过滤器负责用户的认证工作，必须启用它 --&amp;gt;\n    &amp;lt;filter&amp;gt;\n        &amp;lt;filter-name&amp;gt;CASFilter&amp;lt;/filter-name&amp;gt;\n        &amp;lt;filter-class&amp;gt;org.jasig.cas.client.authentication.AuthenticationFilter&amp;lt;/filter-class&amp;gt;\n        &amp;lt;init-param&amp;gt;\n            &amp;lt;param-name&amp;gt;casServerLoginUrl&amp;lt;/param-name&amp;gt;\n            &amp;lt;param-value&amp;gt;http://localhost:9100/cas/login&amp;lt;/param-value&amp;gt;\n            &amp;lt;!--这里的server是服务端的IP --&amp;gt;\n        &amp;lt;/init-param&amp;gt;\n        &amp;lt;init-param&amp;gt;\n            &amp;lt;param-name&amp;gt;serverName&amp;lt;/param-name&amp;gt;\n            &amp;lt;param-value&amp;gt;http://localhost:9001&amp;lt;/param-value&amp;gt;\n        &amp;lt;/init-param&amp;gt;\n    &amp;lt;/filter&amp;gt;\n    &amp;lt;filter-mapping&amp;gt;\n        &amp;lt;filter-name&amp;gt;CASFilter&amp;lt;/filter-name&amp;gt;\n        &amp;lt;url-pattern&amp;gt;/*&amp;lt;/url-pattern&amp;gt;\n    &amp;lt;/filter-mapping&amp;gt;\n\n    &amp;lt;!-- 该过滤器负责对Ticket的校验工作，必须启用它 --&amp;gt;\n    &amp;lt;filter&amp;gt;\n        &amp;lt;filter-name&amp;gt;CAS Validation Filter&amp;lt;/filter-name&amp;gt;\n        &amp;lt;filter-class&amp;gt;org.jasig.cas.client.validation.Cas20ProxyReceivingTicketValidationFilter&amp;lt;/filter-class&amp;gt;\n        &amp;lt;init-param&amp;gt;\n            &amp;lt;param-name&amp;gt;casServerUrlPrefix&amp;lt;/param-name&amp;gt;\n            &amp;lt;param-value&amp;gt;http://localhost:9100/cas&amp;lt;/param-value&amp;gt;\n        &amp;lt;/init-param&amp;gt;\n        &amp;lt;init-param&amp;gt;\n            &amp;lt;param-name&amp;gt;serverName&amp;lt;/param-name&amp;gt;\n            &amp;lt;param-value&amp;gt;http://localhost:9001&amp;lt;/param-value&amp;gt;\n        &amp;lt;/init-param&amp;gt;\n    &amp;lt;/filter&amp;gt;\n    &amp;lt;filter-mapping&amp;gt;\n        &amp;lt;filter-name&amp;gt;CAS Validation Filter&amp;lt;/filter-name&amp;gt;\n        &amp;lt;url-pattern&amp;gt;/*&amp;lt;/url-pattern&amp;gt;\n    &amp;lt;/filter-mapping&amp;gt;\n\n    &amp;lt;!-- 该过滤器负责实现HttpServletRequest请求的包裹， 比如允许开发者通过HttpServletRequest的getRemoteUser()方法获得SSO登录用户的登录名，可选配置。 --&amp;gt;\n    &amp;lt;filter&amp;gt;\n        &amp;lt;filter-name&amp;gt;CAS HttpServletRequest Wrapper Filter&amp;lt;/filter-name&amp;gt;\n        &amp;lt;filter-class&amp;gt;\n            org.jasig.cas.client.util.HttpServletRequestWrapperFilter&amp;lt;/filter-class&amp;gt;\n    &amp;lt;/filter&amp;gt;\n    &amp;lt;filter-mapping&amp;gt;\n        &amp;lt;filter-name&amp;gt;CAS HttpServletRequest Wrapper Filter&amp;lt;/filter-name&amp;gt;\n        &amp;lt;url-pattern&amp;gt;/*&amp;lt;/url-pattern&amp;gt;\n    &amp;lt;/filter-mapping&amp;gt;\n\n    &amp;lt;!-- 该过滤器使得开发者可以通过org.jasig.cas.client.util.AssertionHolder来获取用户的登录名。 比如AssertionHolder.getAssertion().getPrincipal().getName()。 --&amp;gt;\n    &amp;lt;filter&amp;gt;\n        &amp;lt;filter-name&amp;gt;CAS Assertion Thread Local Filter&amp;lt;/filter-name&amp;gt;\n        &amp;lt;filter-class&amp;gt;org.jasig.cas.client.util.AssertionThreadLocalFilter&amp;lt;/filter-class&amp;gt;\n    &amp;lt;/filter&amp;gt;\n    &amp;lt;filter-mapping&amp;gt;\n        &amp;lt;filter-name&amp;gt;CAS Assertion Thread Local Filter&amp;lt;/filter-name&amp;gt;\n        &amp;lt;url-pattern&amp;gt;/*&amp;lt;/url-pattern&amp;gt;\n    &amp;lt;/filter-mapping&amp;gt;\n\n&amp;lt;/web-app&amp;gt;\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h4 id=\&#34;3-编写indexjsp\&#34;&gt;3、编写index.jsp&lt;/h4&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-jsp\&#34;&gt;&amp;lt;%@ page language=&amp;quot;java&amp;quot; contentType=&amp;quot;text/html; charset=utf-8&amp;quot; pageEncoding=&amp;quot;utf-8&amp;quot;%&amp;gt;\n&amp;lt;!DOCTYPE html PUBLIC &amp;quot;-//W3C//DTD HTML 4.01 Transitional//EN&amp;quot; &amp;quot;http://www.w3.org/TR/html4/loose.dtd&amp;quot;&amp;gt;\n&amp;lt;html&amp;gt;\n&amp;lt;head&amp;gt;\n    &amp;lt;meta http-equiv=&amp;quot;Content-Type&amp;quot; content=&amp;quot;text/html; charset=utf-8&amp;quot;&amp;gt;\n    &amp;lt;title&amp;gt;Hello&amp;lt;/title&amp;gt;\n&amp;lt;/head&amp;gt;\n&amp;lt;body&amp;gt;\n欢迎登陆一：\n&amp;lt;%--为获取远程登录名--%&amp;gt;\n&amp;lt;%=request.getRemoteUser()%&amp;gt;\n&amp;lt;/body&amp;gt;\n&amp;lt;/html&amp;gt;\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h3 id=\&#34;客户端工程2搭建\&#34;&gt;客户端工程2搭建&lt;/h3&gt;\n&lt;h4 id=\&#34;1-搭建工程\&#34;&gt;1、搭建工程&lt;/h4&gt;\n&lt;blockquote&gt;\n&lt;p&gt;创建Maven工程 （war）casclient_demo2 引入cas客户端依赖并制定tomcat运行端口为9002&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;h4 id=\&#34;2-修改webxml-2\&#34;&gt;2、修改web.xml&lt;/h4&gt;\n&lt;blockquote&gt;\n&lt;p&gt;创建web.xml，参照casclient_demo1 ,将serverName的值改为http://localhost:9002，一共两处&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;h4 id=\&#34;3-编写indexjsp-2\&#34;&gt;3、编写index.jsp&lt;/h4&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-jsp\&#34;&gt;创建index.jsp  ,内容显示“欢迎登陆二：”\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h3 id=\&#34;单点退出登录\&#34;&gt;单点退出登录&lt;/h3&gt;\n&lt;blockquote&gt;\n&lt;p&gt;地址栏输入 &lt;a href=\&#34;http://localhost:9000/cas/logout\&#34;&gt;http://localhost:9100/cas/logout&lt;/a&gt;&lt;/p&gt;\n&lt;p&gt;即可看到退出后的提示页面&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;h4 id=\&#34;指定退出后跳转地址\&#34;&gt;指定退出后跳转地址&lt;/h4&gt;\n&lt;p&gt;1、修改cas系统的配置文件cas-servlet.xml（217行）&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-xml\&#34;&gt; &amp;lt;bean id=&amp;quot;logoutAction&amp;quot; class=&amp;quot;org.jasig.cas.web.flow.LogoutAction&amp;quot;\n        p:servicesManager-ref=&amp;quot;servicesManager&amp;quot;\n        p:followServiceRedirects=&amp;quot;${cas.logout.followServiceRedirects:false}&amp;quot;/&amp;gt;\n&amp;lt;!-- 把p:followServiceRedirects的false修改为true --&amp;gt;\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;2、填入跳转地址&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-html\&#34;&gt;&amp;lt;!-- service参数为退出后跳转的地址 --&amp;gt;\n&amp;lt;a href=&amp;quot;http://localhost:9100/cas/logout?service=http://www.baidu.com&amp;quot;&amp;gt;退出登录&amp;lt;/a&amp;gt;\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h2 id=\&#34;cas服务端数据源设置\&#34;&gt;CAS服务端数据源设置&lt;/h2&gt;\n&lt;h3 id=\&#34;1-配置数据源\&#34;&gt;1、配置数据源&lt;/h3&gt;\n&lt;p&gt;修改cas服务端中web-inf下deployerConfigContext.xml ，添加如下配置&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-xml\&#34;&gt;&amp;lt;!-- 配置数据源c3p0连接池 --&amp;gt;\n&amp;lt;bean id=&amp;quot;dataSource&amp;quot; class=&amp;quot;com.mchange.v2.c3p0.ComboPooledDataSource&amp;quot;  \n\t\t\t  p:driverClass=&amp;quot;com.mysql.jdbc.Driver&amp;quot;  \n\t\t\t  p:jdbcUrl=&amp;quot;jdbc:mysql://127.0.0.1:3306/jd?characterEncoding=utf8&amp;quot;  \n\t\t\t  p:user=&amp;quot;root&amp;quot;  \n\t\t\t  p:password=&amp;quot;root&amp;quot; /&amp;gt; \n&amp;lt;!-- 密码加密的方式为 md5,在登陆时先加密密码然后再去数据库比对 --&amp;gt;\n&amp;lt;bean id=&amp;quot;passwordEncoder&amp;quot; class=&amp;quot;org.jasig.cas.authentication.handler.DefaultPasswordEncoder&amp;quot;  \n\t\tc:encodingAlgorithm=&amp;quot;MD5&amp;quot;  \n\t\tp:characterEncoding=&amp;quot;UTF-8&amp;quot; /&amp;gt; \n&amp;lt;!-- 数据校验 --&amp;gt;\n&amp;lt;bean id=&amp;quot;dbAuthHandler&amp;quot;  \n\t\t  class=&amp;quot;org.jasig.cas.adaptors.jdbc.QueryDatabaseAuthenticationHandler&amp;quot;  \n\t\t  p:dataSource-ref=&amp;quot;dataSource&amp;quot;  \n\t\t  p:sql=&amp;quot;select password from tb_user where username = ?&amp;quot;  \n\t\t  p:passwordEncoder-ref=&amp;quot;passwordEncoder&amp;quot;/&amp;gt;  \n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;然后在配置文件开始部分找到如下配置&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-xml\&#34;&gt;&amp;lt;bean id=&amp;quot;authenticationManager&amp;quot; class=&amp;quot;org.jasig.cas.authentication.PolicyBasedAuthenticationManager&amp;quot;&amp;gt;\n    &amp;lt;constructor-arg&amp;gt;\n        &amp;lt;map&amp;gt;               \n            &amp;lt;entry key-ref=&amp;quot;proxyAuthenticationHandler&amp;quot; value-ref=&amp;quot;proxyPrincipalResolver&amp;quot; /&amp;gt;\n            &amp;lt;entry key-ref=&amp;quot;primaryAuthenticationHandler&amp;quot; value-ref=&amp;quot;primaryPrincipalResolver&amp;quot; /&amp;gt;\n        &amp;lt;/map&amp;gt;\n    &amp;lt;/constructor-arg&amp;gt;      \n    &amp;lt;property name=&amp;quot;authenticationPolicy&amp;quot;&amp;gt;\n        &amp;lt;bean class=&amp;quot;org.jasig.cas.authentication.AnyAuthenticationPolicy&amp;quot; /&amp;gt;\n    &amp;lt;/property&amp;gt;\n&amp;lt;/bean&amp;gt;\n&amp;lt;!--\n\t其中&amp;lt;entry key-ref=&amp;quot;primaryAuthenticationHandler&amp;quot; value-ref=&amp;quot;primaryPrincipalResolver&amp;quot; /&amp;gt;\n\t一句是使用固定的用户名和密码，我们在下面可以看到这两个bean ,如果我们使用数据库认证用户名和密码，需要将这句注释掉。\n\t添加下面这一句配置(54行)\n\t&amp;lt;entry key-ref=&amp;quot;dbAuthHandler&amp;quot; value-ref=&amp;quot;primaryPrincipalResolver&amp;quot;/&amp;gt;\n--&amp;gt;\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h3 id=\&#34;2-添加jar包\&#34;&gt;2、添加jar包&lt;/h3&gt;\n&lt;blockquote&gt;\n&lt;p&gt;将以下三个jar包放入webapps\\cas\\WEB-INF\\lib下&lt;/p&gt;\n&lt;p&gt;c3p0-0.9.1.2.jar&lt;/p&gt;\n&lt;p&gt;cas-server-support-jdbc-4.0.0.jar&lt;/p&gt;\n&lt;p&gt;mysql-connector-java-5.1.32.jar&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;h3 id=\&#34;3-测试\&#34;&gt;3、测试&lt;/h3&gt;\n&lt;blockquote&gt;\n&lt;p&gt;用数据库中的用户名和密码进行测试&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;h2 id=\&#34;修改默认登陆页面\&#34;&gt;修改默认登陆页面&lt;/h2&gt;\n&lt;h3 id=\&#34;1-上传文件\&#34;&gt;1、上传文件&lt;/h3&gt;\n&lt;blockquote&gt;\n&lt;p&gt;上传自己的登陆页面到WEB-INF\\view\\jsp\\default\\ui\\casLoginView.jsp&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;h3 id=\&#34;2-编辑casloginviewjsp-内容\&#34;&gt;2、&lt;strong&gt;编辑casLoginView.jsp&lt;/strong&gt; 内容&lt;/h3&gt;\n&lt;h4 id=\&#34;1-添加指令\&#34;&gt;1、添加指令&lt;/h4&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-jsp\&#34;&gt;&amp;lt;%@ page pageEncoding=&amp;quot;UTF-8&amp;quot; %&amp;gt;\n&amp;lt;%@ page contentType=&amp;quot;text/html; charset=UTF-8&amp;quot; %&amp;gt;\n&amp;lt;%@ taglib prefix=&amp;quot;c&amp;quot; uri=&amp;quot;http://java.sun.com/jsp/jstl/core&amp;quot; %&amp;gt;\n&amp;lt;%@ taglib prefix=&amp;quot;spring&amp;quot; uri=&amp;quot;http://www.springframework.org/tags&amp;quot; %&amp;gt;\n&amp;lt;%@ taglib prefix=&amp;quot;form&amp;quot; uri=&amp;quot;http://www.springframework.org/tags/form&amp;quot; %&amp;gt;\n&amp;lt;%@ taglib prefix=&amp;quot;fn&amp;quot; uri=&amp;quot;http://java.sun.com/jsp/jstl/functions&amp;quot; %&amp;gt;\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h4 id=\&#34;2-修改form标签\&#34;&gt;2、修改form标签&lt;/h4&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-jsp\&#34;&gt;&amp;lt;form:form method=&amp;quot;post&amp;quot; id=&amp;quot;fm1&amp;quot; commandName=&amp;quot;${commandName}&amp;quot; htmlEscape=&amp;quot;true&amp;quot; class=&amp;quot;sui-form&amp;quot;&amp;gt;\n......\n&amp;lt;/form:form&amp;gt;\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h4 id=\&#34;3-修改用户名框\&#34;&gt;3、修改用户名框&lt;/h4&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-jsp\&#34;&gt;&amp;lt;form:input id=&amp;quot;username&amp;quot; tabindex=&amp;quot;1&amp;quot; \n\taccesskey=&amp;quot;${userNameAccessKey}&amp;quot; path=&amp;quot;username&amp;quot; autocomplete=&amp;quot;off&amp;quot; htmlEscape=&amp;quot;true&amp;quot; \n\tplaceholder=&amp;quot;邮箱/用户名/手机号&amp;quot; class=&amp;quot;span2 input-xfat&amp;quot; /&amp;gt;\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h4 id=\&#34;4-修改密码框\&#34;&gt;4、修改密码框&lt;/h4&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-jsp\&#34;&gt;&amp;lt;form:password  id=&amp;quot;password&amp;quot; tabindex=&amp;quot;2&amp;quot; path=&amp;quot;password&amp;quot; \n      accesskey=&amp;quot;${passwordAccessKey}&amp;quot; htmlEscape=&amp;quot;true&amp;quot; autocomplete=&amp;quot;off&amp;quot; \n\t  placeholder=&amp;quot;请输入密码&amp;quot; class=&amp;quot;span2 input-xfat&amp;quot;   /&amp;gt;\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h4 id=\&#34;5-修改登陆按钮\&#34;&gt;5、修改登陆按钮&lt;/h4&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-jsp\&#34;&gt;&amp;lt;input type=&amp;quot;hidden&amp;quot; name=&amp;quot;lt&amp;quot; value=&amp;quot;${loginTicket}&amp;quot; /&amp;gt;\n&amp;lt;input type=&amp;quot;hidden&amp;quot; name=&amp;quot;execution&amp;quot; value=&amp;quot;${flowExecutionKey}&amp;quot; /&amp;gt;\n&amp;lt;input type=&amp;quot;hidden&amp;quot; name=&amp;quot;_eventId&amp;quot; value=&amp;quot;submit&amp;quot; /&amp;gt;\n&amp;lt;input class=&amp;quot;sui-btn btn-block btn-xlarge btn-danger&amp;quot; accesskey=&amp;quot;l&amp;quot; value=&amp;quot;登陆&amp;quot; type=&amp;quot;submit&amp;quot; /&amp;gt;\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h3 id=\&#34;3-错误提示\&#34;&gt;3、错误提示&lt;/h3&gt;\n&lt;p&gt;在表单内加入错误提示框&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-jsp\&#34;&gt;&amp;lt;form:errors path=&amp;quot;*&amp;quot; id=&amp;quot;msg&amp;quot; cssClass=&amp;quot;errors&amp;quot; element=&amp;quot;div&amp;quot; htmlEscape=&amp;quot;false&amp;quot; /&amp;gt;\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;设置登陆失败中文提示&lt;/p&gt;\n&lt;p&gt;修改cas-servlet.xml中的en（61行）&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-xml\&#34;&gt;&amp;lt;bean id=&amp;quot;localeResolver&amp;quot; class=&amp;quot;org.springframework.web.servlet.i18n.CookieLocaleResolver&amp;quot; p:defaultLocale=&amp;quot;zh_CN&amp;quot; /&amp;gt;\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;将此信息拷贝到WEB-INF\\classes\\messages_zh_CN.properties下，并改为中文提示（转码）&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-properties\&#34;&gt;authenticationFailure.AccountNotFoundException=\\u7528\\u6237\\u4E0D\\u5B58\\u5728.\nauthenticationFailure.FailedLoginException=\\u5BC6\\u7801\\u9519\\u8BEF.\n&lt;/code&gt;&lt;/pre&gt;\n&lt;blockquote&gt;\n&lt;p&gt;第一个是用户名不存在时的错误提示&lt;/p&gt;\n&lt;p&gt;第二个是密码错误的提示&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;h2 id=\&#34;cas客户端与springsecurity集成\&#34;&gt;CAS客户端与SpringSecurity集成&lt;/h2&gt;\n&lt;h3 id=\&#34;1-创建工程\&#34;&gt;1、创建工程&lt;/h3&gt;\n&lt;blockquote&gt;\n&lt;p&gt;建立Maven项目casclient_demo3 ，引入spring依赖和spring secrity 相关依赖 ，tomcat端口设置为9003&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;h3 id=\&#34;2-引入依赖\&#34;&gt;2、引入依赖&lt;/h3&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-xml\&#34;&gt;&amp;lt;dependencies&amp;gt;\n    &amp;lt;dependency&amp;gt;\n        &amp;lt;groupId&amp;gt;org.springframework&amp;lt;/groupId&amp;gt;\n        &amp;lt;artifactId&amp;gt;spring-webmvc&amp;lt;/artifactId&amp;gt;\n        &amp;lt;version&amp;gt;4.2.4.RELEASE&amp;lt;/version&amp;gt;\n    &amp;lt;/dependency&amp;gt;\n    &amp;lt;dependency&amp;gt;\n        &amp;lt;groupId&amp;gt;com.fasterxml.jackson.core&amp;lt;/groupId&amp;gt;\n        &amp;lt;artifactId&amp;gt;jackson-databind&amp;lt;/artifactId&amp;gt;\n        &amp;lt;version&amp;gt;2.4.2&amp;lt;/version&amp;gt;\n    &amp;lt;/dependency&amp;gt;\n    &amp;lt;dependency&amp;gt;\n        &amp;lt;groupId&amp;gt;javax.servlet&amp;lt;/groupId&amp;gt;\n        &amp;lt;artifactId&amp;gt;servlet-api&amp;lt;/artifactId&amp;gt;\n        &amp;lt;version&amp;gt;2.5&amp;lt;/version&amp;gt;\n        &amp;lt;scope&amp;gt;provided&amp;lt;/scope&amp;gt;\n    &amp;lt;/dependency&amp;gt;\n    &amp;lt;!-- 身份验证 --&amp;gt;\n    &amp;lt;dependency&amp;gt;\n        &amp;lt;groupId&amp;gt;org.springframework.security&amp;lt;/groupId&amp;gt;\n        &amp;lt;artifactId&amp;gt;spring-security-web&amp;lt;/artifactId&amp;gt;\n        &amp;lt;version&amp;gt;4.1.0.RELEASE&amp;lt;/version&amp;gt;\n    &amp;lt;/dependency&amp;gt;\n    &amp;lt;dependency&amp;gt;\n        &amp;lt;groupId&amp;gt;org.springframework.security&amp;lt;/groupId&amp;gt;\n        &amp;lt;artifactId&amp;gt;spring-security-config&amp;lt;/artifactId&amp;gt;\n        &amp;lt;version&amp;gt;4.1.0.RELEASE&amp;lt;/version&amp;gt;\n    &amp;lt;/dependency&amp;gt;\n    &amp;lt;dependency&amp;gt;\n        &amp;lt;groupId&amp;gt;com.github.penggle&amp;lt;/groupId&amp;gt;\n        &amp;lt;artifactId&amp;gt;kaptcha&amp;lt;/artifactId&amp;gt;\n        &amp;lt;version&amp;gt;2.3.2&amp;lt;/version&amp;gt;\n        &amp;lt;exclusions&amp;gt;\n            &amp;lt;exclusion&amp;gt;\n                &amp;lt;groupId&amp;gt;javax.servlet&amp;lt;/groupId&amp;gt;\n                &amp;lt;artifactId&amp;gt;javax.servlet-api&amp;lt;/artifactId&amp;gt;\n            &amp;lt;/exclusion&amp;gt;\n        &amp;lt;/exclusions&amp;gt;\n    &amp;lt;/dependency&amp;gt;\n    &amp;lt;dependency&amp;gt;\n        &amp;lt;groupId&amp;gt;org.springframework.security&amp;lt;/groupId&amp;gt;\n        &amp;lt;artifactId&amp;gt;spring-security-cas&amp;lt;/artifactId&amp;gt;\n        &amp;lt;version&amp;gt;4.1.0.RELEASE&amp;lt;/version&amp;gt;\n    &amp;lt;/dependency&amp;gt;\n    &amp;lt;dependency&amp;gt;\n        &amp;lt;groupId&amp;gt;org.jasig.cas.client&amp;lt;/groupId&amp;gt;\n        &amp;lt;artifactId&amp;gt;cas-client-core&amp;lt;/artifactId&amp;gt;\n        &amp;lt;version&amp;gt;3.3.3&amp;lt;/version&amp;gt;\n        &amp;lt;!-- 排除log4j包冲突 --&amp;gt;\n        &amp;lt;exclusions&amp;gt;\n            &amp;lt;exclusion&amp;gt;\n                &amp;lt;groupId&amp;gt;org.slf4j&amp;lt;/groupId&amp;gt;\n                &amp;lt;artifactId&amp;gt;log4j-over-slf4j&amp;lt;/artifactId&amp;gt;\n            &amp;lt;/exclusion&amp;gt;\n        &amp;lt;/exclusions&amp;gt;\n    &amp;lt;/dependency&amp;gt;\n&amp;lt;/dependencies&amp;gt;\n\n&amp;lt;build&amp;gt;\n    &amp;lt;plugins&amp;gt;\n        &amp;lt;!-- 配置Tomcat插件 --&amp;gt;\n        &amp;lt;plugin&amp;gt;\n            &amp;lt;groupId&amp;gt;org.apache.tomcat.maven&amp;lt;/groupId&amp;gt;\n            &amp;lt;artifactId&amp;gt;tomcat7-maven-plugin&amp;lt;/artifactId&amp;gt;\n            &amp;lt;configuration&amp;gt;\n                &amp;lt;port&amp;gt;9003&amp;lt;/port&amp;gt;\n                &amp;lt;path&amp;gt;/&amp;lt;/path&amp;gt;\n                &amp;lt;uriEncoding&amp;gt;utf-8&amp;lt;/uriEncoding&amp;gt;\n            &amp;lt;/configuration&amp;gt;\n        &amp;lt;/plugin&amp;gt;\n    &amp;lt;/plugins&amp;gt;\n    &amp;lt;resources&amp;gt;\n        &amp;lt;resource&amp;gt;\n            &amp;lt;directory&amp;gt;src/main/java&amp;lt;/directory&amp;gt;\n            &amp;lt;includes&amp;gt;\n                &amp;lt;include&amp;gt;**/*.*&amp;lt;/include&amp;gt;\n            &amp;lt;/includes&amp;gt;\n        &amp;lt;/resource&amp;gt;\n        &amp;lt;resource&amp;gt;\n            &amp;lt;directory&amp;gt;src/main/resources&amp;lt;/directory&amp;gt;\n            &amp;lt;includes&amp;gt;\n                &amp;lt;include&amp;gt;**/*.*&amp;lt;/include&amp;gt;\n            &amp;lt;/includes&amp;gt;\n        &amp;lt;/resource&amp;gt;\n    &amp;lt;/resources&amp;gt;\n&amp;lt;/build&amp;gt;\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h3 id=\&#34;3-创建spring-mvcxml\&#34;&gt;3、创建spring-mvc.xml&lt;/h3&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-xml\&#34;&gt;&amp;lt;?xml version=&amp;quot;1.0&amp;quot; encoding=&amp;quot;UTF-8&amp;quot;?&amp;gt;\n&amp;lt;beans xmlns=&amp;quot;http://www.springframework.org/schema/beans&amp;quot;\n       xmlns:xsi=&amp;quot;http://www.w3.org/2001/XMLSchema-instance&amp;quot;\n       xmlns:context=&amp;quot;http://www.springframework.org/schema/context&amp;quot;\n       xmlns:mvc=&amp;quot;http://www.springframework.org/schema/mvc&amp;quot;\n       xsi:schemaLocation=&amp;quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd\n        http://www.springframework.org/schema/mvc http://www.springframework.org/schema/mvc/spring-mvc.xsd\n        http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd&amp;quot;&amp;gt;\n\n    &amp;lt;!-- 扫描用@Controller注解的类，并且加载到spring中进行管理 --&amp;gt;\n    &amp;lt;context:component-scan base-package=&amp;quot;com.cn.controller&amp;quot;/&amp;gt;\n    &amp;lt;!-- 配置注解驱动 --&amp;gt;\n    &amp;lt;mvc:annotation-driven&amp;gt;\n        &amp;lt;!-- 添加转换器，添加对于对象的支持 --&amp;gt;\n        &amp;lt;mvc:message-converters&amp;gt;\n            &amp;lt;ref bean=&amp;quot;stringHttpMessageConverter&amp;quot;/&amp;gt;\n            &amp;lt;ref bean=&amp;quot;mappingJackson2HttpMessageConverter&amp;quot;/&amp;gt;\n        &amp;lt;/mvc:message-converters&amp;gt;\n    &amp;lt;/mvc:annotation-driven&amp;gt;\n\n    &amp;lt;bean id=&amp;quot;stringHttpMessageConverter&amp;quot; class=&amp;quot;org.springframework.http.converter.StringHttpMessageConverter&amp;quot;/&amp;gt;\n    &amp;lt;!--解决IE浏览器json文件下载和json数据中午乱码的问题--&amp;gt;\n    &amp;lt;bean id=&amp;quot;mappingJackson2HttpMessageConverter&amp;quot;\n          class=&amp;quot;org.springframework.http.converter.json.MappingJackson2HttpMessageConverter&amp;quot;&amp;gt;\n        &amp;lt;property name=&amp;quot;supportedMediaTypes&amp;quot;&amp;gt;\n            &amp;lt;list&amp;gt;\n                &amp;lt;value&amp;gt;text/html;charset=UTF-8&amp;lt;/value&amp;gt;\n            &amp;lt;/list&amp;gt;\n        &amp;lt;/property&amp;gt;\n    &amp;lt;/bean&amp;gt;\n    &amp;lt;mvc:default-servlet-handler/&amp;gt;\n    &amp;lt;!-- jackson --&amp;gt;\n    &amp;lt;mvc:annotation-driven&amp;gt;\n        &amp;lt;mvc:message-converters&amp;gt;\n            &amp;lt;bean class=&amp;quot;org.springframework.http.converter.StringHttpMessageConverter&amp;quot;/&amp;gt;\n            &amp;lt;bean class=&amp;quot;org.springframework.http.converter.json.MappingJackson2HttpMessageConverter&amp;quot;/&amp;gt;\n        &amp;lt;/mvc:message-converters&amp;gt;\n    &amp;lt;/mvc:annotation-driven&amp;gt;\n\n&amp;lt;/beans&amp;gt;\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h3 id=\&#34;4-创建spring-securityxml\&#34;&gt;4、创建spring-security.xml&lt;/h3&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-xml\&#34;&gt;&amp;lt;?xml version=&amp;quot;1.0&amp;quot; encoding=&amp;quot;UTF-8&amp;quot;?&amp;gt;\n&amp;lt;beans:beans xmlns=&amp;quot;http://www.springframework.org/schema/security&amp;quot;\n             xmlns:beans=&amp;quot;http://www.springframework.org/schema/beans&amp;quot;\n             xmlns:xsi=&amp;quot;http://www.w3.org/2001/XMLSchema-instance&amp;quot;\n             xsi:schemaLocation=&amp;quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd\n\t\t\t\t\t\thttp://www.springframework.org/schema/security http://www.springframework.org/schema/security/spring-security.xsd&amp;quot;&amp;gt;\n\n    &amp;lt;!--   entry-point-ref  入口点引用 --&amp;gt;\n    &amp;lt;http use-expressions=&amp;quot;false&amp;quot; entry-point-ref=&amp;quot;casProcessingFilterEntryPoint&amp;quot;&amp;gt;\n        &amp;lt;intercept-url pattern=&amp;quot;/**&amp;quot; access=&amp;quot;ROLE_USER&amp;quot;/&amp;gt;\n        &amp;lt;csrf disabled=&amp;quot;true&amp;quot;/&amp;gt;\n        &amp;lt;!-- custom-filter为过滤器， position 表示将过滤器放在指定的位置上(参照位置表)，before表示放在指定位置之前  ，after表示放在指定的位置之后  --&amp;gt;\n        &amp;lt;custom-filter ref=&amp;quot;casAuthenticationFilter&amp;quot; position=&amp;quot;CAS_FILTER&amp;quot;/&amp;gt;\n        &amp;lt;custom-filter ref=&amp;quot;requestSingleLogoutFilter&amp;quot; before=&amp;quot;LOGOUT_FILTER&amp;quot;/&amp;gt;\n        &amp;lt;custom-filter ref=&amp;quot;singleLogoutFilter&amp;quot; before=&amp;quot;CAS_FILTER&amp;quot;/&amp;gt;\n    &amp;lt;/http&amp;gt;\n\n    &amp;lt;!-- CAS入口点 开始 --&amp;gt;\n    &amp;lt;beans:bean id=&amp;quot;casProcessingFilterEntryPoint&amp;quot;\n                class=&amp;quot;org.springframework.security.cas.web.CasAuthenticationEntryPoint&amp;quot;&amp;gt;\n        &amp;lt;!-- 单点登录服务器登录URL --&amp;gt;\n        &amp;lt;beans:property name=&amp;quot;loginUrl&amp;quot; value=&amp;quot;http://localhost:9100/cas/login&amp;quot;/&amp;gt;\n        &amp;lt;beans:property name=&amp;quot;serviceProperties&amp;quot; ref=&amp;quot;serviceProperties&amp;quot;/&amp;gt;\n    &amp;lt;/beans:bean&amp;gt;\n    &amp;lt;beans:bean id=&amp;quot;serviceProperties&amp;quot; class=&amp;quot;org.springframework.security.cas.ServiceProperties&amp;quot;&amp;gt;\n        &amp;lt;!--service 配置自身工程的根地址+/login/cas   --&amp;gt;\n        &amp;lt;beans:property name=&amp;quot;service&amp;quot; value=&amp;quot;http://localhost:9003/login/cas&amp;quot;/&amp;gt;\n    &amp;lt;/beans:bean&amp;gt;\n    &amp;lt;!-- CAS入口点 结束 --&amp;gt;\n\n    &amp;lt;!-- 认证过滤器 开始 --&amp;gt;\n    &amp;lt;beans:bean id=&amp;quot;casAuthenticationFilter&amp;quot; class=&amp;quot;org.springframework.security.cas.web.CasAuthenticationFilter&amp;quot;&amp;gt;\n        &amp;lt;beans:property name=&amp;quot;authenticationManager&amp;quot; ref=&amp;quot;authenticationManager&amp;quot;/&amp;gt;\n    &amp;lt;/beans:bean&amp;gt;\n    &amp;lt;!-- 认证管理器 --&amp;gt;\n    &amp;lt;authentication-manager alias=&amp;quot;authenticationManager&amp;quot;&amp;gt;\n        &amp;lt;authentication-provider ref=&amp;quot;casAuthenticationProvider&amp;quot;&amp;gt;\n        &amp;lt;/authentication-provider&amp;gt;\n    &amp;lt;/authentication-manager&amp;gt;\n    &amp;lt;!-- 认证提供者 --&amp;gt;\n    &amp;lt;beans:bean id=&amp;quot;casAuthenticationProvider&amp;quot;\n                class=&amp;quot;org.springframework.security.cas.authentication.CasAuthenticationProvider&amp;quot;&amp;gt;\n        &amp;lt;beans:property name=&amp;quot;authenticationUserDetailsService&amp;quot;&amp;gt;\n            &amp;lt;beans:bean class=&amp;quot;org.springframework.security.core.userdetails.UserDetailsByNameServiceWrapper&amp;quot;&amp;gt;\n                &amp;lt;beans:constructor-arg ref=&amp;quot;userDetailsService&amp;quot;/&amp;gt;\n            &amp;lt;/beans:bean&amp;gt;\n        &amp;lt;/beans:property&amp;gt;\n        &amp;lt;beans:property name=&amp;quot;serviceProperties&amp;quot; ref=&amp;quot;serviceProperties&amp;quot;/&amp;gt;\n        &amp;lt;!-- ticketValidator 为票据验证器 --&amp;gt;\n        &amp;lt;beans:property name=&amp;quot;ticketValidator&amp;quot;&amp;gt;\n            &amp;lt;beans:bean class=&amp;quot;org.jasig.cas.client.validation.Cas20ServiceTicketValidator&amp;quot;&amp;gt;\n                &amp;lt;beans:constructor-arg index=&amp;quot;0&amp;quot; value=&amp;quot;http://localhost:9100/cas&amp;quot;/&amp;gt;\n            &amp;lt;/beans:bean&amp;gt;\n        &amp;lt;/beans:property&amp;gt;\n        &amp;lt;beans:property name=&amp;quot;key&amp;quot; value=&amp;quot;an_id_for_this_auth_provider_only&amp;quot;/&amp;gt;\n    &amp;lt;/beans:bean&amp;gt;\n    &amp;lt;!-- 认证类 --&amp;gt;\n    &amp;lt;beans:bean id=&amp;quot;userDetailsService&amp;quot; class=&amp;quot;com.cn.service.impl.UserDetailServiceImpl&amp;quot;/&amp;gt;\n\n    &amp;lt;!-- 认证过滤器 结束 --&amp;gt;\n    &amp;lt;!-- 单点登出  开始  --&amp;gt;\n    &amp;lt;beans:bean id=&amp;quot;singleLogoutFilter&amp;quot; class=&amp;quot;org.jasig.cas.client.session.SingleSignOutFilter&amp;quot;/&amp;gt;\n    &amp;lt;beans:bean id=&amp;quot;requestSingleLogoutFilter&amp;quot;\n                class=&amp;quot;org.springframework.security.web.authentication.logout.LogoutFilter&amp;quot;&amp;gt;\n        &amp;lt;beans:constructor-arg value=&amp;quot;http://localhost:9100/cas/logout?service=http://www.baidu.com&amp;quot;/&amp;gt;\n        &amp;lt;beans:constructor-arg&amp;gt;\n            &amp;lt;beans:bean class=&amp;quot;org.springframework.security.web.authentication.logout.SecurityContextLogoutHandler&amp;quot;/&amp;gt;\n        &amp;lt;/beans:constructor-arg&amp;gt;\n        &amp;lt;beans:property name=&amp;quot;filterProcessesUrl&amp;quot; value=&amp;quot;/logout/cas&amp;quot;/&amp;gt;\n    &amp;lt;/beans:bean&amp;gt;\n    &amp;lt;!-- 单点登出  结束 --&amp;gt;\n\n&amp;lt;/beans:beans&amp;gt;\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h3 id=\&#34;5-创建认证类\&#34;&gt;5、创建认证类&lt;/h3&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;public class UserDetailServiceImpl implements UserDetailsService {\n\n    @Override\n    public UserDetails loadUserByUsername(String username) throws UsernameNotFoundException {\n        //构建角色集合\n        List&amp;lt;GrantedAuthority&amp;gt; authorities=new ArrayList();\n        authorities.add(new SimpleGrantedAuthority(&amp;quot;ROLE_USER&amp;quot;));\n        return new User(username, &amp;quot;&amp;quot;  , authorities);\n    }\n\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h3 id=\&#34;6-修改webxml-添加过滤器等配置\&#34;&gt;6、修改web.xml ,添加过滤器等配置&lt;/h3&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-xml\&#34;&gt;&amp;lt;?xml version=&amp;quot;1.0&amp;quot; encoding=&amp;quot;UTF-8&amp;quot;?&amp;gt;\n&amp;lt;web-app xmlns=&amp;quot;http://xmlns.jcp.org/xml/ns/javaee&amp;quot;\n         xmlns:xsi=&amp;quot;http://www.w3.org/2001/XMLSchema-instance&amp;quot;\n         xsi:schemaLocation=&amp;quot;http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_4_0.xsd&amp;quot;\n         version=&amp;quot;4.0&amp;quot;&amp;gt;\n    &amp;lt;context-param&amp;gt;\n        &amp;lt;param-name&amp;gt;contextConfigLocation&amp;lt;/param-name&amp;gt;\n        &amp;lt;param-value&amp;gt;classpath:spring-security.xml&amp;lt;/param-value&amp;gt;\n    &amp;lt;/context-param&amp;gt;\n    &amp;lt;listener&amp;gt;\n        &amp;lt;listener-class&amp;gt;\n            org.springframework.web.context.ContextLoaderListener\n        &amp;lt;/listener-class&amp;gt;\n    &amp;lt;/listener&amp;gt;\n    &amp;lt;filter&amp;gt;\n        &amp;lt;filter-name&amp;gt;springSecurityFilterChain&amp;lt;/filter-name&amp;gt;\n        &amp;lt;filter-class&amp;gt;org.springframework.web.filter.DelegatingFilterProxy&amp;lt;/filter-class&amp;gt;\n    &amp;lt;/filter&amp;gt;\n    &amp;lt;filter-mapping&amp;gt;\n        &amp;lt;filter-name&amp;gt;springSecurityFilterChain&amp;lt;/filter-name&amp;gt;\n        &amp;lt;url-pattern&amp;gt;/*&amp;lt;/url-pattern&amp;gt;\n    &amp;lt;/filter-mapping&amp;gt;\n&amp;lt;!--------------------------------------------------------------------------------&amp;gt;\n    &amp;lt;!-- 解决post乱码 --&amp;gt;\n    &amp;lt;filter&amp;gt;\n        &amp;lt;filter-name&amp;gt;CharacterEncodingFilter&amp;lt;/filter-name&amp;gt;\n        &amp;lt;filter-class&amp;gt;org.springframework.web.filter.CharacterEncodingFilter&amp;lt;/filter-class&amp;gt;\n        &amp;lt;init-param&amp;gt;\n            &amp;lt;param-name&amp;gt;encoding&amp;lt;/param-name&amp;gt;\n            &amp;lt;param-value&amp;gt;utf-8&amp;lt;/param-value&amp;gt;\n        &amp;lt;/init-param&amp;gt;\n        &amp;lt;init-param&amp;gt;\n            &amp;lt;param-name&amp;gt;forceEncoding&amp;lt;/param-name&amp;gt;\n            &amp;lt;param-value&amp;gt;true&amp;lt;/param-value&amp;gt;\n        &amp;lt;/init-param&amp;gt;\n    &amp;lt;/filter&amp;gt;\n    &amp;lt;filter-mapping&amp;gt;\n        &amp;lt;filter-name&amp;gt;CharacterEncodingFilter&amp;lt;/filter-name&amp;gt;\n        &amp;lt;url-pattern&amp;gt;/*&amp;lt;/url-pattern&amp;gt;\n    &amp;lt;/filter-mapping&amp;gt;\n\n    &amp;lt;servlet&amp;gt;\n        &amp;lt;servlet-name&amp;gt;springmvc&amp;lt;/servlet-name&amp;gt;\n        &amp;lt;servlet-class&amp;gt;org.springframework.web.servlet.DispatcherServlet&amp;lt;/servlet-class&amp;gt;\n        &amp;lt;!-- 指定加载的配置文件 ，通过参数contextConfigLocation加载--&amp;gt;\n        &amp;lt;init-param&amp;gt;\n            &amp;lt;param-name&amp;gt;contextConfigLocation&amp;lt;/param-name&amp;gt;\n            &amp;lt;param-value&amp;gt;classpath:spring-mvc.xml&amp;lt;/param-value&amp;gt;\n        &amp;lt;/init-param&amp;gt;\n        &amp;lt;load-on-startup&amp;gt;1&amp;lt;/load-on-startup&amp;gt;\n    &amp;lt;/servlet&amp;gt;\n\n    &amp;lt;servlet-mapping&amp;gt;\n        &amp;lt;servlet-name&amp;gt;springmvc&amp;lt;/servlet-name&amp;gt;\n        &amp;lt;url-pattern&amp;gt;/&amp;lt;/url-pattern&amp;gt;\n    &amp;lt;/servlet-mapping&amp;gt;\n&amp;lt;/web-app&amp;gt;\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h3 id=\&#34;7-创建usercontroller\&#34;&gt;7、创建UserController&lt;/h3&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;@RestController\npublic class UserController {\n\n    @RequestMapping(&amp;quot;/findLoginUser&amp;quot;)\n    public void  findLoginUser(){\n        String name = SecurityContextHolder.getContext().getAuthentication().getName();\n        System.out.println(name);\n    }\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h3 id=\&#34;8-退出登陆\&#34;&gt;8、退出登陆&lt;/h3&gt;\n&lt;p&gt;修改spring-security.xml&lt;/p&gt;\n&lt;blockquote&gt;\n&lt;p&gt;http://localhost:9100/cas/logout?service=http://www.baidu.com&lt;/p&gt;\n&lt;p&gt;service 等于登出后跳转的地址&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-xml\&#34;&gt;&amp;lt;!-- 单点登出  开始  --&amp;gt;\n&amp;lt;beans:bean id=&amp;quot;singleLogoutFilter&amp;quot; class=&amp;quot;org.jasig.cas.client.session.SingleSignOutFilter&amp;quot;/&amp;gt;\n&amp;lt;beans:bean id=&amp;quot;requestSingleLogoutFilter&amp;quot;\n            class=&amp;quot;org.springframework.security.web.authentication.logout.LogoutFilter&amp;quot;&amp;gt;\n    &amp;lt;beans:constructor-arg value=&amp;quot;http://localhost:9100/cas/logout?service=http://www.baidu.com&amp;quot;/&amp;gt;\n    &amp;lt;beans:constructor-arg&amp;gt;\n        &amp;lt;beans:bean class=&amp;quot;org.springframework.security.web.authentication.logout.SecurityContextLogoutHandler&amp;quot;/&amp;gt;\n    &amp;lt;/beans:constructor-arg&amp;gt;\n    &amp;lt;beans:property name=&amp;quot;filterProcessesUrl&amp;quot; value=&amp;quot;/logout/cas&amp;quot;/&amp;gt;\n&amp;lt;/beans:bean&amp;gt;\n&amp;lt;!-- 单点登出  结束 --&amp;gt;\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;在页面上添加&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-html\&#34;&gt;&amp;lt;a href=&amp;quot;/logout/cas&amp;quot;&amp;gt;退出登录&amp;lt;/a&amp;gt;\n&lt;/code&gt;&lt;/pre&gt;\n&#34;,&#34;fileName&#34;:&#34;dan-dian-deng-lu-cas&#34;,&#34;abstract&#34;:&#34;&#34;,&#34;title&#34;:&#34;单点登陆-CAS&#34;,&#34;tags&#34;:[{&#34;name&#34;:&#34;CAS&#34;,&#34;slug&#34;:&#34;5wQcTelqx&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://haohanya.github.io/tag/5wQcTelqx/&#34;},{&#34;name&#34;:&#34;单点登陆&#34;,&#34;slug&#34;:&#34;_AfHtpsMsE&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://haohanya.github.io/tag/_AfHtpsMsE/&#34;}],&#34;date&#34;:&#34;2020-05-19 22:18:12&#34;,&#34;dateFormat&#34;:&#34;2020-05-19&#34;,&#34;feature&#34;:&#34;&#34;,&#34;link&#34;:&#34;https://haohanya.github.io/post/dan-dian-deng-lu-cas/&#34;,&#34;hideInList&#34;:false,&#34;isTop&#34;:false,&#34;stats&#34;:{&#34;text&#34;:&#34;29 min read&#34;,&#34;time&#34;:1715000,&#34;words&#34;:5384,&#34;minutes&#34;:29},&#34;description&#34;:&#34;什么是单点登录\n\n单点登录（Single Sign On），简称为 SSO，是目前比较流行的企业业务整合的解决方案之一。SSO的定义是在多个应用系统中，用户只需要登录一次就可以访问所有相互信任的应用系统。\n我们目前的系统存在诸多子系统，而这...&#34;,&#34;toc&#34;:&#34;&lt;ul class=\&#34;markdownIt-TOC\&#34;&gt;\n&lt;li&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E4%BB%80%E4%B9%88%E6%98%AF%E5%8D%95%E7%82%B9%E7%99%BB%E5%BD%95\&#34;&gt;什么是单点登录&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E4%BB%80%E4%B9%88%E6%98%AFcas\&#34;&gt;什么是CAS&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#cas%E6%9C%8D%E5%8A%A1%E7%AB%AF%E9%83%A8%E7%BD%B2\&#34;&gt;CAS服务端部署&lt;/a&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#1-cas%E5%AE%89%E8%A3%85\&#34;&gt;1、cas安装&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#2-%E4%BF%AE%E6%94%B9%E7%AB%AF%E5%8F%A3\&#34;&gt;2、修改端口&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#3-%E5%8E%BB%E9%99%A4https%E8%AE%A4%E8%AF%81\&#34;&gt;3、去除https认证&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#cas%E5%AE%A2%E6%88%B7%E7%AB%AF%E5%85%A5%E9%97%A8%E5%B0%8Fdemo\&#34;&gt;CAS客户端入门小Demo&lt;/a&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E5%AE%A2%E6%88%B7%E7%AB%AF%E5%B7%A5%E7%A8%8B1%E6%90%AD%E5%BB%BA\&#34;&gt;客户端工程1搭建&lt;/a&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#1-%E6%90%AD%E5%BB%BA%E5%B7%A5%E7%A8%8B%E5%BC%95%E5%85%A5%E4%BE%9D%E8%B5%96\&#34;&gt;1、搭建工程引入依赖&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#2-%E4%BF%AE%E6%94%B9webxml\&#34;&gt;2、修改web.xml&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#3-%E7%BC%96%E5%86%99indexjsp\&#34;&gt;3、编写index.jsp&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E5%AE%A2%E6%88%B7%E7%AB%AF%E5%B7%A5%E7%A8%8B2%E6%90%AD%E5%BB%BA\&#34;&gt;客户端工程2搭建&lt;/a&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#1-%E6%90%AD%E5%BB%BA%E5%B7%A5%E7%A8%8B\&#34;&gt;1、搭建工程&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#2-%E4%BF%AE%E6%94%B9webxml-2\&#34;&gt;2、修改web.xml&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#3-%E7%BC%96%E5%86%99indexjsp-2\&#34;&gt;3、编写index.jsp&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E5%8D%95%E7%82%B9%E9%80%80%E5%87%BA%E7%99%BB%E5%BD%95\&#34;&gt;单点退出登录&lt;/a&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E6%8C%87%E5%AE%9A%E9%80%80%E5%87%BA%E5%90%8E%E8%B7%B3%E8%BD%AC%E5%9C%B0%E5%9D%80\&#34;&gt;指定退出后跳转地址&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#cas%E6%9C%8D%E5%8A%A1%E7%AB%AF%E6%95%B0%E6%8D%AE%E6%BA%90%E8%AE%BE%E7%BD%AE\&#34;&gt;CAS服务端数据源设置&lt;/a&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#1-%E9%85%8D%E7%BD%AE%E6%95%B0%E6%8D%AE%E6%BA%90\&#34;&gt;1、配置数据源&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#2-%E6%B7%BB%E5%8A%A0jar%E5%8C%85\&#34;&gt;2、添加jar包&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#3-%E6%B5%8B%E8%AF%95\&#34;&gt;3、测试&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E4%BF%AE%E6%94%B9%E9%BB%98%E8%AE%A4%E7%99%BB%E9%99%86%E9%A1%B5%E9%9D%A2\&#34;&gt;修改默认登陆页面&lt;/a&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#1-%E4%B8%8A%E4%BC%A0%E6%96%87%E4%BB%B6\&#34;&gt;1、上传文件&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#2-%E7%BC%96%E8%BE%91casloginviewjsp-%E5%86%85%E5%AE%B9\&#34;&gt;2、&lt;strong&gt;编辑casLoginView.jsp&lt;/strong&gt; 内容&lt;/a&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#1-%E6%B7%BB%E5%8A%A0%E6%8C%87%E4%BB%A4\&#34;&gt;1、添加指令&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#2-%E4%BF%AE%E6%94%B9form%E6%A0%87%E7%AD%BE\&#34;&gt;2、修改form标签&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#3-%E4%BF%AE%E6%94%B9%E7%94%A8%E6%88%B7%E5%90%8D%E6%A1%86\&#34;&gt;3、修改用户名框&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#4-%E4%BF%AE%E6%94%B9%E5%AF%86%E7%A0%81%E6%A1%86\&#34;&gt;4、修改密码框&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#5-%E4%BF%AE%E6%94%B9%E7%99%BB%E9%99%86%E6%8C%89%E9%92%AE\&#34;&gt;5、修改登陆按钮&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#3-%E9%94%99%E8%AF%AF%E6%8F%90%E7%A4%BA\&#34;&gt;3、错误提示&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#cas%E5%AE%A2%E6%88%B7%E7%AB%AF%E4%B8%8Espringsecurity%E9%9B%86%E6%88%90\&#34;&gt;CAS客户端与SpringSecurity集成&lt;/a&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#1-%E5%88%9B%E5%BB%BA%E5%B7%A5%E7%A8%8B\&#34;&gt;1、创建工程&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#2-%E5%BC%95%E5%85%A5%E4%BE%9D%E8%B5%96\&#34;&gt;2、引入依赖&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#3-%E5%88%9B%E5%BB%BAspring-mvcxml\&#34;&gt;3、创建spring-mvc.xml&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#4-%E5%88%9B%E5%BB%BAspring-securityxml\&#34;&gt;4、创建spring-security.xml&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#5-%E5%88%9B%E5%BB%BA%E8%AE%A4%E8%AF%81%E7%B1%BB\&#34;&gt;5、创建认证类&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#6-%E4%BF%AE%E6%94%B9webxml-%E6%B7%BB%E5%8A%A0%E8%BF%87%E6%BB%A4%E5%99%A8%E7%AD%89%E9%85%8D%E7%BD%AE\&#34;&gt;6、修改web.xml ,添加过滤器等配置&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#7-%E5%88%9B%E5%BB%BAusercontroller\&#34;&gt;7、创建UserController&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#8-%E9%80%80%E5%87%BA%E7%99%BB%E9%99%86\&#34;&gt;8、退出登陆&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;/ul&gt;\n&#34;},{&#34;content&#34;:&#34;&lt;h2 id=\&#34;redis安装\&#34;&gt;redis安装&lt;/h2&gt;\n&lt;p&gt;安装gcc&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-bash\&#34;&gt;yum install gcc-c++\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;解压源码&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-bash\&#34;&gt;tar -zxvf redis-3.0.0.tar.gz\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;进入解压后的目录进行编译&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-bash\&#34;&gt;cd /usr/local/redis-3.0.0\nmake PREFIX=/usr/local/redis install\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;拷贝配置文件到安装目录下&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-bash\&#34;&gt;cd /usr/local/redis\nmkdir conf\ncp /usr/local/redis-3.0.0/redis.conf  /usr/local/redis/bin\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;运行&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-bash\&#34;&gt;bin/redis-server\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;后端模式运行&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-bash\&#34;&gt;修改redis.conf文件 : daemonize yes\n./bin/redis-server redis.conf\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h2 id=\&#34;springdataredis简介\&#34;&gt;SpringDataRedis简介&lt;/h2&gt;\n&lt;h3 id=\&#34;redis\&#34;&gt;Redis&lt;/h3&gt;\n&lt;blockquote&gt;\n&lt;p&gt;&lt;strong&gt;redis&lt;/strong&gt;是一款开源的Key-Value&lt;strong&gt;数据库&lt;/strong&gt;，运行在内存中，由ANSI C编写。企业开发通常采用Redis来实现缓存。同类的产品还有memcache 、MongoDB等。&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;h3 id=\&#34;jedis\&#34;&gt;Jedis&lt;/h3&gt;\n&lt;blockquote&gt;\n&lt;p&gt;Jedis是Redis官方推出的一款面向&lt;strong&gt;Java&lt;/strong&gt;的客户端，提供了很多接口供Java语言调用。可以在Redis官网下载，当然还有一些开源爱好者提供的客户端，如Jredis、SRP等等，推荐使用Jedis。&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;h2 id=\&#34;spring-data-redis\&#34;&gt;Spring Data Redis&lt;/h2&gt;\n&lt;blockquote&gt;\n&lt;p&gt;Spring-data-redis是spring大家族的一部分，提供了在srping应用中通过简单的配置访问redis服务，对reids底层开发包(Jedis,  JRedis, and RJC)进行了高度封装，RedisTemplate提供了redis各种操作、异常处理及序列化，支持发布订阅，并对spring 3.1 cache进行了实现。&lt;/p&gt;\n&lt;p&gt;spring-data-redis针对jedis提供了如下功能：&lt;br&gt;\n1、连接池自动管理，提供了一个高度封装的“RedisTemplate”类&lt;/p&gt;\n&lt;p&gt;​\t2、针对jedis客户端中大量api进行了归类封装,将同一类型操作封装为operation接口&lt;/p&gt;\n&lt;p&gt;​     ValueOperations：简单K-V操作&lt;/p&gt;\n&lt;p&gt;​     SetOperations：set类型数据操作&lt;/p&gt;\n&lt;p&gt;​     ZSetOperations：zset类型数据操作&lt;/p&gt;\n&lt;p&gt;​     HashOperations：针对map类型的数据操作&lt;/p&gt;\n&lt;p&gt;​     ListOperations：针对list类型的数据操作&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;h2 id=\&#34;spring-data-redis入门小demo\&#34;&gt;Spring Data Redis入门小Demo&lt;/h2&gt;\n&lt;p&gt;1、引入依赖&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-xml\&#34;&gt;&amp;lt;!-- 缓存 --&amp;gt;\n&amp;lt;dependency&amp;gt; \n    &amp;lt;groupId&amp;gt;redis.clients&amp;lt;/groupId&amp;gt; \n    &amp;lt;artifactId&amp;gt;jedis&amp;lt;/artifactId&amp;gt; \n    &amp;lt;version&amp;gt;2.8.1&amp;lt;/version&amp;gt; \n&amp;lt;/dependency&amp;gt; \n&amp;lt;dependency&amp;gt; \n    &amp;lt;groupId&amp;gt;org.springframework.data&amp;lt;/groupId&amp;gt; \n    &amp;lt;artifactId&amp;gt;spring-data-redis&amp;lt;/artifactId&amp;gt; \n    &amp;lt;version&amp;gt;1.7.2.RELEASE&amp;lt;/version&amp;gt; \n&amp;lt;/dependency&amp;gt;\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;2、创建redis-config.properties&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-properties\&#34;&gt;redis.host=127.0.0.1 \nredis.port=6379 \nredis.pass= \nredis.database=0 \nredis.maxIdle=300 \nredis.maxWait=3000 \nredis.testOnBorrow=true \n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;3、编写redis配置文件&lt;/p&gt;\n&lt;p&gt;applicationContext-redis.xml&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-xml\&#34;&gt;&amp;lt;context:property-placeholder location=&amp;quot;classpath*:properties/*.properties&amp;quot; /&amp;gt;   \n&amp;lt;!-- redis 相关配置 --&amp;gt; \n&amp;lt;bean id=&amp;quot;poolConfig&amp;quot; class=&amp;quot;redis.clients.jedis.JedisPoolConfig&amp;quot;&amp;gt;  \n &amp;lt;property name=&amp;quot;maxIdle&amp;quot; value=&amp;quot;${redis.maxIdle}&amp;quot; /&amp;gt;   \n &amp;lt;property name=&amp;quot;maxWaitMillis&amp;quot; value=&amp;quot;${redis.maxWait}&amp;quot; /&amp;gt;  \n &amp;lt;property name=&amp;quot;testOnBorrow&amp;quot; value=&amp;quot;${redis.testOnBorrow}&amp;quot; /&amp;gt;  \n&amp;lt;/bean&amp;gt;  \n&amp;lt;bean id=&amp;quot;JedisConnectionFactory&amp;quot; class=&amp;quot;org.springframework.data.redis.connection.jedis.JedisConnectionFactory&amp;quot; \n   p:host-name=&amp;quot;${redis.host}&amp;quot; p:port=&amp;quot;${redis.port}&amp;quot; p:password=&amp;quot;${redis.pass}&amp;quot; p:pool-config-ref=&amp;quot;poolConfig&amp;quot;/&amp;gt;  \n\n&amp;lt;bean id=&amp;quot;redisTemplate&amp;quot; class=&amp;quot;org.springframework.data.redis.core.RedisTemplate&amp;quot;&amp;gt;  \n &amp;lt;property name=&amp;quot;connectionFactory&amp;quot; ref=&amp;quot;JedisConnectionFactory&amp;quot; /&amp;gt;  \n&amp;lt;/bean&amp;gt;  \n&lt;/code&gt;&lt;/pre&gt;\n&lt;blockquote&gt;\n&lt;p&gt;maxIdle ：最大空闲数&lt;/p&gt;\n&lt;p&gt;maxWaitMillis:连接时的最大等待毫秒数&lt;/p&gt;\n&lt;p&gt;testOnBorrow：在提取一个jedis实例时，是否提前进行验证操作；如果为true，则得到的jedis实例均是可用的；&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;p&gt;4、值类型操作&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;@RunWith(SpringJUnit4ClassRunner.class)\n@ContextConfiguration(locations=&amp;quot;classpath:spring/applicationContext-redis.xml&amp;quot;)\npublic class TestValue {\n\t@Autowired\n\tprivate RedisTemplate redisTemplate;\t\n\t@Test\n\tpublic void setValue(){\n\t\tredisTemplate.boundValueOps(&amp;quot;name&amp;quot;).set(&amp;quot;zhangsan&amp;quot;);\t\t\n\t}\t\n\t@Test\n\tpublic void getValue(){\n\t\tString str = (String) redisTemplate.boundValueOps(&amp;quot;name&amp;quot;).get();\n\t\tSystem.out.println(str);\n\t}\t\n\t@Test\n\tpublic void deleteValue(){\n\t\tredisTemplate.delete(&amp;quot;name&amp;quot;);;\n\t}\t\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;5、Set类型操作&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;@RunWith(SpringJUnit4ClassRunner.class)\n@ContextConfiguration(locations=&amp;quot;classpath:spring/applicationContext-redis.xml&amp;quot;)\npublic class TestSet {\n\t@Autowired\n\tprivate RedisTemplate redisTemplate;\n\t/**\n\t * 存入值\n\t */\n\t@Test\n\tpublic void setValue(){\n\t\tredisTemplate.boundSetOps(&amp;quot;nameset&amp;quot;).add(&amp;quot;罗志祥&amp;quot;);\t\t\n\t\tredisTemplate.boundSetOps(&amp;quot;nameset&amp;quot;).add(&amp;quot;周扬青&amp;quot;);\t\n\t\tredisTemplate.boundSetOps(&amp;quot;nameset&amp;quot;).add(&amp;quot;蝴蝶姐&amp;quot;);\n\t}\n\t/**\n\t * 提取值\n\t */\n\t@Test\n\tpublic void getValue(){\n\t\tSet members = redisTemplate.boundSetOps(&amp;quot;nameset&amp;quot;).members();\n\t\tSystem.out.println(members);\n\t}\n    /**\n\t * 删除集合中的某一个值\n\t */\n\t@Test\n\tpublic void deleteValue(){\n\t\tredisTemplate.boundSetOps(&amp;quot;nameset&amp;quot;).remove(&amp;quot;蝴蝶姐&amp;quot;);\n\t}\n\t\n\t/**\n\t * 删除整个集合\n\t */\n\t@Test\n\tpublic void deleteAllValue(){\n\t\tredisTemplate.delete(&amp;quot;nameset&amp;quot;);\n\t}\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;6、List类型操作&lt;/p&gt;\n&lt;p&gt;6.1、右压栈&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;/**\n * 右压栈：后添加的对象排在后边\n */\n@Test\npublic void testSetValue1(){\t\t\n    redisTemplate.boundListOps(&amp;quot;namelist1&amp;quot;).rightPush(&amp;quot;刘备&amp;quot;);\n    redisTemplate.boundListOps(&amp;quot;namelist1&amp;quot;).rightPush(&amp;quot;关羽&amp;quot;);\n    redisTemplate.boundListOps(&amp;quot;namelist1&amp;quot;).rightPush(&amp;quot;张飞&amp;quot;);\t\t\n}\n/**\n * 显示右压栈集合\n */\n@Test\npublic void testGetValue1(){\n    List list = redisTemplate.boundListOps(&amp;quot;namelist1&amp;quot;).range(0, 10);\n    System.out.println(list);\n}\n//运行结果：[刘备, 关羽, 张飞]\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;6.2、左压栈&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;/**\n * 左压栈：后添加的对象排在前边\n */\n@Test\npublic void testSetValue2(){\t\t\n    redisTemplate.boundListOps(&amp;quot;namelist2&amp;quot;).leftPush(&amp;quot;刘备&amp;quot;);\n    redisTemplate.boundListOps(&amp;quot;namelist2&amp;quot;).leftPush(&amp;quot;关羽&amp;quot;);\n    redisTemplate.boundListOps(&amp;quot;namelist2&amp;quot;).leftPush(&amp;quot;张飞&amp;quot;);\t\t\n}\n/**\n * 显示左压栈集合\n */\n@Test\npublic void testGetValue2(){\n    List list = redisTemplate.boundListOps(&amp;quot;namelist2&amp;quot;).range(0, 10);\n    System.out.println(list);\n}\n//运行结果：[张飞, 关羽, 刘备]\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;6.3、根据索引查询元素&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;/**\n * 查询集合某个元素\n */\n@Test\npublic void testSearchByIndex(){\n    String s = (String) redisTemplate.boundListOps(&amp;quot;namelist1&amp;quot;).index(1);\n    System.out.println(s);\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;6.4、移除某个元素的值&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;/**\n * 移除集合某个元素\n */\n@Test\npublic void testRemoveByIndex(){\n    redisTemplate.boundListOps(&amp;quot;namelist1&amp;quot;).remove(1, &amp;quot;关羽&amp;quot;);\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;7、Hash类型操作&lt;/p&gt;\n&lt;p&gt;7.1、存入值&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;@Test\npublic void testSetValue(){\n    redisTemplate.boundHashOps(&amp;quot;namehash&amp;quot;).put(&amp;quot;a&amp;quot;, &amp;quot;唐僧&amp;quot;);\n    redisTemplate.boundHashOps(&amp;quot;namehash&amp;quot;).put(&amp;quot;b&amp;quot;, &amp;quot;悟空&amp;quot;);\n    redisTemplate.boundHashOps(&amp;quot;namehash&amp;quot;).put(&amp;quot;c&amp;quot;, &amp;quot;八戒&amp;quot;);\n    redisTemplate.boundHashOps(&amp;quot;namehash&amp;quot;).put(&amp;quot;d&amp;quot;, &amp;quot;沙僧&amp;quot;);\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;7.2、提取所有的KEY&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;@Test\npublic void testGetKeys(){\n    Set s = redisTemplate.boundHashOps(&amp;quot;namehash&amp;quot;).keys();\t\t\n    System.out.println(s);\t\t\n}\n//运行结果：[a, b, c, d]\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;7.3、提取所有的值&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;@Test\npublic void testGetValues(){\n    List values = redisTemplate.boundHashOps(&amp;quot;namehash&amp;quot;).values();\n    System.out.println(values);\t\t\n}\n//运行结果：[唐僧, 悟空, 八戒, 沙僧]\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;7.4、根据KEY提取值&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;@Test\npublic void testGetValueByKey(){\n    Object object = redisTemplate.boundHashOps(&amp;quot;namehash&amp;quot;).get(&amp;quot;b&amp;quot;);\n    System.out.println(object);\n}\n//运行结果：悟空\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;7.5、根据KEY移除值&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;@Test\npublic void testRemoveValueByKey(){\n    redisTemplate.boundHashOps(&amp;quot;namehash&amp;quot;).delete(&amp;quot;c&amp;quot;);\n}\n//运行结果：[唐僧, 悟空, 沙僧]\n&lt;/code&gt;&lt;/pre&gt;\n&#34;,&#34;fileName&#34;:&#34;redis&#34;,&#34;abstract&#34;:&#34;&#34;,&#34;title&#34;:&#34;Redis&#34;,&#34;tags&#34;:[{&#34;name&#34;:&#34;Redis&#34;,&#34;slug&#34;:&#34;WWST57yMi&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://haohanya.github.io/tag/WWST57yMi/&#34;}],&#34;date&#34;:&#34;2020-05-17 12:02:05&#34;,&#34;dateFormat&#34;:&#34;2020-05-17&#34;,&#34;feature&#34;:&#34;&#34;,&#34;link&#34;:&#34;https://haohanya.github.io/post/redis/&#34;,&#34;hideInList&#34;:false,&#34;isTop&#34;:false,&#34;stats&#34;:{&#34;text&#34;:&#34;7 min read&#34;,&#34;time&#34;:406000,&#34;words&#34;:1360,&#34;minutes&#34;:7},&#34;description&#34;:&#34;redis安装\n安装gcc\nyum install gcc-c++\n\n解压源码\ntar -zxvf redis-3.0.0.tar.gz\n\n进入解压后的目录进行编译\ncd /usr/local/redis-3.0.0\nmake PREFIX...&#34;,&#34;toc&#34;:&#34;&lt;ul class=\&#34;markdownIt-TOC\&#34;&gt;\n&lt;li&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#redis%E5%AE%89%E8%A3%85\&#34;&gt;redis安装&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#springdataredis%E7%AE%80%E4%BB%8B\&#34;&gt;SpringDataRedis简介&lt;/a&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#redis\&#34;&gt;Redis&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#jedis\&#34;&gt;Jedis&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#spring-data-redis\&#34;&gt;Spring Data Redis&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#spring-data-redis%E5%85%A5%E9%97%A8%E5%B0%8Fdemo\&#34;&gt;Spring Data Redis入门小Demo&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;/ul&gt;\n&#34;},{&#34;content&#34;:&#34;&lt;h2 id=\&#34;什么是jms\&#34;&gt;什么是jms&lt;/h2&gt;\n&lt;blockquote&gt;\n&lt;p&gt;JMS（java Messaging Service）是Java平台上有关面向消息中间件的技术规范，它便于消息系统中的Java应用程序进行消息交换,并且通过提供标准的产生、发送、接收消息的接口简化企业应用的开发。&lt;/p&gt;\n&lt;p&gt;​    JMS本身只定义了一系列的接口规范，是一种与厂商无关的 API，用来访问消息收发系统。它类似于 JDBC(java Database Connectivity)：这里，JDBC 是可以用来访问许多不同关系数据库的 API，而 JMS 则提供同样与厂商无关的访问方法，以访问消息收发服务。许多厂商目前都支持 JMS，包括 IBM 的 MQSeries、BEA的 Weblogic JMS service和 Progress 的 SonicMQ，这只是几个例子。 JMS 使您能够通过消息收发服务（有时称为消息中介程序或路由器）从一个 JMS 客户机向另一个 JML 客户机发送消息。消息是 JMS 中的一种类型对象，由两部分组成：报头和消息主体。报头由路由信息以及有关该消息的元数据组成。消息主体则携带着应用程序的数据或有效负载。&lt;/p&gt;\n&lt;p&gt;JMS 定义了五种不同的消息正文格式，以及调用的消息类型，允许你发送并接收以一&lt;/p&gt;\n&lt;p&gt;些不同形式的数据，提供现有消息格式的一些级别的兼容性。&lt;/p&gt;\n&lt;p&gt;TextMessage--一个字符串对象（应用最广泛的一种）&lt;/p&gt;\n&lt;p&gt;MapMessage--一套名称-值对&lt;/p&gt;\n&lt;p&gt;ObjectMessage--一个序列化的 Java 对象&lt;/p&gt;\n&lt;p&gt;BytesMessage--一个字节的数据流&lt;/p&gt;\n&lt;p&gt;StreamMessage -- Java 原始值的数据流&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;h2 id=\&#34;jms消息传递类型\&#34;&gt;JMS消息传递类型&lt;/h2&gt;\n&lt;p&gt;对于消息的传递有两种类型：&lt;br&gt;\n一种是点对点的，即一个生产者和一个消费者一一对应；&lt;br&gt;\n&lt;img src=\&#34;https://haohanya.github.io/post-images/1589686388156.png\&#34; alt=\&#34;\&#34; loading=\&#34;lazy\&#34;&gt;&lt;br&gt;\n另一种是发布/ 订阅模式，即一个生产者产生消息并进行发送后，可以由多个消费者进&lt;br&gt;\n行接收。&lt;br&gt;\n&lt;img src=\&#34;https://haohanya.github.io/post-images/1589686418709.png\&#34; alt=\&#34;\&#34; loading=\&#34;lazy\&#34;&gt;&lt;/p&gt;\n&lt;h2 id=\&#34;安装\&#34;&gt;安装&lt;/h2&gt;\n&lt;p&gt;1、上传activeMQ到服务器&lt;/p&gt;\n&lt;p&gt;2、解压 &lt;code&gt;tar -zxvf apache-activemq-5.12.0-bin.tar.gz&lt;/code&gt;&lt;/p&gt;\n&lt;p&gt;3、移动文件 &lt;code&gt;mv apache-activemq-5.12.0 /usr/local/java/activemq-5.12.0&lt;/code&gt;&lt;/p&gt;\n&lt;p&gt;4、进入bin &lt;code&gt;cd /usr/local/java/activemq-5.12.0/bin&lt;/code&gt;&lt;/p&gt;\n&lt;p&gt;5、启动activeMQ &lt;code&gt;./activemq start&lt;/code&gt;&lt;/p&gt;\n&lt;p&gt;6、访问：&lt;code&gt;ip:8161&lt;/code&gt;&lt;/p&gt;\n&lt;p&gt;账号：admin&lt;/p&gt;\n&lt;p&gt;密码：admin&lt;/p&gt;\n&lt;h2 id=\&#34;jms测试\&#34;&gt;JMS测试&lt;/h2&gt;\n&lt;h3 id=\&#34;点对点模式\&#34;&gt;点对点模式&lt;/h3&gt;\n&lt;p&gt;1、引入依赖&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-xml\&#34;&gt; &amp;lt;dependencies&amp;gt;\n    &amp;lt;dependency&amp;gt;\n        &amp;lt;groupId&amp;gt;org.apache.activemq&amp;lt;/groupId&amp;gt;\n        &amp;lt;artifactId&amp;gt;activemq-client&amp;lt;/artifactId&amp;gt;\n        &amp;lt;version&amp;gt;5.13.4&amp;lt;/version&amp;gt;\n    &amp;lt;/dependency&amp;gt;\n&amp;lt;/dependencies&amp;gt;\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;2、创建消息生产者QueueProducer&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;public static void main(String[] args) throws JMSException {\n    //1、创建工厂\n    ConnectionFactory connectionFactory  = new ActiveMQConnectionFactory(&amp;quot;tcp://192.168.25.135:61616&amp;quot;);\n    //2、获取连接\n    Connection connection = connectionFactory.createConnection();\n    //3、启动连接\n    connection.start();\n    /** 4、获取session  \n    \t参数1：是否启用事务 \n    \t参数2：消息确认模式\n            AUTO_ACKNOWLEDGE = 1    自动确认\n            CLIENT_ACKNOWLEDGE = 2    客户端手动确认   \n            DUPS_OK_ACKNOWLEDGE = 3    自动批量确认\n            SESSION_TRANSACTED = 0    事务提交并确认\n\t*/\n    Session session = connection.createSession(false, Session.AUTO_ACKNOWLEDGE);\n    //5、创建队列对象\n    Queue queue = session.createQueue(&amp;quot;test-queue&amp;quot;);\n    //6、创建消息生产着\n    MessageProducer messageProducer = session.createProducer(queue);\n    //7、创建消息\n    TextMessage textMessage = session.createTextMessage(&amp;quot;测试文本内容&amp;quot;);\n    //8、发送消息\n    messageProducer.send(textMessage);\n    //9、关闭资源\n    messageProducer.close();\n    session.close();\n    connection.close();\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;3、创建消息消费者QueueConsumer&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;public static void main(String[] args) throws JMSException, IOException {\n    //1、创建连接工厂\n    ConnectionFactory connectionFactory = new ActiveMQConnectionFactory(&amp;quot;tcp://192.168.25.135:61616&amp;quot;);\n    //2、获取连接\n    Connection connection = connectionFactory.createConnection();\n    //3、启动连接\n    connection.start();\n    //4、获取session\n    Session session = connection.createSession(false, Session.AUTO_ACKNOWLEDGE);\n    //5、创建队列对象\n    Queue queue = session.createQueue(&amp;quot;test-queue&amp;quot;);\n    //6、创建消息消费\n    MessageConsumer consumer = session.createConsumer(queue);\n    //7、监听消息\n    consumer.setMessageListener(new MessageListener() {\n        @Override\n        public void onMessage(Message message) {\n            TextMessage textMessage = (TextMessage) message;\n            try {\n                System.out.println(&amp;quot;接收消息为：&amp;quot;+textMessage.getText());\n            } catch (JMSException e) {\n                e.printStackTrace();\n            }\n        }\n    });\n    //8、等待键盘输入\n    System.in.read();\n    //9、关闭资源\n    consumer.close();\n    session.close();\n    connection.close();\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h3 id=\&#34;发布订阅模式\&#34;&gt;发布/订阅模式&lt;/h3&gt;\n&lt;p&gt;1、消息生产者TopicProducer&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;public static void main(String[] args) throws JMSException, IOException {\n    //1、创建连接工厂\n    ConnectionFactory connectionFactory = new ActiveMQConnectionFactory(&amp;quot;tcp://192.168.25.135:61616&amp;quot;);\n    //2、获取连接\n    Connection connection = connectionFactory.createConnection();\n    //3、启动连接\n    connection.start();\n    //4、获取session\n    Session session = connection.createSession(false, Session.AUTO_ACKNOWLEDGE);\n    //5、创建主题对象\n    Topic topic = session.createTopic(&amp;quot;test-topic&amp;quot;);\n    //6、创建消息消费者\n    MessageConsumer consumer = session.createConsumer(topic);\n    //7、监听消息\n    consumer.setMessageListener(new MessageListener() {\n        @Override\n        public void onMessage(Message message) {\n            TextMessage textMessage = (TextMessage) message;\n            try {\n                System.out.println(&amp;quot;接收消息：&amp;quot;+textMessage.getText());\n            } catch (JMSException e) {\n                e.printStackTrace();\n            }\n        }\n    });\n    //8、等待键盘输入\n    System.in.read();\n    //9、关闭资源\n    consumer.close();\n    session.close();\n    connection.close();\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;2、消息消费者TopicProducer&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;public static void main(String[] args) throws JMSException {\n    //1、创建连接工厂\n    ConnectionFactory connectionFactory = new ActiveMQConnectionFactory(&amp;quot;tcp://192.168.25.135:61616&amp;quot;);\n    //2、获取连接\n    Connection connection = connectionFactory.createConnection();\n    //3、启动连接\n    connection.start();\n    //4、获取session\n    Session session = connection.createSession(false, Session.AUTO_ACKNOWLEDGE);\n    //5、创建主题对象\n    Topic topic = session.createTopic(&amp;quot;test-topic&amp;quot;);\n    //6、创建消息生产者\n    MessageProducer producer = session.createProducer(topic);\n    //7、创建消息\n    TextMessage topicTest = session.createTextMessage(&amp;quot;topicTest&amp;quot;);\n    //8、发送消息\n    producer.send(topicTest);\n    //9、关闭资源\n    producer.close();\n    session.close();\n    connection.close();\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h2 id=\&#34;spring整合jms\&#34;&gt;spring整合jms&lt;/h2&gt;\n&lt;h3 id=\&#34;点对点模式-2\&#34;&gt;点对点模式&lt;/h3&gt;\n&lt;p&gt;1、引入依赖&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-xml\&#34;&gt;&amp;lt;!--spring-jms--&amp;gt;\n&amp;lt;dependency&amp;gt;\n    &amp;lt;groupId&amp;gt;org.springframework&amp;lt;/groupId&amp;gt;\n    &amp;lt;artifactId&amp;gt;spring-jms&amp;lt;/artifactId&amp;gt;\n    &amp;lt;version&amp;gt;4.2.4.RELEASE&amp;lt;/version&amp;gt;\n&amp;lt;/dependency&amp;gt;\n&amp;lt;!-- activemq --&amp;gt;\n&amp;lt;dependency&amp;gt;\n    &amp;lt;groupId&amp;gt;org.apache.activemq&amp;lt;/groupId&amp;gt;\n    &amp;lt;artifactId&amp;gt;activemq-all&amp;lt;/artifactId&amp;gt;\n    &amp;lt;version&amp;gt;5.11.2&amp;lt;/version&amp;gt;\n&amp;lt;/dependency&amp;gt;\n&amp;lt;!-- 单元测试 --&amp;gt;\n&amp;lt;!-- springJunit --&amp;gt;\n&amp;lt;dependency&amp;gt;\n    &amp;lt;groupId&amp;gt;org.springframework&amp;lt;/groupId&amp;gt;\n    &amp;lt;artifactId&amp;gt;spring-test&amp;lt;/artifactId&amp;gt;\n    &amp;lt;version&amp;gt;4.2.4.RELEASE&amp;lt;/version&amp;gt;\n    &amp;lt;scope&amp;gt;test&amp;lt;/scope&amp;gt;\n&amp;lt;/dependency&amp;gt;\n&amp;lt;dependency&amp;gt;\n    &amp;lt;groupId&amp;gt;junit&amp;lt;/groupId&amp;gt;\n    &amp;lt;artifactId&amp;gt;junit&amp;lt;/artifactId&amp;gt;\n    &amp;lt;version&amp;gt;4.12&amp;lt;/version&amp;gt;\n    &amp;lt;scope&amp;gt;test&amp;lt;/scope&amp;gt;\n&amp;lt;/dependency&amp;gt;\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;2、创建生产者配置文件&lt;/p&gt;\n&lt;p&gt;applicationContext-jms-producer-queue.xml&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-xml\&#34;&gt;&amp;lt;?xml version=&amp;quot;1.0&amp;quot; encoding=&amp;quot;UTF-8&amp;quot;?&amp;gt;\n&amp;lt;beans xmlns=&amp;quot;http://www.springframework.org/schema/beans&amp;quot;\n       xmlns:xsi=&amp;quot;http://www.w3.org/2001/XMLSchema-instance&amp;quot;\n       xmlns:context=&amp;quot;http://www.springframework.org/schema/context&amp;quot;\n       xsi:schemaLocation=&amp;quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd&amp;quot;&amp;gt;\n    &amp;lt;!--消息生产者:点对点--&amp;gt;\n\n    &amp;lt;context:component-scan base-package=&amp;quot;com.springjms&amp;quot;/&amp;gt;\n\n    &amp;lt;!--jms服务厂商提供的连接工厂--&amp;gt;\n    &amp;lt;bean id=&amp;quot;targetConnectionFactory&amp;quot; class=&amp;quot;org.apache.activemq.ActiveMQConnectionFactory&amp;quot;&amp;gt;\n        &amp;lt;property name=&amp;quot;brokerURL&amp;quot; value=&amp;quot;tcp://192.168.25.137:61616&amp;quot;/&amp;gt;\n    &amp;lt;/bean&amp;gt;\n    &amp;lt;!--spring用于管理真正的ConnectionFactory--&amp;gt;\n    &amp;lt;bean id=&amp;quot;connectionFactory&amp;quot; class=&amp;quot;org.springframework.jms.connection.SingleConnectionFactory&amp;quot;&amp;gt;\n        &amp;lt;property name=&amp;quot;targetConnectionFactory&amp;quot; ref=&amp;quot;targetConnectionFactory&amp;quot;/&amp;gt;\n    &amp;lt;/bean&amp;gt;\n    &amp;lt;!--spring提供的工具类--&amp;gt;\n    &amp;lt;bean id=&amp;quot;jmsTemplate&amp;quot; class=&amp;quot;org.springframework.jms.core.JmsTemplate&amp;quot;&amp;gt;\n        &amp;lt;constructor-arg name=&amp;quot;connectionFactory&amp;quot; ref=&amp;quot;connectionFactory&amp;quot;/&amp;gt;\n    &amp;lt;/bean&amp;gt;\n\n    &amp;lt;!--queue--&amp;gt;\n    &amp;lt;bean id=&amp;quot;queueTextDestination&amp;quot; class=&amp;quot;org.apache.activemq.command.ActiveMQQueue&amp;quot;&amp;gt;\n        &amp;lt;constructor-arg name=&amp;quot;name&amp;quot; value=&amp;quot;queue_text&amp;quot;/&amp;gt;\n    &amp;lt;/bean&amp;gt;\n&amp;lt;/beans&amp;gt;\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;3、发送消息&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;@Component\npublic class QueueProducer {\n\n    @Resource\n    private JmsTemplate jmsTemplate;\n\n    @Resource\n    private Destination queueTextDestination;\n\n    /**\n     * 发送文本消息\n     * @param text  发送的文本内容\n     */\n    public void sendTextMessage(final String text){\n        jmsTemplate.send(queueTextDestination, new MessageCreator() {\n            @Override\n            public Message createMessage(Session session) throws JMSException {\n                return session.createTextMessage(text);\n            }\n        });\n    }\n\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;4、测试发送消息&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;@RunWith(SpringJUnit4ClassRunner.class)\n@ContextConfiguration(locations = &amp;quot;classpath:applicationContext-jms-producer-queue.xml&amp;quot;)\npublic class MyTest {\n\n    @Resource\n    private QueueProducer queueProducer;\n\n    @Test\n    public void test(){\n        queueProducer.sendTextMessage(&amp;quot;Hello! queue&amp;quot;);\n    }\n\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;5、创建消费者配置文件&lt;/p&gt;\n&lt;p&gt;applicationContext-jms-consumer-queue.xml&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-xml\&#34;&gt;&amp;lt;?xml version=&amp;quot;1.0&amp;quot; encoding=&amp;quot;UTF-8&amp;quot;?&amp;gt;\n&amp;lt;beans xmlns=&amp;quot;http://www.springframework.org/schema/beans&amp;quot;\n       xmlns:xsi=&amp;quot;http://www.w3.org/2001/XMLSchema-instance&amp;quot;\n       xsi:schemaLocation=&amp;quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd&amp;quot;&amp;gt;\n    &amp;lt;!--服务消费者:点对点--&amp;gt;\n\n    &amp;lt;!--jsm服务厂商提供的连接工厂--&amp;gt;\n    &amp;lt;bean id=&amp;quot;targetConnectionFactory&amp;quot; class=&amp;quot;org.apache.activemq.ActiveMQConnectionFactory&amp;quot;&amp;gt;\n        &amp;lt;property name=&amp;quot;brokerURL&amp;quot; value=&amp;quot;tcp://192.168.25.137:61616&amp;quot;/&amp;gt;\n    &amp;lt;/bean&amp;gt;\n    &amp;lt;!--spring用于管理真正的ConnectionFactory--&amp;gt;\n    &amp;lt;bean id=&amp;quot;connectionFactory&amp;quot; class=&amp;quot;org.springframework.jms.connection.SingleConnectionFactory&amp;quot;&amp;gt;\n        &amp;lt;property name=&amp;quot;targetConnectionFactory&amp;quot; ref=&amp;quot;targetConnectionFactory&amp;quot;/&amp;gt;\n    &amp;lt;/bean&amp;gt;\n    &amp;lt;!--spring提供的工具类--&amp;gt;\n    &amp;lt;bean id=&amp;quot;jmsTemplate&amp;quot; class=&amp;quot;org.springframework.jms.core.JmsTemplate&amp;quot;&amp;gt;\n        &amp;lt;constructor-arg name=&amp;quot;connectionFactory&amp;quot; ref=&amp;quot;connectionFactory&amp;quot;/&amp;gt;\n    &amp;lt;/bean&amp;gt;\n\n    &amp;lt;!--queue--&amp;gt;\n    &amp;lt;bean id=&amp;quot;queueTextDestination&amp;quot; class=&amp;quot;org.apache.activemq.command.ActiveMQQueue&amp;quot;&amp;gt;\n        &amp;lt;constructor-arg name=&amp;quot;name&amp;quot; value=&amp;quot;queue_text&amp;quot;/&amp;gt;\n    &amp;lt;/bean&amp;gt;\n    &amp;lt;!--监听类,用来监听mq中是否有消息--&amp;gt;\n    &amp;lt;bean id=&amp;quot;myMessageListener&amp;quot; class=&amp;quot;com.springjms.MyMessageListener&amp;quot;/&amp;gt;\n    &amp;lt;!--消息的监听器--&amp;gt;\n    &amp;lt;bean class=&amp;quot;org.springframework.jms.listener.DefaultMessageListenerContainer&amp;quot;&amp;gt;\n        &amp;lt;property name=&amp;quot;connectionFactory&amp;quot; ref=&amp;quot;connectionFactory&amp;quot;/&amp;gt;\n        &amp;lt;property name=&amp;quot;destination&amp;quot; ref=&amp;quot;queueTextDestination&amp;quot;/&amp;gt;\n        &amp;lt;property name=&amp;quot;messageListener&amp;quot; ref=&amp;quot;myMessageListener&amp;quot;/&amp;gt;\n    &amp;lt;/bean&amp;gt;\n&amp;lt;/beans&amp;gt;\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;6、编写监听类&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;public class MyMessageListener implements MessageListener {\n    @Override\n    public void onMessage(Message message) {\n        TextMessage textMessage = (TextMessage) message;\n        try {\n            System.out.println(&amp;quot;接收到消息：&amp;quot;+textMessage.getText());\n        } catch (JMSException e) {\n            e.printStackTrace();\n        }\n    }\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;7、测试&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;@RunWith(SpringJUnit4ClassRunner.class)\n@ContextConfiguration(locations=&amp;quot;classpath:applicationContext-jms-consumer-queue.xml&amp;quot;)\npublic class MyTest1 {\n    @Test\n    public void testQueue(){\n        try {\n            System.in.read();\n        } catch (IOException e) {\n            e.printStackTrace();\n        }\n    }\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h2 id=\&#34;发布订阅模式-2\&#34;&gt;发布/订阅模式&lt;/h2&gt;\n&lt;p&gt;1、创建生产者，在applicationContext-jms-producer-queue.xml新增内容&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-xml\&#34;&gt;&amp;lt;!--这个是订阅模式  文本信息--&amp;gt;  \n&amp;lt;bean id=&amp;quot;topicTextDestination&amp;quot; class=&amp;quot;org.apache.activemq.command.ActiveMQTopic&amp;quot;&amp;gt;  \n    &amp;lt;constructor-arg value=&amp;quot;topic_text&amp;quot;/&amp;gt;  \n&amp;lt;/bean&amp;gt;\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;2、发送消息&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;@Component\npublic class TopicProducer {\n\n    @Resource\n    private JmsTemplate jmsTemplate;\n    @Resource\n    private Destination topicTextDestination;\n\n    /**\n     * 发送消息\n     * @param text\n     */\n    public void sendMessage(final String text){\n        jmsTemplate.send(topicTextDestination, new MessageCreator() {\n            @Override\n            public Message createMessage(Session session) throws JMSException {\n                return session.createTextMessage(text);\n            }\n        });\n    }\n\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;3、测试&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;@RunWith(SpringJUnit4ClassRunner.class)\n@ContextConfiguration(locations = &amp;quot;classpath:applicationContext-jms-producer-topic.xml&amp;quot;)\npublic class MyTest2 {\n\n    @Resource\n    private TopicProducer topicProducer;\n\n    @Test\n    public void test(){\n        topicProducer.sendMessage(&amp;quot;Hello! topic&amp;quot;);\n    }\n\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;4、创建消费者，在applicationContext-jms-consumer-queue.xml新增内容&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-xml\&#34;&gt;&amp;lt;!--topic--&amp;gt;\n&amp;lt;bean id=&amp;quot;topicTextDestination&amp;quot; class=&amp;quot;org.apache.activemq.command.ActiveMQTopic&amp;quot;&amp;gt;\n    &amp;lt;constructor-arg name=&amp;quot;name&amp;quot; value=&amp;quot;topic_text&amp;quot;/&amp;gt;\n&amp;lt;/bean&amp;gt;\n&amp;lt;!--监听类,用来监听mq中是否有消息--&amp;gt;\n&amp;lt;bean id=&amp;quot;topicMessageListener&amp;quot; class=&amp;quot;com.springjms.TopicMessageListener&amp;quot;/&amp;gt;\n&amp;lt;!--消息的监听器--&amp;gt;\n&amp;lt;bean class=&amp;quot;org.springframework.jms.listener.DefaultMessageListenerContainer&amp;quot;&amp;gt;\n    &amp;lt;property name=&amp;quot;connectionFactory&amp;quot; ref=&amp;quot;connectionFactory&amp;quot;/&amp;gt;\n    &amp;lt;property name=&amp;quot;destination&amp;quot; ref=&amp;quot;topicTextDestination&amp;quot;/&amp;gt;\n    &amp;lt;property name=&amp;quot;messageListener&amp;quot; ref=&amp;quot;topicMessageListener&amp;quot;/&amp;gt;\n&amp;lt;/bean&amp;gt;\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;5、编写监听类&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;public class TopicMessageListener implements MessageListener {\n    @Override\n    public void onMessage(Message message) {\n        TextMessage textMessage = (TextMessage) message;\n        try {\n            System.out.println(&amp;quot;接收到消息：&amp;quot;+textMessage.getText());\n        } catch (JMSException e) {\n            e.printStackTrace();\n        }\n    }\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;6、编写测试类&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;@RunWith(SpringJUnit4ClassRunner.class)\n@ContextConfiguration(locations=&amp;quot;classpath:applicationContext-jms-consumer-topic.xml&amp;quot;)\npublic class MyTest3 {\n    @Test\n    public void testQueue(){\n        try {\n            System.in.read();\n        } catch (IOException e) {\n            e.printStackTrace();\n        }\n    }\n}\n&lt;/code&gt;&lt;/pre&gt;\n&#34;,&#34;fileName&#34;:&#34;activemq&#34;,&#34;abstract&#34;:&#34;&#34;,&#34;title&#34;:&#34;ActiveMQ&#34;,&#34;tags&#34;:[{&#34;name&#34;:&#34;ActiveMQ&#34;,&#34;slug&#34;:&#34;TJ1wkA5NP&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://haohanya.github.io/tag/TJ1wkA5NP/&#34;}],&#34;date&#34;:&#34;2020-05-17 11:28:44&#34;,&#34;dateFormat&#34;:&#34;2020-05-17&#34;,&#34;feature&#34;:&#34;&#34;,&#34;link&#34;:&#34;https://haohanya.github.io/post/activemq/&#34;,&#34;hideInList&#34;:false,&#34;isTop&#34;:false,&#34;stats&#34;:{&#34;text&#34;:&#34;13 min read&#34;,&#34;time&#34;:765000,&#34;words&#34;:2496,&#34;minutes&#34;:13},&#34;description&#34;:&#34;什么是jms\n\nJMS（java Messaging Service）是Java平台上有关面向消息中间件的技术规范，它便于消息系统中的Java应用程序进行消息交换,并且通过提供标准的产生、发送、接收消息的接口简化企业应用的开发。\n​    ...&#34;,&#34;toc&#34;:&#34;&lt;ul class=\&#34;markdownIt-TOC\&#34;&gt;\n&lt;li&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E4%BB%80%E4%B9%88%E6%98%AFjms\&#34;&gt;什么是jms&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#jms%E6%B6%88%E6%81%AF%E4%BC%A0%E9%80%92%E7%B1%BB%E5%9E%8B\&#34;&gt;JMS消息传递类型&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E5%AE%89%E8%A3%85\&#34;&gt;安装&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#jms%E6%B5%8B%E8%AF%95\&#34;&gt;JMS测试&lt;/a&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E7%82%B9%E5%AF%B9%E7%82%B9%E6%A8%A1%E5%BC%8F\&#34;&gt;点对点模式&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E5%8F%91%E5%B8%83%E8%AE%A2%E9%98%85%E6%A8%A1%E5%BC%8F\&#34;&gt;发布/订阅模式&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#spring%E6%95%B4%E5%90%88jms\&#34;&gt;spring整合jms&lt;/a&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E7%82%B9%E5%AF%B9%E7%82%B9%E6%A8%A1%E5%BC%8F-2\&#34;&gt;点对点模式&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E5%8F%91%E5%B8%83%E8%AE%A2%E9%98%85%E6%A8%A1%E5%BC%8F-2\&#34;&gt;发布/订阅模式&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;/ul&gt;\n&#34;},{&#34;content&#34;:&#34;&lt;h2 id=\&#34;什么是solr\&#34;&gt;什么是Solr&lt;/h2&gt;\n&lt;blockquote&gt;\n&lt;p&gt;大多数搜索引擎应用都必须具有某种搜索功能，问题是搜索功能往往是巨大的资源消耗并且它们由于沉重的数据库加载而拖垮你的应用的性能。&lt;/p&gt;\n&lt;p&gt;这就是为什么转移负载到一个外部的搜索服务器是一个不错的主意，Apache Solr是一个流行的开源搜索服务器，它通过使用类似REST的HTTP API，这就确保你能从几乎任何编程语言来使用solr。&lt;/p&gt;\n&lt;p&gt;Solr是一个开源搜索平台，用于构建搜索应用程序。 它建立在Lucene(全文搜索引擎)之上。 Solr是企业级的，快速的和高度可扩展的。 使用Solr构建的应用程序非常复杂，可提供高性能。&lt;/p&gt;\n&lt;p&gt;为了在CNET网络的公司网站上添加搜索功能，Yonik Seely于2004年创建了Solr。并在2006年1月，它成为Apache软件基金会下的一个开源项目。并于2016年发布最新版本Solr 6.0，支持并行SQL查询的执行。&lt;/p&gt;\n&lt;p&gt;Solr可以和Hadoop一起使用。由于Hadoop处理大量数据，Solr帮助我们从这么大的源中找到所需的信息。不仅限于搜索，Solr也可以用于存储目的。像其他NoSQL数据库一样，它是一种非关系数据存储和处理技术。&lt;/p&gt;\n&lt;p&gt;总之，Solr是一个可扩展的，可部署，搜索/存储引擎，优化搜索大量以文本为中心的数据。&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;h2 id=\&#34;solr安装\&#34;&gt;solr安装&lt;/h2&gt;\n&lt;h3 id=\&#34;1-上传文件\&#34;&gt;1 上传文件&lt;/h3&gt;\n&lt;p&gt;apache-tomcat-7.0.82.tar.gz&lt;/p&gt;\n&lt;p&gt;solr-4.10.3.tgz.tgz&lt;/p&gt;\n&lt;p&gt;IK Analyzer 2012FF_hf1&lt;/p&gt;\n&lt;h3 id=\&#34;2-创建目录\&#34;&gt;2 创建目录&lt;/h3&gt;\n&lt;p&gt;mkdir /usr/soft/solr&lt;/p&gt;\n&lt;h3 id=\&#34;3-解压tomcat并移动到solr目录\&#34;&gt;3 解压tomcat并移动到solr目录&lt;/h3&gt;\n&lt;p&gt;tar -zxvf apache-tomcat-7.0.82.tar.gz&lt;/p&gt;\n&lt;p&gt;mv apache-tomcat-7.0.82 /usr/soft/solr/tomcat7&lt;/p&gt;\n&lt;p&gt;tar -zxvf solr-4.10.3.tgz.tgz&lt;/p&gt;\n&lt;p&gt;在solr-4.10.3/dist目录下有一个war包 需要把war包移动到tomcat里运行&lt;/p&gt;\n&lt;p&gt;cp ~/solr-4.10.3/dist/solr-4.10.3.war /usr/soft/solr/tomcat7/webapps/solr.war&lt;/p&gt;\n&lt;h3 id=\&#34;4-启动tomcat\&#34;&gt;4 启动tomcat&lt;/h3&gt;\n&lt;p&gt;cd /usr/soft/solr/tomcat7&lt;/p&gt;\n&lt;p&gt;./bin/startup.sh&lt;/p&gt;\n&lt;p&gt;查看tomcat日志(可选)&lt;/p&gt;\n&lt;p&gt;tail -f logs/catalina.out&lt;/p&gt;\n&lt;h3 id=\&#34;5-引入依赖jar包\&#34;&gt;5 引入依赖jar包&lt;/h3&gt;\n&lt;p&gt;cd ~/solr-4.10.3/example/lib/ext&lt;/p&gt;\n&lt;p&gt;cp * /usr/soft/solr/tomcat7/webapps/solr/WEB-INF/lib&lt;/p&gt;\n&lt;h3 id=\&#34;6-复制配置文件\&#34;&gt;6 复制配置文件&lt;/h3&gt;\n&lt;p&gt;cd ~/solr-4.10.3/example&lt;/p&gt;\n&lt;p&gt;cp -r solr /usr/soft/solr/solrhome&lt;/p&gt;\n&lt;h3 id=\&#34;7-solr和solrhome建立联系\&#34;&gt;7 solr和solrhome建立联系&lt;/h3&gt;\n&lt;p&gt;cd /usr/soft/solr/tomcat7/webapps/solr/WEB-INF&lt;/p&gt;\n&lt;p&gt;vi web.xml&lt;/p&gt;\n&lt;p&gt;/usr/soft/solr/solrhome&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-xml\&#34;&gt;&amp;lt;env-entry&amp;gt;\n\t&amp;lt;env-entry-name&amp;gt;solr/home&amp;lt;/env-entry-name&amp;gt;\n    &amp;lt;!-- 这里设置为自己的solrhome路径 --&amp;gt;\n    &amp;lt;env-entry-value&amp;gt;/usr/soft/solr/solrhome&amp;lt;/env-entry-value&amp;gt;\n    &amp;lt;env-entry-type&amp;gt;java.lang.String&amp;lt;/env-entry-type&amp;gt;\n&amp;lt;/env-entry&amp;gt;\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;:wq&lt;/p&gt;\n&lt;h3 id=\&#34;8-重启-tomcat\&#34;&gt;8 重启 tomcat&lt;/h3&gt;\n&lt;p&gt;cd /usr/soft/solr/tomcat7/bin&lt;/p&gt;\n&lt;p&gt;./shutdown.sh&lt;/p&gt;\n&lt;p&gt;./startup.sh&lt;/p&gt;\n&lt;h3 id=\&#34;9-访问solr\&#34;&gt;9 访问solr&lt;/h3&gt;\n&lt;p&gt;http://192.168.25.132:8080/solr/&lt;/p&gt;\n&lt;h2 id=\&#34;配置ik分词器\&#34;&gt;配置IK分词器&lt;/h2&gt;\n&lt;h3 id=\&#34;ik-analyzer简介\&#34;&gt;IK Analyzer简介&lt;/h3&gt;\n&lt;blockquote&gt;\n&lt;p&gt;IK Analyzer 是一个开源的，基亍 java 语言开发的轻量级的中文分词工具包。从 2006年 12 月推出 1.0 版开始， IKAnalyzer 已经推出了 4 个大版本。最初，它是以开源项目Luence 为应用主体的，结合词典分词和文法分析算法的中文分词组件。从 3.0 版本开始，IK 发展为面向 Java 的公用分词组件，独立亍 Lucene 项目，同时提供了对 Lucene 的默认优化实现。在 2012 版本中，IK 实现了简单的分词歧义排除算法，标志着 IK 分词器从单纯的词典分词向模拟语义分词衍化。&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;h3 id=\&#34;1-将ik分词器jar包移动到solr中\&#34;&gt;1 将ik分词器jar包移动到solr中&lt;/h3&gt;\n&lt;p&gt;cp ~/IK\\ Analyzer\\ 2012FF_hf1/IKAnalyzer2012FF_u1.jar /usr/soft/solr/tomcat7/webapps/solr/WEB-INF/lib&lt;/p&gt;\n&lt;h3 id=\&#34;2-在solr项目的web-inf-目录创建一个classes目录\&#34;&gt;2 在solr项目的WEB-INF 目录创建一个classes目录&lt;/h3&gt;\n&lt;p&gt;mkdir /usr/soft/solr/tomcat7/webapps/solr/WEB-INF/classes&lt;/p&gt;\n&lt;h3 id=\&#34;3-移动配置文件到classes目录\&#34;&gt;3 移动配置文件到classes目录&lt;/h3&gt;\n&lt;p&gt;cp IKAnalyzer.cfg.xml ext_stopword.dic mydict.dic /usr/soft/solr/tomcat7/webapps/solr/WEB-INF/classes&lt;/p&gt;\n&lt;h3 id=\&#34;4-启用-编辑配置文件\&#34;&gt;4 启用---编辑配置文件&lt;/h3&gt;\n&lt;p&gt;使用npp编辑服务器上的文件&lt;/p&gt;\n&lt;p&gt;1 安装npp (略)&lt;/p&gt;\n&lt;p&gt;2  安装NppFTP(略)&lt;/p&gt;\n&lt;p&gt;3 连接服务器 (虐)&lt;/p&gt;\n&lt;p&gt;4 编辑xml文件 : /usr/soft/solr/solrhome/collection1/conf/schema.xml&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-xml\&#34;&gt;&amp;lt;!-- 配置IK分词器 --&amp;gt;\n&amp;lt;fieldType name=&amp;quot;text_ik&amp;quot; class=&amp;quot;solr.TextField&amp;quot;&amp;gt;\n    &amp;lt;analyzer class=&amp;quot;org.wltea.analyzer.lucene.IKAnalyzer&amp;quot;&amp;gt;&amp;lt;/analyzer&amp;gt;\n&amp;lt;/fieldType&amp;gt;\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;5 重启tomcat&lt;/p&gt;\n&lt;p&gt;cd /usr/soft/solr/tomcat7/bin&lt;/p&gt;\n&lt;p&gt;./shutdown.sh&lt;/p&gt;\n&lt;p&gt;./startup.sh&lt;/p&gt;\n&lt;p&gt;6 访问url&lt;/p&gt;\n&lt;p&gt;http://192.168.25.132:8080/solr/&lt;/p&gt;\n&lt;h2 id=\&#34;域\&#34;&gt;域&lt;/h2&gt;\n&lt;p&gt;域 : 相当于数据库表的字段&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-xml\&#34;&gt;&amp;lt;!--\n\tname : 指定域的名称\n\ttype : 指定域的类型\n\tindexed : 是否索引\n\tstored : 是否存储\n\trequired : 是否必须\n\tmultiValued : 是否多值\n--&amp;gt;\n&amp;lt;field name=&amp;quot;id&amp;quot; type=&amp;quot;string&amp;quot; indexed=&amp;quot;true&amp;quot; stored=&amp;quot;true&amp;quot; required=&amp;quot;true&amp;quot; multiValued=&amp;quot;false&amp;quot; /&amp;gt; \n&lt;/code&gt;&lt;/pre&gt;\n&lt;h2 id=\&#34;spring-data-solr-demo\&#34;&gt;Spring Data Solr Demo&lt;/h2&gt;\n&lt;p&gt;1、引入依赖&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-xml\&#34;&gt;&amp;lt;dependency&amp;gt;\n    &amp;lt;groupId&amp;gt;org.springframework.data&amp;lt;/groupId&amp;gt;\n    &amp;lt;artifactId&amp;gt;spring-data-solr&amp;lt;/artifactId&amp;gt;\n    &amp;lt;version&amp;gt;1.5.5.RELEASE&amp;lt;/version&amp;gt;\n&amp;lt;/dependency&amp;gt; \n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;2、applicationContext-solr.xml&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-xml\&#34;&gt;&amp;lt;?xml version=&amp;quot;1.0&amp;quot; encoding=&amp;quot;UTF-8&amp;quot;?&amp;gt;\n&amp;lt;beans xmlns=&amp;quot;http://www.springframework.org/schema/beans&amp;quot;\n\txmlns:xsi=&amp;quot;http://www.w3.org/2001/XMLSchema-instance&amp;quot; xmlns:p=&amp;quot;http://www.springframework.org/schema/p&amp;quot;\n\txmlns:context=&amp;quot;http://www.springframework.org/schema/context&amp;quot;\n\txmlns:solr=&amp;quot;http://www.springframework.org/schema/data/solr&amp;quot;\n\txsi:schemaLocation=&amp;quot;http://www.springframework.org/schema/data/solr \n  \t\thttp://www.springframework.org/schema/data/solr/spring-solr-1.0.xsd\n\t\thttp://www.springframework.org/schema/beans \n\t\thttp://www.springframework.org/schema/beans/spring-beans.xsd\n\t\thttp://www.springframework.org/schema/context \n\t\thttp://www.springframework.org/schema/context/spring-context.xsd&amp;quot;&amp;gt;\n\t&amp;lt;!-- solr服务器地址 --&amp;gt;\n\t&amp;lt;solr:solr-server id=&amp;quot;solrServer&amp;quot; url=&amp;quot;http://127.0.0.1:8080/solr&amp;quot; /&amp;gt;\n\t&amp;lt;!-- solr模板，使用solr模板可对索引库进行CRUD的操作 --&amp;gt;\n\t&amp;lt;bean id=&amp;quot;solrTemplate&amp;quot; class=&amp;quot;org.springframework.data.solr.core.SolrTemplate&amp;quot;&amp;gt;\n\t\t&amp;lt;constructor-arg ref=&amp;quot;solrServer&amp;quot; /&amp;gt;\n\t&amp;lt;/bean&amp;gt;\n&amp;lt;/beans&amp;gt;\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;3、@Field 注解&lt;/p&gt;\n&lt;p&gt;作用：如果在pojo上添加了这个注解，那么这个属性会被引用到solr，value为指定solr中field定义的name，如果一样可以省略&lt;/p&gt;\n&lt;p&gt;@Dynamic注解，在属性上定义就表示是一个动态域&lt;/p&gt;\n&lt;p&gt;4、添加&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;@Autowired\nprivate SolrTemplate solrTemplate;\n\nsolrTemplate.saveBean(item);\n//添加多条数据可以使用saveBeans\nsolrTemplate.commit();//提交事务\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;5、按主键查询&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;//参数1 ：要查询的主键ID\n//参数2 ：返回的数据类型\nsolrTemplate.getById(1,TbItem.class)\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;6、按主键删除&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;solrTemplate.deleteById(&amp;quot;1&amp;quot;);\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;7、分页查询&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;//条件\nQuery query = newSimpleQuery(&amp;quot;*:*&amp;quot;);\n//查询条件\nCriteria criteria = new Criteria();\n//and ：查询的域\n//contains ：查询的关键字\ncriteria.and(&amp;quot;item_title&amp;quot;).contains(&amp;quot;手机&amp;quot;);\n//将查询条件添加到queyr中\nquery.addCriteria(criteria);\nquery.setOffset(0);//开始索引，默认为0，翻页规则 (pageNow - 1) * pageSize\nquery.setRows(20);//每页记录条数\n//ScoredPage ：solr的分页查询\n//参数1：查询条件\n//参数2：返回类型\nScoredPage&amp;lt;TbItem&amp;gt; page = solrTemplate.queryForPage(query,TbItem.class)\nSystem.out.pringln(&amp;quot;总记录数:&amp;quot;+page.getTotalElements());\nList&amp;lt;TbItem&amp;gt; list = page.getContent();\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;8、高亮查询&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;@Resource\nprivate SolrTemplate solrTemplate;\n\n@Override\npublic Map&amp;lt;String, Object&amp;gt; search(Map&amp;lt;String, Object&amp;gt; searchMap) {\n\n    Map&amp;lt;String,Object&amp;gt; map = new HashMap&amp;lt;String, Object&amp;gt;();\n\n    //设置搜索高亮\n    HighlightQuery query = new SimpleHighlightQuery();\n\n    //设置高亮的域\n    HighlightOptions highlightOptions = new HighlightOptions().addField(&amp;quot;item_title&amp;quot;);\n\n    //设置高亮前缀\n    highlightOptions.setSimplePrefix(&amp;quot;&amp;lt;em style=&#39;color:red&#39;&amp;gt;&amp;quot;);\n    //设置高亮后缀\n    highlightOptions.setSimplePostfix(&amp;quot;&amp;lt;/em&amp;gt;&amp;quot;);\n\n    //设置高亮选项\n    query.setHighlightOptions(highlightOptions);\n\n    //按照关键字查询\n    Criteria criteria = new Criteria(&amp;quot;item_keywords&amp;quot;).is(searchMap.get(&amp;quot;keywords&amp;quot;));\n\n    //添加条件\n    query.addCriteria(criteria);\n\n    //到solr中查询\n    HighlightPage&amp;lt;TbItem&amp;gt; page = solrTemplate.queryForHighlightPage(query,TbItem.class);\n\n    //循环高亮入口集合\n    for (HighlightEntry&amp;lt;TbItem&amp;gt; entry : page.getHighlighted()) {\n        //获取原实体类\n        TbItem tbItem = entry.getEntity();\n\n        //判断是否有高亮内容\n        if(entry.getHighlights().size() &amp;gt; 0 &amp;amp;&amp;amp; entry.getHighlights().get(0).getSnipplets().size() &amp;gt; 0 ){\n            //设置高亮的结果\n            tbItem.setTitle(entry.getHighlights().get(0).getSnipplets().get(0));\n        }\n    }\n    map.put(&amp;quot;rows&amp;quot;,page.getContent());\n\n    return map;\n}\n&lt;/code&gt;&lt;/pre&gt;\n&#34;,&#34;fileName&#34;:&#34;solr-an-zhuang-shi-yong&#34;,&#34;abstract&#34;:&#34;&#34;,&#34;title&#34;:&#34;solr安装使用&#34;,&#34;tags&#34;:[{&#34;name&#34;:&#34;solr&#34;,&#34;slug&#34;:&#34;D-nvo_2ol&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://haohanya.github.io/tag/D-nvo_2ol/&#34;}],&#34;date&#34;:&#34;2020-05-12 18:47:23&#34;,&#34;dateFormat&#34;:&#34;2020-05-12&#34;,&#34;feature&#34;:&#34;&#34;,&#34;link&#34;:&#34;https://haohanya.github.io/post/solr-an-zhuang-shi-yong/&#34;,&#34;hideInList&#34;:false,&#34;isTop&#34;:false,&#34;stats&#34;:{&#34;text&#34;:&#34;9 min read&#34;,&#34;time&#34;:521000,&#34;words&#34;:1850,&#34;minutes&#34;:9},&#34;description&#34;:&#34;什么是Solr\n\n大多数搜索引擎应用都必须具有某种搜索功能，问题是搜索功能往往是巨大的资源消耗并且它们由于沉重的数据库加载而拖垮你的应用的性能。\n这就是为什么转移负载到一个外部的搜索服务器是一个不错的主意，Apache Solr是一个流行的...&#34;,&#34;toc&#34;:&#34;&lt;ul class=\&#34;markdownIt-TOC\&#34;&gt;\n&lt;li&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E4%BB%80%E4%B9%88%E6%98%AFsolr\&#34;&gt;什么是Solr&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#solr%E5%AE%89%E8%A3%85\&#34;&gt;solr安装&lt;/a&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#1-%E4%B8%8A%E4%BC%A0%E6%96%87%E4%BB%B6\&#34;&gt;1 上传文件&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#2-%E5%88%9B%E5%BB%BA%E7%9B%AE%E5%BD%95\&#34;&gt;2 创建目录&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#3-%E8%A7%A3%E5%8E%8Btomcat%E5%B9%B6%E7%A7%BB%E5%8A%A8%E5%88%B0solr%E7%9B%AE%E5%BD%95\&#34;&gt;3 解压tomcat并移动到solr目录&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#4-%E5%90%AF%E5%8A%A8tomcat\&#34;&gt;4 启动tomcat&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#5-%E5%BC%95%E5%85%A5%E4%BE%9D%E8%B5%96jar%E5%8C%85\&#34;&gt;5 引入依赖jar包&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#6-%E5%A4%8D%E5%88%B6%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6\&#34;&gt;6 复制配置文件&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#7-solr%E5%92%8Csolrhome%E5%BB%BA%E7%AB%8B%E8%81%94%E7%B3%BB\&#34;&gt;7 solr和solrhome建立联系&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#8-%E9%87%8D%E5%90%AF-tomcat\&#34;&gt;8 重启 tomcat&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#9-%E8%AE%BF%E9%97%AEsolr\&#34;&gt;9 访问solr&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E9%85%8D%E7%BD%AEik%E5%88%86%E8%AF%8D%E5%99%A8\&#34;&gt;配置IK分词器&lt;/a&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#ik-analyzer%E7%AE%80%E4%BB%8B\&#34;&gt;IK Analyzer简介&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#1-%E5%B0%86ik%E5%88%86%E8%AF%8D%E5%99%A8jar%E5%8C%85%E7%A7%BB%E5%8A%A8%E5%88%B0solr%E4%B8%AD\&#34;&gt;1 将ik分词器jar包移动到solr中&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#2-%E5%9C%A8solr%E9%A1%B9%E7%9B%AE%E7%9A%84web-inf-%E7%9B%AE%E5%BD%95%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AAclasses%E7%9B%AE%E5%BD%95\&#34;&gt;2 在solr项目的WEB-INF 目录创建一个classes目录&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#3-%E7%A7%BB%E5%8A%A8%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E5%88%B0classes%E7%9B%AE%E5%BD%95\&#34;&gt;3 移动配置文件到classes目录&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#4-%E5%90%AF%E7%94%A8-%E7%BC%96%E8%BE%91%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6\&#34;&gt;4 启用---编辑配置文件&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E5%9F%9F\&#34;&gt;域&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#spring-data-solr-demo\&#34;&gt;Spring Data Solr Demo&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;/ul&gt;\n&#34;},{&#34;content&#34;:&#34;&lt;h2 id=\&#34;spring-security简介\&#34;&gt;Spring Security简介&lt;/h2&gt;\n&lt;blockquote&gt;\n&lt;p&gt;Spring Security是一个能够为基于Spring的企业应用系统提供声明式的安全访问控制解决方案的安全框架。它提供了一组可以在Spring应用上下文中配置的Bean，充分利用了Spring IoC，DI（控制反转Inversion of Control ,DI:Dependency Injection 依赖注入）和AOP（面向切面编程）功能，为应用系统提供声明式的安全访问控制功能，减少了为企业系统安全控制编写大量重复代码的工作。&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;h2 id=\&#34;单机版\&#34;&gt;单机版&lt;/h2&gt;\n&lt;p&gt;1.引入依赖&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-xml\&#34;&gt; &amp;lt;!-- 身份验证 --&amp;gt;\n&amp;lt;dependency&amp;gt;\n    &amp;lt;groupId&amp;gt;org.springframework.security&amp;lt;/groupId&amp;gt;\n    &amp;lt;artifactId&amp;gt;spring-security-web&amp;lt;/artifactId&amp;gt;\n&amp;lt;/dependency&amp;gt;\n&amp;lt;dependency&amp;gt;\n    &amp;lt;groupId&amp;gt;org.springframework.security&amp;lt;/groupId&amp;gt;\n    &amp;lt;artifactId&amp;gt;spring-security-config&amp;lt;/artifactId&amp;gt;\n&amp;lt;/dependency&amp;gt;\n&lt;/code&gt;&lt;/pre&gt;\n&lt;!-- more --&gt;\n&lt;p&gt;2.配置核心配置文件&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-xml\&#34;&gt;&amp;lt;?xml version=&amp;quot;1.0&amp;quot; encoding=&amp;quot;UTF-8&amp;quot;?&amp;gt;\n&amp;lt;beans:beans xmlns=&amp;quot;http://www.springframework.org/schema/security&amp;quot;\n             xmlns:beans=&amp;quot;http://www.springframework.org/schema/beans&amp;quot;\n             xmlns:xsi=&amp;quot;http://www.w3.org/2001/XMLSchema-instance&amp;quot;\n             xsi:schemaLocation=&amp;quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd\n\t\t\t\t\t\thttp://www.springframework.org/schema/security http://www.springframework.org/schema/security/spring-security.xsd&amp;quot;&amp;gt;\n    &amp;lt;!-- 以下页面不被拦截 --&amp;gt;\n    &amp;lt;http pattern=&amp;quot;/login.html&amp;quot; security=&amp;quot;none&amp;quot;/&amp;gt;\n    &amp;lt;http pattern=&amp;quot;/css/**&amp;quot; security=&amp;quot;none&amp;quot;/&amp;gt;\n    &amp;lt;http pattern=&amp;quot;/img/**&amp;quot; security=&amp;quot;none&amp;quot;/&amp;gt;\n    &amp;lt;http pattern=&amp;quot;/js/**&amp;quot; security=&amp;quot;none&amp;quot;/&amp;gt;\n    &amp;lt;http pattern=&amp;quot;/plugins/**&amp;quot; security=&amp;quot;none&amp;quot;/&amp;gt;\n\n    &amp;lt;!--\n            页面拦截规则\n                use-expressions:是否启用spel表达式, 如果为true那么access=&amp;quot;hasRole(&#39;ROLE_USER&#39;)&amp;quot;\n        --&amp;gt;\n    &amp;lt;!-- 页面拦截规则 --&amp;gt;\n    &amp;lt;http use-expressions=&amp;quot;false&amp;quot;&amp;gt;\n        &amp;lt;!--\n            pattern : 拦截的url\n            access : 拥有如下权限允许访问\n        --&amp;gt;\n        &amp;lt;intercept-url pattern=&amp;quot;/**&amp;quot; access=&amp;quot;ROLE_ADMIN&amp;quot; /&amp;gt;\n        &amp;lt;!--\n            login-page : 自定义登陆页面\n            default-target-url : 登陆成功后跳转的页面,不设定默认跳转上一次访问的页面\n            authentication-failure-url : 登陆失败时跳转的url\n            always-use-default-target : 登陆成功后 总是跳转到 default-target-url 设定的url\n        --&amp;gt;\n        &amp;lt;form-login login-page=&amp;quot;/login.html&amp;quot;  default-target-url=&amp;quot;/admin/index.html&amp;quot; authentication-failure-url=&amp;quot;/login.html&amp;quot; always-use-default-target=&amp;quot;true&amp;quot;/&amp;gt;\n        &amp;lt;csrf disabled=&amp;quot;true&amp;quot;/&amp;gt;\n\n        &amp;lt;!--\n            logout-url : 退出的地址\n            logout-success-url : 退出后跳转的地址\n        --&amp;gt;\n        &amp;lt;logout logout-url=&amp;quot;/logout&amp;quot; logout-success-url=&amp;quot;/login.html&amp;quot;/&amp;gt;\n        &amp;lt;!--\n            如果使用了iframe,需要指定框架页的策略为 SAMEORIGIN\n        --&amp;gt;\n        &amp;lt;headers&amp;gt;\n            &amp;lt;frame-options policy=&amp;quot;SAMEORIGIN&amp;quot;/&amp;gt;  &amp;lt;!--允许使用frameset --&amp;gt;\n        &amp;lt;/headers&amp;gt;\n    &amp;lt;/http&amp;gt;\n\n    &amp;lt;!--认证管理器--&amp;gt;\n    &amp;lt;authentication-manager&amp;gt;\n        &amp;lt;authentication-provider&amp;gt;\n            &amp;lt;user-service&amp;gt;\n                &amp;lt;!--用户名和密码,权限--&amp;gt;\n                &amp;lt;user name=&amp;quot;root&amp;quot; password=&amp;quot;root&amp;quot; authorities=&amp;quot;ROLE_ADMIN&amp;quot;/&amp;gt;\n            &amp;lt;/user-service&amp;gt;\n        &amp;lt;/authentication-provider&amp;gt;\n    &amp;lt;/authentication-manager&amp;gt;\n\n&amp;lt;/beans:beans&amp;gt;\n\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;3.配置web.xml&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-xml\&#34;&gt;&amp;lt;context-param&amp;gt;\n    &amp;lt;param-name&amp;gt;contextConfigLocation&amp;lt;/param-name&amp;gt;\n    &amp;lt;param-value&amp;gt;classpath:spring/spring-security.xml&amp;lt;/param-value&amp;gt;\n&amp;lt;/context-param&amp;gt;\n&amp;lt;listener&amp;gt;\n    &amp;lt;listener-class&amp;gt;\n        org.springframework.web.context.ContextLoaderListener\n    &amp;lt;/listener-class&amp;gt;\n&amp;lt;/listener&amp;gt;\n&amp;lt;filter&amp;gt;\n    &amp;lt;filter-name&amp;gt;springSecurityFilterChain&amp;lt;/filter-name&amp;gt;\n    &amp;lt;filter-class&amp;gt;org.springframework.web.filter.DelegatingFilterProxy&amp;lt;/filter-class&amp;gt;\n&amp;lt;/filter&amp;gt;\n&amp;lt;filter-mapping&amp;gt;\n    &amp;lt;filter-name&amp;gt;springSecurityFilterChain&amp;lt;/filter-name&amp;gt;\n    &amp;lt;url-pattern&amp;gt;/*&amp;lt;/url-pattern&amp;gt;\n&amp;lt;/filter-mapping&amp;gt;\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h2 id=\&#34;连接数据库\&#34;&gt;连接数据库&lt;/h2&gt;\n&lt;p&gt;1.引入依赖&lt;/p&gt;\n&lt;p&gt;2.实现UserDetailsService接口&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;package com.jd.shop.service.impl;\n\nimport com.jd.pojo.TbSeller;\nimport com.jd.sellergoods.service.TbSellerService;\nimport org.springframework.security.core.GrantedAuthority;\nimport org.springframework.security.core.authority.SimpleGrantedAuthority;\nimport org.springframework.security.core.userdetails.User;\nimport org.springframework.security.core.userdetails.UserDetails;\nimport org.springframework.security.core.userdetails.UserDetailsService;\nimport org.springframework.security.core.userdetails.UsernameNotFoundException;\n\nimport java.util.ArrayList;\nimport java.util.List;\n\n/**\n * 认证类\n * @program: jd\n * @author: 潘\n * @create: 2020-04-29 22:43\n **/\npublic class UserDetailsServiceImpl implements UserDetailsService{\n\n    private TbSellerService tbSellerService;\n\n    public void setTbSellerService(TbSellerService tbSellerService) {\n        this.tbSellerService = tbSellerService;\n    }\n\n    @Override\n    public UserDetails loadUserByUsername(String username) throws UsernameNotFoundException {\n\n        if(username == null){\n            return null;\n        }\n\n        TbSeller byId = tbSellerService.findById(username);\n\n        if(byId == null){\n            return null;\n        }\n\n        //构建角色列表\n        List&amp;lt;GrantedAuthority&amp;gt; list = new ArrayList&amp;lt;&amp;gt;();\n\n        //用户的权限集合\n        list.add(new SimpleGrantedAuthority(&amp;quot;ROLE_USER&amp;quot;));\n\n        return new User(username,byId.getPassword(),list);\n    }\n}\n\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;3.配置核心配置文件&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-xml\&#34;&gt;&amp;lt;?xml version=&amp;quot;1.0&amp;quot; encoding=&amp;quot;UTF-8&amp;quot;?&amp;gt;\n&amp;lt;beans:beans xmlns=&amp;quot;http://www.springframework.org/schema/security&amp;quot;\n             xmlns:beans=&amp;quot;http://www.springframework.org/schema/beans&amp;quot;\n             xmlns:xsi=&amp;quot;http://www.w3.org/2001/XMLSchema-instance&amp;quot;\n             xmlns:dubbo=&amp;quot;http://code.alibabatech.com/schema/dubbo&amp;quot;\n             xsi:schemaLocation=&amp;quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd\n\t\t\t\t\t\thttp://www.springframework.org/schema/security http://www.springframework.org/schema/security/spring-security.xsd http://code.alibabatech.com/schema/dubbo http://code.alibabatech.com/schema/dubbo/dubbo.xsd&amp;quot;&amp;gt;\n    &amp;lt;!-- 以下页面不被拦截 --&amp;gt;\n    &amp;lt;http pattern=&amp;quot;/login.html&amp;quot; security=&amp;quot;none&amp;quot;/&amp;gt;\n    &amp;lt;http pattern=&amp;quot;/css/**&amp;quot; security=&amp;quot;none&amp;quot;/&amp;gt;\n    &amp;lt;http pattern=&amp;quot;/img/**&amp;quot; security=&amp;quot;none&amp;quot;/&amp;gt;\n    &amp;lt;http pattern=&amp;quot;/js/**&amp;quot; security=&amp;quot;none&amp;quot;/&amp;gt;\n    &amp;lt;http pattern=&amp;quot;/plugins/**&amp;quot; security=&amp;quot;none&amp;quot;/&amp;gt;\n    &amp;lt;http pattern=&amp;quot;/*.html&amp;quot; security=&amp;quot;none&amp;quot;/&amp;gt;\n&amp;lt;!--    &amp;lt;http pattern=&amp;quot;/login&amp;quot; security=&amp;quot;none&amp;quot;/&amp;gt;--&amp;gt;\n\n    &amp;lt;!--\n            页面拦截规则\n                use-expressions:是否启用spel表达式, 如果为true那么access=&amp;quot;hasRole(&#39;ROLE_USER&#39;)&amp;quot;\n        --&amp;gt;\n    &amp;lt;!-- 页面拦截规则 --&amp;gt;\n    &amp;lt;http use-expressions=&amp;quot;false&amp;quot;&amp;gt;\n        &amp;lt;!--\n            pattern : 拦截的url\n            access : 拥有如下权限允许访问\n        --&amp;gt;\n        &amp;lt;intercept-url pattern=&amp;quot;/**&amp;quot; access=&amp;quot;ROLE_USER&amp;quot; /&amp;gt;\n        &amp;lt;!--\n            login-page : 自定义登陆页面\n            default-target-url : 登陆成功后跳转的页面,不设定默认跳转上一次访问的页面\n            authentication-failure-url : 登陆失败时跳转的url\n            always-use-default-target : 登陆成功后 总是跳转到 default-target-url 设定的url\n        --&amp;gt;\n        &amp;lt;form-login login-processing-url=&amp;quot;/login&amp;quot; login-page=&amp;quot;/shoplogin.html&amp;quot;  default-target-url=&amp;quot;/admin/index.html&amp;quot; authentication-failure-url=&amp;quot;/shoplogin.html&amp;quot; always-use-default-target=&amp;quot;true&amp;quot;/&amp;gt;\n        &amp;lt;csrf disabled=&amp;quot;true&amp;quot;/&amp;gt;\n\n        &amp;lt;!--\n            logout-url : 退出的地址\n            logout-success-url : 退出后跳转的地址\n        --&amp;gt;\n        &amp;lt;logout logout-url=&amp;quot;/logout&amp;quot; logout-success-url=&amp;quot;/shoplogin.html&amp;quot;/&amp;gt;\n        &amp;lt;!--\n            如果使用了iframe,需要指定框架页的策略为 SAMEORIGIN\n        --&amp;gt;\n        &amp;lt;headers&amp;gt;\n            &amp;lt;frame-options policy=&amp;quot;SAMEORIGIN&amp;quot;/&amp;gt;  &amp;lt;!--允许使用frameset --&amp;gt;\n        &amp;lt;/headers&amp;gt;\n    &amp;lt;/http&amp;gt;\n\n    &amp;lt;!--认证管理器--&amp;gt;\n    &amp;lt;authentication-manager&amp;gt;\n        &amp;lt;authentication-provider user-service-ref=&amp;quot;userDetailsServiceImpl&amp;quot;/&amp;gt;\n    &amp;lt;/authentication-manager&amp;gt;\n\n    &amp;lt;!-- 引用dubbo 服务 --&amp;gt;\n    &amp;lt;dubbo:application name=&amp;quot;jd-shop-web&amp;quot; /&amp;gt;\n    &amp;lt;dubbo:registry address=&amp;quot;zookeeper://47.98.157.69:2181&amp;quot; timeout=&amp;quot;30000&amp;quot;/&amp;gt;\n    &amp;lt;dubbo:annotation package=&amp;quot;com.jd.shop.controller&amp;quot; /&amp;gt;\n    \n    &amp;lt;dubbo:reference interface=&amp;quot;com.jd.sellergoods.service.TbSellerService&amp;quot; id=&amp;quot;tbSellerService&amp;quot;/&amp;gt;\n\n    &amp;lt;beans:bean id=&amp;quot;userDetailsServiceImpl&amp;quot; class=&amp;quot;com.jd.shop.service.impl.UserDetailsServiceImpl&amp;quot;&amp;gt;\n        &amp;lt;beans:property name=&amp;quot;tbSellerService&amp;quot; ref=&amp;quot;tbSellerService&amp;quot;/&amp;gt;\n    &amp;lt;/beans:bean&amp;gt;\n\n&amp;lt;/beans:beans&amp;gt;\n\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;4.配置web.xml文件&lt;/p&gt;\n&lt;h2 id=\&#34;brcy加密\&#34;&gt;Brcy加密&lt;/h2&gt;\n&lt;p&gt;1.编写java&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;BCryptPasswordEncoder passwordEncoder = new BCryptPasswordEncoder();\nString encode = passwordEncoder.encode(tbSeller.getPassword());\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;2.编写配置文件&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-xml\&#34;&gt;&amp;lt;!--认证管理器--&amp;gt;\n&amp;lt;authentication-manager&amp;gt;\n    &amp;lt;authentication-provider user-service-ref=&amp;quot;userDetailsServiceImpl&amp;quot;&amp;gt;\n        &amp;lt;!-- 这句话表示在登陆时使用bcry加密验证 --&amp;gt;\n        &amp;lt;password-encoder ref=&amp;quot;bCryptPasswordEncoder&amp;quot;/&amp;gt;\n    &amp;lt;/authentication-provider&amp;gt;\n&amp;lt;/authentication-manager&amp;gt;\n&amp;lt;!--配置加密,在认证管理器中引用--&amp;gt;\n&amp;lt;beans:bean id=&amp;quot;bCryptPasswordEncoder&amp;quot; class=&amp;quot;org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder&amp;quot;/&amp;gt;\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h2 id=\&#34;记住我\&#34;&gt;记住我&lt;/h2&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-html\&#34;&gt;&amp;lt;input value=&amp;quot;1&amp;quot; name=&amp;quot;remember-me&amp;quot;/&amp;gt;\n\n&lt;/code&gt;&lt;/pre&gt;\n&#34;,&#34;fileName&#34;:&#34;spring-security&#34;,&#34;abstract&#34;:&#34;&lt;h2 id=\&#34;spring-security简介\&#34;&gt;Spring Security简介&lt;/h2&gt;\n&lt;blockquote&gt;\n&lt;p&gt;Spring Security是一个能够为基于Spring的企业应用系统提供声明式的安全访问控制解决方案的安全框架。它提供了一组可以在Spring应用上下文中配置的Bean，充分利用了Spring IoC，DI（控制反转Inversion of Control ,DI:Dependency Injection 依赖注入）和AOP（面向切面编程）功能，为应用系统提供声明式的安全访问控制功能，减少了为企业系统安全控制编写大量重复代码的工作。&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;h2 id=\&#34;单机版\&#34;&gt;单机版&lt;/h2&gt;\n&lt;p&gt;1.引入依赖&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-xml\&#34;&gt; &amp;lt;!-- 身份验证 --&amp;gt;\n&amp;lt;dependency&amp;gt;\n    &amp;lt;groupId&amp;gt;org.springframework.security&amp;lt;/groupId&amp;gt;\n    &amp;lt;artifactId&amp;gt;spring-security-web&amp;lt;/artifactId&amp;gt;\n&amp;lt;/dependency&amp;gt;\n&amp;lt;dependency&amp;gt;\n    &amp;lt;groupId&amp;gt;org.springframework.security&amp;lt;/groupId&amp;gt;\n    &amp;lt;artifactId&amp;gt;spring-security-config&amp;lt;/artifactId&amp;gt;\n&amp;lt;/dependency&amp;gt;\n&lt;/code&gt;&lt;/pre&gt;\n&#34;,&#34;title&#34;:&#34;Spring-Security&#34;,&#34;tags&#34;:[{&#34;name&#34;:&#34;spring-security&#34;,&#34;slug&#34;:&#34;YYffL2EXa&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://haohanya.github.io/tag/YYffL2EXa/&#34;},{&#34;name&#34;:&#34;spring&#34;,&#34;slug&#34;:&#34;POgCfBu13Z&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://haohanya.github.io/tag/POgCfBu13Z/&#34;}],&#34;date&#34;:&#34;2020-05-04 12:14:24&#34;,&#34;dateFormat&#34;:&#34;2020-05-04&#34;,&#34;feature&#34;:&#34;&#34;,&#34;link&#34;:&#34;https://haohanya.github.io/post/spring-security/&#34;,&#34;hideInList&#34;:false,&#34;isTop&#34;:false,&#34;stats&#34;:{&#34;text&#34;:&#34;10 min read&#34;,&#34;time&#34;:540000,&#34;words&#34;:1682,&#34;minutes&#34;:10},&#34;description&#34;:&#34;Spring Security简介\n\nSpring Security是一个能够为基于Spring的企业应用系统提供声明式的安全访问控制解决方案的安全框架。它提供了一组可以在Spring应用上下文中配置的Bean，充分利用了Spring Io...&#34;,&#34;toc&#34;:&#34;&lt;ul class=\&#34;markdownIt-TOC\&#34;&gt;\n&lt;li&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#spring-security%E7%AE%80%E4%BB%8B\&#34;&gt;Spring Security简介&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E5%8D%95%E6%9C%BA%E7%89%88\&#34;&gt;单机版&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E8%BF%9E%E6%8E%A5%E6%95%B0%E6%8D%AE%E5%BA%93\&#34;&gt;连接数据库&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#brcy%E5%8A%A0%E5%AF%86\&#34;&gt;Brcy加密&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E8%AE%B0%E4%BD%8F%E6%88%91\&#34;&gt;记住我&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;/ul&gt;\n&#34;},{&#34;content&#34;:&#34;&lt;h1 id=\&#34;快速开始\&#34;&gt;快速开始&lt;/h1&gt;\n&lt;h2 id=\&#34;1-mybatis核心配置文件\&#34;&gt;1、MyBatis核心配置文件&lt;/h2&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-xml\&#34;&gt;&amp;lt;?xml version=&amp;quot;1.0&amp;quot; encoding=&amp;quot;UTF-8&amp;quot; ?&amp;gt;\n&amp;lt;!DOCTYPE configuration\n  PUBLIC &amp;quot;-//mybatis.org//DTD Config 3.0//EN&amp;quot;\n  &amp;quot;http://mybatis.org/dtd/mybatis-3-config.dtd&amp;quot;&amp;gt;\n&amp;lt;configuration&amp;gt;\n  &amp;lt;!-- 配置数据源 --&amp;gt;\n  &amp;lt;environments default=&amp;quot;development&amp;quot;&amp;gt;\n    &amp;lt;environment id=&amp;quot;development&amp;quot;&amp;gt;\n     &amp;lt;!--事务处理方式--&amp;gt;\n      &amp;lt;transactionManager type=&amp;quot;JDBC&amp;quot;/&amp;gt;\n      &amp;lt;dataSource type=&amp;quot;POOLED&amp;quot;&amp;gt;\n        &amp;lt;property name=&amp;quot;driver&amp;quot; value=&amp;quot;com.mysql.jdbc.Driver&amp;quot;/&amp;gt;\n        &amp;lt;property name=&amp;quot;url&amp;quot; value=&amp;quot;jdbc:mysql://localhost:3306/mybatis&amp;quot;/&amp;gt;\n        &amp;lt;property name=&amp;quot;username&amp;quot; value=&amp;quot;root&amp;quot;/&amp;gt;\n        &amp;lt;property name=&amp;quot;password&amp;quot; value=&amp;quot;root&amp;quot;/&amp;gt;\n      &amp;lt;/dataSource&amp;gt;\n    &amp;lt;/environment&amp;gt;\n  &amp;lt;/environments&amp;gt;\n&amp;lt;!--映射器：每一个Mapper接口都应该在核心配置文件&amp;lt;mappers&amp;gt;标签中注册--&amp;gt;\n  &amp;lt;mappers&amp;gt;\n  \t&amp;lt;!--使用XML配置文件注册--&amp;gt;\n    &amp;lt;mapper resource=&amp;quot;com/cn/mybatis/dao/IcpInfoMapper.xml&amp;quot;/&amp;gt;\n    &amp;lt;!--使用类注册方式--&amp;gt;\n    &amp;lt;mapper class=&amp;quot;com.cn.mybatis.dao.IcpInfoMapper&amp;quot; /&amp;gt;\n  &amp;lt;/mappers&amp;gt;\n&amp;lt;/configuration&amp;gt;\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h2 id=\&#34;2-orm映射文件mapperxml\&#34;&gt;2、ORM映射文件mapper.xml&lt;/h2&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-xml\&#34;&gt;&amp;lt;?xml version=&amp;quot;1.0&amp;quot; encoding=&amp;quot;UTF-8&amp;quot; ?&amp;gt;\n&amp;lt;!DOCTYPE mapper\n  PUBLIC &amp;quot;-//mybatis.org//DTD Mapper 3.0//EN&amp;quot;\n  &amp;quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&amp;quot;&amp;gt;\n&amp;lt;!-- 这个配置文件主要是配置实体类和数据库中的表映射关系 --&amp;gt;\n&amp;lt;!-- mapper：映射信息配置 namesapce:如果是在ibatis的开发中，名字可以随便取，但是在mybatis中将有特殊的意义 --&amp;gt;\n&amp;lt;mapper namespace=&amp;quot;test&amp;quot;&amp;gt;\n\t&amp;lt;!-- 查询所有的书籍信息 select:专门用于查询的statement\n\t     id:是statement的唯一标识符\n\t     resultType:返回值得类型（跟返回的个数无关），将返回类型的全限定名写到这里\n\t --&amp;gt;\n\t&amp;lt;select id=&amp;quot;selectAllBooks&amp;quot; resultType=&amp;quot;cn.kgc.pojo.Book&amp;quot;&amp;gt;\n\t\tselect * from book\n\t&amp;lt;/select&amp;gt;\n&amp;lt;/mapper&amp;gt;\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h2 id=\&#34;3-日志文件\&#34;&gt;3、日志文件&lt;/h2&gt;\n&lt;p&gt;&lt;code&gt;log4j.properties&lt;/code&gt;&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-properties\&#34;&gt;log4j.rootLogger=DEBUG,A1\nlog4j.logger.org.mybatis=DEBUG\nlog4j.appender.A1=org.apache.log4j.ConsoleAppender\nlog4j.appender.A1.layout=org.apache.log4j.PatternLayout\nlog4j.appender.A1.layout.ConversionPattern=%-d{yyyy-MM-dd HH:mm:ss,SSS} [%t] [%c]-[%p] %m%n\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h2 id=\&#34;4-测试\&#34;&gt;4、测试&lt;/h2&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;//查询全部\n@Test\npublic void testFindAll() throws Exception{\n    //通过流的方式读取配置文件\n    InputStream inputStream = Resources.getResourceAsStream(&amp;quot;mybatis-config.xml&amp;quot;);\n    //1.读取配置文件,得到SqlSessionFactory\n    SqlSessionFactory sqlSessionFactory = new SqlSessionFactoryBuilder().build(inputStream );\n    //2.创建SqlSession\n    SqlSession sqlSession = sqlSessionFactory.openSession();\n    //3.查询所有(参数：是namespace.statementId)\n    List&amp;lt;Book&amp;gt; list = sqlSession.selectList(&amp;quot;test.selectAllBooks&amp;quot;);\n    System.out.println(list);\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h1 id=\&#34;properties属性\&#34;&gt;properties属性&lt;/h1&gt;\n&lt;p&gt;创建一个外部的properties文件&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-properties\&#34;&gt;jdbc.dirver=com.mysql.jdbc.Driver\njdbc.url=jdbc:mysql://localhost:3306/mybatis?useUnicode=true&amp;amp;amp;characterEncoding=utf-8\njdbc.username=root\njdbc.password=root\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;在核心配置文件中引用properties文件&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-xml\&#34;&gt;&amp;lt;properties resource=&amp;quot;jdbc.properties&amp;quot;/&amp;gt;\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;使用&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-xml\&#34;&gt;${jdbc.dirver}\n${jdbc.url}\n${jdbc.username}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h1 id=\&#34;settings\&#34;&gt;settings&lt;/h1&gt;\n&lt;p&gt;&lt;code&gt;mapUnderscoreToCamelCase&lt;/code&gt;:开启驼峰命名，可以帮助我们完成数据库的经典命名规则，到java的经典命名规则（驼峰命名发）&lt;/p&gt;\n&lt;p&gt;如：数据库叫user_name  到java类（&lt;code&gt;pojo&lt;/code&gt;）中是&lt;code&gt;userName&lt;/code&gt;&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-xml\&#34;&gt;&amp;lt;settings&amp;gt;\n    &amp;lt;!-- 开启驼峰命名 --&amp;gt;\n    &amp;lt;setting name=&amp;quot;mapUnderscoreToCamelCase&amp;quot; value=&amp;quot;true&amp;quot;/&amp;gt;\n    &amp;lt;!--指定 MyBatis 所用日志的具体实现，未指定时将自动查找。\n\t日志类型：\n\tSTDOUT_LOGGING 不需要导入jar包，因为是mybatis自带\n\tNO_LOGGING 代表不需要日志输出\n\tSLF4J | LOG4J | LOG4J2 | JDK_LOGGING | COMMONS_LOGGING | STDOUT_LOGGING | NO_LOGGING\n \t--&amp;gt;\n    &amp;lt;setting name=&amp;quot;logImpl&amp;quot; value=&amp;quot;STDOUT_LOGGING&amp;quot;/&amp;gt;\n&amp;lt;/settings&amp;gt;\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;分析日志输出&lt;/p&gt;\n&lt;figure data-type=\&#34;image\&#34; tabindex=\&#34;1\&#34;&gt;&lt;img src=\&#34;MyBatis.assets%5Cimage-20200307124719177.png\&#34; alt=\&#34;image-20200307124719177\&#34; loading=\&#34;lazy\&#34;&gt;&lt;/figure&gt;\n&lt;h1 id=\&#34;typealiases类型别名\&#34;&gt;typeAliases（类型别名）&lt;/h1&gt;\n&lt;h2 id=\&#34;自定义别名\&#34;&gt;自定义别名&lt;/h2&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-xml\&#34;&gt;&amp;lt;!--别名，用于简化--&amp;gt;\n&amp;lt;typeAliases&amp;gt;\n    &amp;lt;!--type：包+类名，alias：别名--&amp;gt;\n    &amp;lt;typeAlias type=&amp;quot;com.cn.mybatis.entity.IcpInfo&amp;quot; alias=&amp;quot;Icp&amp;quot; /&amp;gt;\n    &amp;lt;!--使用包的方式\n\t\t每一个在包 domain.blog 中的 Java Bean，在没有注解的情况下\n\t\t会使用 Bean 的首字母小写的非限定类名来作为它的别名\n\t\t(这句话意思是：@Alias(&amp;quot;author&amp;quot;)\n\t\t在使用包方式时，javaBean没有添加注解指定别名时自动使用类名{首字母小写})\n\t--&amp;gt;\n    &amp;lt;package name=&amp;quot;com.cn.mybatis.entity&amp;quot;/&amp;gt;\n&amp;lt;/typeAliases&amp;gt;\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h1 id=\&#34;plugins插件\&#34;&gt;plugins（插件）&lt;/h1&gt;\n&lt;h1 id=\&#34;xml映射\&#34;&gt;XML映射&lt;/h1&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;code&gt;cache&lt;/code&gt; – 对给定命名空间的缓存配置。&lt;/li&gt;\n&lt;li&gt;&lt;code&gt;cache-ref&lt;/code&gt; – 对其他命名空间缓存配置的引用。&lt;/li&gt;\n&lt;li&gt;&lt;code&gt;resultMap&lt;/code&gt; – 是最复杂也是最强大的元素，用来描述如何从数据库结果集中来加载对象。&lt;/li&gt;\n&lt;li&gt;&lt;code&gt;parameterMap&lt;/code&gt; – 已被废弃！老式风格的参数映射。更好的办法是使用内联参数，此元素可能在将来被移除。文档中不会介绍此元素。&lt;/li&gt;\n&lt;li&gt;&lt;code&gt;sql&lt;/code&gt; – 可被其他语句引用的可重用语句块。&lt;/li&gt;\n&lt;li&gt;&lt;code&gt;insert&lt;/code&gt; – 映射插入语句&lt;/li&gt;\n&lt;li&gt;&lt;code&gt;update&lt;/code&gt; – 映射更新语句&lt;/li&gt;\n&lt;li&gt;&lt;code&gt;delete&lt;/code&gt; – 映射删除语句&lt;/li&gt;\n&lt;li&gt;&lt;code&gt;select&lt;/code&gt; – 映射查询语句&lt;/li&gt;\n&lt;/ul&gt;\n&lt;h2 id=\&#34;select-查询语句\&#34;&gt;select 查询语句&lt;/h2&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-xml\&#34;&gt;&amp;lt;!--\n\tid：一般和Mepper接口的方法名称相同，在命名空间中唯一的标识符，可以被用来引用这条语句。\n\tparameterType：接收一个int类型的参数\n\t\t接收参数使用#{ }包裹着，这个参数对应着接口的参数\n\tresultType：返回一个hashmap 类型的数据\n\n--&amp;gt;\n&amp;lt;select id=&amp;quot;selectPerson&amp;quot; parameterType=&amp;quot;int&amp;quot; resultType=&amp;quot;hashmap&amp;quot;&amp;gt;\n  SELECT * FROM PERSON WHERE ID = #{id}\n&amp;lt;/select&amp;gt;\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h2 id=\&#34;insert-updatea-delete\&#34;&gt;insert updatea delete&lt;/h2&gt;\n&lt;p&gt;在使用这些语句的时候需要提交事务：session.commit();&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-xml\&#34;&gt;&amp;lt;insert id=&amp;quot;addIcpInfo&amp;quot; parameterType=&amp;quot;icpInfo&amp;quot; &amp;gt;\n    insert into icpinfo (icp, name, address, home, introduce, author, email, date, type) values (#{icp}, #{name}, #{address}, #{home}, #{introduce}, #{author}, #{email}, #{date}, #{type})\n&amp;lt;/insert&amp;gt;\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;获取插入数据后的主键id：useGeneratedKeys=&amp;quot;true&amp;quot; keyProperty=&amp;quot;cip&amp;quot;&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-xml\&#34;&gt;&amp;lt;insert id=&amp;quot;addIcpInfo&amp;quot; useGeneratedKeys=&amp;quot;true&amp;quot; keyProperty=&amp;quot;cip&amp;quot;&amp;gt;\n    insert into icpinfo (icp, name, address, home, introduce, author, email, date, type) values (#{icp}, #{name}, #{address}, #{home}, #{introduce}, #{author}, #{email}, #{date}, #{type})\n&amp;lt;/insert&amp;gt;\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;插入多条数据：传入一个 数组或集合，并返回自动生成的主键。&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-xml\&#34;&gt;&amp;lt;insert id=&amp;quot;addIcpInfoList&amp;quot; useGeneratedKeys=&amp;quot;true&amp;quot; keyProperty=&amp;quot;cip&amp;quot;&amp;gt;\n    insert into icpinfo (icp, name, address, home, introduce, author, email, date, type) values\n    &amp;lt;foreach collection=&amp;quot;list&amp;quot; item=&amp;quot;item&amp;quot; separator=&amp;quot;,&amp;quot;&amp;gt;\n        (#{item.icp}, #{item.name}, #{item.address}, #{item.home}, #{item.introduce}, #{item.author}, #{item.email}, #{item.date}, #{item.type})\n    &amp;lt;/foreach&amp;gt;\n&amp;lt;/insert&amp;gt;\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h1 id=\&#34;动态sql\&#34;&gt;动态SQL&lt;/h1&gt;\n&lt;h2 id=\&#34;if\&#34;&gt;if&lt;/h2&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-xml\&#34;&gt;对于输入映射类型为pojo类型：\n#{pojo中的属性名}   ${pojo中的属性名}\n&amp;lt;if test=&amp;quot;gradeId != null&amp;quot;&amp;gt;\n    and grade_id = #{gradeId}\n&amp;lt;/if&amp;gt;\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h2 id=\&#34;sql注入的问题\&#34;&gt;sql注入的问题&lt;/h2&gt;\n&lt;p&gt;在使用${}会出现&lt;code&gt;sql&lt;/code&gt;注入的问题（拼接字符串，没有使用预编译）&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-xml\&#34;&gt;如果为简单数据类型需要把name换成_parameter\n&amp;lt;bind name=&amp;quot;n&amp;quot; value=&amp;quot;&#39;%&#39;+name+&#39;%&#39;&amp;quot;/&amp;gt;\nand name like #{n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h2 id=\&#34;when\&#34;&gt;when&lt;/h2&gt;\n&lt;p&gt;应用场景：可能查询全部，有可能根据条件查询，并且如果第一个条件前面有and，where子句会自动把这个and删除再作为sql语句运行&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-xml\&#34;&gt;&amp;lt;select id=&amp;quot;findStudentByLike&amp;quot; resultType=&amp;quot;student&amp;quot; parameterType=&amp;quot;student&amp;quot;&amp;gt;\n    select * from student\n    &amp;lt;where&amp;gt;\n        &amp;lt;if test=&amp;quot;name != null and name != &#39;&#39;&amp;quot;&amp;gt;\n            &amp;lt;bind name=&amp;quot;n&amp;quot; value=&amp;quot;&#39;%&#39;+name+&#39;%&#39;&amp;quot;/&amp;gt;\n            and name like #{n}\n        &amp;lt;/if&amp;gt;\n        &amp;lt;if test=&amp;quot;gradeId != null&amp;quot;&amp;gt;\n            and grade_id = #{gradeId}\n        &amp;lt;/if&amp;gt;\n    &amp;lt;/where&amp;gt;\n&amp;lt;/select&amp;gt;\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h2 id=\&#34;choose\&#34;&gt;choose&lt;/h2&gt;\n&lt;p&gt;其实就是java中的switch  或者 if...else if ...else&lt;/p&gt;\n&lt;h2 id=\&#34;set\&#34;&gt;set&lt;/h2&gt;\n&lt;p&gt;set标签作用：能自动的判断是否在sql语句的结尾处是否要添加逗号，如果不需要逗号它自动帮我们删除&lt;/p&gt;\n&lt;p&gt;(和where一样不会自动添加)&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-xml\&#34;&gt;&amp;lt;update id=&amp;quot;updateStudentByById&amp;quot; parameterType=&amp;quot;student&amp;quot;&amp;gt;\n    update student\n    &amp;lt;set&amp;gt;\n        &amp;lt;if test=&amp;quot;name != null&amp;quot;&amp;gt;\n            name = #{name},\n        &amp;lt;/if&amp;gt;\n        &amp;lt;if test=&amp;quot;gradeId != null&amp;quot;&amp;gt;\n            grade_id = #{gradeId}\n        &amp;lt;/if&amp;gt;\n    &amp;lt;/set&amp;gt;\n    where id = #{id}\n&amp;lt;/update&amp;gt;\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h2 id=\&#34;foreach\&#34;&gt;foreach&lt;/h2&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-xml\&#34;&gt;&amp;lt;select id=&amp;quot;findStudentsById&amp;quot; parameterType=&amp;quot;int&amp;quot; resultType=&amp;quot;student&amp;quot;&amp;gt;\n        select * from student where id in\n        &amp;lt;foreach collection=&amp;quot;list&amp;quot; open=&amp;quot;(&amp;quot; separator=&amp;quot;,&amp;quot; close=&amp;quot;)&amp;quot; item=&amp;quot;item&amp;quot;&amp;gt;\n            #{item}\n        &amp;lt;/foreach&amp;gt;\n    &amp;lt;/select&amp;gt;\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h1 id=\&#34;sql片段\&#34;&gt;SQL片段&lt;/h1&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-xml\&#34;&gt;&amp;lt;sql id=&amp;quot;sql&amp;quot;&amp;gt;\n    select * from student\n&amp;lt;/sql&amp;gt;\n调用\n&amp;lt;include refid=&amp;quot;sql&amp;quot;&amp;gt;&amp;lt;/include&amp;gt;\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h1 id=\&#34;多表联合查询\&#34;&gt;多表联合查询&lt;/h1&gt;\n&lt;h2 id=\&#34;vo\&#34;&gt;VO&lt;/h2&gt;\n&lt;p&gt;解决思路：要求返回的是一个对象，如果&lt;code&gt;pojo&lt;/code&gt;不能满足(要返回的列不存在&lt;code&gt;pojo&lt;/code&gt;中)，那么创建一个VO对象，这个VO对象中包含了所有要返回的字段&lt;/p&gt;\n&lt;h3 id=\&#34;创建一个vo\&#34;&gt;创建一个VO&lt;/h3&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;package cn.kgc.vo;\n\nimport cn.kgc.pojo.Student;\n//继承的原则：要返回的字段哪个pojo中多，那么就继承哪个pojo\npublic class StudentVO extends Student{\n\tprivate String gradeName;\n\n\tpublic String getGradeName() {\n\t\treturn gradeName;\n\t}\n\n\tpublic void setGradeName(String gradeName) {\n\t\tthis.gradeName = gradeName;\n\t}\t\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h3 id=\&#34;编写mapper接口\&#34;&gt;编写mapper接口&lt;/h3&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;public interface StudentMapper {\n\t/**\n\t * 查询学生信息，要求展示学生信息中年级名称(联合查询)\n\t */\n\tList&amp;lt;StudentVO&amp;gt; getStudentVO();\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h3 id=\&#34;编写mapperxml\&#34;&gt;编写mapper.xml&lt;/h3&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-xml\&#34;&gt;&amp;lt;select id=&amp;quot;getStudentVO&amp;quot; resultType=&amp;quot;cn.kgc.vo.StudentVO&amp;quot;&amp;gt;\n\tSELECT s.*,g.name gradeName FROM student s,grade g WHERE s.grade_id=g.id\n&amp;lt;/select&amp;gt;\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h2 id=\&#34;一对一\&#34;&gt;一对一&lt;/h2&gt;\n&lt;h3 id=\&#34;按照查询嵌套处理\&#34;&gt;按照查询嵌套处理&lt;/h3&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-xml\&#34;&gt;&amp;lt;resultMap id=&amp;quot;IcpInfoType&amp;quot; type=&amp;quot;icpInfo&amp;quot;&amp;gt;\n&amp;lt;!-- property：实体类的对象属性名，\n\tcolumn：数据库中关联的列，\n\tjavaType：实体类对象，\n\tselect：一个sql语句查询的是实体对象的sql\n--&amp;gt;\n    &amp;lt;association property=&amp;quot;type&amp;quot; column=&amp;quot;type&amp;quot; javaType=&amp;quot;type&amp;quot; select=&amp;quot;getTypeList&amp;quot; /&amp;gt;\n&amp;lt;/resultMap&amp;gt;\n&amp;lt;select id=&amp;quot;getList&amp;quot; resultMap=&amp;quot;IcpInfoType&amp;quot;&amp;gt;\n    select * from icpinfo\n&amp;lt;/select&amp;gt;\n&amp;lt;!--这个typeID 获取的是 column=&amp;quot;type&amp;quot; 这个列的值--&amp;gt;\n&amp;lt;select id=&amp;quot;getTypeList&amp;quot; resultType=&amp;quot;type&amp;quot; &amp;gt;\n    select * from type where tid = #{id}\n&amp;lt;/select&amp;gt;\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h3 id=\&#34;按照结果嵌套处理\&#34;&gt;按照结果嵌套处理&lt;/h3&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-xml\&#34;&gt;&amp;lt;select id=&amp;quot;getList2&amp;quot; resultMap=&amp;quot;getList2&amp;quot; &amp;gt;\n    select icp, name, address, home, introduce, author, email, `date`, type, tid, tname from icpinfo i ,type t\n    where i.type = t.tid\n&amp;lt;/select&amp;gt;\n&amp;lt;!--type = 要查询的对象--&amp;gt;\n&amp;lt;resultMap id=&amp;quot;getList2&amp;quot; type=&amp;quot;icpInfo&amp;quot; &amp;gt;\n    &amp;lt;!--property=实体类的属性名 column=列名or别名--&amp;gt;\n    &amp;lt;result property=&amp;quot;icp&amp;quot; column=&amp;quot;icp&amp;quot; /&amp;gt;\n    &amp;lt;result property=&amp;quot;name&amp;quot; column=&amp;quot;name&amp;quot; /&amp;gt;\n    &amp;lt;result property=&amp;quot;address&amp;quot; column=&amp;quot;address&amp;quot; /&amp;gt;\n    &amp;lt;result property=&amp;quot;home&amp;quot; column=&amp;quot;home&amp;quot; /&amp;gt;\n    &amp;lt;result property=&amp;quot;introduce&amp;quot; column=&amp;quot;introduce&amp;quot; /&amp;gt;\n    &amp;lt;result property=&amp;quot;author&amp;quot; column=&amp;quot;author&amp;quot; /&amp;gt;\n    &amp;lt;result property=&amp;quot;email&amp;quot; column=&amp;quot;email&amp;quot; /&amp;gt;\n    &amp;lt;result property=&amp;quot;date&amp;quot; column=&amp;quot;date&amp;quot; /&amp;gt;\n    &amp;lt;!--复杂类型\n\t\tproperty=在icpInfo里的属性是type\n\t\tjavaType=type的对象\n\t--&amp;gt;\n    &amp;lt;association property=&amp;quot;type&amp;quot; javaType=&amp;quot;type&amp;quot; &amp;gt;\n        &amp;lt;result property=&amp;quot;tid&amp;quot; column=&amp;quot;tid&amp;quot; /&amp;gt;\n        &amp;lt;result property=&amp;quot;tname&amp;quot; column=&amp;quot;tname&amp;quot; /&amp;gt;\n    &amp;lt;/association&amp;gt;\n&amp;lt;/resultMap&amp;gt;\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h2 id=\&#34;一对多\&#34;&gt;一对多&lt;/h2&gt;\n&lt;p&gt;一对多只需要把association换成&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-xml\&#34;&gt;&amp;lt;!--ofType=&amp;quot;&amp;quot;\n\t集合中的泛型信息\n--&amp;gt;\n&amp;lt;collection property=&amp;quot;&amp;quot; ofType=&amp;quot;&amp;quot;&amp;gt;&amp;lt;/collection&amp;gt;\n&lt;/code&gt;&lt;/pre&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-xml\&#34;&gt;&amp;lt;?xml version=&amp;quot;1.0&amp;quot; encoding=&amp;quot;UTF-8&amp;quot; ?&amp;gt;\n&amp;lt;!DOCTYPE mapper\n  PUBLIC &amp;quot;-//mybatis.org//DTD Mapper 3.0//EN&amp;quot;\n  &amp;quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&amp;quot;&amp;gt;\n&amp;lt;mapper namespace=&amp;quot;cn.kgc.mapper.GradeMapper&amp;quot;&amp;gt;\n\t&amp;lt;!-- 查询年级，把属于这个年级的所有学生查询出来 --&amp;gt;\n\t&amp;lt;resultMap type=&amp;quot;cn.kgc.pojo.Grade&amp;quot; id=&amp;quot;gradeStudentMap&amp;quot;&amp;gt;\n\t\t&amp;lt;id column=&amp;quot;id&amp;quot; property=&amp;quot;id&amp;quot; javaType=&amp;quot;int&amp;quot;/&amp;gt;\n\t\t&amp;lt;result column=&amp;quot;name&amp;quot; property=&amp;quot;name&amp;quot; javaType=&amp;quot;string&amp;quot;/&amp;gt;\n\t\t&amp;lt;!-- collection:一对多的映射关系\n\t\t\tproperty:表示一对多映射关系在pojo中的属性名\n\t\t\tofType:表示该集合的泛型的全限定名\n\t\t --&amp;gt;\n\t\t&amp;lt;collection property=&amp;quot;studentList&amp;quot; ofType=&amp;quot;cn.kgc.pojo.Student&amp;quot;&amp;gt;\n\t\t\t&amp;lt;id column=&amp;quot;sid&amp;quot; property=&amp;quot;id&amp;quot; javaType=&amp;quot;int&amp;quot;/&amp;gt;\n\t\t\t&amp;lt;result column=&amp;quot;sname&amp;quot; property=&amp;quot;name&amp;quot; javaType=&amp;quot;string&amp;quot;/&amp;gt;\n\t\t\t&amp;lt;!-- gradeid因为在grade中已经有了，所以不需要再配置 --&amp;gt;\n\t\t&amp;lt;/collection&amp;gt;\n\t&amp;lt;/resultMap&amp;gt;\n\t\n\t&amp;lt;select id=&amp;quot;getGradeById&amp;quot; parameterType=&amp;quot;int&amp;quot; resultMap=&amp;quot;gradeStudentMap&amp;quot;&amp;gt;\n\t\tSELECT \n\t\t  g.*,\n\t\t  s.id sid,\n\t\t  s.name sname\n\t\tFROM\n\t\t  grade g,\n\t\t  student s \n\t\tWHERE g.id = s.grade_id \n\t\t  AND g.id = #{id}\n\t&amp;lt;/select&amp;gt;\n&amp;lt;/mapper&amp;gt;\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h3 id=\&#34;多对多\&#34;&gt;多对多&lt;/h3&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-xml\&#34;&gt;&amp;lt;?xml version=&amp;quot;1.0&amp;quot; encoding=&amp;quot;UTF-8&amp;quot; ?&amp;gt;\n&amp;lt;!DOCTYPE mapper\n  PUBLIC &amp;quot;-//mybatis.org//DTD Mapper 3.0//EN&amp;quot;\n  &amp;quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&amp;quot;&amp;gt;\n&amp;lt;mapper namespace=&amp;quot;cn.kgc.mapper.StudentMapper&amp;quot;&amp;gt;\n\t&amp;lt;resultMap type=&amp;quot;cn.kgc.pojo.Student&amp;quot; id=&amp;quot;studentMap&amp;quot;&amp;gt;\n\t\t&amp;lt;id column=&amp;quot;id&amp;quot; property=&amp;quot;id&amp;quot; javaType=&amp;quot;int&amp;quot;/&amp;gt;\n\t\t&amp;lt;result column=&amp;quot;name&amp;quot; property=&amp;quot;name&amp;quot; javaType=&amp;quot;string&amp;quot;/&amp;gt;\n\t\t&amp;lt;result column=&amp;quot;grade_id&amp;quot; property=&amp;quot;gradeId&amp;quot; javaType=&amp;quot;int&amp;quot;/&amp;gt;\n\t\t&amp;lt;!-- 一对多的映射关系 --&amp;gt;\n\t\t&amp;lt;collection property=&amp;quot;studentCourseList&amp;quot; ofType=&amp;quot;cn.kgc.pojo.StudentCourse&amp;quot;&amp;gt;\n\t\t\t&amp;lt;id column=&amp;quot;scid&amp;quot; property=&amp;quot;id&amp;quot; javaType=&amp;quot;int&amp;quot;/&amp;gt;\n\t\t\t&amp;lt;!-- studentCourse和course是一对一的映射俄关系 --&amp;gt;\n\t\t\t&amp;lt;association property=&amp;quot;course&amp;quot; javaType=&amp;quot;cn.kgc.pojo.Course&amp;quot;&amp;gt;\n\t\t\t\t&amp;lt;id column=&amp;quot;cid&amp;quot; property=&amp;quot;id&amp;quot; javaType=&amp;quot;int&amp;quot;/&amp;gt;\n\t\t\t\t&amp;lt;result column=&amp;quot;cname&amp;quot; property=&amp;quot;name&amp;quot; javaType=&amp;quot;string&amp;quot;/&amp;gt;\n\t\t\t&amp;lt;/association&amp;gt;\n\t\t&amp;lt;/collection&amp;gt;\n\t&amp;lt;/resultMap&amp;gt;\n\n\t&amp;lt;select id=&amp;quot;getStudentById&amp;quot; parameterType=&amp;quot;int&amp;quot; resultMap=&amp;quot;studentMap&amp;quot;&amp;gt;\n\tSELECT \n\t  s.*,\n\t  sc.id scid,\n\t  c.id cid,\n\t  c.name cname \n\tFROM\n\t  student s,\n\t  student_course sc,\n\t  course c \n\tWHERE s.id = sc.sid \n\t  AND c.id = sc.cid \n\t  AND s.id = #{id}\n\t&amp;lt;/select&amp;gt;\n&amp;lt;/mapper&amp;gt;\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h1 id=\&#34;延迟加载\&#34;&gt;延迟加载&lt;/h1&gt;\n&lt;p&gt;什么是懒加载&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;懒加载：就是在需要数据的时候才加载，不需要数据的时候不加载，这样有利于系统性能的提升，这就是懒加载（也叫做延迟加载）\n\n好处：在关联查询的时候，根据需求进行关联查询，大大提高了数据库的查询性能。（单表的查询效率永远要比多表联合查询的效率高）\n\n坏处：因为需要用到数据的时候才去做查询，这样大批量的数据查询的时候等待时间会变得更长，造成用户的体验下降\n(select * from student)会把所有的学生的年级编号也在里面\n突然要查询年级信息，它底层操作是：根据年级id一个一个去执行查询\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h2 id=\&#34;使用association实现懒加载\&#34;&gt;使用&lt;code&gt;association&lt;/code&gt;实现懒加载&lt;/h2&gt;\n&lt;h3 id=\&#34;核心配置开启懒加载\&#34;&gt;核心配置开启懒加载&lt;/h3&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-xml\&#34;&gt; &amp;lt;settings&amp;gt;\n  \t&amp;lt;!-- 开启懒加载 --&amp;gt;\n  \t&amp;lt;setting name=&amp;quot;lazyLoadingEnabled&amp;quot; value=&amp;quot;true&amp;quot;/&amp;gt;\n  \t&amp;lt;!-- mybatis3.4.1之前默认值是true，需要设置为false（将积极加载改为消息加载也就是按需加载） --&amp;gt;\n  \t&amp;lt;setting name=&amp;quot;aggressiveLazyLoading&amp;quot; value=&amp;quot;false&amp;quot;/&amp;gt;\n  \t&amp;lt;!-- 因为我这里为了打印对象里信息的方便，所以都重写了toString方法，mybatis中默认是如果使用(equals,clone,hashCode,toString任意一个方法)那么就不再延迟加载 --&amp;gt;\n  \t&amp;lt;setting name=&amp;quot;lazyLoadTriggerMethods&amp;quot; value=&amp;quot;&amp;quot;/&amp;gt;\n  &amp;lt;/settings&amp;gt;\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;GradeMapper.xml&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-xml\&#34;&gt;&amp;lt;?xml version=&amp;quot;1.0&amp;quot; encoding=&amp;quot;UTF-8&amp;quot; ?&amp;gt;\n&amp;lt;!DOCTYPE mapper\n  PUBLIC &amp;quot;-//mybatis.org//DTD Mapper 3.0//EN&amp;quot;\n  &amp;quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&amp;quot;&amp;gt;\n&amp;lt;mapper namespace=&amp;quot;cn.kgc.mapper.GradeMapper&amp;quot;&amp;gt;\n\t&amp;lt;!-- 根据id查询年级对象 --&amp;gt;\n\t&amp;lt;select id=&amp;quot;getGradeById&amp;quot; parameterType=&amp;quot;int&amp;quot; resultType=&amp;quot;cn.kgc.pojo.Grade&amp;quot;&amp;gt;\n\t\tselect * from grade where id=#{id}\n\t&amp;lt;/select&amp;gt;\n&amp;lt;/mapper&amp;gt;\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;StudentMapper.xml&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-xml\&#34;&gt;&amp;lt;?xml version=&amp;quot;1.0&amp;quot; encoding=&amp;quot;UTF-8&amp;quot; ?&amp;gt;\n&amp;lt;!DOCTYPE mapper\n  PUBLIC &amp;quot;-//mybatis.org//DTD Mapper 3.0//EN&amp;quot;\n  &amp;quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&amp;quot;&amp;gt;\n&amp;lt;mapper namespace=&amp;quot;cn.kgc.mapper.StudentMapper&amp;quot;&amp;gt;\n\t\n\t&amp;lt;resultMap type=&amp;quot;cn.kgc.pojo.Student&amp;quot; id=&amp;quot;studentMap&amp;quot;&amp;gt;\n\t\t&amp;lt;id column=&amp;quot;id&amp;quot; property=&amp;quot;id&amp;quot; javaType=&amp;quot;int&amp;quot;/&amp;gt;\n\t\t&amp;lt;result column=&amp;quot;name&amp;quot; property=&amp;quot;name&amp;quot; javaType=&amp;quot;string&amp;quot;/&amp;gt;\n\t\t&amp;lt;!-- 一个学生对应一个年级：一对一的关系映射\n\t\t\t对于association方式的懒加载：\n\t\t\t\tselect:此处要求是根据年级的id查询年级对象的mapper接口中方法的全限定名\n\t\t\t\tcolumn:在数据库中表与表之间关系的外键\n\t\t --&amp;gt;\n\t\t&amp;lt;association property=&amp;quot;grade&amp;quot; javaType=&amp;quot;cn.kgc.pojo.Grade&amp;quot;\n\t\t\tselect=&amp;quot;cn.kgc.mapper.GradeMapper.getGradeById&amp;quot; column=&amp;quot;grade_id&amp;quot;&amp;gt;&amp;lt;/association&amp;gt;\n\t&amp;lt;/resultMap&amp;gt;\n\t\n\t&amp;lt;select id=&amp;quot;getAllStudents&amp;quot; resultMap=&amp;quot;studentMap&amp;quot;&amp;gt;\n\t\tselect * from student\n\t&amp;lt;/select&amp;gt;\n&amp;lt;/mapper&amp;gt;\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h2 id=\&#34;使用collection实现懒加载\&#34;&gt;使用&lt;code&gt;collection&lt;/code&gt;实现懒加载&lt;/h2&gt;\n&lt;h3 id=\&#34;核心配置开启懒加载-2\&#34;&gt;核心配置开启懒加载&lt;/h3&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-xml\&#34;&gt;&amp;lt;settings&amp;gt;\n&amp;lt;!-- 开启懒加载 --&amp;gt;\n&amp;lt;setting name=&amp;quot;lazyLoadingEnabled&amp;quot; value=&amp;quot;true&amp;quot;/&amp;gt;\n&amp;lt;!-- mybatis3.4.1之前默认值是true，需要设置为false（将积极加载改为消息加载也就是按需加载） --&amp;gt;\n&amp;lt;setting name=&amp;quot;aggressiveLazyLoading&amp;quot; value=&amp;quot;false&amp;quot;/&amp;gt;\n&amp;lt;!-- 因为我这里为了打印对象里信息的方便，所以都重写了toString方法，mybatis中默认是如果使用(equals,clone,hashCode,toString任意一个方法)那么就不再延迟加载 --&amp;gt;\n&amp;lt;setting name=&amp;quot;lazyLoadTriggerMethods&amp;quot; value=&amp;quot;&amp;quot;/&amp;gt;\n&amp;lt;/settings&amp;gt;\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;StudentMapper.xml&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-xml\&#34;&gt;&amp;lt;select id=&amp;quot;getStudentsByGradeId&amp;quot; parameterType=&amp;quot;int&amp;quot; resultType=&amp;quot;cn.kgc.pojo.Student&amp;quot;&amp;gt;\n    select * from student where grade_id=#{gradeId}\n&amp;lt;/select&amp;gt;\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;GradeMapper.xml&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-xml\&#34;&gt;&amp;lt;!-- 查询年级信息，有可能查询年级中所有的学生信息 --&amp;gt;\n&amp;lt;resultMap type=&amp;quot;cn.kgc.pojo.Grade&amp;quot; id=&amp;quot;gradeMap&amp;quot;&amp;gt;\n    &amp;lt;id column=&amp;quot;id&amp;quot; property=&amp;quot;id&amp;quot; javaType=&amp;quot;int&amp;quot;/&amp;gt;\n    &amp;lt;result column=&amp;quot;name&amp;quot; property=&amp;quot;name&amp;quot; javaType=&amp;quot;string&amp;quot;/&amp;gt;\n    &amp;lt;!-- 一对多的映射关系\n        select:根据年级编号查询学生列表的方法\n        column:就是grade的id（它就是grade表的主键）\n     --&amp;gt;\n    &amp;lt;collection property=&amp;quot;studentList&amp;quot; ofType=&amp;quot;cn.kgc.pojo.Student&amp;quot;\n        select=&amp;quot;cn.kgc.mapper.StudentMapper.getStudentsByGradeId&amp;quot; column=&amp;quot;id&amp;quot;&amp;gt;&amp;lt;/collection&amp;gt;\n&amp;lt;/resultMap&amp;gt;\n&amp;lt;select id=&amp;quot;getAllGrades&amp;quot; resultMap=&amp;quot;gradeMap&amp;quot;&amp;gt;\n    select * from grade\n&amp;lt;/select&amp;gt;\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h1 id=\&#34;mybatis缓存\&#34;&gt;mybatis缓存&lt;/h1&gt;\n&lt;h2 id=\&#34;一级缓存\&#34;&gt;一级缓存&lt;/h2&gt;\n&lt;p&gt;它是&lt;code&gt;SqlSession&lt;/code&gt;级别的，同一个&lt;code&gt;SqlSession&lt;/code&gt;才涉及到一级缓存&lt;/p&gt;\n&lt;p&gt;一级缓存是默认存在，它不需要去做任何的设置&lt;/p&gt;\n&lt;h2 id=\&#34;二级缓存\&#34;&gt;二级缓存&lt;/h2&gt;\n&lt;p&gt;它是mapper级别的，需要开启才能使用&lt;/p&gt;\n&lt;blockquote&gt;\n&lt;p&gt;缓存在实际开发中是很有用的，它能大大的提升查询的效率，提高程序的性能&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;h3 id=\&#34;在核心配置文件中开启二级缓存\&#34;&gt;在核心配置文件中开启二级缓存&lt;/h3&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-xml\&#34;&gt;&amp;lt;!-- 开启二级缓存(默认值就是true，准备我们使用二级缓存，可以不用设置) --&amp;gt;\n&amp;lt;setting name=&amp;quot;cacheEnabled&amp;quot; value=&amp;quot;true&amp;quot;/&amp;gt;\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h3 id=\&#34;在mappexml中开启二级缓存\&#34;&gt;在mappe.xml中开启二级缓存&lt;/h3&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-xml\&#34;&gt;&amp;lt;mapper namespace=&amp;quot;cn.kgc.mapper.StudentMapper&amp;quot;&amp;gt;\n\t&amp;lt;!-- 在StudentMapper.xml中开启二级缓存 ,因为mybatis中二级缓存的实现类只有一个，默认就是这个，type可以省略不写--&amp;gt;\n\t&amp;lt;cache type=&amp;quot;org.apache.ibatis.cache.impl.PerpetualCache&amp;quot;&amp;gt;&amp;lt;/cache&amp;gt;\n&amp;lt;/mapper&amp;gt;\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h3 id=\&#34;pojo需要实现序列化接口\&#34;&gt;pojo需要实现序列化接口&lt;/h3&gt;\n&lt;p&gt;因为缓存的时候要将pojo流化然后存储在内存中，查询再取出&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;public class Student implements Serializable{\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;blockquote&gt;\n&lt;p&gt;补充：在mapper应用二级缓存后，默认是所有的查询方法都开启二级缓存，如果要某个查询不使用二级缓存可以添加&lt;code&gt;useCache=&amp;quot;false&amp;quot;&lt;/code&gt;&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;h1 id=\&#34;注解开发入门\&#34;&gt;注解开发入门&lt;/h1&gt;\n&lt;p&gt;在spring4.x开始就推荐我们使用注解，完全去取代xml的配置文件&lt;/p&gt;\n&lt;p&gt;目前最主流的开发方式就是：只使用注解，不再使用xml配置&lt;/p&gt;\n&lt;p&gt;mybatis注解方式的开发是一种未来的趋势,这种方式比传统的xml的开发要简单并且高效&lt;/p&gt;\n&lt;h2 id=\&#34;导入jar包\&#34;&gt;导入jar包&lt;/h2&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-xml\&#34;&gt;&amp;lt;dependencies&amp;gt;\n    &amp;lt;!-- mysql驱动 --&amp;gt;\n    &amp;lt;dependency&amp;gt;\n        &amp;lt;groupId&amp;gt;mysql&amp;lt;/groupId&amp;gt;\n        &amp;lt;artifactId&amp;gt;mysql-connector-java&amp;lt;/artifactId&amp;gt;\n        &amp;lt;version&amp;gt;5.1.38&amp;lt;/version&amp;gt;\n    &amp;lt;/dependency&amp;gt;\n    &amp;lt;!-- mybatis的核心包 --&amp;gt;\n    &amp;lt;dependency&amp;gt;\n        &amp;lt;groupId&amp;gt;org.mybatis&amp;lt;/groupId&amp;gt;\n        &amp;lt;artifactId&amp;gt;mybatis&amp;lt;/artifactId&amp;gt;\n        &amp;lt;version&amp;gt;3.4.6&amp;lt;/version&amp;gt;\n    &amp;lt;/dependency&amp;gt;\n    &amp;lt;!-- junit单元测试 --&amp;gt;\n    &amp;lt;dependency&amp;gt;\n        &amp;lt;groupId&amp;gt;junit&amp;lt;/groupId&amp;gt;\n        &amp;lt;artifactId&amp;gt;junit&amp;lt;/artifactId&amp;gt;\n        &amp;lt;version&amp;gt;4.12&amp;lt;/version&amp;gt;\n    &amp;lt;/dependency&amp;gt;\n    &amp;lt;!-- slf4j-log4j12  (slf4j:酸辣粉) --&amp;gt;\n    &amp;lt;dependency&amp;gt;\n        &amp;lt;groupId&amp;gt;org.slf4j&amp;lt;/groupId&amp;gt;\n        &amp;lt;artifactId&amp;gt;slf4j-log4j12&amp;lt;/artifactId&amp;gt;\n        &amp;lt;version&amp;gt;1.7.25&amp;lt;/version&amp;gt;\n    &amp;lt;/dependency&amp;gt;\n&amp;lt;/dependencies&amp;gt;\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h2 id=\&#34;配置文件\&#34;&gt;配置文件&lt;/h2&gt;\n&lt;p&gt;log4j.properties&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-properties\&#34;&gt;log4j.rootLogger=DEBUG,A1\nlog4j.logger.org.mybatis=DEBUG\nlog4j.appender.A1=org.apache.log4j.ConsoleAppender\nlog4j.appender.A1.layout=org.apache.log4j.PatternLayout\nlog4j.appender.A1.layout.ConversionPattern=%-d{yyyy-MM-dd HH:mm:ss,SSS} [%t] [%c]-[%p] %m%n\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;jdbc.properties&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-properties\&#34;&gt;jdbc.dirver=com.mysql.jdbc.Driver\njdbc.url=jdbc:mysql://localhost:3306/mybatis?useUnicode=true&amp;amp;amp;characterEncoding=utf-8\njdbc.username=root\njdbc.password=root\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;mybatis-config.xml&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-xml\&#34;&gt;&amp;lt;?xml version=&amp;quot;1.0&amp;quot; encoding=&amp;quot;UTF-8&amp;quot; ?&amp;gt;\n&amp;lt;!DOCTYPE configuration\n  PUBLIC &amp;quot;-//mybatis.org//DTD Config 3.0//EN&amp;quot;\n  &amp;quot;http://mybatis.org/dtd/mybatis-3-config.dtd&amp;quot;&amp;gt;\n&amp;lt;configuration&amp;gt;\n  &amp;lt;!-- 引入外部的属性文件 --&amp;gt;\n  &amp;lt;properties resource=&amp;quot;jdbc.properties&amp;quot;&amp;gt;&amp;lt;/properties&amp;gt;\n  &amp;lt;settings&amp;gt;\n  \t&amp;lt;!-- 开启驼峰命名 --&amp;gt;\n  \t&amp;lt;setting name=&amp;quot;mapUnderscoreToCamelCase&amp;quot; value=&amp;quot;true&amp;quot;/&amp;gt;\n  &amp;lt;/settings&amp;gt;\n  &amp;lt;!-- 配置数据源 --&amp;gt;\n  &amp;lt;environments default=&amp;quot;development&amp;quot;&amp;gt;\n    &amp;lt;environment id=&amp;quot;development&amp;quot;&amp;gt;\n      &amp;lt;transactionManager type=&amp;quot;JDBC&amp;quot;/&amp;gt;\n      &amp;lt;dataSource type=&amp;quot;POOLED&amp;quot;&amp;gt;\n        &amp;lt;property name=&amp;quot;driver&amp;quot; value=&amp;quot;${jdbc.dirver}&amp;quot;/&amp;gt;\n        &amp;lt;property name=&amp;quot;url&amp;quot; value=&amp;quot;${jdbc.url}&amp;quot;/&amp;gt;\n        &amp;lt;property name=&amp;quot;username&amp;quot; value=&amp;quot;${jdbc.username}&amp;quot;/&amp;gt;\n        &amp;lt;property name=&amp;quot;password&amp;quot; value=&amp;quot;${jdbc.password}&amp;quot;/&amp;gt;\n      &amp;lt;/dataSource&amp;gt;\n    &amp;lt;/environment&amp;gt;\n  &amp;lt;/environments&amp;gt;\n  &amp;lt;mappers&amp;gt;\n    &amp;lt;package name=&amp;quot;cn.kgc.mapper&amp;quot;/&amp;gt;\n  &amp;lt;/mappers&amp;gt;\n  \n&amp;lt;/configuration&amp;gt;\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;@Select(&amp;quot;SQL&amp;quot;)&lt;/p&gt;\n&lt;p&gt;@Insert(&amp;quot;SQL&amp;quot;)&lt;/p&gt;\n&lt;p&gt;@Delete(&amp;quot;SQL&amp;quot;)&lt;/p&gt;\n&lt;p&gt;@Update(&amp;quot;SQL&amp;quot;)&lt;/p&gt;\n&lt;h2 id=\&#34;解决数据库表中的列名和pojo中属性名不一致\&#34;&gt;解决数据库表中的列名和pojo中属性名不一致&lt;/h2&gt;\n&lt;h3 id=\&#34;第一种\&#34;&gt;第一种&lt;/h3&gt;\n&lt;p&gt;给sql 语句起别名&lt;/p&gt;\n&lt;h3 id=\&#34;第二种\&#34;&gt;第二种&lt;/h3&gt;\n&lt;p&gt;@Results  相当于是&lt;code&gt;resultMap&lt;/code&gt;&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;@Select(&amp;quot;select * from book&amp;quot;)\n@Results(id=&amp;quot;bookMap&amp;quot;,\n    value={\n        @Result(id=true,column=&amp;quot;id&amp;quot;,property=&amp;quot;id&amp;quot;),\n        @Result(column=&amp;quot;book_name&amp;quot;,property=&amp;quot;name&amp;quot;),\n        @Result(column=&amp;quot;price&amp;quot;,property=&amp;quot;price&amp;quot;)\n})\nList&amp;lt;Book&amp;gt; getAllBooks();\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h2 id=\&#34;注解开发中的动态sql\&#34;&gt;注解开发中的动态sql&lt;/h2&gt;\n&lt;h3 id=\&#34;输入映射类型为简单类型\&#34;&gt;输入映射类型为简单类型&lt;/h3&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;/**\n * 有可能查询全部，有可能根据id查询\n * 动态sql中输入映射为简单类型，输入映射为简单类型  test中变量名必须叫_parameter\n */\n@Select(&amp;quot;&amp;lt;script&amp;gt;SELECT * FROM book &amp;lt;if test=&#39;_parameter != null&#39;&amp;gt;WHERE id=#{id}&amp;lt;/if&amp;gt;&amp;lt;/script&amp;gt;&amp;quot;)\nList&amp;lt;Book&amp;gt; getBooksOrById(Integer id);\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h3 id=\&#34;输入映射类型为pojo\&#34;&gt;输入映射类型为pojo&lt;/h3&gt;\n&lt;p&gt;开发产生SQL语句的类和方法&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;package cn.kgc.sql.provider;\n\nimport cn.kgc.pojo.Book;\n\npublic class BookMapperProvider {\n\t/**\n\t * 专门用来给BookMapper接口来提供动态sql语句的\n\t * @param book\n\t * @return\n\t */\n\tpublic String getBooks(Book book){\n\t\tString sql = &amp;quot;select * from book&amp;quot;;\n\t\tif(book != null){\n\t\t\tif(book.getId() != null){\n\t\t\t\t//id有值\n\t\t\t\tsql = &amp;quot;select * from book where id=#{id}&amp;quot;;\n\t\t\t}\n\t\t\tif(book.getName() != null &amp;amp;&amp;amp; !book.getName().equals(&amp;quot;&amp;quot;)){\n\t\t\t\tsql = &amp;quot;select * from book where name like #{name}&amp;quot;;\n\t\t\t}\n\t\t\tif(book.getId() != null &amp;amp;&amp;amp; (book.getName() != null &amp;amp;&amp;amp; !book.getName().equals(&amp;quot;&amp;quot;))){\n\t\t\t\tsql = &amp;quot;select * from book where id=#{id} and name like #{name}&amp;quot;;\n\t\t\t}\n\t\t}\n\t\treturn sql;\n\t}\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;接口&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;/**\n * 查询：有可能查询全部，有可能根据id查询，有可能根据name做模糊查询\n * @param book\n * @return\n */\n@SelectProvider(type=BookMapperProvider.class,method=&amp;quot;getBooks&amp;quot;)\nList&amp;lt;Book&amp;gt; getBooks(Book book);\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h2 id=\&#34;注解开发实现复杂的映射关系\&#34;&gt;注解开发实现复杂的映射关系&lt;/h2&gt;\n&lt;p&gt;复杂的映射开发本质是两种一对一、一对多&lt;/p&gt;\n&lt;p&gt;注解就对应的是：@One(一对一)  @Many(一对多)&lt;/p&gt;\n&lt;p&gt;要求我们使用懒加载&lt;/p&gt;\n&lt;h3 id=\&#34;一对一关系\&#34;&gt;一对一关系&lt;/h3&gt;\n&lt;p&gt;在核心配置文件中开启懒加载&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-xml\&#34;&gt; &amp;lt;settings&amp;gt;\n  \t&amp;lt;!-- 开启驼峰命名 --&amp;gt;\n  \t&amp;lt;setting name=&amp;quot;mapUnderscoreToCamelCase&amp;quot; value=&amp;quot;true&amp;quot;/&amp;gt;\n  \t&amp;lt;!-- 开启懒加载 --&amp;gt;\n  \t&amp;lt;setting name=&amp;quot;lazyLoadingEnabled&amp;quot; value=&amp;quot;true&amp;quot;/&amp;gt;\n  \t&amp;lt;!-- mybatis3.4.1之前默认值是true，需要设置为false（将积极加载改为消息加载也就是按需加载） --&amp;gt;\n  \t&amp;lt;setting name=&amp;quot;aggressiveLazyLoading&amp;quot; value=&amp;quot;false&amp;quot;/&amp;gt;\n  \t&amp;lt;!-- 因为我这里为了打印对象里信息的方便，所以都重写了toString方法，mybatis中默认是如果使用(equals,clone,hashCode,toString任意一个方法)那么就不再延迟加载 --&amp;gt;\n  \t&amp;lt;setting name=&amp;quot;lazyLoadTriggerMethods&amp;quot; value=&amp;quot;&amp;quot;/&amp;gt;\n  &amp;lt;/settings&amp;gt;\n&lt;/code&gt;&lt;/pre&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;public interface GradeMapper {\n\t/**\n\t * 根据id查询对象\n\t * @param id\n\t * @return\n\t */\n\t@Select(&amp;quot;select * from grade where id=#{id}&amp;quot;)\n\tGrade getGradeById(Integer id);\n}\n\n&lt;/code&gt;&lt;/pre&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;public interface StudentMapper {\n\t/**\n\t * 查询学生顺便将学生所在的年级名称查询出来\n\t */\n\t@Select(&amp;quot;select * from student&amp;quot;)\n\t@Results(id=&amp;quot;studentMap&amp;quot;,\n\t\t\tvalue={\n\t\t\t@Result(id=true,column=&amp;quot;id&amp;quot;,property=&amp;quot;id&amp;quot;),\n\t\t\t@Result(column=&amp;quot;name&amp;quot;,property=&amp;quot;name&amp;quot;),\n\t\t\t@Result(column=&amp;quot;grade_id&amp;quot;,property=&amp;quot;grade&amp;quot;,\n\t\t\t\t\tone=@One(select=&amp;quot;cn.kgc.mapper.GradeMapper.getGradeById&amp;quot;,fetchType=FetchType.LAZY))\n\t\t\t\n\t})\n\tList&amp;lt;Student&amp;gt; getAllStudents();\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;blockquote&gt;\n&lt;p&gt;FetchType.LAZY表示加载的方式是懒加载,   FetchType.EAGER表示一定联合查询&lt;/p&gt;\n&lt;p&gt;如果不添加fetchType，默认就是懒加载&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;h2 id=\&#34;一对多的关系\&#34;&gt;一对多的关系&lt;/h2&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;public interface StudentMapper {\n\t/**\n\t * 根据年级编号查询学生列表\n\t * @param id\n\t * @return\n\t */\n\t@Select(&amp;quot;select * from student where grade_id=#{gid}&amp;quot;)\n\tList&amp;lt;Student&amp;gt; findStudentsListByGradeId(Integer id);\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;package cn.kgc.mapper;\n\nimport java.util.List;\n\nimport org.apache.ibatis.annotations.Many;\nimport org.apache.ibatis.annotations.Result;\nimport org.apache.ibatis.annotations.Results;\nimport org.apache.ibatis.annotations.Select;\nimport org.apache.ibatis.mapping.FetchType;\n\nimport cn.kgc.pojo.Grade;\n\npublic interface GradeMapper {\n\n\t@Select(&amp;quot;select * from grade&amp;quot;)\n\t@Results(id=&amp;quot;gradeMap&amp;quot;,\n\t\t\tvalue={\n\t\t\t\t@Result(id=true,column=&amp;quot;id&amp;quot;,property=&amp;quot;id&amp;quot;),\n\t\t\t\t@Result(column=&amp;quot;name&amp;quot;,property=&amp;quot;name&amp;quot;),\n\t\t\t\t@Result(column=&amp;quot;id&amp;quot;,property=&amp;quot;studentList&amp;quot;,\n\t\t\t\t\t\tmany=@Many(select=&amp;quot;cn.kgc.mapper.StudentMapper.findStudentsListByGradeId&amp;quot;,fetchType=FetchType.LAZY))\n\t})\n\tList&amp;lt;Grade&amp;gt; getGrades();\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h2 id=\&#34;mybatis基于二级缓存的开发\&#34;&gt;mybatis基于二级缓存的开发&lt;/h2&gt;\n&lt;p&gt;一级缓存基于&lt;code&gt;sqlSession&lt;/code&gt;的，默认就存在的，咱们可以不用管，它一定会存在&lt;/p&gt;\n&lt;h3 id=\&#34;4-1-在核心配置文件中开启二级缓存\&#34;&gt;4-1 在核心配置文件中开启二级缓存&lt;/h3&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-xml\&#34;&gt;&amp;lt;!-- 开启二级缓存(新版本的mybatis默认就已经开启了，所以我们不用专门开) --&amp;gt;\n&amp;lt;setting name=&amp;quot;cacheEnabled&amp;quot; value=&amp;quot;true&amp;quot;/&amp;gt;\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h3 id=\&#34;4-2-在mapper接口中使用注解配置开启二级缓存\&#34;&gt;4-2 在mapper接口中使用注解配置开启二级缓存&lt;/h3&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-xml\&#34;&gt;&amp;lt;!-- 开启二级缓存(新版本的mybatis默认就已经开启了，所以我们不用专门开) --&amp;gt;\n&amp;lt;setting name=&amp;quot;cacheEnabled&amp;quot; value=&amp;quot;true&amp;quot;/&amp;gt;\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h3 id=\&#34;4-2-pojo需要实现序列化-接口\&#34;&gt;4-2 &lt;code&gt;pojo&lt;/code&gt;需要实现序列化 接口&lt;/h3&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;public class Book implements Serializable{\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h3 id=\&#34;4-3-mapper开启二级缓存\&#34;&gt;4-3 mapper开启二级缓存&lt;/h3&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;@CacheNamespace(blocking=true)\t\t//在mapper接口中开启二级缓存，默认是所有的查询都使用二级缓存\npublic interface BookMapper {\n    /**\n\t * 查询:根据主键查询\n\t * 同样准守：输入映射类型为简单类型 #{随便写}\n\t * 如果列名不一样,可以直接引用上面已经写好的@Results定义的列和pojo属性映射的关系，方式：@ResultMap(&amp;quot;@Results的id&amp;quot;)\n\t */\n\t@Select(&amp;quot;SELECT * FROM book WHERE id=#{id}&amp;quot;)\n\t@ResultMap(&amp;quot;bookMap&amp;quot;)\n\t//@Options(useCache=true)   //默认就是开启二级缓存，可以不用添加该注解\n\tBook getBookById(Integer id);\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h1 id=\&#34;分页查询\&#34;&gt;分页查询&lt;/h1&gt;\n&lt;h2 id=\&#34;添加分页插件的jar包依赖\&#34;&gt;添加分页插件的jar包依赖&lt;/h2&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-xml\&#34;&gt;&amp;lt;!-- pageHelper --&amp;gt;\n&amp;lt;dependency&amp;gt;\n    &amp;lt;groupId&amp;gt;com.github.pagehelper&amp;lt;/groupId&amp;gt;\n    &amp;lt;artifactId&amp;gt;pagehelper&amp;lt;/artifactId&amp;gt;\n    &amp;lt;version&amp;gt;5.1.6&amp;lt;/version&amp;gt;\n&amp;lt;/dependency&amp;gt;\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h2 id=\&#34;在核心配置文件中配置分页拦截器\&#34;&gt;在核心配置文件中配置分页拦截器&lt;/h2&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-xml\&#34;&gt;&amp;lt;!-- 添加分页插件 --&amp;gt;\n&amp;lt;plugins&amp;gt;\n&amp;lt;plugin interceptor=&amp;quot;com.github.pagehelper.PageInterceptor&amp;quot;&amp;gt;&amp;lt;/plugin&amp;gt;\n&amp;lt;/plugins&amp;gt;\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h2 id=\&#34;实现分页操作\&#34;&gt;实现分页操作&lt;/h2&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;/**\n * 分页查询:在实际开发中我们都会去使用分页插件来完成\n * pageHelper是国人做的分页插件，非常的优秀\n */\n@Test\npublic void testPage(){\n    //1.开始分页(参数一：当前要展示的页码(1,2..)，  参数二：每页显示的信息条数)\n    PageHelper.startPage(1, 3);\n    //2.执行查询(正常的执行)\n    BookExample example = new BookExample();\n    /*如果分页中有条件\n    Criteria criteria = example.createCriteria();\n    criteria.andNameLike(&amp;quot;%龙%&amp;quot;);\n    */\n    List&amp;lt;Book&amp;gt; list = bookMapper.selectByExample(example);\n    //3.分页就通过pageHelper拦截器来实现分页\n    PageInfo&amp;lt;Book&amp;gt; pageInfo = new PageInfo&amp;lt;Book&amp;gt;(list);\n    //一页信息\n    List&amp;lt;Book&amp;gt; bookList = pageInfo.getList();\n    for (Book book : bookList) {\n        System.out.println(book);\n    }\n    System.out.println(&amp;quot;总的页数：&amp;quot; + pageInfo.getPages());\n}\n&lt;/code&gt;&lt;/pre&gt;\n&#34;,&#34;fileName&#34;:&#34;mybatis&#34;,&#34;abstract&#34;:&#34;&#34;,&#34;title&#34;:&#34;MyBatis&#34;,&#34;tags&#34;:[{&#34;name&#34;:&#34;mybatis&#34;,&#34;slug&#34;:&#34;6pWqw4cF3&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://haohanya.github.io/tag/6pWqw4cF3/&#34;}],&#34;date&#34;:&#34;2020-05-04 12:13:12&#34;,&#34;dateFormat&#34;:&#34;2020-05-04&#34;,&#34;feature&#34;:&#34;&#34;,&#34;link&#34;:&#34;https://haohanya.github.io/post/mybatis/&#34;,&#34;hideInList&#34;:false,&#34;isTop&#34;:false,&#34;stats&#34;:{&#34;text&#34;:&#34;31 min read&#34;,&#34;time&#34;:1856000,&#34;words&#34;:6302,&#34;minutes&#34;:31},&#34;description&#34;:&#34;快速开始\n1、MyBatis核心配置文件\n&amp;lt;?xml version=&amp;quot;1.0&amp;quot; encoding=&amp;quot;UTF-8&amp;quot; ?&amp;gt;\n&amp;lt;!DOCTYPE configuration\n  PUBL...&#34;,&#34;toc&#34;:&#34;&lt;ul class=\&#34;markdownIt-TOC\&#34;&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E5%BF%AB%E9%80%9F%E5%BC%80%E5%A7%8B\&#34;&gt;快速开始&lt;/a&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#1-mybatis%E6%A0%B8%E5%BF%83%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6\&#34;&gt;1、MyBatis核心配置文件&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#2-orm%E6%98%A0%E5%B0%84%E6%96%87%E4%BB%B6mapperxml\&#34;&gt;2、ORM映射文件mapper.xml&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#3-%E6%97%A5%E5%BF%97%E6%96%87%E4%BB%B6\&#34;&gt;3、日志文件&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#4-%E6%B5%8B%E8%AF%95\&#34;&gt;4、测试&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#properties%E5%B1%9E%E6%80%A7\&#34;&gt;properties属性&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#settings\&#34;&gt;settings&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#typealiases%E7%B1%BB%E5%9E%8B%E5%88%AB%E5%90%8D\&#34;&gt;typeAliases（类型别名）&lt;/a&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E8%87%AA%E5%AE%9A%E4%B9%89%E5%88%AB%E5%90%8D\&#34;&gt;自定义别名&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#plugins%E6%8F%92%E4%BB%B6\&#34;&gt;plugins（插件）&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#xml%E6%98%A0%E5%B0%84\&#34;&gt;XML映射&lt;/a&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#select-%E6%9F%A5%E8%AF%A2%E8%AF%AD%E5%8F%A5\&#34;&gt;select 查询语句&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#insert-updatea-delete\&#34;&gt;insert updatea delete&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E5%8A%A8%E6%80%81sql\&#34;&gt;动态SQL&lt;/a&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#if\&#34;&gt;if&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#sql%E6%B3%A8%E5%85%A5%E7%9A%84%E9%97%AE%E9%A2%98\&#34;&gt;sql注入的问题&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#when\&#34;&gt;when&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#choose\&#34;&gt;choose&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#set\&#34;&gt;set&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#foreach\&#34;&gt;foreach&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#sql%E7%89%87%E6%AE%B5\&#34;&gt;SQL片段&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E5%A4%9A%E8%A1%A8%E8%81%94%E5%90%88%E6%9F%A5%E8%AF%A2\&#34;&gt;多表联合查询&lt;/a&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#vo\&#34;&gt;VO&lt;/a&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AAvo\&#34;&gt;创建一个VO&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E7%BC%96%E5%86%99mapper%E6%8E%A5%E5%8F%A3\&#34;&gt;编写mapper接口&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E7%BC%96%E5%86%99mapperxml\&#34;&gt;编写mapper.xml&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E4%B8%80%E5%AF%B9%E4%B8%80\&#34;&gt;一对一&lt;/a&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E6%8C%89%E7%85%A7%E6%9F%A5%E8%AF%A2%E5%B5%8C%E5%A5%97%E5%A4%84%E7%90%86\&#34;&gt;按照查询嵌套处理&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E6%8C%89%E7%85%A7%E7%BB%93%E6%9E%9C%E5%B5%8C%E5%A5%97%E5%A4%84%E7%90%86\&#34;&gt;按照结果嵌套处理&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E4%B8%80%E5%AF%B9%E5%A4%9A\&#34;&gt;一对多&lt;/a&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E5%A4%9A%E5%AF%B9%E5%A4%9A\&#34;&gt;多对多&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E5%BB%B6%E8%BF%9F%E5%8A%A0%E8%BD%BD\&#34;&gt;延迟加载&lt;/a&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E4%BD%BF%E7%94%A8association%E5%AE%9E%E7%8E%B0%E6%87%92%E5%8A%A0%E8%BD%BD\&#34;&gt;使用&lt;code&gt;association&lt;/code&gt;实现懒加载&lt;/a&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E6%A0%B8%E5%BF%83%E9%85%8D%E7%BD%AE%E5%BC%80%E5%90%AF%E6%87%92%E5%8A%A0%E8%BD%BD\&#34;&gt;核心配置开启懒加载&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E4%BD%BF%E7%94%A8collection%E5%AE%9E%E7%8E%B0%E6%87%92%E5%8A%A0%E8%BD%BD\&#34;&gt;使用&lt;code&gt;collection&lt;/code&gt;实现懒加载&lt;/a&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E6%A0%B8%E5%BF%83%E9%85%8D%E7%BD%AE%E5%BC%80%E5%90%AF%E6%87%92%E5%8A%A0%E8%BD%BD-2\&#34;&gt;核心配置开启懒加载&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#mybatis%E7%BC%93%E5%AD%98\&#34;&gt;mybatis缓存&lt;/a&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E4%B8%80%E7%BA%A7%E7%BC%93%E5%AD%98\&#34;&gt;一级缓存&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E4%BA%8C%E7%BA%A7%E7%BC%93%E5%AD%98\&#34;&gt;二级缓存&lt;/a&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E5%9C%A8%E6%A0%B8%E5%BF%83%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E4%B8%AD%E5%BC%80%E5%90%AF%E4%BA%8C%E7%BA%A7%E7%BC%93%E5%AD%98\&#34;&gt;在核心配置文件中开启二级缓存&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E5%9C%A8mappexml%E4%B8%AD%E5%BC%80%E5%90%AF%E4%BA%8C%E7%BA%A7%E7%BC%93%E5%AD%98\&#34;&gt;在mappe.xml中开启二级缓存&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#pojo%E9%9C%80%E8%A6%81%E5%AE%9E%E7%8E%B0%E5%BA%8F%E5%88%97%E5%8C%96%E6%8E%A5%E5%8F%A3\&#34;&gt;pojo需要实现序列化接口&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E6%B3%A8%E8%A7%A3%E5%BC%80%E5%8F%91%E5%85%A5%E9%97%A8\&#34;&gt;注解开发入门&lt;/a&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E5%AF%BC%E5%85%A5jar%E5%8C%85\&#34;&gt;导入jar包&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6\&#34;&gt;配置文件&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E8%A7%A3%E5%86%B3%E6%95%B0%E6%8D%AE%E5%BA%93%E8%A1%A8%E4%B8%AD%E7%9A%84%E5%88%97%E5%90%8D%E5%92%8Cpojo%E4%B8%AD%E5%B1%9E%E6%80%A7%E5%90%8D%E4%B8%8D%E4%B8%80%E8%87%B4\&#34;&gt;解决数据库表中的列名和pojo中属性名不一致&lt;/a&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E7%AC%AC%E4%B8%80%E7%A7%8D\&#34;&gt;第一种&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E7%AC%AC%E4%BA%8C%E7%A7%8D\&#34;&gt;第二种&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E6%B3%A8%E8%A7%A3%E5%BC%80%E5%8F%91%E4%B8%AD%E7%9A%84%E5%8A%A8%E6%80%81sql\&#34;&gt;注解开发中的动态sql&lt;/a&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E8%BE%93%E5%85%A5%E6%98%A0%E5%B0%84%E7%B1%BB%E5%9E%8B%E4%B8%BA%E7%AE%80%E5%8D%95%E7%B1%BB%E5%9E%8B\&#34;&gt;输入映射类型为简单类型&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E8%BE%93%E5%85%A5%E6%98%A0%E5%B0%84%E7%B1%BB%E5%9E%8B%E4%B8%BApojo\&#34;&gt;输入映射类型为pojo&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E6%B3%A8%E8%A7%A3%E5%BC%80%E5%8F%91%E5%AE%9E%E7%8E%B0%E5%A4%8D%E6%9D%82%E7%9A%84%E6%98%A0%E5%B0%84%E5%85%B3%E7%B3%BB\&#34;&gt;注解开发实现复杂的映射关系&lt;/a&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E4%B8%80%E5%AF%B9%E4%B8%80%E5%85%B3%E7%B3%BB\&#34;&gt;一对一关系&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E4%B8%80%E5%AF%B9%E5%A4%9A%E7%9A%84%E5%85%B3%E7%B3%BB\&#34;&gt;一对多的关系&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#mybatis%E5%9F%BA%E4%BA%8E%E4%BA%8C%E7%BA%A7%E7%BC%93%E5%AD%98%E7%9A%84%E5%BC%80%E5%8F%91\&#34;&gt;mybatis基于二级缓存的开发&lt;/a&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#4-1-%E5%9C%A8%E6%A0%B8%E5%BF%83%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E4%B8%AD%E5%BC%80%E5%90%AF%E4%BA%8C%E7%BA%A7%E7%BC%93%E5%AD%98\&#34;&gt;4-1 在核心配置文件中开启二级缓存&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#4-2-%E5%9C%A8mapper%E6%8E%A5%E5%8F%A3%E4%B8%AD%E4%BD%BF%E7%94%A8%E6%B3%A8%E8%A7%A3%E9%85%8D%E7%BD%AE%E5%BC%80%E5%90%AF%E4%BA%8C%E7%BA%A7%E7%BC%93%E5%AD%98\&#34;&gt;4-2 在mapper接口中使用注解配置开启二级缓存&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#4-2-pojo%E9%9C%80%E8%A6%81%E5%AE%9E%E7%8E%B0%E5%BA%8F%E5%88%97%E5%8C%96-%E6%8E%A5%E5%8F%A3\&#34;&gt;4-2 &lt;code&gt;pojo&lt;/code&gt;需要实现序列化 接口&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#4-3-mapper%E5%BC%80%E5%90%AF%E4%BA%8C%E7%BA%A7%E7%BC%93%E5%AD%98\&#34;&gt;4-3 mapper开启二级缓存&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E5%88%86%E9%A1%B5%E6%9F%A5%E8%AF%A2\&#34;&gt;分页查询&lt;/a&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E6%B7%BB%E5%8A%A0%E5%88%86%E9%A1%B5%E6%8F%92%E4%BB%B6%E7%9A%84jar%E5%8C%85%E4%BE%9D%E8%B5%96\&#34;&gt;添加分页插件的jar包依赖&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E5%9C%A8%E6%A0%B8%E5%BF%83%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E4%B8%AD%E9%85%8D%E7%BD%AE%E5%88%86%E9%A1%B5%E6%8B%A6%E6%88%AA%E5%99%A8\&#34;&gt;在核心配置文件中配置分页拦截器&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E5%AE%9E%E7%8E%B0%E5%88%86%E9%A1%B5%E6%93%8D%E4%BD%9C\&#34;&gt;实现分页操作&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;/ul&gt;\n&#34;},{&#34;content&#34;:&#34;&lt;h2 id=\&#34;获取class对象的方式\&#34;&gt;获取Class对象的方式&lt;/h2&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;Class.forName(&amp;quot;全类名&amp;quot;);//将字节码文件加载进内存，返回Class对象\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;多用于配置文件，将类名定义在配置文件中。读取文件，加载类&lt;br&gt;\n类名.class：通过类名的属性class获取&lt;br&gt;\n多用于参数的传递&lt;br&gt;\n对象.getClass()：getClass()方法在Object类中定义着。&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;//多用于对象的获取字节码的方式\nClass clazz = News.class;\nObject obj = clazz.newInstance();           //实例化一个对象：等同于 new 一个对象\nSystem.out.println(clazz.getSimpleName());  //获取类名\nSystem.out.println(clazz.getName());        //获取完整的包名+类名\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h2 id=\&#34;class对象功能\&#34;&gt;Class对象功能&lt;/h2&gt;\n&lt;h3 id=\&#34;获取成员变量\&#34;&gt;获取成员变量&lt;/h3&gt;\n&lt;p&gt;​        Field[] getFields() ：获取所有public修饰的成员变量&lt;/p&gt;\n&lt;p&gt;​\t\tField getField(String name)   获取指定名称的 public修饰的成员变量&lt;/p&gt;\n&lt;p&gt;​\t\tField[] getDeclaredFields();  //获取所有的成员变量，不考虑修饰符&lt;/p&gt;\n&lt;p&gt;​\t\tField getDeclaredField(String name); // 获取指定名称的成员变量，不考虑修饰符&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;Class clazz = News.class;\nSystem.out.println(clazz.getSimpleName());//获取类名\nSystem.out.println(clazz.getName());//获取包名+类名\nObject obj = clazz.newInstance();//实例化News的这个对象\nTable table = obj.getClass().getAnnotation(Table.class);//获取obj对象的Table注解，没有返回null\nSystem.out.println(table.value());\nField[] fields = clazz.getDeclaredFields();\nfor (Field field : fields) {\n\tfield.setAccessible(true);//暴力反射,如果不写这个将会报错\n    //获取属性的注解\n    //Field field1 = obj.getClass().getDeclaredField(field.getName());//获取obj对象的指定属性\n    PK pk = field.getAnnotation(PK.class);//获取属性的注解\n\n\tif(pk!=null){\n    \tSystem.out.println(field.getName()+&amp;quot;&amp;gt;&amp;gt;&amp;gt;&amp;quot;+pk);//获取属性名称\n    }\n        field.set(obj,null);//给当前clazz对象的field属性赋值为i\n        System.out.println(field.get(obj));//输出clazz对象的field的属性值\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h3 id=\&#34;获取构造方法\&#34;&gt;获取构造方法&lt;/h3&gt;\n&lt;p&gt;​\tConstructor&amp;lt;?&amp;gt;[] getConstructors()&lt;/p&gt;\n&lt;p&gt;​\tConstructor&lt;T&gt; getConstructor(类&amp;lt;?&amp;gt;... parameterTypes)&lt;/p&gt;\n&lt;p&gt;​\tConstructor&lt;T&gt; getDeclaredConstructor(类&amp;lt;?&amp;gt;... parameterTypes)&lt;/p&gt;\n&lt;p&gt;​\tConstructor&amp;lt;?&amp;gt;[] getDeclaredConstructors()&lt;/p&gt;\n&lt;h3 id=\&#34;获取成员方法\&#34;&gt;获取成员方法&lt;/h3&gt;\n&lt;p&gt;​\tMethod[] getMethods()&lt;/p&gt;\n&lt;p&gt;​\tMethod getMethod(String name, 类&amp;lt;?&amp;gt;... parameterTypes)&lt;/p&gt;\n&lt;p&gt;​\tMethod[] getDeclaredMethods()&lt;/p&gt;\n&lt;p&gt;​\tMethod getDeclaredMethod(String name, 类&amp;lt;?&amp;gt;... parameterTypes)&lt;/p&gt;\n&lt;h3 id=\&#34;field成员变量\&#34;&gt;Field：成员变量&lt;/h3&gt;\n&lt;p&gt;设置值&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;void set(Object obj, Object value)\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;获取值，传的是对象&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;get(Object obj) \n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;忽略访问权限修饰符的安全检查&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;setAccessible(true)\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h3 id=\&#34;constructor构造方法\&#34;&gt;Constructor:构造方法&lt;/h3&gt;\n&lt;p&gt;创建对象，如果使用空参数构造方法创建对象，操作可以简化：Class对象的newInstance方法&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;T newInstance(Object... initargs)\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h3 id=\&#34;method方法对象\&#34;&gt;Method：方法对象&lt;/h3&gt;\n&lt;p&gt;执行方法&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;Object invoke(Object obj, Object... args)\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;获取方法名称&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;String getName\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h2 id=\&#34;反射获取注解\&#34;&gt;反射获取注解&lt;/h2&gt;\n&lt;p&gt;获取obj对象的Table注解，没有返回null，obj是要获取的对象&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;Table table = obj.getClass().getAnnotation(Table.class);\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;获取属性的注解，获取obj对象的field.getName()的属性注解&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;Field field1 = obj.getClass().getDeclaredField(field.getName());//获取obj对象的指定属性\nPK pk = field1.getAnnotation(PK.class);//获取属性的注解\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h2 id=\&#34;获取当前调用的方法上的注解\&#34;&gt;获取当前调用的方法上的注解&lt;/h2&gt;\n&lt;pre&gt;&lt;code&gt;StackTraceElement[] stack = new Throwable().getStackTrace();\nMethod method = this.getClass().getMethod(stack[1].getMethodName());//这里0是当前方法的注解，1是调用者方法的注解\nfor(Annotation an : method.getAnnotations()){\n    System.out.println(an);\n}\n&lt;/code&gt;&lt;/pre&gt;\n&#34;,&#34;fileName&#34;:&#34;java-fan-she&#34;,&#34;abstract&#34;:&#34;&#34;,&#34;title&#34;:&#34;Java反射&#34;,&#34;tags&#34;:[{&#34;name&#34;:&#34;java&#34;,&#34;slug&#34;:&#34;CX9XCxDcJ&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://haohanya.github.io/tag/CX9XCxDcJ/&#34;}],&#34;date&#34;:&#34;2020-05-04 12:12:12&#34;,&#34;dateFormat&#34;:&#34;2020-05-04&#34;,&#34;feature&#34;:&#34;&#34;,&#34;link&#34;:&#34;https://haohanya.github.io/post/java-fan-she/&#34;,&#34;hideInList&#34;:false,&#34;isTop&#34;:false,&#34;stats&#34;:{&#34;text&#34;:&#34;4 min read&#34;,&#34;time&#34;:182000,&#34;words&#34;:703,&#34;minutes&#34;:4},&#34;description&#34;:&#34;获取Class对象的方式\nClass.forName(&amp;quot;全类名&amp;quot;);//将字节码文件加载进内存，返回Class对象\n\n多用于配置文件，将类名定义在配置文件中。读取文件，加载类\n类名.class：通过类名的属性class获...&#34;,&#34;toc&#34;:&#34;&lt;ul class=\&#34;markdownIt-TOC\&#34;&gt;\n&lt;li&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E8%8E%B7%E5%8F%96class%E5%AF%B9%E8%B1%A1%E7%9A%84%E6%96%B9%E5%BC%8F\&#34;&gt;获取Class对象的方式&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#class%E5%AF%B9%E8%B1%A1%E5%8A%9F%E8%83%BD\&#34;&gt;Class对象功能&lt;/a&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E8%8E%B7%E5%8F%96%E6%88%90%E5%91%98%E5%8F%98%E9%87%8F\&#34;&gt;获取成员变量&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E8%8E%B7%E5%8F%96%E6%9E%84%E9%80%A0%E6%96%B9%E6%B3%95\&#34;&gt;获取构造方法&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E8%8E%B7%E5%8F%96%E6%88%90%E5%91%98%E6%96%B9%E6%B3%95\&#34;&gt;获取成员方法&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#field%E6%88%90%E5%91%98%E5%8F%98%E9%87%8F\&#34;&gt;Field：成员变量&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#constructor%E6%9E%84%E9%80%A0%E6%96%B9%E6%B3%95\&#34;&gt;Constructor:构造方法&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#method%E6%96%B9%E6%B3%95%E5%AF%B9%E8%B1%A1\&#34;&gt;Method：方法对象&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E5%8F%8D%E5%B0%84%E8%8E%B7%E5%8F%96%E6%B3%A8%E8%A7%A3\&#34;&gt;反射获取注解&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E8%8E%B7%E5%8F%96%E5%BD%93%E5%89%8D%E8%B0%83%E7%94%A8%E7%9A%84%E6%96%B9%E6%B3%95%E4%B8%8A%E7%9A%84%E6%B3%A8%E8%A7%A3\&#34;&gt;获取当前调用的方法上的注解&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;/ul&gt;\n&#34;},{&#34;content&#34;:&#34;&lt;h2 id=\&#34;什么是fastdfs\&#34;&gt;什么是FastDFS&lt;/h2&gt;\n&lt;blockquote&gt;\n&lt;p&gt;FastDFS 是用 c 语言编写的一款开源的分布式文件系统。FastDFS 为互联网量身定制，充分考虑了冗余备份、负载均衡、线性扩容等机制，并注重高可用、高性能等指标，使用 FastDFS很容易搭建一套高性能的文件服务器集群提供文件上传、下载等服务。&lt;/p&gt;\n&lt;p&gt;FastDFS 架构包括 Tracker server 和 Storage server。客户端请求 Tracker server 进行文件上传、下载，通过 Tracker server 调度最终由 Storage server 完成文件上传和下载。&lt;/p&gt;\n&lt;p&gt;Tracker server 作用是负载均衡和调度，通过 Tracker server 在文件上传时可以根据一些策略找到 Storage server 提供文件上传服务。可以将 tracker 称为追踪服务器或调度服务器。&lt;/p&gt;\n&lt;p&gt;Storage server 作用是文件存储，客户端上传的文件最终存储在 Storage 服务器上，Storageserver 没有实现自己的文件系统而是利用操作系统 的文件系统来管理文件。可以将storage称为存储服务器。&lt;/p&gt;\n&lt;figure data-type=\&#34;image\&#34; tabindex=\&#34;1\&#34;&gt;&lt;img src=\&#34;https://haohanya.github.io/post-images/1589686914052.jpg\&#34; alt=\&#34;\&#34; loading=\&#34;lazy\&#34;&gt;&lt;/figure&gt;\n&lt;p&gt;服务端两个角色：&lt;/p&gt;\n&lt;p&gt;Tracker：管理集群，tracker 也可以实现集群。每个 tracker 节点地位平等。收集 Storage 集群的状态。&lt;/p&gt;\n&lt;p&gt;Storage：实际保存文件  Storage 分为多个组，每个组之间保存的文件是不同的。每个组内部可以有多个成员，组成员内部保存的内容是一样的，组成员的地位是一致的，没有主从的概念。&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;h2 id=\&#34;文件上传流程\&#34;&gt;文件上传流程&lt;/h2&gt;\n&lt;blockquote&gt;\n&lt;figure data-type=\&#34;image\&#34; tabindex=\&#34;2\&#34;&gt;&lt;img src=\&#34;https://haohanya.github.io/post-images/1589687036366.jpg\&#34; alt=\&#34;\&#34; loading=\&#34;lazy\&#34;&gt;&lt;/figure&gt;\n&lt;p&gt;客户端上传文件后存储服务器将文件 ID 返回给客户端，此文件 ID 用于以后访问该文件的索引信息。文件索引信息包括：组名，虚拟磁盘路径，数据两级目录，文件名。&lt;/p&gt;\n&lt;figure data-type=\&#34;image\&#34; tabindex=\&#34;3\&#34;&gt;&lt;img src=\&#34;https://haohanya.github.io/post-images/1589687044591.jpg\&#34; alt=\&#34;\&#34; loading=\&#34;lazy\&#34;&gt;&lt;/figure&gt;\n&lt;p&gt;&lt;strong&gt;组名&lt;/strong&gt;：文件上传后所在的 storage 组名称，在文件上传成功后有 storage 服务器返回，需要客户端自行保存。&lt;/p&gt;\n&lt;p&gt;&lt;strong&gt;虚拟磁盘路径&lt;/strong&gt;：storage 配置的虚拟路径，与磁盘选项 store_path*对应。如果配置了&lt;/p&gt;\n&lt;p&gt;store_path0 则是 M00，如果配置了 store_path1 则是 M01，以此类推。&lt;/p&gt;\n&lt;p&gt;&lt;strong&gt;数据两级目录&lt;/strong&gt;：storage 服务器在每个虚拟磁盘路径下创建的两级目录，用于存储数据&lt;/p&gt;\n&lt;p&gt;文件。&lt;/p&gt;\n&lt;p&gt;&lt;strong&gt;文件名&lt;/strong&gt;：与文件上传时不同。是由存储服务器根据特定信息生成，文件名包含：源存储&lt;/p&gt;\n&lt;p&gt;服务器 IP 地址、文件创建时间戳、文件大小、随机数和文件拓展名等信息。&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;h2 id=\&#34;文件下载流程\&#34;&gt;文件下载流程&lt;/h2&gt;\n&lt;figure data-type=\&#34;image\&#34; tabindex=\&#34;4\&#34;&gt;&lt;img src=\&#34;https://haohanya.github.io/post-images/1589687076743.jpg\&#34; alt=\&#34;\&#34; loading=\&#34;lazy\&#34;&gt;&lt;/figure&gt;\n&lt;h2 id=\&#34;0-准备安装包上传到usrlocal\&#34;&gt;0. 准备安装包上传到/usr/local/&lt;/h2&gt;\n&lt;p&gt;FastDFS_v5.05.tar.gz  （FastDFS安装包）&lt;/p&gt;\n&lt;p&gt;libfastcommonV1.0.7.tar.gz （FastDFS依赖程序）&lt;/p&gt;\n&lt;p&gt;nginx-1.8.0.tar.gz （nginx安装包，用于做文件请求http代理服务器）&lt;/p&gt;\n&lt;p&gt;fastdfs-nginx-module_v1.16.tar.gz （nginx和fastdfs的桥梁插件模块）&lt;/p&gt;\n&lt;h2 id=\&#34;1-安装cc编译环境\&#34;&gt;1. 安装c/c++编译环境&lt;/h2&gt;\n&lt;pre&gt;&lt;code&gt;yum install gcc-c++\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h2 id=\&#34;2-安装libevent\&#34;&gt;2. 安装libevent&lt;/h2&gt;\n&lt;pre&gt;&lt;code&gt;yum -y install libevent\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h2 id=\&#34;3-安装libfastcommon\&#34;&gt;3. 安装libfastcommon&lt;/h2&gt;\n&lt;p&gt;将&lt;code&gt;libfastcommonV1.0.7.tar.gz&lt;/code&gt;拷贝至&lt;code&gt;/usr/local/&lt;/code&gt;下&lt;/p&gt;\n&lt;pre&gt;&lt;code&gt;cd /usr/local\ntar -zxvf libfastcommonV1.0.7.tar.gz\ncd libfastcommon-1.0.7\n./make.sh\n./make.sh install\ncp /usr/lib64/libfastcommon.so /usr/lib\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h2 id=\&#34;4创建数据存储目录\&#34;&gt;4.创建数据存储目录&lt;/h2&gt;\n&lt;pre&gt;&lt;code&gt;mkdir -p /home/FastDFS/tracker /home/FastDFS/storage /home/FastDFS/client\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h2 id=\&#34;5-tracker编译安装\&#34;&gt;5. tracker编译安装&lt;/h2&gt;\n&lt;p&gt;将FastDFS_v5.05.tar.gz拷贝至/usr/local/下&lt;/p&gt;\n&lt;pre&gt;&lt;code&gt;tar -zxvf FastDFS_v5.05.tar.gz\ncd FastDFS\n./make.sh\n./make.sh install\ncd conf\ncp * /etc/fdfs\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h2 id=\&#34;6-编辑etcfdfstrackerconf\&#34;&gt;6. 编辑/etc/fdfs/tracker.conf&lt;/h2&gt;\n&lt;pre&gt;&lt;code&gt;vi /etc/fdfs/tracker.conf\n\tbase_path=/home/FastDFS/tracker\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h2 id=\&#34;7-启动tracker\&#34;&gt;7. 启动tracker&lt;/h2&gt;\n&lt;pre&gt;&lt;code&gt;/usr/bin/fdfs_trackerd /etc/fdfs/tracker.conf [restart](重启)\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h2 id=\&#34;8-配置storage节点\&#34;&gt;8. 配置storage节点&lt;/h2&gt;\n&lt;pre&gt;&lt;code&gt;vi /etc/fdfs/storage.conf\n    base_path=/home/FastDFS/storage\n    store_path0=/home/FastDFS/storage\n    tracker_server = 192.168.100.151:22122\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h2 id=\&#34;9-启动storage节点\&#34;&gt;9. 启动storage节点&lt;/h2&gt;\n&lt;pre&gt;&lt;code&gt;/usr/bin/fdfs_storage{fdfs_storaged} /etc/fdfs/storage.conf\nfdfs_storage不存在就使用fdfs_storaged\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h2 id=\&#34;10-安装nginx\&#34;&gt;10. 安装nginx&lt;/h2&gt;\n&lt;pre&gt;&lt;code&gt;yum install -y gcc-c++   (已安装)\nyum install -y pcre pcre-devel\nyum install -y zlib zlib-devel\nyum install -y openssl openssl-devel\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h2 id=\&#34;11解压fastdfs-nginx-module_v116targz\&#34;&gt;11.解压fastdfs-nginx-module_v1.16.tar.gz&lt;/h2&gt;\n&lt;pre&gt;&lt;code&gt;cd /usr/local/\ntar -zxf fastdfs-nginx-module_v1.16.tar.gz\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h2 id=\&#34;12修改fastdfs-nginx-modulesrcconfig配置文件\&#34;&gt;12.修改fastdfs-nginx-module/src/config配置文件&lt;/h2&gt;\n&lt;pre&gt;&lt;code&gt;vi fastdfs-nginx-module/src/config\n&lt;/code&gt;&lt;/pre&gt;\n&lt;blockquote&gt;\n&lt;p&gt;把CORE_INCS=&amp;quot;$CORE_INCS /usr/local/include/fastdfs /usr/include/fastcommon/&amp;quot;&lt;/p&gt;\n&lt;p&gt;修改为：CORE_INCS=&amp;quot;$CORE_INCS /usr/include/fastdfs /usr/include/fastcommon/&amp;quot;&lt;/p&gt;\n&lt;p&gt;把CORE_LIBS=&amp;quot;$CORE_LIBS -L/usr/local/lib -lfastcommon -lfdfsclient&amp;quot;&lt;/p&gt;\n&lt;p&gt;修改为：CORE_LIBS=&amp;quot;$CORE_LIBS -L/usr/lib -lfastcommon -lfdfsclient&amp;quot;&lt;/p&gt;\n&lt;p&gt;实际就是把路径中的local这一层删除掉&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;h2 id=\&#34;13复制fastdfs-nginx-modulesrcmod_fastdfsconf-到etcfdfs目录下并编辑\&#34;&gt;13.复制fastdfs-nginx-module/src/mod_fastdfs.conf 到/etc/fdfs目录下并编辑&lt;/h2&gt;\n&lt;pre&gt;&lt;code&gt;cp fastdfs-nginx-module/src/mod_fastdfs.conf /etc/fdfs/\n\tvi /etc/fdfs/mod_fastdfs.conf\n        tracker_server=192.168.100.151:22122\n        url_have_group_name = true\n        storage_server_port=23000\n        group_name=group1\n        store_path0=/home/FastDFS/storage\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h2 id=\&#34;14安装nginx\&#34;&gt;14.安装nginx&lt;/h2&gt;\n&lt;pre&gt;&lt;code&gt;cd /usr/local/\ntar -zxf  nginx-1.8.1.tar.gz\ncd nginx-1.8.1\n./configure --add-module=/usr/local/fastdfs-nginx-module/src/\nmake\nmake install\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h2 id=\&#34;15-配置nginx\&#34;&gt;15. 配置nginx&lt;/h2&gt;\n&lt;pre&gt;&lt;code&gt;cd /usr/local/nginx/conf\nvi nginx.conf\n\t\n\tserver{\n        listen     80;\n        server_name     localhost;\n        location /group1/M00/{\n            ngx_fastdfs_module;\n        }\n    }\n\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;重启nginx&lt;/p&gt;\n&lt;pre&gt;&lt;code&gt;/usr/local/nginx/sbin/nginx\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h2 id=\&#34;测试\&#34;&gt;测试&lt;/h2&gt;\n&lt;ol&gt;\n&lt;li&gt;引入依赖&lt;/li&gt;\n&lt;/ol&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-xml\&#34;&gt;&amp;lt;!-- 文件上传组件 --&amp;gt;\n&amp;lt;dependency&amp;gt;\n    &amp;lt;groupId&amp;gt;commons-fileupload&amp;lt;/groupId&amp;gt;\n    &amp;lt;artifactId&amp;gt;commons-fileupload&amp;lt;/artifactId&amp;gt;\n    &amp;lt;version&amp;gt;1.3.1&amp;lt;/version&amp;gt;\n&amp;lt;/dependency&amp;gt;\n&amp;lt;!--fastdfs--&amp;gt;\n&amp;lt;dependency&amp;gt;\n    &amp;lt;groupId&amp;gt;org.csource.fastdfs&amp;lt;/groupId&amp;gt;\n    &amp;lt;artifactId&amp;gt;fastdfs&amp;lt;/artifactId&amp;gt;\n    &amp;lt;version&amp;gt;1.2&amp;lt;/version&amp;gt;\n&amp;lt;/dependency&amp;gt;\n&lt;/code&gt;&lt;/pre&gt;\n&lt;ol start=\&#34;2\&#34;&gt;\n&lt;li&gt;编写配置文件&lt;pre&gt;&lt;code class=\&#34;language-xml\&#34;&gt; &amp;lt;!-- 配置多媒体解析器 --&amp;gt;\n &amp;lt;bean id=&amp;quot;multipartResolver&amp;quot; class=&amp;quot;org.springframework.web.multipart.commons.CommonsMultipartResolver&amp;quot;&amp;gt;\n \t&amp;lt;property name=&amp;quot;defaultEncoding&amp;quot; value=&amp;quot;UTF-8&amp;quot;/&amp;gt;\n \t&amp;lt;!-- 设定文件上传的最大值5MB，5*1024*1024 --&amp;gt;\n \t&amp;lt;property name=&amp;quot;maxUploadSize&amp;quot; value=&amp;quot;5242880&amp;quot;/&amp;gt;\n &amp;lt;/bean&amp;gt;\n&lt;/code&gt;&lt;/pre&gt;\n&lt;/li&gt;\n&lt;li&gt;UploadController&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt; /**\n  * 文件服务器地址\n  */\n @Value(&amp;quot;${FILE_SERVER_URL}&amp;quot;)\n private String FILE_SERVER_URL;\n\n @RequestMapping(&amp;quot;/upload&amp;quot;)\n public JdResult upload(MultipartFile file) {\n     //1、取文件的扩展名\n     String originalFilename = file.getOriginalFilename();\n     String extName = originalFilename.substring(originalFilename.lastIndexOf(&amp;quot;.&amp;quot;) + 1);\n     try {\n         //2、创建一个 FastDFS 的客户端\n         FastDFSClient dfsClient = new FastDFSClient(&amp;quot;classpath:conf/fdfs_client.conf&amp;quot;);\n         //3、执行上传处理\n         String path = dfsClient.uploadFile(file.getBytes(), extName);\n         //4、拼接返回的 url 和 ip 地址，拼装成完整的 url\n         String url = FILE_SERVER_URL + path;\n         return JdResult.ok(url);\n     } catch (Exception e) {\n         e.printStackTrace();\n         return JdResult.error(&amp;quot;文件上传失败&amp;quot;);\n     }\n }\n&lt;/code&gt;&lt;/pre&gt;\n&lt;/li&gt;\n&lt;/ol&gt;\n&#34;,&#34;fileName&#34;:&#34;FastDFS&#34;,&#34;abstract&#34;:&#34;&#34;,&#34;title&#34;:&#34;FastDFS&#34;,&#34;tags&#34;:[{&#34;name&#34;:&#34;FastDFS&#34;,&#34;slug&#34;:&#34;AowgROl25&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://haohanya.github.io/tag/AowgROl25/&#34;}],&#34;date&#34;:&#34;2020-05-04 12:09:39&#34;,&#34;dateFormat&#34;:&#34;2020-05-04&#34;,&#34;feature&#34;:&#34;&#34;,&#34;link&#34;:&#34;https://haohanya.github.io/post/FastDFS/&#34;,&#34;hideInList&#34;:false,&#34;isTop&#34;:false,&#34;stats&#34;:{&#34;text&#34;:&#34;7 min read&#34;,&#34;time&#34;:387000,&#34;words&#34;:1412,&#34;minutes&#34;:7},&#34;description&#34;:&#34;什么是FastDFS\n\nFastDFS 是用 c 语言编写的一款开源的分布式文件系统。FastDFS 为互联网量身定制，充分考虑了冗余备份、负载均衡、线性扩容等机制，并注重高可用、高性能等指标，使用 FastDFS很容易搭建一套高性能的文件...&#34;,&#34;toc&#34;:&#34;&lt;ul class=\&#34;markdownIt-TOC\&#34;&gt;\n&lt;li&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E4%BB%80%E4%B9%88%E6%98%AFfastdfs\&#34;&gt;什么是FastDFS&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%B5%81%E7%A8%8B\&#34;&gt;文件上传流程&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E6%96%87%E4%BB%B6%E4%B8%8B%E8%BD%BD%E6%B5%81%E7%A8%8B\&#34;&gt;文件下载流程&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#0-%E5%87%86%E5%A4%87%E5%AE%89%E8%A3%85%E5%8C%85%E4%B8%8A%E4%BC%A0%E5%88%B0usrlocal\&#34;&gt;0. 准备安装包上传到/usr/local/&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#1-%E5%AE%89%E8%A3%85cc%E7%BC%96%E8%AF%91%E7%8E%AF%E5%A2%83\&#34;&gt;1. 安装c/c++编译环境&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#2-%E5%AE%89%E8%A3%85libevent\&#34;&gt;2. 安装libevent&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#3-%E5%AE%89%E8%A3%85libfastcommon\&#34;&gt;3. 安装libfastcommon&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#4%E5%88%9B%E5%BB%BA%E6%95%B0%E6%8D%AE%E5%AD%98%E5%82%A8%E7%9B%AE%E5%BD%95\&#34;&gt;4.创建数据存储目录&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#5-tracker%E7%BC%96%E8%AF%91%E5%AE%89%E8%A3%85\&#34;&gt;5. tracker编译安装&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#6-%E7%BC%96%E8%BE%91etcfdfstrackerconf\&#34;&gt;6. 编辑/etc/fdfs/tracker.conf&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#7-%E5%90%AF%E5%8A%A8tracker\&#34;&gt;7. 启动tracker&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#8-%E9%85%8D%E7%BD%AEstorage%E8%8A%82%E7%82%B9\&#34;&gt;8. 配置storage节点&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#9-%E5%90%AF%E5%8A%A8storage%E8%8A%82%E7%82%B9\&#34;&gt;9. 启动storage节点&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#10-%E5%AE%89%E8%A3%85nginx\&#34;&gt;10. 安装nginx&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#11%E8%A7%A3%E5%8E%8Bfastdfs-nginx-module_v116targz\&#34;&gt;11.解压fastdfs-nginx-module_v1.16.tar.gz&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#12%E4%BF%AE%E6%94%B9fastdfs-nginx-modulesrcconfig%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6\&#34;&gt;12.修改fastdfs-nginx-module/src/config配置文件&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#13%E5%A4%8D%E5%88%B6fastdfs-nginx-modulesrcmod_fastdfsconf-%E5%88%B0etcfdfs%E7%9B%AE%E5%BD%95%E4%B8%8B%E5%B9%B6%E7%BC%96%E8%BE%91\&#34;&gt;13.复制fastdfs-nginx-module/src/mod_fastdfs.conf 到/etc/fdfs目录下并编辑&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#14%E5%AE%89%E8%A3%85nginx\&#34;&gt;14.安装nginx&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#15-%E9%85%8D%E7%BD%AEnginx\&#34;&gt;15. 配置nginx&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E6%B5%8B%E8%AF%95\&#34;&gt;测试&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;/ul&gt;\n&#34;},{&#34;content&#34;:&#34;&lt;h2 id=\&#34;1-freemarker入门\&#34;&gt;1、freemarker入门&lt;/h2&gt;\n&lt;h3 id=\&#34;1依赖核心包\&#34;&gt;1.依赖核心包&lt;/h3&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-xml\&#34;&gt;&amp;lt;!-- 依赖freemarker --&amp;gt;\n&amp;lt;dependency&amp;gt;\n\t&amp;lt;groupId&amp;gt;org.freemarker&amp;lt;/groupId&amp;gt;\n\t&amp;lt;artifactId&amp;gt;freemarker&amp;lt;/artifactId&amp;gt;\n\t&amp;lt;version&amp;gt;2.3.23&amp;lt;/version&amp;gt;\n&amp;lt;/dependency&amp;gt;\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h3 id=\&#34;2创建模板文件\&#34;&gt;2.创建模板文件&lt;/h3&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-html\&#34;&gt;&amp;lt;!DOCTYPE html&amp;gt;\n&amp;lt;html&amp;gt;\n&amp;lt;head&amp;gt;\n&amp;lt;meta charset=&amp;quot;UTF-8&amp;quot;&amp;gt;\n&amp;lt;title&amp;gt;这个是模板&amp;lt;/title&amp;gt;\n&amp;lt;/head&amp;gt;\n&amp;lt;body&amp;gt;\n\t&amp;lt;#--  这是我的注释，不会被输出 --&amp;gt;\n\thello ${name}\n&amp;lt;/body&amp;gt;\n&amp;lt;/html&amp;gt;\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h3 id=\&#34;3生成文件\&#34;&gt;3.生成文件&lt;/h3&gt;\n&lt;ul&gt;\n&lt;li&gt;第一步：创建Configuration对象（直接new，在构造方法中添加&lt;code&gt;freemarker&lt;/code&gt;的版本号）&lt;br&gt;\n第二步：设置模板所在的路径&lt;/li&gt;\n&lt;li&gt;第三步：设置模板文件的编码字符集（一般使用&lt;code&gt;utf-8&lt;/code&gt;）&lt;/li&gt;\n&lt;li&gt;第四步：加载一个模板，创建一个模板对象&lt;/li&gt;\n&lt;li&gt;第五步：创建数据模型（使用的是Map&amp;lt;String,Object&amp;gt; 还可以使用自定义的&lt;code&gt;pojo&lt;/code&gt;实际开发中都用map）&lt;/li&gt;\n&lt;li&gt;第六步：创建writer对象，一般用&lt;code&gt;FileWriter&lt;/code&gt;对象进行实例化，执行生成的文件&lt;/li&gt;\n&lt;li&gt;第七步：调用模板对象的process方法输出文件&lt;/li&gt;\n&lt;li&gt;第八步：关闭流&lt;/li&gt;\n&lt;/ul&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;public static void main(String[] args) throws Exception{\n    //1.创建配置类\n    Configuration configuration = new Configuration(Configuration.getVersion());\n    //2.设置模板所在目录\n    configuration.setDirectoryForTemplateLoading(new File(&amp;quot;F:\\\\workspace002\\\\freemarker-demo01\\\\src\\\\main\\\\resources&amp;quot;));\n    //3.设置编码集\n    configuration.setDefaultEncoding(&amp;quot;UTF-8&amp;quot;);\n    //4.加载模板\n    Template template = configuration.getTemplate(&amp;quot;hello.html&amp;quot;);\n    //5.创建数据模型\n    Map&amp;lt;String, Object&amp;gt; data = new HashMap&amp;lt;String, Object&amp;gt;();\n    data.put(&amp;quot;name&amp;quot;, &amp;quot;张三&amp;quot;);\n    //6.创建writer对象，准备用来输出文件\n    Writer out = new FileWriter(new File(&amp;quot;E:\\\\freemarker\\\\hello.html&amp;quot;));\n    //7,输出文件\n    template.process(data, out);\n    //8.关闭流\n    out.close();\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h2 id=\&#34;ftl指令\&#34;&gt;FTL指令&lt;/h2&gt;\n&lt;h3 id=\&#34;1assign\&#34;&gt;1.assign&lt;/h3&gt;\n&lt;blockquote&gt;\n&lt;p&gt;作用：用于在页面上定义一个变量&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-html\&#34;&gt;\t&amp;lt;#-- assign：用来在页面上定义一个变量 --&amp;gt;\n\t&amp;lt;#assign name=&amp;quot;张三&amp;quot;&amp;gt;\n\t获取变量：${name}\n\t&amp;lt;hr/&amp;gt;\n\t&amp;lt;#-- assign:还可以用来定义一个对象 --&amp;gt;\n\t&amp;lt;#assign info={&amp;quot;name&amp;quot;:&amp;quot;李四&amp;quot;,&amp;quot;age&amp;quot;:18,&amp;quot;hobs&amp;quot;:&amp;quot;java&amp;quot;}&amp;gt;\n\t获取到对象的属性:姓名-${info.name},年龄-${info.age},爱好-${info.hobs}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h3 id=\&#34;2include\&#34;&gt;2.include&lt;/h3&gt;\n&lt;blockquote&gt;\n&lt;p&gt;作用：此指令用于模板文件之间的相互嵌套&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-html\&#34;&gt;&amp;lt;#include &amp;quot;head.ftl&amp;quot;&amp;gt;\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h3 id=\&#34;3if\&#34;&gt;3.if&lt;/h3&gt;\n&lt;blockquote&gt;\n&lt;p&gt;作用：用于条件判断&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-html\&#34;&gt;data.put(&amp;quot;success&amp;quot;, true);\n\n&amp;lt;#if success = true&amp;gt;\n\tsuccess的值是true\n&amp;lt;#else&amp;gt;\n\tsuccess的值是false\n&amp;lt;/#if&amp;gt;\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h3 id=\&#34;4list\&#34;&gt;4.list&lt;/h3&gt;\n&lt;blockquote&gt;\n&lt;p&gt;作用：在页面中遍历集合&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-html\&#34;&gt;&amp;lt;ul&amp;gt;\n\t&amp;lt;#list mylist as user&amp;gt;\n\t\t&amp;lt;li&amp;gt;${user.name}&amp;lt;/li&amp;gt;\n\t&amp;lt;/#list&amp;gt;\n&amp;lt;/ul&amp;gt;\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h3 id=\&#34;5内建函数\&#34;&gt;5.内建函数&lt;/h3&gt;\n&lt;p&gt;&lt;code&gt;语法：变量 + ? + 函数名&lt;/code&gt;&lt;/p&gt;\n&lt;h4 id=\&#34;5-1-获取集合的大小size\&#34;&gt;5-1 获取集合的大小(size)&lt;/h4&gt;\n&lt;p&gt;&lt;code&gt;${mylist?size}&lt;/code&gt;&lt;/p&gt;\n&lt;h4 id=\&#34;5-2-转换json字符串为json对象\&#34;&gt;5-2 转换&lt;code&gt;json&lt;/code&gt;字符串为&lt;code&gt;json&lt;/code&gt;对象&lt;/h4&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-html\&#34;&gt;&amp;lt;#-- 定义一个json字符串  --&amp;gt;\n&amp;lt;#assign text=&amp;quot;{&#39;name&#39;:&#39;张三&#39;,&#39;sex&#39;:&#39;男&#39;}&amp;quot;&amp;gt;\n&amp;lt;#-- 将json字符串转换成json对象 --&amp;gt;\n&amp;lt;#assign person=text?eval&amp;gt;\n姓名：${person.name}，性别:${person.sex}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h4 id=\&#34;5-3-日期\&#34;&gt;5-3 日期&lt;/h4&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-html\&#34;&gt;年月日：${mydate?date}\n&amp;lt;br/&amp;gt;\n时分秒：${mydate?time}\n&amp;lt;br/&amp;gt;\n年月日时分秒：${mydate?datetime}\n&amp;lt;br/&amp;gt;\n自定义日期：${mydate?string(&#39;yyyy年MM月dd日  hh时mm分ss秒&#39;)}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h4 id=\&#34;5-4-数字转换成字符串\&#34;&gt;5-4 数字转换成字符串&lt;/h4&gt;\n&lt;p&gt;&lt;code&gt;${mynum?c}&lt;/code&gt;&lt;/p&gt;\n&lt;h3 id=\&#34;6空值处理\&#34;&gt;6.空值处理&lt;/h3&gt;\n&lt;h4 id=\&#34;6-1-处理方案一缺值表达式\&#34;&gt;6-1 处理方案一(缺值表达式)&lt;/h4&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-html\&#34;&gt;${mytest!&amp;quot;值为null&amp;quot;}\n&amp;lt;/br&amp;gt;\n${mytest!}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h4 id=\&#34;6-2-处理方案二\&#34;&gt;6-2 处理方案二&lt;/h4&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-html\&#34;&gt;&amp;lt;#if mytest??&amp;gt;\n\tmytest值是存在的:${mytest}\n&amp;lt;#else&amp;gt;\n\tmytest的值为null\n&amp;lt;/#if&amp;gt;\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h3 id=\&#34;7运算符\&#34;&gt;7.运算符&lt;/h3&gt;\n&lt;h4 id=\&#34;7-1-算术运算符\&#34;&gt;7-1 算术运算符&lt;/h4&gt;\n&lt;p&gt;&lt;code&gt;+ - * / %&lt;/code&gt;&lt;/p&gt;\n&lt;h4 id=\&#34;7-2-逻辑运算符\&#34;&gt;7-2 逻辑运算符&lt;/h4&gt;\n&lt;p&gt;&lt;code&gt;&amp;amp;&amp;amp; 、 || 、 !&lt;/code&gt;&lt;/p&gt;\n&lt;h4 id=\&#34;7-3-比较运算符\&#34;&gt;7-3 比较运算符&lt;/h4&gt;\n&lt;ul&gt;\n&lt;li&gt;= 或者 ==&lt;/li&gt;\n&lt;li&gt;!=&lt;/li&gt;\n&lt;li&gt;&amp;gt;  或者是 gt&lt;/li&gt;\n&lt;li&gt;&amp;lt; 或者是 lt&lt;/li&gt;\n&lt;li&gt;&amp;gt;= 或者是 gte&lt;/li&gt;\n&lt;li&gt;&amp;lt;= 或者是 lte&lt;/li&gt;\n&lt;/ul&gt;\n&#34;,&#34;fileName&#34;:&#34;freemarker&#34;,&#34;abstract&#34;:&#34;&#34;,&#34;title&#34;:&#34;freemarker&#34;,&#34;tags&#34;:[{&#34;name&#34;:&#34;freemarker&#34;,&#34;slug&#34;:&#34;pV4gj9NcU&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://haohanya.github.io/tag/pV4gj9NcU/&#34;}],&#34;date&#34;:&#34;2020-05-04 12:08:06&#34;,&#34;dateFormat&#34;:&#34;2020-05-04&#34;,&#34;feature&#34;:&#34;&#34;,&#34;link&#34;:&#34;https://haohanya.github.io/post/freemarker/&#34;,&#34;hideInList&#34;:false,&#34;isTop&#34;:false,&#34;stats&#34;:{&#34;text&#34;:&#34;4 min read&#34;,&#34;time&#34;:236000,&#34;words&#34;:853,&#34;minutes&#34;:4},&#34;description&#34;:&#34;1、freemarker入门\n1.依赖核心包\n&amp;lt;!-- 依赖freemarker --&amp;gt;\n&amp;lt;dependency&amp;gt;\n\t&amp;lt;groupId&amp;gt;org.freemarker&amp;lt;/groupId&amp;gt;\n\t&amp;l...&#34;,&#34;toc&#34;:&#34;&lt;ul class=\&#34;markdownIt-TOC\&#34;&gt;\n&lt;li&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#1-freemarker%E5%85%A5%E9%97%A8\&#34;&gt;1、freemarker入门&lt;/a&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#1%E4%BE%9D%E8%B5%96%E6%A0%B8%E5%BF%83%E5%8C%85\&#34;&gt;1.依赖核心包&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#2%E5%88%9B%E5%BB%BA%E6%A8%A1%E6%9D%BF%E6%96%87%E4%BB%B6\&#34;&gt;2.创建模板文件&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#3%E7%94%9F%E6%88%90%E6%96%87%E4%BB%B6\&#34;&gt;3.生成文件&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#ftl%E6%8C%87%E4%BB%A4\&#34;&gt;FTL指令&lt;/a&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#1assign\&#34;&gt;1.assign&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#2include\&#34;&gt;2.include&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#3if\&#34;&gt;3.if&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#4list\&#34;&gt;4.list&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#5%E5%86%85%E5%BB%BA%E5%87%BD%E6%95%B0\&#34;&gt;5.内建函数&lt;/a&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#5-1-%E8%8E%B7%E5%8F%96%E9%9B%86%E5%90%88%E7%9A%84%E5%A4%A7%E5%B0%8Fsize\&#34;&gt;5-1 获取集合的大小(size)&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#5-2-%E8%BD%AC%E6%8D%A2json%E5%AD%97%E7%AC%A6%E4%B8%B2%E4%B8%BAjson%E5%AF%B9%E8%B1%A1\&#34;&gt;5-2 转换&lt;code&gt;json&lt;/code&gt;字符串为&lt;code&gt;json&lt;/code&gt;对象&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#5-3-%E6%97%A5%E6%9C%9F\&#34;&gt;5-3 日期&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#5-4-%E6%95%B0%E5%AD%97%E8%BD%AC%E6%8D%A2%E6%88%90%E5%AD%97%E7%AC%A6%E4%B8%B2\&#34;&gt;5-4 数字转换成字符串&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#6%E7%A9%BA%E5%80%BC%E5%A4%84%E7%90%86\&#34;&gt;6.空值处理&lt;/a&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#6-1-%E5%A4%84%E7%90%86%E6%96%B9%E6%A1%88%E4%B8%80%E7%BC%BA%E5%80%BC%E8%A1%A8%E8%BE%BE%E5%BC%8F\&#34;&gt;6-1 处理方案一(缺值表达式)&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#6-2-%E5%A4%84%E7%90%86%E6%96%B9%E6%A1%88%E4%BA%8C\&#34;&gt;6-2 处理方案二&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#7%E8%BF%90%E7%AE%97%E7%AC%A6\&#34;&gt;7.运算符&lt;/a&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#7-1-%E7%AE%97%E6%9C%AF%E8%BF%90%E7%AE%97%E7%AC%A6\&#34;&gt;7-1 算术运算符&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#7-2-%E9%80%BB%E8%BE%91%E8%BF%90%E7%AE%97%E7%AC%A6\&#34;&gt;7-2 逻辑运算符&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#7-3-%E6%AF%94%E8%BE%83%E8%BF%90%E7%AE%97%E7%AC%A6\&#34;&gt;7-3 比较运算符&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;/ul&gt;\n&#34;},{&#34;content&#34;:&#34;&lt;blockquote&gt;\n&lt;p&gt;欢迎来到我的小站呀，很高兴遇见你！🤝&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;h2 id=\&#34;关于本站\&#34;&gt;🏠 关于本站&lt;/h2&gt;\n&lt;p&gt;磕磕碰碰的小破站,前不久域名的备案被注销...后换到Gridea,托管在GitHub&lt;/p&gt;\n&lt;h2 id=\&#34;博主是谁\&#34;&gt;👨‍💻 博主是谁&lt;/h2&gt;\n&lt;p&gt;一位正在努力成长的码农...&lt;/p&gt;\n&lt;h2 id=\&#34;兴趣爱好\&#34;&gt;⛹ 兴趣爱好&lt;/h2&gt;\n&lt;p&gt;吃,睡,coding&lt;/p&gt;\n&lt;h2 id=\&#34;联系我呀\&#34;&gt;📬 联系我呀&lt;/h2&gt;\n&lt;p&gt;QQ : 2369710264&lt;/p&gt;\n&#34;,&#34;fileName&#34;:&#34;about&#34;,&#34;abstract&#34;:&#34;&#34;,&#34;title&#34;:&#34;关于&#34;,&#34;tags&#34;:[],&#34;date&#34;:&#34;2019-01-25 19:09:48&#34;,&#34;dateFormat&#34;:&#34;2019-01-25&#34;,&#34;feature&#34;:&#34;&#34;,&#34;link&#34;:&#34;https://haohanya.github.io/post/about/&#34;,&#34;hideInList&#34;:true,&#34;isTop&#34;:false,&#34;stats&#34;:{&#34;text&#34;:&#34;1 min read&#34;,&#34;time&#34;:15000,&#34;words&#34;:74,&#34;minutes&#34;:1},&#34;description&#34;:&#34;\n欢迎来到我的小站呀，很高兴遇见你！🤝\n\n🏠 关于本站\n磕磕碰碰的小破站,前不久域名的备案被注销...后换到Gridea,托管在GitHub\n👨‍💻 博主是谁\n一位正在努力成长的码农...\n⛹ 兴趣爱好\n吃,睡,coding\n📬 ...&#34;,&#34;toc&#34;:&#34;&lt;ul class=\&#34;markdownIt-TOC\&#34;&gt;\n&lt;li&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E5%85%B3%E4%BA%8E%E6%9C%AC%E7%AB%99\&#34;&gt;🏠 关于本站&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E5%8D%9A%E4%B8%BB%E6%98%AF%E8%B0%81\&#34;&gt;👨‍💻 博主是谁&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E5%85%B4%E8%B6%A3%E7%88%B1%E5%A5%BD\&#34;&gt;⛹ 兴趣爱好&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E8%81%94%E7%B3%BB%E6%88%91%E5%91%80\&#34;&gt;📬 联系我呀&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;/ul&gt;\n&#34;},{&#34;content&#34;:&#34;&lt;p&gt;又是一个新的开始！！！&lt;/p&gt;\n&lt;!-- more --&gt;\n&lt;p&gt;基于GitHub Pages + Gridea&lt;/p&gt;\n&#34;,&#34;fileName&#34;:&#34;hello&#34;,&#34;abstract&#34;:&#34;&lt;p&gt;又是一个新的开始！！！&lt;/p&gt;\n&#34;,&#34;title&#34;:&#34;Hello&#34;,&#34;tags&#34;:[{&#34;name&#34;:&#34;Gridea&#34;,&#34;slug&#34;:&#34;xi3C-nNGB&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://haohanya.github.io/tag/xi3C-nNGB/&#34;}],&#34;date&#34;:&#34;2018-12-12 00:00:00&#34;,&#34;dateFormat&#34;:&#34;2018-12-12&#34;,&#34;feature&#34;:&#34;https://haohanya.github.io/post-images/hello.png&#34;,&#34;link&#34;:&#34;https://haohanya.github.io/post/hello/&#34;,&#34;hideInList&#34;:false,&#34;isTop&#34;:true,&#34;stats&#34;:{&#34;text&#34;:&#34;1 min read&#34;,&#34;time&#34;:3000,&#34;words&#34;:13,&#34;minutes&#34;:1},&#34;description&#34;:&#34;又是一个新的开始！！！\n\n基于GitHub Pages + Gridea\n&#34;,&#34;toc&#34;:&#34;&#34;}]";
  // var json = escape.substr(1, escape.length - 2);
  // var datas = json.split(',');
  // for (let i=0; i < datas.length; i++) {
  //   let item = datas[i];
  //   let attrs = item.split('34;:&#34')
  //   debugger
  //   console.log(datas[i])
  // }
  let escapeMap = new Map();
  escapeMap.set('&#34;', '"');
  escapeMap.set('&gt;', '>');
  escapeMap.set('&#39;', "'");
  escapeMap.set('&lt;', '<');
  escapeMap.set('&quot;', '"');
  escapeMap.set('&amp;', '&');
</script> -->


<script src=" /media/js/cool.js"></script>


</html>